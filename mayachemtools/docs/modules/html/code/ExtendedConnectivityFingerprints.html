<html>
<head>
<title>MayaChemTools:Code:Fingerprints::ExtendedConnectivityFingerprints.pm</title>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<link rel="stylesheet" type="text/css" href="../../../css/MayaChemToolsCode.css">
</head>
<body leftmargin="20" rightmargin="20" topmargin="10" bottommargin="10">
<br/>
<center>
<a href="http://www.mayachemtools.org" title="MayaChemTools Home"><img src="../../../images/MayaChemToolsLogo.gif" border="0" alt="MayaChemTools"></a>
</center>
<br/>
<pre>
<a name="package-Fingerprints::ExtendedConnectivityFingerprints-"></a>   1 <span class="k">package </span><span class="i">Fingerprints::ExtendedConnectivityFingerprints</span><span class="sc">;</span>
   2 <span class="c">#</span>
   3 <span class="c"># $RCSfile: ExtendedConnectivityFingerprints.pm,v $</span>
   4 <span class="c"># $Date: 2017/01/12 18:59:24 $</span>
   5 <span class="c"># $Revision: 1.41 $</span>
   6 <span class="c">#</span>
   7 <span class="c"># Author: Manish Sud &lt;msud@san.rr.com&gt;</span>
   8 <span class="c">#</span>
   9 <span class="c"># Copyright (C) 2017 Manish Sud. All rights reserved.</span>
  10 <span class="c">#</span>
  11 <span class="c"># This file is part of MayaChemTools.</span>
  12 <span class="c">#</span>
  13 <span class="c"># MayaChemTools is free software; you can redistribute it and/or modify it under</span>
  14 <span class="c"># the terms of the GNU Lesser General Public License as published by the Free</span>
  15 <span class="c"># Software Foundation; either version 3 of the License, or (at your option) any</span>
  16 <span class="c"># later version.</span>
  17 <span class="c">#</span>
  18 <span class="c"># MayaChemTools is distributed in the hope that it will be useful, but without</span>
  19 <span class="c"># any warranty; without even the implied warranty of merchantability of fitness</span>
  20 <span class="c"># for a particular purpose.  See the GNU Lesser General Public License for more</span>
  21 <span class="c"># details.</span>
  22 <span class="c">#</span>
  23 <span class="c"># You should have received a copy of the GNU Lesser General Public License</span>
  24 <span class="c"># along with MayaChemTools; if not, see &lt;http://www.gnu.org/licenses/&gt; or</span>
  25 <span class="c"># write to the Free Software Foundation Inc., 59 Temple Place, Suite 330,</span>
  26 <span class="c"># Boston, MA, 02111-1307, USA.</span>
  27 <span class="c">#</span>
  28 
  29 <span class="k">use</span> <span class="w">strict</span><span class="sc">;</span>
  30 <span class="k">use</span> <span class="w">Carp</span><span class="sc">;</span>
  31 <span class="k">use</span> <span class="w">Exporter</span><span class="sc">;</span>
  32 <span class="k">use</span> <span class="w">TextUtil</span> <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  33 <span class="k">use</span> <span class="w">MathUtil</span> <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  34 <span class="k">use</span> <span class="w">Fingerprints::Fingerprints</span><span class="sc">;</span>
  35 <span class="k">use</span> <span class="w">Molecule</span><span class="sc">;</span>
  36 <span class="k">use</span> <span class="w">AtomTypes::AtomicInvariantsAtomTypes</span><span class="sc">;</span>
  37 <span class="k">use</span> <span class="w">AtomTypes::FunctionalClassAtomTypes</span><span class="sc">;</span>
  38 <span class="k">use</span> <span class="w">AtomTypes::DREIDINGAtomTypes</span><span class="sc">;</span>
  39 <span class="k">use</span> <span class="w">AtomTypes::EStateAtomTypes</span><span class="sc">;</span>
  40 <span class="k">use</span> <span class="w">AtomTypes::MMFF94AtomTypes</span><span class="sc">;</span>
  41 <span class="k">use</span> <span class="w">AtomTypes::SLogPAtomTypes</span><span class="sc">;</span>
  42 <span class="k">use</span> <span class="w">AtomTypes::SYBYLAtomTypes</span><span class="sc">;</span>
  43 <span class="k">use</span> <span class="w">AtomTypes::TPSAAtomTypes</span><span class="sc">;</span>
  44 <span class="k">use</span> <span class="w">AtomTypes::UFFAtomTypes</span><span class="sc">;</span>
  45 
  46 <span class="k">use</span> <span class="w">vars</span> <span class="q">qw(@ISA @EXPORT @EXPORT_OK %EXPORT_TAGS)</span><span class="sc">;</span>
  47 
  48 <span class="i">@ISA</span> = <span class="q">qw(Fingerprints::Fingerprints Exporter)</span><span class="sc">;</span>
  49 <span class="i">@EXPORT</span> = <span class="q">qw()</span><span class="sc">;</span>
  50 <span class="i">@EXPORT_OK</span> = <span class="q">qw()</span><span class="sc">;</span>
  51 
  52 <span class="i">%EXPORT_TAGS</span> = <span class="s">(</span><span class="w">all</span>  <span class="cm">=&gt;</span> <span class="s">[</span><span class="i">@EXPORT</span><span class="cm">,</span> <span class="i">@EXPORT_OK</span><span class="s">]</span><span class="s">)</span><span class="sc">;</span>
  53 
  54 <span class="c"># Setup class variables...</span>
  55 <span class="k">my</span><span class="s">(</span><span class="i">$ClassName</span><span class="s">)</span><span class="sc">;</span>
  56 <span class="i">_InitializeClass</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  57 
  58 <span class="c"># Overload Perl functions...</span>
  59 <span class="k">use</span> <span class="w">overload</span> <span class="q">&#39;&quot;&quot;&#39;</span> <span class="cm">=&gt;</span> <span class="q">&#39;StringifyExtendedConnectivityFingerprints&#39;</span><span class="sc">;</span>
  60 
  61 <span class="c"># Class constructor...</span>
<a name="new-"></a>  62 <span class="k">sub </span><span class="m">new</span> <span class="s">{</span>
  63   <span class="k">my</span><span class="s">(</span><span class="i">$Class</span><span class="cm">,</span> <span class="i">%NamesAndValues</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
  64 
  65   <span class="c"># Initialize object...</span>
  66   <span class="k">my</span> <span class="i">$This</span> = <span class="i">$Class</span><span class="i">-&gt;SUPER::new</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  67   <span class="k">bless</span> <span class="i">$This</span><span class="cm">,</span> <span class="k">ref</span><span class="s">(</span><span class="i">$Class</span><span class="s">)</span> || <span class="i">$Class</span><span class="sc">;</span>
  68   <span class="i">$This</span><span class="i">-&gt;_InitializeExtendedConnectivityFingerprints</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  69 
  70   <span class="i">$This</span><span class="i">-&gt;_InitializeExtendedConnectivityFingerprintsProperties</span><span class="s">(</span><span class="i">%NamesAndValues</span><span class="s">)</span><span class="sc">;</span>
  71 
  72   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
  73 <span class="s">}</span>
  74 
  75 <span class="c"># Initialize object data...</span>
  76 <span class="c">#</span>
<a name="_InitializeExtendedConnectivityFingerprints-"></a>  77 <span class="k">sub </span><span class="m">_InitializeExtendedConnectivityFingerprints</span> <span class="s">{</span>
  78   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
  79 
  80   <span class="c"># Type of fingerprint to generate:</span>
  81   <span class="c">#</span>
  82   <span class="c"># ExtendedConnectivity - Set of integer identifiers corresponding to structurally unique features</span>
  83   <span class="c"># ExtendedConnectivityCount - Set of integer identifiers corresponding to structurally unique features and their count</span>
  84   <span class="c"># ExtendedConnectivityBits - A bit vector indicating presence/absence of structurally unique features</span>
  85   <span class="c">#</span>
  86   <span class="i">$This</span>-&gt;{<span class="w">Type</span>} = <span class="q">&#39;ExtendedConnectivity&#39;</span><span class="sc">;</span>
  87 
  88   <span class="c"># Atomic neighborhoods radius for extended connectivity...</span>
  89   <span class="i">$This</span>-&gt;{<span class="w">NeighborhoodRadius</span>} = <span class="n">2</span><span class="sc">;</span>
  90 
  91   <span class="c"># Size of bit bector to use during generation of ExtendedConnectivityBits fingerprints...</span>
  92   <span class="i">$This</span>-&gt;{<span class="w">Size</span>} = <span class="n">1024</span><span class="sc">;</span>
  93 
  94   <span class="c"># Min and max size of bit bector to use during generation of ExtendedConnectivityBits fingerprints...</span>
  95   <span class="i">$This</span>-&gt;{<span class="w">MinSize</span>} = <span class="n">32</span><span class="sc">;</span>
  96   <span class="i">$This</span>-&gt;{<span class="w">MaxSize</span>} = <span class="n">2</span>**<span class="n">32</span><span class="sc">;</span>
  97 
  98   <span class="c"># Type of atom attributes to use for initial identifier assignment to non-hydrogen atoms</span>
  99   <span class="c"># during the calculation of extended connectivity fingerprints [ Ref 48, Ref 52 ]...</span>
 100   <span class="c">#</span>
 101   <span class="c"># Currently supported values are: AtomicInvariantsAtomTypes, FunctionalClassAtomTypes,</span>
 102   <span class="c"># DREIDINGAtomTypes, EStateAtomTypes, MMFF94AtomTypes, SLogPAtomTypes, SYBYLAtomTypes,</span>
 103   <span class="c"># TPSAAtomTypes, UFFAtomTypes</span>
 104   <span class="c">#</span>
 105   <span class="i">$This</span>-&gt;{<span class="w">AtomIdentifierType</span>} = <span class="q">&#39;&#39;</span><span class="sc">;</span>
 106 
 107   <span class="c"># Random number generator to use during generation of fingerprints bit-vector</span>
 108   <span class="c"># string: Perl CORE::rand or MayaChemTools MathUtil::random function.</span>
 109   <span class="c">#</span>
 110   <span class="c"># The random number generator implemented in MayaChemTools is a variant of</span>
 111   <span class="c"># linear congruential generator (LCG) as described by Miller et al. [ Ref 120 ].</span>
 112   <span class="c"># It is also referred to as Lehmer random number generator or Park-Miller</span>
 113   <span class="c"># random number generator.</span>
 114   <span class="c">#</span>
 115   <span class="c"># Unlike Perl&#39;s core random number generator function rand, the random number</span>
 116   <span class="c"># generator implemented in MayaChemTools, MathUtil::random,  generates consistent</span>
 117   <span class="c"># random values across different platformsfor a specific random seed and leads</span>
 118   <span class="c"># to generation of portable fingerprints bit-vector strings.</span>
 119   <span class="c">#</span>
 120   <span class="i">$This</span>-&gt;{<span class="w">UsePerlCoreRandom</span>} = <span class="n">1</span><span class="sc">;</span>
 121 
 122   <span class="c"># Atom neighorhoods up to specified neighborhood radius...</span>
 123   <span class="i">%</span>{<span class="i">$This</span>-&gt;{<span class="w">AtomNeighborhoods</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 124 
 125   <span class="c"># Atom identifiers at different neighborhoods up to specified neighborhood radius...</span>
 126   <span class="i">%</span>{<span class="i">$This</span>-&gt;{<span class="w">AtomIdentifiers</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 127 
 128   <span class="c"># Structurally unique atom identifiers at different neighborhoods up to specified neighborhood radius...</span>
 129   <span class="i">%</span>{<span class="i">$This</span>-&gt;{<span class="w">UniqueAtomIdentifiers</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 130   <span class="i">%</span>{<span class="i">$This</span>-&gt;{<span class="w">UniqueAtomIdentifiersCount</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 131 
 132   <span class="c"># Unique atom identifiers at different neighborhoods up to specified neighborhood radius...</span>
 133   <span class="i">%</span>{<span class="i">$This</span>-&gt;{<span class="w">StructurallyUniqueAtomIdentifiers</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 134   <span class="i">%</span>{<span class="i">$This</span>-&gt;{<span class="w">StructurallyUniqueAtomIdentifiersCount</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 135 
 136   <span class="c"># Structure feature  information at different neighborhoods up to specified neighborhood</span>
 137   <span class="c"># radius used during removal of atom indentifiers which are structually equivalent...</span>
 138   <span class="i">%</span>{<span class="i">$This</span>-&gt;{<span class="w">StructureFeatures</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 139 <span class="s">}</span>
 140 
 141 <span class="c"># Initialize class ...</span>
<a name="_InitializeClass-"></a> 142 <span class="k">sub </span><span class="m">_InitializeClass</span> <span class="s">{</span>
 143   <span class="c">#Class name...</span>
 144   <span class="i">$ClassName</span> = <span class="w">__PACKAGE__</span><span class="sc">;</span>
 145 <span class="s">}</span>
 146 
 147 <span class="c"># Initialize object properties....</span>
<a name="_InitializeExtendedConnectivityFingerprintsProperties-"></a> 148 <span class="k">sub </span><span class="m">_InitializeExtendedConnectivityFingerprintsProperties</span> <span class="s">{</span>
 149   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">%NamesAndValues</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 150 
 151   <span class="k">my</span><span class="s">(</span><span class="i">$Name</span><span class="cm">,</span> <span class="i">$Value</span><span class="cm">,</span> <span class="i">$MethodName</span><span class="s">)</span><span class="sc">;</span>
 152   <span class="k">while</span> <span class="s">(</span><span class="s">(</span><span class="i">$Name</span><span class="cm">,</span> <span class="i">$Value</span><span class="s">)</span> = <span class="k">each</span>  <span class="i">%NamesAndValues</span><span class="s">)</span> <span class="s">{</span>
 153     <span class="i">$MethodName</span> = <span class="q">&quot;Set${Name}&quot;</span><span class="sc">;</span>
 154     <span class="i">$This</span><span class="i">-&gt;$MethodName</span><span class="s">(</span><span class="i">$Value</span><span class="s">)</span><span class="sc">;</span>
 155   <span class="s">}</span>
 156 
 157   <span class="c"># Make sure molecule object was specified...</span>
 158   <span class="k">if</span> <span class="s">(</span>!<span class="k">exists</span> <span class="i">$NamesAndValues</span>{<span class="w">Molecule</span>}<span class="s">)</span> <span class="s">{</span>
 159     <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;New: Object can&#39;t be instantiated without specifying molecule...&quot;</span><span class="sc">;</span>
 160   <span class="s">}</span>
 161 
 162   <span class="c"># Make sure AtomIdentifierType was specified...</span>
 163   <span class="k">if</span> <span class="s">(</span>!<span class="k">exists</span> <span class="i">$NamesAndValues</span>{<span class="w">AtomIdentifierType</span>}<span class="s">)</span> <span class="s">{</span>
 164     <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;New: Object can&#39;t be instantiated without specifying AtomIdentifierType...&quot;</span><span class="sc">;</span>
 165   <span class="s">}</span>
 166 
 167   <span class="c"># Make sure it&#39;s power of 2...</span>
 168   <span class="k">if</span> <span class="s">(</span><span class="k">exists</span> <span class="i">$NamesAndValues</span>{<span class="w">Size</span>}<span class="s">)</span> <span class="s">{</span>
 169     <span class="k">if</span> <span class="s">(</span>!<span class="i">TextUtil::IsNumberPowerOfNumber</span><span class="s">(</span><span class="i">$NamesAndValues</span>{<span class="w">Size</span>}<span class="cm">,</span> <span class="n">2</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 170       <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;New: Specified size value, $NamesAndValues{Size}, must be power of 2...&quot;</span><span class="sc">;</span>
 171     <span class="s">}</span>
 172   <span class="s">}</span>
 173 
 174   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">Type</span>} =~ <span class="q">/^ExtendedConnectivity$/i</span><span class="s">)</span> <span class="s">{</span>
 175     <span class="i">$This</span><span class="i">-&gt;_InitializeExtendedConnectivityFingerprintsVector</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 176   <span class="s">}</span>
 177   <span class="k">elsif</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">Type</span>} =~ <span class="q">/^ExtendedConnectivityCount$/i</span><span class="s">)</span> <span class="s">{</span>
 178     <span class="i">$This</span><span class="i">-&gt;_InitializeExtendedConnectivityCountFingerprintsVector</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 179   <span class="s">}</span>
 180   <span class="k">elsif</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">Type</span>} =~ <span class="q">/^ExtendedConnectivityBits$/i</span><span class="s">)</span> <span class="s">{</span>
 181     <span class="i">$This</span><span class="i">-&gt;_InitializeExtendedConnectivityBitsFingerprintsBitVector</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 182   <span class="s">}</span>
 183   <span class="k">else</span> <span class="s">{</span>
 184     <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;_InitializeExtendedConnectivityFingerprintsProperties: Unknown ExtendedConnectivity fingerprints type: $This-&gt;{Type}; Supported fingerprints types: ExtendedConnectivity, ExtendedConnectivityCount or ExtendedConnectivityBits...&quot;</span><span class="sc">;</span>
 185   <span class="s">}</span>
 186 
 187   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 188 <span class="s">}</span>
 189 
 190 <span class="c"># Initialize extended connectivity fingerprints vector...</span>
 191 <span class="c">#</span>
<a name="_InitializeExtendedConnectivityFingerprintsVector-"></a> 192 <span class="k">sub </span><span class="m">_InitializeExtendedConnectivityFingerprintsVector</span> <span class="s">{</span>
 193   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 194 
 195   <span class="c"># Type of vector...</span>
 196   <span class="i">$This</span>-&gt;{<span class="w">VectorType</span>} = <span class="q">&#39;FingerprintsVector&#39;</span><span class="sc">;</span>
 197 
 198   <span class="c"># Type of FingerprintsVector...</span>
 199   <span class="i">$This</span>-&gt;{<span class="w">FingerprintsVectorType</span>} = <span class="q">&#39;AlphaNumericalValues&#39;</span><span class="sc">;</span>
 200 
 201   <span class="i">$This</span><span class="i">-&gt;_InitializeFingerprintsVector</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 202 
 203   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 204 <span class="s">}</span>
 205 
 206 <span class="c"># Initialize extended connectivity count fingerprints vector...</span>
 207 <span class="c">#</span>
<a name="_InitializeExtendedConnectivityCountFingerprintsVector-"></a> 208 <span class="k">sub </span><span class="m">_InitializeExtendedConnectivityCountFingerprintsVector</span> <span class="s">{</span>
 209   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 210 
 211   <span class="c"># Type of vector...</span>
 212   <span class="i">$This</span>-&gt;{<span class="w">VectorType</span>} = <span class="q">&#39;FingerprintsVector&#39;</span><span class="sc">;</span>
 213 
 214   <span class="c"># Type of FingerprintsVector...</span>
 215   <span class="i">$This</span>-&gt;{<span class="w">FingerprintsVectorType</span>} = <span class="q">&#39;NumericalValues&#39;</span><span class="sc">;</span>
 216 
 217   <span class="i">$This</span><span class="i">-&gt;_InitializeFingerprintsVector</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 218 
 219   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 220 <span class="s">}</span>
 221 
 222 <span class="c"># Initialize extended connectivity bit fingerprints vector...</span>
 223 <span class="c">#</span>
<a name="_InitializeExtendedConnectivityBitsFingerprintsBitVector-"></a> 224 <span class="k">sub </span><span class="m">_InitializeExtendedConnectivityBitsFingerprintsBitVector</span> <span class="s">{</span>
 225   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 226 
 227   <span class="c"># Type of vector...</span>
 228   <span class="i">$This</span>-&gt;{<span class="w">VectorType</span>} = <span class="q">&#39;FingerprintsBitVector&#39;</span><span class="sc">;</span>
 229 
 230   <span class="i">$This</span><span class="i">-&gt;_InitializeFingerprintsBitVector</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 231 
 232   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 233 <span class="s">}</span>
 234 
 235 <span class="c"># Set type...</span>
 236 <span class="c">#</span>
<a name="SetType-"></a> 237 <span class="k">sub </span><span class="m">SetType</span> <span class="s">{</span>
 238   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Type</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 239 
 240   <span class="k">if</span> <span class="s">(</span><span class="i">$Type</span> =~ <span class="q">/^ExtendedConnectivity$/i</span><span class="s">)</span> <span class="s">{</span>
 241     <span class="i">$This</span>-&gt;{<span class="w">Type</span>} = <span class="q">&#39;ExtendedConnectivity&#39;</span><span class="sc">;</span><span class="sc">;</span>
 242   <span class="s">}</span>
 243   <span class="k">elsif</span> <span class="s">(</span><span class="i">$Type</span> =~ <span class="q">/^ExtendedConnectivityCount$/i</span><span class="s">)</span> <span class="s">{</span>
 244     <span class="i">$This</span>-&gt;{<span class="w">Type</span>} = <span class="q">&#39;ExtendedConnectivityCount&#39;</span><span class="sc">;</span><span class="sc">;</span>
 245   <span class="s">}</span>
 246   <span class="k">elsif</span> <span class="s">(</span><span class="i">$Type</span> =~ <span class="q">/^ExtendedConnectivityBits$/i</span><span class="s">)</span> <span class="s">{</span>
 247     <span class="i">$This</span>-&gt;{<span class="w">Type</span>} = <span class="q">&#39;ExtendedConnectivityBits&#39;</span><span class="sc">;</span><span class="sc">;</span>
 248   <span class="s">}</span>
 249   <span class="k">else</span> <span class="s">{</span>
 250     <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;SetType: Unknown ExtendedConnectivity fingerprints type: $This-&gt;{Type}; Supported fingerprints types: ExtendedConnectivity, ExtendedConnectivityCount or ExtendedConnectivityBits...&quot;</span><span class="sc">;</span>
 251   <span class="s">}</span>
 252   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 253 <span class="s">}</span>
 254 
 255 <span class="c"># Disable vector type change...</span>
 256 <span class="c">#</span>
<a name="SetVectorType-"></a> 257 <span class="k">sub </span><span class="m">SetVectorType</span> <span class="s">{</span>
 258   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Type</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 259 
 260   <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;SetVectorType: Can&#39;t change vector type...&quot;</span><span class="sc">;</span>
 261 
 262   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 263 <span class="s">}</span>
 264 
 265 <span class="c"># Disable vector type change...</span>
 266 <span class="c">#</span>
<a name="SetFingerprintsVectorType-"></a> 267 <span class="k">sub </span><span class="m">SetFingerprintsVectorType</span> <span class="s">{</span>
 268   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Type</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 269 
 270   <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;SetFingerprintsVectorType: Can&#39;t change fingerprints vector type...&quot;</span><span class="sc">;</span>
 271 
 272   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 273 <span class="s">}</span>
 274 
 275 <span class="c"># Set intial atom identifier type..</span>
 276 <span class="c">#</span>
<a name="SetAtomIdentifierType-"></a> 277 <span class="k">sub </span><span class="m">SetAtomIdentifierType</span> <span class="s">{</span>
 278   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$IdentifierType</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 279 
 280   <span class="k">if</span> <span class="s">(</span><span class="i">$IdentifierType</span> !~ <span class="q">/^(AtomicInvariantsAtomTypes|FunctionalClassAtomTypes|DREIDINGAtomTypes|EStateAtomTypes|MMFF94AtomTypes|SLogPAtomTypes|SYBYLAtomTypes|TPSAAtomTypes|UFFAtomTypes)$/i</span><span class="s">)</span> <span class="s">{</span>
 281     <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;SetAtomIdentifierType: Specified value, $IdentifierType, for AtomIdentifierType is not vaild. Supported types in current release of MayaChemTools: AtomicInvariantsAtomTypes, FunctionalClassAtomTypes, DREIDINGAtomTypes, EStateAtomTypes, MMFF94AtomTypes, SLogPAtomTypes, SYBYLAtomTypes, TPSAAtomTypes and UFFAtomTypes.&quot;</span><span class="sc">;</span>
 282   <span class="s">}</span>
 283 
 284   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomIdentifierType</span>}<span class="s">)</span> <span class="s">{</span>
 285     <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;SetAtomIdentifierType: Can&#39;t change intial atom identifier type:  It&#39;s already set...&quot;</span><span class="sc">;</span>
 286   <span class="s">}</span>
 287 
 288   <span class="i">$This</span>-&gt;{<span class="w">AtomIdentifierType</span>} = <span class="i">$IdentifierType</span><span class="sc">;</span>
 289 
 290   <span class="c"># Initialize identifier type information...</span>
 291   <span class="i">$This</span><span class="i">-&gt;_InitializeAtomIdentifierTypeInformation</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 292 
 293   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 294 <span class="s">}</span>
 295 
 296 <span class="c"># Set atom neighborhood radius...</span>
 297 <span class="c">#</span>
<a name="SetNeighborhoodRadius-"></a> 298 <span class="k">sub </span><span class="m">SetNeighborhoodRadius</span> <span class="s">{</span>
 299   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Value</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 300 
 301   <span class="k">if</span> <span class="s">(</span>!<span class="i">TextUtil::IsInteger</span><span class="s">(</span><span class="i">$Value</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 302     <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;SetNeighborhoodRadius: NeighborhoodRadius value, $Value, is not valid:  It must be an  integer...&quot;</span><span class="sc">;</span>
 303   <span class="s">}</span>
 304 
 305   <span class="k">if</span> <span class="s">(</span><span class="i">$Value</span> &lt; <span class="n">0</span> <span class="s">)</span> <span class="s">{</span>
 306     <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;SetNeighborhoodRadius: NeighborhoodRadius value, $Value, is not valid:  It must be &gt;= 0...&quot;</span><span class="sc">;</span>
 307   <span class="s">}</span>
 308   <span class="i">$This</span>-&gt;{<span class="w">NeighborhoodRadius</span>} = <span class="i">$Value</span><span class="sc">;</span>
 309 
 310   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 311 <span class="s">}</span>
 312 
 313 <span class="c"># Generate fingerprints description...</span>
 314 <span class="c">#</span>
<a name="GetDescription-"></a> 315 <span class="k">sub </span><span class="m">GetDescription</span> <span class="s">{</span>
 316   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 317 
 318   <span class="c"># Is description explicity set?</span>
 319   <span class="k">if</span> <span class="s">(</span><span class="k">exists</span> <span class="i">$This</span>-&gt;{<span class="w">Description</span>}<span class="s">)</span> <span class="s">{</span>
 320     <span class="k">return</span> <span class="i">$This</span>-&gt;{<span class="w">Description</span>}<span class="sc">;</span>
 321   <span class="s">}</span>
 322 
 323   <span class="c"># Generate fingerprints description...</span>
 324 
 325   <span class="k">return</span> <span class="q">&quot;$This-&gt;{Type}:$This-&gt;{AtomIdentifierType}:Radius$This-&gt;{NeighborhoodRadius}&quot;</span><span class="sc">;</span>
 326 <span class="s">}</span>
 327 
 328 <span class="c"># Generate fingerprints...</span>
 329 <span class="c">#</span>
 330 <span class="c"># Methodology:</span>
 331 <span class="c">#   . Assign initial atom identfiers to all non-hydrogen atoms in the molecule</span>
 332 <span class="c">#</span>
 333 <span class="c">#   . Remove duplicates from the initial identifiers and add them to list corresponding</span>
 334 <span class="c">#     to molecule fingerprint</span>
 335 <span class="c">#</span>
 336 <span class="c">#   . For NeighborhoodRadius value of 0, just return the molecule fingerprint list</span>
 337 <span class="c">#</span>
 338 <span class="c">#   . For each NeighborhoodRadius level</span>
 339 <span class="c">#      . For each non-hydrogen CentralAtom at this NeighborhoodRadius level</span>
 340 <span class="c">#         . For each non-hydrogen SuccessorNeighborAtom</span>
 341 <span class="c">#           . Collect (BondOrder AtomIdentifier) pair of values corresponding to</span>
 342 <span class="c">#             (CentralAtom SuccessorNeighborAtom)  and add it to a list</span>
 343 <span class="c">#</span>
 344 <span class="c">#         . Sort list containing (BondOrder AtomIdentifier) pairs first by BondOrder followed</span>
 345 <span class="c">#            by AtomIdendifiers to make these values graph invariant</span>
 346 <span class="c">#         . Generate a hash code for the values in the list</span>
 347 <span class="c">#         . Assign hash code as new atom identifier at the current NeighborhoodRadius level</span>
 348 <span class="c">#         . Save all atoms and bonds corresponding to the substructure involved in</span>
 349 <span class="c">#           generating the hash code to be used for identifying structural duplicate hash code</span>
 350 <span class="c">#</span>
 351 <span class="c">#         . Add the new identifier to the molecule fingerprint list making sure it&#39;s not a duplicate</span>
 352 <span class="c">#           identifier</span>
 353 <span class="c">#</span>
 354 <span class="c">#   Hash code atom identifier deduplication:</span>
 355 <span class="c">#     . Track/remove the identifier generated at higher neighborhood radius level</span>
 356 <span class="c">#</span>
 357 <span class="c">#  Structural atom identifier deduplication:</span>
 358 <span class="c">#    . For equivalent atoms and bonds corresponding to substructure at a NeighborhoodRadius level,</span>
 359 <span class="c">#      track/remove the atom identifier with largest value</span>
 360 <span class="c">#</span>
 361 <span class="c">#</span>
<a name="GenerateFingerprints-"></a> 362 <span class="k">sub </span><span class="m">GenerateFingerprints</span> <span class="s">{</span>
 363   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 364 
 365   <span class="c"># Cache appropriate molecule data...</span>
 366   <span class="i">$This</span><span class="i">-&gt;_SetupMoleculeDataCache</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 367 
 368   <span class="c"># Assign intial atom identifers...</span>
 369   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;_AssignInitialAtomIdentifiers</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 370     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;GenerateFingerprints: $This-&gt;{AtomIdentifierType} fingerprints generation didn&#39;t succeed: Couldn&#39;t assign valid $This-&gt;{AtomIdentifierType} to all atoms...&quot;</span><span class="sc">;</span>
 371     <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 372   <span class="s">}</span>
 373 
 374   <span class="c"># Identify atom neighborhoods up to specified radius...</span>
 375   <span class="i">$This</span><span class="i">-&gt;_GetAtomNeighborhoods</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 376 
 377   <span class="c"># Assign atom identifiers to central atoms considering atom neighborhoods at each</span>
 378   <span class="c"># radius level...</span>
 379   <span class="i">$This</span><span class="i">-&gt;_AssignAtomIdentifiersToAtomNeighborhoods</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 380 
 381   <span class="c"># Remove duplicates identifiers...</span>
 382   <span class="i">$This</span><span class="i">-&gt;_RemoveDuplicateAtomIdentifiers</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 383 
 384   <span class="c"># Set final fingerprints...</span>
 385   <span class="i">$This</span><span class="i">-&gt;_SetFinalFingerprints</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 386 
 387   <span class="c"># Clear cached molecule data...</span>
 388   <span class="i">$This</span><span class="i">-&gt;_ClearMoleculeDataCache</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 389 
 390   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 391 <span class="s">}</span>
 392 
 393 <span class="c"># Assign appropriate initial atom identifiers...</span>
 394 <span class="c">#</span>
 395 <span class="c">#   Generation of initial identifier for a specific atom involves:</span>
 396 <span class="c">#     . Values of the specified atom attributes are appended in a specific order to</span>
 397 <span class="c">#       generate an initial atom identifier string</span>
 398 <span class="c">#     . A 32 bit unsigned integer hash key, using TextUtil::HashCode function,  is</span>
 399 <span class="c">#       generated for the atom indentifier and assigned to the atom as initial</span>
 400 <span class="c">#       atom identifier.</span>
 401 <span class="c">#</span>
<a name="_AssignInitialAtomIdentifiers-"></a> 402 <span class="k">sub </span><span class="m">_AssignInitialAtomIdentifiers</span> <span class="s">{</span>
 403   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 404   <span class="k">my</span><span class="s">(</span><span class="i">$Atom</span><span class="cm">,</span> <span class="i">$AtomID</span><span class="cm">,</span> <span class="i">$Radius</span><span class="cm">,</span> <span class="i">$SpecifiedAtomTypes</span><span class="cm">,</span> <span class="i">$IgnoreHydrogens</span><span class="cm">,</span> <span class="i">$AtomType</span><span class="cm">,</span> <span class="i">$InitialAtomTypeString</span><span class="cm">,</span> <span class="i">$InitialAtomIdentifier</span><span class="s">)</span><span class="sc">;</span>
 405 
 406   <span class="c"># Initialize atom identifiers...</span>
 407   <span class="i">$This</span><span class="i">-&gt;_InitializeAtomIdentifiers</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 408 
 409   <span class="c"># Set up atom types...</span>
 410   <span class="i">$IgnoreHydrogens</span> = <span class="n">1</span><span class="sc">;</span>
 411   <span class="i">$SpecifiedAtomTypes</span> = <span class="k">undef</span><span class="sc">;</span>
 412 
 413   <span class="j">IDENTIFIERTYPE:</span> <span class="s">{</span>
 414     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomIdentifierType</span>} =~ <span class="q">/^AtomicInvariantsAtomTypes$/i</span><span class="s">)</span> <span class="s">{</span>
 415       <span class="i">$SpecifiedAtomTypes</span> = <span class="i">new</span> <span class="i">AtomTypes::AtomicInvariantsAtomTypes</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span> <span class="cm">=&gt;</span> <span class="i">$This</span>-&gt;{<span class="w">Molecule</span>}<span class="cm">,</span> <span class="q">&#39;IgnoreHydrogens&#39;</span> <span class="cm">=&gt;</span> <span class="i">$IgnoreHydrogens</span><span class="cm">,</span> <span class="q">&#39;AtomicInvariantsToUse&#39;</span> <span class="cm">=&gt;</span> <span class="i">$This</span>-&gt;{<span class="w">AtomicInvariantsToUse</span>}<span class="s">)</span><span class="sc">;</span>
 416       <span class="k">last</span> <span class="j">IDENTIFIERTYPE</span><span class="sc">;</span>
 417     <span class="s">}</span>
 418 
 419     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomIdentifierType</span>} =~ <span class="q">/^FunctionalClassAtomTypes$/i</span><span class="s">)</span> <span class="s">{</span>
 420       <span class="i">$SpecifiedAtomTypes</span> = <span class="i">new</span> <span class="i">AtomTypes::FunctionalClassAtomTypes</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span> <span class="cm">=&gt;</span> <span class="i">$This</span>-&gt;{<span class="w">Molecule</span>}<span class="cm">,</span> <span class="q">&#39;IgnoreHydrogens&#39;</span> <span class="cm">=&gt;</span> <span class="i">$IgnoreHydrogens</span><span class="cm">,</span> <span class="q">&#39;FunctionalClassesToUse&#39;</span> <span class="cm">=&gt;</span> <span class="i">$This</span>-&gt;{<span class="w">FunctionalClassesToUse</span>}<span class="s">)</span><span class="sc">;</span>
 421       <span class="k">last</span> <span class="j">IDENTIFIERTYPE</span><span class="sc">;</span>
 422     <span class="s">}</span>
 423 
 424     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomIdentifierType</span>} =~ <span class="q">/^DREIDINGAtomTypes$/i</span><span class="s">)</span> <span class="s">{</span>
 425       <span class="i">$SpecifiedAtomTypes</span> = <span class="i">new</span> <span class="i">AtomTypes::DREIDINGAtomTypes</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span> <span class="cm">=&gt;</span> <span class="i">$This</span>-&gt;{<span class="w">Molecule</span>}<span class="cm">,</span> <span class="q">&#39;IgnoreHydrogens&#39;</span> <span class="cm">=&gt;</span> <span class="i">$IgnoreHydrogens</span><span class="s">)</span><span class="sc">;</span>
 426       <span class="k">last</span> <span class="j">IDENTIFIERTYPE</span><span class="sc">;</span>
 427     <span class="s">}</span>
 428 
 429     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomIdentifierType</span>} =~ <span class="q">/^EStateAtomTypes$/i</span><span class="s">)</span> <span class="s">{</span>
 430       <span class="i">$SpecifiedAtomTypes</span> = <span class="i">new</span> <span class="i">AtomTypes::EStateAtomTypes</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span> <span class="cm">=&gt;</span> <span class="i">$This</span>-&gt;{<span class="w">Molecule</span>}<span class="cm">,</span> <span class="q">&#39;IgnoreHydrogens&#39;</span> <span class="cm">=&gt;</span> <span class="i">$IgnoreHydrogens</span><span class="s">)</span><span class="sc">;</span>
 431       <span class="k">last</span> <span class="j">IDENTIFIERTYPE</span><span class="sc">;</span>
 432     <span class="s">}</span>
 433 
 434     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomIdentifierType</span>} =~ <span class="q">/^MMFF94AtomTypes$/i</span><span class="s">)</span> <span class="s">{</span>
 435       <span class="i">$SpecifiedAtomTypes</span> = <span class="i">new</span> <span class="i">AtomTypes::MMFF94AtomTypes</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span> <span class="cm">=&gt;</span> <span class="i">$This</span>-&gt;{<span class="w">Molecule</span>}<span class="cm">,</span> <span class="q">&#39;IgnoreHydrogens&#39;</span> <span class="cm">=&gt;</span> <span class="i">$IgnoreHydrogens</span><span class="s">)</span><span class="sc">;</span>
 436       <span class="k">last</span> <span class="j">IDENTIFIERTYPE</span><span class="sc">;</span>
 437     <span class="s">}</span>
 438 
 439     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomIdentifierType</span>} =~ <span class="q">/^SLogPAtomTypes$/i</span><span class="s">)</span> <span class="s">{</span>
 440       <span class="i">$SpecifiedAtomTypes</span> = <span class="i">new</span> <span class="i">AtomTypes::SLogPAtomTypes</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span> <span class="cm">=&gt;</span> <span class="i">$This</span>-&gt;{<span class="w">Molecule</span>}<span class="cm">,</span> <span class="q">&#39;IgnoreHydrogens&#39;</span> <span class="cm">=&gt;</span> <span class="i">$IgnoreHydrogens</span><span class="s">)</span><span class="sc">;</span>
 441       <span class="k">last</span> <span class="j">IDENTIFIERTYPE</span><span class="sc">;</span>
 442     <span class="s">}</span>
 443 
 444     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomIdentifierType</span>} =~ <span class="q">/^SYBYLAtomTypes$/i</span><span class="s">)</span> <span class="s">{</span>
 445       <span class="i">$SpecifiedAtomTypes</span> = <span class="i">new</span> <span class="i">AtomTypes::SYBYLAtomTypes</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span> <span class="cm">=&gt;</span> <span class="i">$This</span>-&gt;{<span class="w">Molecule</span>}<span class="cm">,</span> <span class="q">&#39;IgnoreHydrogens&#39;</span> <span class="cm">=&gt;</span> <span class="i">$IgnoreHydrogens</span><span class="s">)</span><span class="sc">;</span>
 446       <span class="k">last</span> <span class="j">IDENTIFIERTYPE</span><span class="sc">;</span>
 447     <span class="s">}</span>
 448 
 449     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomIdentifierType</span>} =~ <span class="q">/^TPSAAtomTypes$/i</span><span class="s">)</span> <span class="s">{</span>
 450       <span class="i">$SpecifiedAtomTypes</span> = <span class="i">new</span> <span class="i">AtomTypes::TPSAAtomTypes</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span> <span class="cm">=&gt;</span> <span class="i">$This</span>-&gt;{<span class="w">Molecule</span>}<span class="cm">,</span> <span class="q">&#39;IgnorePhosphorus&#39;</span> <span class="cm">=&gt;</span> <span class="n">0</span><span class="cm">,</span> <span class="q">&#39;IgnoreSulfur&#39;</span> <span class="cm">=&gt;</span> <span class="n">0</span><span class="s">)</span><span class="sc">;</span>
 451       <span class="k">last</span> <span class="j">IDENTIFIERTYPE</span><span class="sc">;</span>
 452     <span class="s">}</span>
 453 
 454     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomIdentifierType</span>} =~ <span class="q">/^UFFAtomTypes$/i</span><span class="s">)</span> <span class="s">{</span>
 455       <span class="i">$SpecifiedAtomTypes</span> = <span class="i">new</span> <span class="i">AtomTypes::UFFAtomTypes</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span> <span class="cm">=&gt;</span> <span class="i">$This</span>-&gt;{<span class="w">Molecule</span>}<span class="cm">,</span> <span class="q">&#39;IgnoreHydrogens&#39;</span> <span class="cm">=&gt;</span> <span class="i">$IgnoreHydrogens</span><span class="s">)</span><span class="sc">;</span>
 456       <span class="k">last</span> <span class="j">IDENTIFIERTYPE</span><span class="sc">;</span>
 457     <span class="s">}</span>
 458 
 459     <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;_AssignInitialAtomIdentifiers: Couldn&#39;t assign intial atom identifiers: InitialAtomIdentifierType $This-&gt;{AtomIdentifierType} is not supported...&quot;</span><span class="sc">;</span>
 460   <span class="s">}</span>
 461 
 462   <span class="c"># Assign atom types...</span>
 463   <span class="i">$SpecifiedAtomTypes</span><span class="i">-&gt;AssignAtomTypes</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 464 
 465   <span class="c"># Make sure atom types assignment is successful...</span>
 466   <span class="k">if</span> <span class="s">(</span>!<span class="i">$SpecifiedAtomTypes</span><span class="i">-&gt;IsAtomTypesAssignmentSuccessful</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 467     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
 468   <span class="s">}</span>
 469 
 470   <span class="c"># Assign atom identifiers at radius 0...</span>
 471   <span class="i">$Radius</span> = <span class="n">0</span><span class="sc">;</span>
 472   <span class="k">for</span> <span class="i">$Atom</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">Atoms</span>}}<span class="s">)</span> <span class="s">{</span>
 473     <span class="i">$AtomID</span> = <span class="i">$Atom</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 474 
 475     <span class="i">$AtomType</span> = <span class="i">$SpecifiedAtomTypes</span><span class="i">-&gt;GetAtomType</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 476     <span class="i">$InitialAtomTypeString</span> = <span class="i">$AtomType</span> ? <span class="i">$AtomType</span> <span class="co">:</span> <span class="q">&#39;None&#39;</span><span class="sc">;</span>
 477 
 478     <span class="i">$InitialAtomIdentifier</span> = <span class="i">TextUtil::HashCode</span><span class="s">(</span><span class="i">$InitialAtomTypeString</span><span class="s">)</span><span class="sc">;</span>
 479     <span class="i">$This</span>-&gt;{<span class="w">AtomIdentifiers</span>}{<span class="i">$Radius</span>}{<span class="i">$AtomID</span>} = <span class="i">$InitialAtomIdentifier</span><span class="sc">;</span>
 480   <span class="s">}</span>
 481 
 482   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 483 <span class="s">}</span>
 484 
 485 <span class="c"># Initialize atom identifiers...</span>
 486 <span class="c">#</span>
<a name="_InitializeAtomIdentifiers-"></a> 487 <span class="k">sub </span><span class="m">_InitializeAtomIdentifiers</span> <span class="s">{</span>
 488   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 489   <span class="k">my</span><span class="s">(</span><span class="i">$Radius</span><span class="cm">,</span> <span class="i">$CurrentRadius</span><span class="s">)</span><span class="sc">;</span>
 490 
 491   <span class="i">$Radius</span> = <span class="i">$This</span>-&gt;{<span class="w">NeighborhoodRadius</span>}<span class="sc">;</span>
 492 
 493   <span class="i">%</span>{<span class="i">$This</span>-&gt;{<span class="w">AtomIdentifiers</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 494   <span class="k">for</span> <span class="i">$CurrentRadius</span> <span class="s">(</span><span class="n">0</span> .. <span class="i">$Radius</span><span class="s">)</span> <span class="s">{</span>
 495     <span class="c"># Atom idenfiers key and value correspond to AtomID and AtomIdentifier</span>
 496     <span class="i">%</span>{<span class="i">$This</span>-&gt;{<span class="w">AtomIdentifiers</span>}{<span class="i">$CurrentRadius</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 497 
 498     <span class="c"># Unique and strcuturally unique idenfiers key and value correspond to AtomIdentifier and AtomID</span>
 499     <span class="i">%</span>{<span class="i">$This</span>-&gt;{<span class="w">UniqueAtomIdentifiers</span>}{<span class="i">$CurrentRadius</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 500     <span class="i">%</span>{<span class="i">$This</span>-&gt;{<span class="w">UniqueAtomIdentifiersCount</span>}{<span class="i">$CurrentRadius</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 501 
 502     <span class="i">%</span>{<span class="i">$This</span>-&gt;{<span class="w">StructurallyUniqueAtomIdentifiers</span>}{<span class="i">$CurrentRadius</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 503     <span class="i">%</span>{<span class="i">$This</span>-&gt;{<span class="w">StructurallyUniqueAtomIdentifiersCount</span>}{<span class="i">$CurrentRadius</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 504   <span class="s">}</span>
 505 
 506 <span class="s">}</span>
 507 
 508 <span class="c"># Collect atom neighborhoods upto specified neighborhood radius...</span>
 509 <span class="c">#</span>
<a name="_GetAtomNeighborhoods-"></a> 510 <span class="k">sub </span><span class="m">_GetAtomNeighborhoods</span> <span class="s">{</span>
 511   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 512   <span class="k">my</span><span class="s">(</span><span class="i">$Atom</span><span class="cm">,</span> <span class="i">$AtomID</span><span class="cm">,</span> <span class="i">$Radius</span><span class="cm">,</span> <span class="i">$CurrentRadius</span><span class="cm">,</span> <span class="i">$Molecule</span><span class="s">)</span><span class="sc">;</span>
 513 
 514   <span class="i">%</span>{<span class="i">$This</span>-&gt;{<span class="w">AtomNeighborhoods</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 515 
 516   <span class="i">$Radius</span> = <span class="i">$This</span>-&gt;{<span class="w">NeighborhoodRadius</span>}<span class="sc">;</span>
 517   <span class="k">if</span> <span class="s">(</span><span class="i">$Radius</span> &lt; <span class="n">1</span><span class="s">)</span> <span class="s">{</span>
 518     <span class="c"># At radius level 0, it&#39;s just the atoms...</span>
 519     <span class="k">return</span><span class="sc">;</span>
 520   <span class="s">}</span>
 521 
 522   <span class="c"># Initialize neighborhood at different radii...</span>
 523   <span class="k">for</span> <span class="i">$CurrentRadius</span> <span class="s">(</span><span class="n">0</span> .. <span class="i">$Radius</span><span class="s">)</span> <span class="s">{</span>
 524     <span class="i">%</span>{<span class="i">$This</span>-&gt;{<span class="w">AtomNeighborhoods</span>}{<span class="i">$CurrentRadius</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 525   <span class="s">}</span>
 526 
 527   <span class="i">$Molecule</span> = <span class="i">$This</span><span class="i">-&gt;GetMolecule</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 528 
 529   <span class="c"># Collect available atom neighborhoods at different at different neighborhood level for each atom...</span>
 530   <span class="k">my</span><span class="s">(</span><span class="i">$AtomsNeighborhoodWithSuccessorAtomsRef</span><span class="s">)</span><span class="sc">;</span>
 531 
 532   <span class="k">for</span> <span class="i">$Atom</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">Atoms</span>}}<span class="s">)</span> <span class="s">{</span>
 533     <span class="i">$AtomID</span> = <span class="i">$Atom</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 534     <span class="i">$CurrentRadius</span> = <span class="n">0</span><span class="sc">;</span>
 535     <span class="k">for</span> <span class="i">$AtomsNeighborhoodWithSuccessorAtomsRef</span> <span class="s">(</span><span class="i">$Molecule</span><span class="i">-&gt;GetAtomNeighborhoodsWithSuccessorAtomsAndRadiusUpto</span><span class="s">(</span><span class="i">$Atom</span><span class="cm">,</span> <span class="i">$Radius</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 536       <span class="i">$This</span>-&gt;{<span class="w">AtomNeighborhoods</span>}{<span class="i">$CurrentRadius</span>}{<span class="i">$AtomID</span>} = <span class="i">$AtomsNeighborhoodWithSuccessorAtomsRef</span><span class="sc">;</span>
 537       <span class="i">$CurrentRadius</span>++<span class="sc">;</span>
 538     <span class="s">}</span>
 539   <span class="s">}</span>
 540   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 541 <span class="s">}</span>
 542 
 543 <span class="c"># Assign atom identifiers to central atom at each neighborhood radius level...</span>
 544 <span class="c">#</span>
<a name="_AssignAtomIdentifiersToAtomNeighborhoods-"></a> 545 <span class="k">sub </span><span class="m">_AssignAtomIdentifiersToAtomNeighborhoods</span> <span class="s">{</span>
 546   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 547   <span class="k">my</span><span class="s">(</span><span class="i">$Radius</span><span class="cm">,</span> <span class="i">$NextRadius</span><span class="cm">,</span> <span class="i">$Atom</span><span class="cm">,</span> <span class="i">$AtomID</span><span class="cm">,</span> <span class="i">$NeighborhoodAtom</span><span class="cm">,</span> <span class="i">$SuccessorAtom</span><span class="cm">,</span> <span class="i">$SuccessorAtomID</span><span class="cm">,</span> <span class="i">$NeighborhoodAtomSuccessorAtomsRef</span><span class="cm">,</span> <span class="i">$NeighborhoodAtomsWithSuccessorAtomsRef</span><span class="cm">,</span> <span class="i">$Bond</span><span class="cm">,</span> <span class="i">$BondOrder</span><span class="cm">,</span> <span class="i">$SuccessorAtomCount</span><span class="s">)</span><span class="sc">;</span>
 548 
 549   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">NeighborhoodRadius</span>} &lt; <span class="n">1</span><span class="s">)</span> <span class="s">{</span>
 550     <span class="k">return</span><span class="sc">;</span>
 551   <span class="s">}</span>
 552 
 553   <span class="c"># Go over the atom neighborhoods at each radius upto specified radius and assign atom</span>
 554   <span class="c"># indentifiers using their connected successor atoms and their identifiers.</span>
 555   <span class="c">#</span>
 556   <span class="c"># For a neighborhood atom at a specified radius, the successor connected atoms correpond</span>
 557   <span class="c"># to next radius level and the last set of neighorhood atoms don&#39;t have any successor connected</span>
 558   <span class="c"># atoms. Additionally, radius level 0 just correspond to initial atom identifiers.</span>
 559   <span class="c">#</span>
 560   <span class="c"># So in order to process atom neighborhood upto specified radius level, the last atom neighborhood</span>
 561   <span class="c"># doesn&#39;t need to be processed: it gets processed at previous radius level as successor connected</span>
 562   <span class="c"># atoms.</span>
 563   <span class="c">#</span>
 564   <span class="j">RADIUS:</span> <span class="k">for</span> <span class="i">$Radius</span> <span class="s">(</span><span class="n">0</span> .. <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">NeighborhoodRadius</span>} - <span class="n">1</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 565     <span class="j">ATOM:</span> <span class="k">for</span> <span class="i">$Atom</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">Atoms</span>}}<span class="s">)</span> <span class="s">{</span>
 566       <span class="i">$AtomID</span> = <span class="i">$Atom</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 567 
 568       <span class="c"># Are there any available atom neighborhoods at this radius?</span>
 569       <span class="k">if</span> <span class="s">(</span>!<span class="k">exists</span> <span class="i">$This</span>-&gt;{<span class="w">AtomNeighborhoods</span>}{<span class="i">$Radius</span>}{<span class="i">$AtomID</span>}<span class="s">)</span> <span class="s">{</span>
 570         <span class="k">next</span> <span class="j">ATOM</span><span class="sc">;</span>
 571       <span class="s">}</span>
 572       <span class="i">$NextRadius</span> = <span class="i">$Radius</span> + <span class="n">1</span><span class="sc">;</span>
 573 
 574       <span class="c"># Go over neighborhood atoms and their successor connected atoms at this radius and collect</span>
 575       <span class="c"># (BondOrder AtomIdentifier) values for bonded atom pairs. Additionally, keep track of atom and bonds</span>
 576       <span class="c"># for the neighorhoods to remove identifieres generated from structurally duplicate features.</span>
 577       <span class="c">#</span>
 578       <span class="k">my</span><span class="s">(</span><span class="i">%BondOrdersAndAtomIdentifiers</span><span class="s">)</span><span class="sc">;</span>
 579 
 580       <span class="i">%BondOrdersAndAtomIdentifiers</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 581       <span class="i">$SuccessorAtomCount</span> = <span class="n">0</span><span class="sc">;</span>
 582 
 583       <span class="j">NEIGHBORHOODS:</span> <span class="k">for</span> <span class="i">$NeighborhoodAtomsWithSuccessorAtomsRef</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">AtomNeighborhoods</span>}{<span class="i">$Radius</span>}{<span class="i">$AtomID</span>}}<span class="s">)</span> <span class="s">{</span>
 584         <span class="s">(</span><span class="i">$NeighborhoodAtom</span><span class="cm">,</span> <span class="i">$NeighborhoodAtomSuccessorAtomsRef</span><span class="s">)</span> = <span class="i">@</span>{<span class="i">$NeighborhoodAtomsWithSuccessorAtomsRef</span>}<span class="sc">;</span>
 585 
 586         <span class="c"># Any connected successors for the NeighborhoodAtom?</span>
 587         <span class="k">if</span> <span class="s">(</span>!<span class="i">@</span>{<span class="i">$NeighborhoodAtomSuccessorAtomsRef</span>}<span class="s">)</span> <span class="s">{</span>
 588           <span class="k">next</span> <span class="j">NEIGHBORHOODS</span><span class="sc">;</span>
 589         <span class="s">}</span>
 590         <span class="j">SUCCESSORATOM:</span> <span class="k">for</span> <span class="i">$SuccessorAtom</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$NeighborhoodAtomSuccessorAtomsRef</span>}<span class="s">)</span> <span class="s">{</span>
 591           <span class="k">if</span> <span class="s">(</span><span class="i">$SuccessorAtom</span><span class="i">-&gt;IsHydrogen</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 592             <span class="c"># Skip successor hydrogen atom...</span>
 593             <span class="k">next</span> <span class="j">SUCCESSORATOM</span><span class="sc">;</span>
 594           <span class="s">}</span>
 595           <span class="i">$SuccessorAtomID</span> = <span class="i">$SuccessorAtom</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 596           <span class="i">$SuccessorAtomCount</span>++<span class="sc">;</span>
 597 
 598           <span class="i">$Bond</span> = <span class="i">$NeighborhoodAtom</span><span class="i">-&gt;GetBondToAtom</span><span class="s">(</span><span class="i">$SuccessorAtom</span><span class="s">)</span><span class="sc">;</span>
 599           <span class="i">$BondOrder</span> = <span class="i">$Bond</span><span class="i">-&gt;IsAromatic</span><span class="s">(</span><span class="s">)</span> ? <span class="q">&quot;1.5&quot;</span> <span class="co">:</span> <span class="i">$Bond</span><span class="i">-&gt;GetBondOrder</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 600 
 601           <span class="k">if</span> <span class="s">(</span>!<span class="k">exists</span> <span class="i">$BondOrdersAndAtomIdentifiers</span>{<span class="i">$BondOrder</span>}<span class="s">)</span> <span class="s">{</span>
 602             <span class="i">@</span>{<span class="i">$BondOrdersAndAtomIdentifiers</span>{<span class="i">$BondOrder</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 603           <span class="s">}</span>
 604           <span class="k">push</span> <span class="i">@</span>{<span class="i">$BondOrdersAndAtomIdentifiers</span>{<span class="i">$BondOrder</span>}}<span class="cm">,</span> <span class="i">$This</span>-&gt;{<span class="w">AtomIdentifiers</span>}{<span class="i">$Radius</span>}{<span class="i">$SuccessorAtomID</span>}<span class="sc">;</span>
 605         <span class="s">}</span>
 606       <span class="s">}</span>
 607       <span class="k">if</span> <span class="s">(</span>!<span class="i">$SuccessorAtomCount</span><span class="s">)</span> <span class="s">{</span>
 608         <span class="k">next</span> <span class="j">ATOM</span><span class="sc">;</span>
 609       <span class="s">}</span>
 610       <span class="c"># Assign a new atom identifier at the NextRadius level...</span>
 611       <span class="i">$This</span><span class="i">-&gt;_AssignAtomIdentifierToAtomNeighborhood</span><span class="s">(</span><span class="i">$AtomID</span><span class="cm">,</span> <span class="i">$Radius</span><span class="cm">,</span> \<span class="i">%BondOrdersAndAtomIdentifiers</span><span class="s">)</span><span class="sc">;</span>
 612     <span class="s">}</span>
 613  <span class="s">}</span>
 614   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 615 <span class="s">}</span>
 616 
 617 <span class="c"># Generate and assign atom indentifier for AtomID using atom neighborhood at next radius level...</span>
 618 <span class="c">#</span>
<a name="_AssignAtomIdentifierToAtomNeighborhood-"></a> 619 <span class="k">sub </span><span class="m">_AssignAtomIdentifierToAtomNeighborhood</span> <span class="s">{</span>
 620   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$AtomID</span><span class="cm">,</span> <span class="i">$Radius</span><span class="cm">,</span> <span class="i">$BondOrdersAndAtomIdentifiersRef</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 621   <span class="k">my</span><span class="s">(</span><span class="i">$NextRadius</span><span class="cm">,</span> <span class="i">$AtomIdentifier</span><span class="cm">,</span>  <span class="i">$SuccessorAtomIdentifier</span><span class="cm">,</span> <span class="i">$BondOrder</span><span class="cm">,</span> <span class="i">$AtomIdentifierString</span><span class="cm">,</span> <span class="i">@AtomIndentifiersInfo</span><span class="s">)</span><span class="sc">;</span>
 622 
 623   <span class="i">$NextRadius</span> = <span class="i">$Radius</span> + <span class="n">1</span><span class="sc">;</span>
 624 
 625   <span class="i">@AtomIndentifiersInfo</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 626 
 627   <span class="i">$AtomIdentifier</span> = <span class="i">$This</span>-&gt;{<span class="w">AtomIdentifiers</span>}{<span class="i">$Radius</span>}{<span class="i">$AtomID</span>}<span class="sc">;</span>
 628   <span class="k">push</span> <span class="i">@AtomIndentifiersInfo</span><span class="cm">,</span> <span class="s">(</span><span class="i">$NextRadius</span><span class="cm">,</span> <span class="i">$AtomIdentifier</span><span class="s">)</span><span class="sc">;</span>
 629 
 630   <span class="c"># Sort out successor atom bond order and identifier pairs by bond order followed by atom identifiers</span>
 631   <span class="c"># in order to make the final atom identifier graph invariant...</span>
 632   <span class="c">#</span>
 633   <span class="k">for</span> <span class="i">$BondOrder</span> <span class="s">(</span><span class="k">sort</span> <span class="s">{</span> <span class="i">$a</span> &lt;=&gt; <span class="i">$b</span> <span class="s">}</span> <span class="k">keys</span> <span class="i">%</span>{<span class="i">$BondOrdersAndAtomIdentifiersRef</span>}<span class="s">)</span> <span class="s">{</span>
 634     <span class="k">for</span> <span class="i">$SuccessorAtomIdentifier</span> <span class="s">(</span><span class="k">sort</span> <span class="s">{</span> <span class="i">$a</span> &lt;=&gt; <span class="i">$b</span> <span class="s">}</span> <span class="i">@</span>{<span class="i">$BondOrdersAndAtomIdentifiersRef</span>-&gt;{<span class="i">$BondOrder</span>}}<span class="s">)</span> <span class="s">{</span>
 635       <span class="k">push</span> <span class="i">@AtomIndentifiersInfo</span><span class="cm">,</span> <span class="s">(</span><span class="i">$BondOrder</span><span class="cm">,</span> <span class="i">$SuccessorAtomIdentifier</span><span class="s">)</span><span class="sc">;</span>
 636     <span class="s">}</span>
 637   <span class="s">}</span>
 638   <span class="i">$AtomIdentifierString</span> = <span class="k">join</span><span class="s">(</span><span class="q">&quot;&quot;</span><span class="cm">,</span> <span class="i">@AtomIndentifiersInfo</span><span class="s">)</span><span class="sc">;</span>
 639   <span class="i">$AtomIdentifier</span> = <span class="i">TextUtil::HashCode</span><span class="s">(</span><span class="i">$AtomIdentifierString</span><span class="s">)</span><span class="sc">;</span>
 640 
 641   <span class="c"># Assign atom identifier to the atom at next radius level...</span>
 642   <span class="i">$This</span>-&gt;{<span class="w">AtomIdentifiers</span>}{<span class="i">$NextRadius</span>}{<span class="i">$AtomID</span>} = <span class="i">$AtomIdentifier</span><span class="sc">;</span>
 643 
 644   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 645 <span class="s">}</span>
 646 
 647 <span class="c"># Remove duplicates atom identifiers...</span>
 648 <span class="c">#</span>
<a name="_RemoveDuplicateAtomIdentifiers-"></a> 649 <span class="k">sub </span><span class="m">_RemoveDuplicateAtomIdentifiers</span> <span class="s">{</span>
 650   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 651 
 652   <span class="i">$This</span><span class="i">-&gt;_RemoveDuplicateIdentifiersByValue</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 653   <span class="i">$This</span><span class="i">-&gt;_RemoveStructurallyDuplicateIdenfiers</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 654 
 655   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 656 <span class="s">}</span>
 657 
 658 <span class="c"># Remove duplicate identifiers at each radius level by just using their value...</span>
 659 <span class="c">#</span>
<a name="_RemoveDuplicateIdentifiersByValue-"></a> 660 <span class="k">sub </span><span class="m">_RemoveDuplicateIdentifiersByValue</span> <span class="s">{</span>
 661   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 662   <span class="k">my</span><span class="s">(</span><span class="i">$Radius</span><span class="cm">,</span> <span class="i">$Atom</span><span class="cm">,</span> <span class="i">$AtomID</span><span class="cm">,</span> <span class="i">$AtomIdentifier</span><span class="s">)</span><span class="sc">;</span>
 663 
 664   <span class="k">for</span> <span class="i">$Radius</span> <span class="s">(</span><span class="n">0</span> .. <span class="i">$This</span>-&gt;{<span class="w">NeighborhoodRadius</span>}<span class="s">)</span> <span class="s">{</span>
 665     <span class="j">ATOM:</span> <span class="k">for</span> <span class="i">$Atom</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">Atoms</span>}}<span class="s">)</span> <span class="s">{</span>
 666       <span class="i">$AtomID</span> = <span class="i">$Atom</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 667       <span class="k">if</span> <span class="s">(</span>!<span class="k">exists</span> <span class="i">$This</span>-&gt;{<span class="w">AtomIdentifiers</span>}{<span class="i">$Radius</span>}{<span class="i">$AtomID</span>}<span class="s">)</span> <span class="s">{</span>
 668         <span class="k">next</span> <span class="j">ATOM</span><span class="sc">;</span>
 669       <span class="s">}</span>
 670       <span class="i">$AtomIdentifier</span> = <span class="i">$This</span>-&gt;{<span class="w">AtomIdentifiers</span>}{<span class="i">$Radius</span>}{<span class="i">$AtomID</span>}<span class="sc">;</span>
 671       <span class="k">if</span> <span class="s">(</span><span class="k">exists</span> <span class="i">$This</span>-&gt;{<span class="w">UniqueAtomIdentifiers</span>}{<span class="i">$Radius</span>}{<span class="i">$AtomIdentifier</span>}<span class="s">)</span> <span class="s">{</span>
 672         <span class="c"># It&#39;s a duplicate atom idenfier at this radius level...</span>
 673         <span class="i">$This</span>-&gt;{<span class="w">UniqueAtomIdentifiersCount</span>}{<span class="i">$Radius</span>}{<span class="i">$AtomIdentifier</span>} += <span class="n">1</span><span class="sc">;</span>
 674         <span class="k">next</span> <span class="j">ATOM</span><span class="sc">;</span>
 675       <span class="s">}</span>
 676       <span class="i">$This</span>-&gt;{<span class="w">UniqueAtomIdentifiers</span>}{<span class="i">$Radius</span>}{<span class="i">$AtomIdentifier</span>} = <span class="i">$AtomID</span><span class="sc">;</span>
 677       <span class="i">$This</span>-&gt;{<span class="w">UniqueAtomIdentifiersCount</span>}{<span class="i">$Radius</span>}{<span class="i">$AtomIdentifier</span>} = <span class="n">1</span><span class="sc">;</span>
 678     <span class="s">}</span>
 679   <span class="s">}</span>
 680   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 681 <span class="s">}</span>
 682 
 683 <span class="c"># Remove structurally duplicate identifiers at each radius level...</span>
 684 <span class="c">#</span>
 685 <span class="c"># Methodology:</span>
 686 <span class="c">#   . For unquie atom identifiers at each radius level, assign complete structure features</span>
 687 <span class="c">#     in terms all the bonds involved to generate that identifier</span>
 688 <span class="c">#   . Use the complete structure features to remover atom identifiers which are</span>
 689 <span class="c">#     structurally equivalent which can also be at earlier radii levels</span>
 690 <span class="c">#</span>
 691 <span class="c">#</span>
<a name="_RemoveStructurallyDuplicateIdenfiers-"></a> 692 <span class="k">sub </span><span class="m">_RemoveStructurallyDuplicateIdenfiers</span> <span class="s">{</span>
 693   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 694   <span class="k">my</span><span class="s">(</span><span class="i">$Radius</span><span class="cm">,</span> <span class="i">$AtomID</span><span class="cm">,</span> <span class="i">$AtomIdentifier</span><span class="cm">,</span> <span class="i">$SimilarAtomIdentifierRadius</span><span class="cm">,</span> <span class="i">$SimilarAtomIdentifier</span><span class="s">)</span><span class="sc">;</span>
 695 
 696   <span class="c"># Setup structure features...</span>
 697   <span class="i">$This</span><span class="i">-&gt;_SetupStructureFeaturesForAtomIDsInvolvedInUniqueIdentifiers</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 698 
 699   <span class="c"># Identify structurally unqiue identifiers...</span>
 700   <span class="k">for</span> <span class="i">$Radius</span> <span class="s">(</span><span class="n">0</span> .. <span class="i">$This</span>-&gt;{<span class="w">NeighborhoodRadius</span>}<span class="s">)</span> <span class="s">{</span>
 701     <span class="j">ATOMIDENTIFIER:</span> <span class="k">for</span> <span class="i">$AtomIdentifier</span> <span class="s">(</span><span class="k">sort</span> <span class="s">{</span> <span class="i">$a</span> &lt;=&gt; <span class="i">$b</span> <span class="s">}</span> <span class="k">keys</span> <span class="i">%</span>{<span class="i">$This</span>-&gt;{<span class="w">UniqueAtomIdentifiers</span>}{<span class="i">$Radius</span>}}<span class="s">)</span> <span class="s">{</span>
 702       <span class="i">$AtomID</span> = <span class="i">$This</span>-&gt;{<span class="w">UniqueAtomIdentifiers</span>}{<span class="i">$Radius</span>}{<span class="i">$AtomIdentifier</span>}<span class="sc">;</span>
 703 
 704       <span class="s">(</span><span class="i">$SimilarAtomIdentifierRadius</span><span class="cm">,</span> <span class="i">$SimilarAtomIdentifier</span><span class="s">)</span> = <span class="i">$This</span><span class="i">-&gt;_FindStructurallySimilarAtomIdentifier</span><span class="s">(</span><span class="i">$Radius</span><span class="cm">,</span> <span class="i">$AtomID</span><span class="cm">,</span> <span class="i">$AtomIdentifier</span><span class="s">)</span><span class="sc">;</span>
 705       <span class="k">if</span> <span class="s">(</span><span class="i">$SimilarAtomIdentifier</span><span class="s">)</span> <span class="s">{</span>
 706         <span class="c"># Current atom identifier is similar to an earlier structurally unique atom identifier...</span>
 707         <span class="i">$This</span>-&gt;{<span class="w">StructurallyUniqueAtomIdentifiersCount</span>}{<span class="i">$SimilarAtomIdentifierRadius</span>}{<span class="i">$SimilarAtomIdentifier</span>} += <span class="i">$This</span>-&gt;{<span class="w">UniqueAtomIdentifiersCount</span>}{<span class="i">$Radius</span>}{<span class="i">$AtomIdentifier</span>}<span class="sc">;</span>
 708         <span class="k">next</span> <span class="j">ATOMIDENTIFIER</span><span class="sc">;</span>
 709       <span class="s">}</span>
 710       <span class="i">$This</span>-&gt;{<span class="w">StructurallyUniqueAtomIdentifiers</span>}{<span class="i">$Radius</span>}{<span class="i">$AtomIdentifier</span>} = <span class="i">$AtomID</span><span class="sc">;</span>
 711 
 712       <span class="c"># Set structurally unique atom identifier count to the unique atom identifiers count...</span>
 713       <span class="i">$This</span>-&gt;{<span class="w">StructurallyUniqueAtomIdentifiersCount</span>}{<span class="i">$Radius</span>}{<span class="i">$AtomIdentifier</span>} = <span class="i">$This</span>-&gt;{<span class="w">UniqueAtomIdentifiersCount</span>}{<span class="i">$Radius</span>}{<span class="i">$AtomIdentifier</span>}<span class="sc">;</span>
 714     <span class="s">}</span>
 715   <span class="s">}</span>
 716   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 717 <span class="s">}</span>
 718 
 719 <span class="c"># Set final fingerpritns vector...</span>
 720 <span class="c">#</span>
<a name="_SetFinalFingerprints-"></a> 721 <span class="k">sub </span><span class="m">_SetFinalFingerprints</span> <span class="s">{</span>
 722   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 723 
 724   <span class="c"># Mark successful generation of fingerprints...</span>
 725   <span class="i">$This</span>-&gt;{<span class="w">FingerprintsGenerated</span>} = <span class="n">1</span><span class="sc">;</span>
 726 
 727   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">Type</span>} =~ <span class="q">/^ExtendedConnectivity$/i</span><span class="s">)</span> <span class="s">{</span>
 728     <span class="i">$This</span><span class="i">-&gt;_SetFinalExtendedConnectivityFingerprints</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 729   <span class="s">}</span>
 730   <span class="k">elsif</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">Type</span>} =~ <span class="q">/^ExtendedConnectivityCount$/i</span><span class="s">)</span> <span class="s">{</span>
 731     <span class="i">$This</span><span class="i">-&gt;_SetFinalExtendedConnectivityCountFingerprints</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 732   <span class="s">}</span>
 733   <span class="k">elsif</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">Type</span>} =~ <span class="q">/^ExtendedConnectivityBits$/i</span><span class="s">)</span> <span class="s">{</span>
 734     <span class="i">$This</span><span class="i">-&gt;_SetFinalExtendedConnectivityBitsFingerprints</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 735   <span class="s">}</span>
 736 
 737   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 738 <span class="s">}</span>
 739 
 740 <span class="c"># Set final extended connectivity fingerpritns vector...</span>
 741 <span class="c">#</span>
<a name="_SetFinalExtendedConnectivityFingerprints-"></a> 742 <span class="k">sub </span><span class="m">_SetFinalExtendedConnectivityFingerprints</span> <span class="s">{</span>
 743   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 744   <span class="k">my</span><span class="s">(</span><span class="i">$Radius</span><span class="cm">,</span> <span class="i">$AtomIdentifier</span><span class="cm">,</span> <span class="i">@AtomIdentifiers</span><span class="s">)</span><span class="sc">;</span>
 745 
 746   <span class="i">@AtomIdentifiers</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 747 
 748   <span class="k">for</span> <span class="i">$Radius</span> <span class="s">(</span><span class="n">0</span> .. <span class="i">$This</span>-&gt;{<span class="w">NeighborhoodRadius</span>}<span class="s">)</span> <span class="s">{</span>
 749     <span class="k">for</span> <span class="i">$AtomIdentifier</span> <span class="s">(</span><span class="k">sort</span> <span class="s">{</span> <span class="i">$a</span> &lt;=&gt; <span class="i">$b</span> <span class="s">}</span> <span class="k">keys</span> <span class="i">%</span>{<span class="i">$This</span>-&gt;{<span class="w">StructurallyUniqueAtomIdentifiers</span>}{<span class="i">$Radius</span>}}<span class="s">)</span> <span class="s">{</span>
 750       <span class="k">push</span> <span class="i">@AtomIdentifiers</span><span class="cm">,</span> <span class="i">$AtomIdentifier</span><span class="sc">;</span>
 751     <span class="s">}</span>
 752   <span class="s">}</span>
 753   <span class="c"># Add atom identifiers to fingerprint vector...</span>
 754   <span class="i">$This</span>-&gt;{<span class="w">FingerprintsVector</span>}<span class="i">-&gt;AddValues</span><span class="s">(</span>\<span class="i">@AtomIdentifiers</span><span class="s">)</span><span class="sc">;</span>
 755 
 756   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 757 <span class="s">}</span>
 758 
 759 <span class="c"># Set final extended connectivity count fingerpritns vector...</span>
 760 <span class="c">#</span>
<a name="_SetFinalExtendedConnectivityCountFingerprints-"></a> 761 <span class="k">sub </span><span class="m">_SetFinalExtendedConnectivityCountFingerprints</span> <span class="s">{</span>
 762   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 763   <span class="k">my</span><span class="s">(</span><span class="i">$Radius</span><span class="cm">,</span> <span class="i">$AtomIdentifier</span><span class="cm">,</span> <span class="i">$AtomIdentifierCount</span><span class="cm">,</span> <span class="i">@AtomIdentifiers</span><span class="cm">,</span> <span class="i">@AtomIdentifiersCount</span><span class="s">)</span><span class="sc">;</span>
 764 
 765   <span class="i">@AtomIdentifiers</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span> <span class="i">@AtomIdentifiersCount</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 766 
 767   <span class="k">for</span> <span class="i">$Radius</span> <span class="s">(</span><span class="n">0</span> .. <span class="i">$This</span>-&gt;{<span class="w">NeighborhoodRadius</span>}<span class="s">)</span> <span class="s">{</span>
 768     <span class="k">for</span> <span class="i">$AtomIdentifier</span> <span class="s">(</span><span class="k">sort</span> <span class="s">{</span> <span class="i">$a</span> &lt;=&gt; <span class="i">$b</span> <span class="s">}</span> <span class="k">keys</span> <span class="i">%</span>{<span class="i">$This</span>-&gt;{<span class="w">StructurallyUniqueAtomIdentifiers</span>}{<span class="i">$Radius</span>}}<span class="s">)</span> <span class="s">{</span>
 769       <span class="i">$AtomIdentifierCount</span> = <span class="i">$This</span>-&gt;{<span class="w">StructurallyUniqueAtomIdentifiersCount</span>}{<span class="i">$Radius</span>}{<span class="i">$AtomIdentifier</span>}<span class="sc">;</span>
 770       <span class="k">push</span> <span class="i">@AtomIdentifiers</span><span class="cm">,</span> <span class="i">$AtomIdentifier</span><span class="sc">;</span>
 771       <span class="k">push</span> <span class="i">@AtomIdentifiersCount</span><span class="cm">,</span> <span class="i">$AtomIdentifierCount</span><span class="sc">;</span>
 772     <span class="s">}</span>
 773   <span class="s">}</span>
 774   <span class="c"># Add atom identifiers to fingerprint vector as value IDs...</span>
 775   <span class="i">$This</span>-&gt;{<span class="w">FingerprintsVector</span>}<span class="i">-&gt;AddValueIDs</span><span class="s">(</span>\<span class="i">@AtomIdentifiers</span><span class="s">)</span><span class="sc">;</span>
 776 
 777   <span class="c"># Add atom identifiers to count to fingerprint vector as values...</span>
 778   <span class="i">$This</span>-&gt;{<span class="w">FingerprintsVector</span>}<span class="i">-&gt;AddValues</span><span class="s">(</span>\<span class="i">@AtomIdentifiersCount</span><span class="s">)</span><span class="sc">;</span>
 779 
 780   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 781 <span class="s">}</span>
 782 
 783 <span class="c"># Set final extended connectivity bits fingerpritns vector...</span>
 784 <span class="c">#</span>
<a name="_SetFinalExtendedConnectivityBitsFingerprints-"></a> 785 <span class="k">sub </span><span class="m">_SetFinalExtendedConnectivityBitsFingerprints</span> <span class="s">{</span>
 786   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 787   <span class="k">my</span><span class="s">(</span><span class="i">$Radius</span><span class="cm">,</span> <span class="i">$AtomIdentifier</span><span class="cm">,</span> <span class="i">$FingerprintsBitVector</span><span class="cm">,</span> <span class="i">$Size</span><span class="cm">,</span> <span class="i">$SkipBitPosCheck</span><span class="cm">,</span> <span class="i">$AtomIdentifierBitPos</span><span class="cm">,</span> <span class="i">$SetBitNum</span><span class="s">)</span><span class="sc">;</span>
 788 
 789   <span class="i">$FingerprintsBitVector</span> = <span class="i">$This</span>-&gt;{<span class="w">FingerprintsBitVector</span>}<span class="sc">;</span>
 790 
 791   <span class="i">$Size</span> = <span class="i">$This</span>-&gt;{<span class="w">Size</span>}<span class="sc">;</span>
 792 
 793   <span class="i">$SkipBitPosCheck</span> = <span class="n">1</span><span class="sc">;</span>
 794 
 795   <span class="k">for</span> <span class="i">$Radius</span> <span class="s">(</span><span class="n">0</span> .. <span class="i">$This</span>-&gt;{<span class="w">NeighborhoodRadius</span>}<span class="s">)</span> <span class="s">{</span>
 796     <span class="k">for</span> <span class="i">$AtomIdentifier</span> <span class="s">(</span><span class="k">keys</span> <span class="i">%</span>{<span class="i">$This</span>-&gt;{<span class="w">StructurallyUniqueAtomIdentifiers</span>}{<span class="i">$Radius</span>}}<span class="s">)</span> <span class="s">{</span>
 797       <span class="c"># Set random number seed...</span>
 798       <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">UsePerlCoreRandom</span>}<span class="s">)</span> <span class="s">{</span>
 799         <span class="i">CORE::</span><span class="k">srand</span><span class="s">(</span><span class="i">$AtomIdentifier</span><span class="s">)</span><span class="sc">;</span>
 800       <span class="s">}</span>
 801       <span class="k">else</span> <span class="s">{</span>
 802         <span class="i">MathUtil::srandom</span><span class="s">(</span><span class="i">$AtomIdentifier</span><span class="s">)</span><span class="sc">;</span>
 803       <span class="s">}</span>
 804 
 805       <span class="c"># Set bit position...</span>
 806       <span class="i">$AtomIdentifierBitPos</span> = <span class="i">$This</span>-&gt;{<span class="w">UsePerlCoreRandom</span>} ? <span class="k">int</span><span class="s">(</span><span class="i">CORE::</span><span class="k">rand</span><span class="s">(</span><span class="i">$Size</span><span class="s">)</span><span class="s">)</span> <span class="co">:</span> <span class="k">int</span><span class="s">(</span><span class="i">MathUtil::random</span><span class="s">(</span><span class="i">$Size</span><span class="s">)</span><span class="s">)</span><span class="sc">;</span>
 807       <span class="i">$FingerprintsBitVector</span><span class="i">-&gt;SetBit</span><span class="s">(</span><span class="i">$AtomIdentifierBitPos</span><span class="cm">,</span> <span class="i">$SkipBitPosCheck</span><span class="s">)</span><span class="sc">;</span>
 808     <span class="s">}</span>
 809   <span class="s">}</span>
 810   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 811 <span class="s">}</span>
 812 
 813 
 814 <span class="c"># Identify structurally unique identifiers by comparing structure features involved in</span>
 815 <span class="c"># generating identifiear by comparing it agains all the previous structurally unique</span>
 816 <span class="c"># identifiers...</span>
 817 <span class="c">#</span>
<a name="_FindStructurallySimilarAtomIdentifier-"></a> 818 <span class="k">sub </span><span class="m">_FindStructurallySimilarAtomIdentifier</span> <span class="s">{</span>
 819   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$SpecifiedRadius</span><span class="cm">,</span> <span class="i">$SpecifiedAtomID</span><span class="cm">,</span> <span class="i">$SpecifiedAtomIdentifier</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 820   <span class="k">my</span><span class="s">(</span><span class="i">$Radius</span><span class="cm">,</span> <span class="i">$AtomID</span><span class="cm">,</span> <span class="i">$AtomIdentifier</span><span class="cm">,</span> <span class="i">$FeatureAtomCount</span><span class="cm">,</span> <span class="i">$FeatureAtomIDsRef</span><span class="cm">,</span>  <span class="i">$SpecifiedFeatureAtomID</span><span class="cm">,</span> <span class="i">$SpecifiedFeatureAtomCount</span><span class="cm">,</span> <span class="i">$SpecifiedFeatureAtomIDsRef</span><span class="s">)</span><span class="sc">;</span>
 821 
 822   <span class="k">if</span> <span class="s">(</span><span class="i">$SpecifiedRadius</span> == <span class="n">0</span><span class="s">)</span> <span class="s">{</span>
 823     <span class="c"># After duplicate removal by value, all identifier at radius level 0 would be structurally unique...</span>
 824     <span class="k">return</span> <span class="s">(</span><span class="k">undef</span><span class="cm">,</span> <span class="k">undef</span><span class="s">)</span><span class="sc">;</span>
 825   <span class="s">}</span>
 826 
 827   <span class="i">$SpecifiedFeatureAtomCount</span> = <span class="i">$This</span>-&gt;{<span class="w">StructureFeatures</span>}{<span class="w">AtomCount</span>}{<span class="i">$SpecifiedRadius</span>}{<span class="i">$SpecifiedAtomID</span>}<span class="sc">;</span>
 828   <span class="i">$SpecifiedFeatureAtomIDsRef</span> = <span class="i">$This</span>-&gt;{<span class="w">StructureFeatures</span>}{<span class="w">AtomIDs</span>}{<span class="i">$SpecifiedRadius</span>}{<span class="i">$SpecifiedAtomID</span>}<span class="sc">;</span>
 829 
 830   <span class="c"># No need to compare features at radius 0...</span>
 831   <span class="k">for</span> <span class="i">$Radius</span> <span class="s">(</span><span class="n">1</span> .. <span class="i">$SpecifiedRadius</span><span class="s">)</span> <span class="s">{</span>
 832     <span class="j">ATOMIDENTIFIER:</span> <span class="k">for</span> <span class="i">$AtomIdentifier</span> <span class="s">(</span><span class="k">keys</span> <span class="i">%</span>{<span class="i">$This</span>-&gt;{<span class="w">StructurallyUniqueAtomIdentifiers</span>}{<span class="i">$Radius</span>}}<span class="s">)</span> <span class="s">{</span>
 833       <span class="i">$AtomID</span> = <span class="i">$This</span>-&gt;{<span class="w">StructurallyUniqueAtomIdentifiers</span>}{<span class="i">$Radius</span>}{<span class="i">$AtomIdentifier</span>}<span class="sc">;</span>
 834 
 835       <span class="i">$FeatureAtomCount</span> = <span class="i">$This</span>-&gt;{<span class="w">StructureFeatures</span>}{<span class="w">AtomCount</span>}{<span class="i">$Radius</span>}{<span class="i">$AtomID</span>}<span class="sc">;</span>
 836       <span class="i">$FeatureAtomIDsRef</span> = <span class="i">$This</span>-&gt;{<span class="w">StructureFeatures</span>}{<span class="w">AtomIDs</span>}{<span class="i">$Radius</span>}{<span class="i">$AtomID</span>}<span class="sc">;</span>
 837 
 838       <span class="k">if</span> <span class="s">(</span><span class="i">$SpecifiedFeatureAtomCount</span> != <span class="i">$FeatureAtomCount</span><span class="s">)</span> <span class="s">{</span>
 839         <span class="c"># Couldn&#39;t be structurally equivalent...</span>
 840         <span class="k">next</span> <span class="j">ATOMIDENTIFIER</span><span class="sc">;</span>
 841       <span class="s">}</span>
 842       <span class="k">for</span> <span class="i">$SpecifiedFeatureAtomID</span> <span class="s">(</span><span class="k">keys</span> <span class="i">%</span> {<span class="i">$SpecifiedFeatureAtomIDsRef</span>}<span class="s">)</span> <span class="s">{</span>
 843         <span class="k">if</span> <span class="s">(</span>! <span class="k">exists</span> <span class="i">$FeatureAtomIDsRef</span>-&gt;{<span class="i">$SpecifiedFeatureAtomID</span>}<span class="s">)</span> <span class="s">{</span>
 844           <span class="c"># For structural equivalency, all atom in specified feature must also be present in a previously</span>
 845           <span class="c"># identified structurally unique structure feature...</span>
 846           <span class="k">next</span> <span class="j">ATOMIDENTIFIER</span><span class="sc">;</span>
 847         <span class="s">}</span>
 848       <span class="s">}</span>
 849       <span class="c"># Found structurally equivalent feature...</span>
 850       <span class="k">return</span> <span class="s">(</span><span class="i">$Radius</span><span class="cm">,</span> <span class="i">$AtomIdentifier</span><span class="s">)</span><span class="sc">;</span>
 851     <span class="s">}</span>
 852   <span class="s">}</span>
 853   <span class="k">return</span> <span class="s">(</span><span class="k">undef</span><span class="cm">,</span> <span class="k">undef</span><span class="s">)</span><span class="sc">;</span>
 854 <span class="s">}</span>
 855 
 856 <span class="c"># Setup structure features for atom IDs involved in unique atom identifiers at all</span>
 857 <span class="c"># radii level...</span>
 858 <span class="c">#</span>
<a name="_SetupStructureFeaturesForAtomIDsInvolvedInUniqueIdentifiers-"></a> 859 <span class="k">sub </span><span class="m">_SetupStructureFeaturesForAtomIDsInvolvedInUniqueIdentifiers</span> <span class="s">{</span>
 860   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 861   <span class="k">my</span><span class="s">(</span><span class="i">$Radius</span><span class="cm">,</span> <span class="i">$PreviousRadius</span><span class="cm">,</span> <span class="i">$Atom</span><span class="cm">,</span> <span class="i">$AtomID</span><span class="cm">,</span> <span class="i">$AtomIdentifier</span><span class="cm">,</span> <span class="i">$NeighborhoodAtomID</span><span class="cm">,</span> <span class="i">$NeighborhoodAtomsWithSuccessorAtomsRef</span><span class="cm">,</span> <span class="i">$NeighborhoodAtom</span><span class="cm">,</span> <span class="i">$NeighborhoodAtomSuccessorAtomsRef</span><span class="cm">,</span> <span class="i">%AtomIDs</span><span class="s">)</span><span class="sc">;</span>
 862 
 863   <span class="i">$This</span><span class="i">-&gt;_InitializeStructureFeatures</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 864 
 865   <span class="c"># Collect atom IDs involved in unique atom identifiers...</span>
 866   <span class="i">%AtomIDs</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 867   <span class="k">for</span> <span class="i">$Radius</span> <span class="s">(</span><span class="n">0</span> .. <span class="i">$This</span>-&gt;{<span class="w">NeighborhoodRadius</span>}<span class="s">)</span> <span class="s">{</span>
 868     <span class="k">for</span> <span class="i">$AtomIdentifier</span> <span class="s">(</span><span class="k">keys</span> <span class="i">%</span>{<span class="i">$This</span>-&gt;{<span class="w">UniqueAtomIdentifiers</span>}{<span class="i">$Radius</span>}}<span class="s">)</span> <span class="s">{</span>
 869       <span class="i">$AtomID</span> = <span class="i">$This</span>-&gt;{<span class="w">UniqueAtomIdentifiers</span>}{<span class="i">$Radius</span>}{<span class="i">$AtomIdentifier</span>}<span class="sc">;</span>
 870       <span class="i">$AtomIDs</span>{<span class="i">$AtomID</span>} = <span class="i">$AtomID</span><span class="sc">;</span>
 871     <span class="s">}</span>
 872   <span class="s">}</span>
 873 
 874   <span class="c"># Setup structure features...</span>
 875   <span class="k">for</span> <span class="i">$Radius</span> <span class="s">(</span><span class="n">0</span> .. <span class="i">$This</span>-&gt;{<span class="w">NeighborhoodRadius</span>}<span class="s">)</span> <span class="s">{</span>
 876     <span class="k">for</span> <span class="i">$AtomID</span> <span class="s">(</span><span class="k">keys</span> <span class="i">%AtomIDs</span><span class="s">)</span> <span class="s">{</span>
 877       <span class="k">my</span><span class="s">(</span><span class="i">$StructureFeatureAtomCount</span><span class="cm">,</span> <span class="i">%StructureFeatureAtomIDs</span><span class="s">)</span><span class="sc">;</span>
 878 
 879       <span class="i">$StructureFeatureAtomCount</span> = <span class="n">0</span><span class="sc">;</span>
 880       <span class="i">%StructureFeatureAtomIDs</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 881 
 882       <span class="c"># Get partial structure features for the atom at previous radius level...</span>
 883       <span class="i">$PreviousRadius</span> = <span class="i">$Radius</span> - <span class="n">1</span><span class="sc">;</span>
 884       <span class="k">if</span> <span class="s">(</span><span class="i">$PreviousRadius</span> &gt;= <span class="n">0</span><span class="s">)</span> <span class="s">{</span>
 885         <span class="i">$StructureFeatureAtomCount</span> += <span class="i">$This</span>-&gt;{<span class="w">StructureFeatures</span>}{<span class="w">AtomCount</span>}{<span class="i">$PreviousRadius</span>}{<span class="i">$AtomID</span>}<span class="sc">;</span>
 886         <span class="i">%StructureFeatureAtomIDs</span> = <span class="i">%</span>{<span class="i">$This</span>-&gt;{<span class="w">StructureFeatures</span>}{<span class="w">AtomIDs</span>}{<span class="i">$PreviousRadius</span>}{<span class="i">$AtomID</span>}}<span class="sc">;</span>
 887       <span class="s">}</span>
 888 
 889       <span class="c"># Get all neighborhood atom at this radius level...</span>
 890       <span class="k">if</span> <span class="s">(</span><span class="k">exists</span><span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomNeighborhoods</span>}{<span class="i">$Radius</span>}<span class="s">)</span> &amp;&amp; <span class="k">exists</span><span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomNeighborhoods</span>}{<span class="i">$Radius</span>}{<span class="i">$AtomID</span>}<span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 891         <span class="j">NEIGHBORHOODS:</span> <span class="k">for</span> <span class="i">$NeighborhoodAtomsWithSuccessorAtomsRef</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">AtomNeighborhoods</span>}{<span class="i">$Radius</span>}{<span class="i">$AtomID</span>}}<span class="s">)</span> <span class="s">{</span>
 892           <span class="s">(</span><span class="i">$NeighborhoodAtom</span><span class="cm">,</span> <span class="i">$NeighborhoodAtomSuccessorAtomsRef</span><span class="s">)</span> = <span class="i">@</span>{<span class="i">$NeighborhoodAtomsWithSuccessorAtomsRef</span>}<span class="sc">;</span>
 893           <span class="k">if</span> <span class="s">(</span><span class="i">$NeighborhoodAtom</span><span class="i">-&gt;IsHydrogen</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 894             <span class="k">next</span> <span class="j">NEIGHBORHOODS</span><span class="sc">;</span>
 895           <span class="s">}</span>
 896           <span class="i">$NeighborhoodAtomID</span> = <span class="i">$NeighborhoodAtom</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 897           <span class="i">$StructureFeatureAtomCount</span>++<span class="sc">;</span>
 898           <span class="i">$StructureFeatureAtomIDs</span>{<span class="i">$NeighborhoodAtomID</span>} = <span class="i">$NeighborhoodAtomID</span><span class="sc">;</span>
 899         <span class="s">}</span>
 900       <span class="s">}</span>
 901 
 902       <span class="c"># Assign structure features to atom at this radius level...</span>
 903       <span class="i">$This</span>-&gt;{<span class="w">StructureFeatures</span>}{<span class="w">AtomCount</span>}{<span class="i">$Radius</span>}{<span class="i">$AtomID</span>} = <span class="i">$StructureFeatureAtomCount</span><span class="sc">;</span>
 904       <span class="i">$This</span>-&gt;{<span class="w">StructureFeatures</span>}{<span class="w">AtomIDs</span>}{<span class="i">$Radius</span>}{<span class="i">$AtomID</span>} = \<span class="i">%StructureFeatureAtomIDs</span><span class="sc">;</span>
 905     <span class="s">}</span>
 906   <span class="s">}</span>
 907   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 908 <span class="s">}</span>
 909 
 910 <span class="c"># Intialize structure features at each radius level...</span>
 911 <span class="c">#</span>
<a name="_InitializeStructureFeatures-"></a> 912 <span class="k">sub </span><span class="m">_InitializeStructureFeatures</span> <span class="s">{</span>
 913   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 914   <span class="k">my</span><span class="s">(</span><span class="i">$Radius</span><span class="cm">,</span> <span class="i">$CurrentRadius</span><span class="cm">,</span> <span class="i">$Atom</span><span class="cm">,</span> <span class="i">$AtomID</span><span class="s">)</span><span class="sc">;</span>
 915 
 916   <span class="c"># Initialize all structure features...</span>
 917 
 918   <span class="i">%</span>{<span class="i">$This</span>-&gt;{<span class="w">StructureFeatures</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 919   <span class="i">%</span>{<span class="i">$This</span>-&gt;{<span class="w">StructureFeatures</span>}{<span class="w">AtomCount</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 920   <span class="i">%</span>{<span class="i">$This</span>-&gt;{<span class="w">StructureFeatures</span>}{<span class="w">AtomIDs</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 921 
 922   <span class="i">$Radius</span> = <span class="i">$This</span>-&gt;{<span class="w">NeighborhoodRadius</span>}<span class="sc">;</span>
 923   <span class="k">for</span> <span class="i">$CurrentRadius</span> <span class="s">(</span><span class="n">0</span> .. <span class="i">$Radius</span><span class="s">)</span> <span class="s">{</span>
 924     <span class="c"># Structure features for at specific radii accessed using atom IDs...</span>
 925     <span class="i">%</span>{<span class="i">$This</span>-&gt;{<span class="w">StructureFeatures</span>}{<span class="w">AtomCount</span>}{<span class="i">$CurrentRadius</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 926     <span class="i">%</span>{<span class="i">$This</span>-&gt;{<span class="w">StructureFeatures</span>}{<span class="w">AtomIDs</span>}{<span class="i">$CurrentRadius</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 927   <span class="s">}</span>
 928   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 929 <span class="s">}</span>
 930 
 931 <span class="c"># Cache  appropriate molecule data...</span>
 932 <span class="c">#</span>
<a name="_SetupMoleculeDataCache-"></a> 933 <span class="k">sub </span><span class="m">_SetupMoleculeDataCache</span> <span class="s">{</span>
 934   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 935 
 936   <span class="c"># Get all non-hydrogen atoms...</span>
 937   <span class="k">my</span><span class="s">(</span><span class="i">$NegateAtomCheckMethod</span><span class="s">)</span><span class="sc">;</span>
 938   <span class="i">$NegateAtomCheckMethod</span> = <span class="n">1</span><span class="sc">;</span>
 939   <span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">Atoms</span>}} = <span class="i">$This</span><span class="i">-&gt;GetMolecule</span><span class="s">(</span><span class="s">)</span><span class="i">-&gt;GetAtoms</span><span class="s">(</span><span class="q">&quot;IsHydrogen&quot;</span><span class="cm">,</span> <span class="i">$NegateAtomCheckMethod</span><span class="s">)</span><span class="sc">;</span>
 940 
 941   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 942 <span class="s">}</span>
 943 
 944 <span class="c"># Clear cached molecule data...</span>
 945 <span class="c">#</span>
<a name="_ClearMoleculeDataCache-"></a> 946 <span class="k">sub </span><span class="m">_ClearMoleculeDataCache</span> <span class="s">{</span>
 947   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 948 
 949   <span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">Atoms</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 950 
 951   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 952 <span class="s">}</span>
 953 
 954 <span class="c"># Initialize atom indentifier type information...</span>
 955 <span class="c">#</span>
 956 <span class="c"># Current supported values:</span>
 957 <span class="c">#</span>
 958 <span class="c"># AtomicInvariantsAtomTypes, FunctionalClassAtomTypes, DREIDINGAtomTypes, EStateAtomTypes,</span>
 959 <span class="c"># MMFF94AtomTypes, SLogPAtomTypes, SYBYLAtomTypes, TPSAAtomTypes, UFFAtomTypes</span>
 960 <span class="c">#</span>
<a name="_InitializeAtomIdentifierTypeInformation-"></a> 961 <span class="k">sub </span><span class="m">_InitializeAtomIdentifierTypeInformation</span> <span class="s">{</span>
 962   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 963 
 964   <span class="j">IDENTIFIERTYPE:</span> <span class="s">{</span>
 965     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomIdentifierType</span>} =~ <span class="q">/^AtomicInvariantsAtomTypes$/i</span><span class="s">)</span> <span class="s">{</span>
 966       <span class="i">$This</span><span class="i">-&gt;_InitializeAtomicInvariantsAtomTypesInformation</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 967       <span class="k">last</span> <span class="j">IDENTIFIERTYPE</span><span class="sc">;</span>
 968     <span class="s">}</span>
 969     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomIdentifierType</span>} =~ <span class="q">/^FunctionalClassAtomTypes$/i</span><span class="s">)</span> <span class="s">{</span>
 970       <span class="i">$This</span><span class="i">-&gt;_InitializeFunctionalClassAtomTypesInformation</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 971       <span class="k">last</span> <span class="j">IDENTIFIERTYPE</span><span class="sc">;</span>
 972     <span class="s">}</span>
 973     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomIdentifierType</span>} =~ <span class="q">/^(DREIDINGAtomTypes|EStateAtomTypes|MMFF94AtomTypes|SLogPAtomTypes|SYBYLAtomTypes|TPSAAtomTypes|UFFAtomTypes)$/i</span><span class="s">)</span> <span class="s">{</span>
 974       <span class="c"># Nothing to do for now...</span>
 975       <span class="k">last</span> <span class="j">IDENTIFIERTYPE</span><span class="sc">;</span>
 976     <span class="s">}</span>
 977     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;_InitializeAtomIdentifierTypeInformation: Unknown atom indentifier type $This-&gt;{AtomIdentifierType}...&quot;</span><span class="sc">;</span>
 978   <span class="s">}</span>
 979   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 980 <span class="s">}</span>
 981 
 982 <span class="c"># Initialize atomic invariants atom types, generated by AtomTypes::AtomicInvariantsAtomTypes</span>
 983 <span class="c"># class, to use for generating initial atom identifiers...</span>
 984 <span class="c">#</span>
 985 <span class="c"># Let:</span>
 986 <span class="c">#   AS = Atom symbol corresponding to element symbol</span>
 987 <span class="c">#</span>
 988 <span class="c">#   X&lt;n&gt;   = Number of non-hydrogen atom neighbors or heavy atoms attached to atom</span>
 989 <span class="c">#   BO&lt;n&gt; = Sum of bond orders to non-hydrogen atom neighbors or heavy atoms attached to atom</span>
 990 <span class="c">#   LBO&lt;n&gt; = Largest bond order of non-hydrogen atom neighbors or heavy atoms attached to atom</span>
 991 <span class="c">#   SB&lt;n&gt; = Number of single bonds to non-hydrogen atom neighbors or heavy atoms attached to atom</span>
 992 <span class="c">#   DB&lt;n&gt; = Number of double bonds to non-hydrogen atom neighbors or heavy atoms attached to atom</span>
 993 <span class="c">#   TB&lt;n&gt; = Number of triple bonds to non-hydrogen atom neighbors or heavy atoms attached to atom</span>
 994 <span class="c">#   H&lt;n&gt;   = Number of implicit and explicit hydrogens for atom</span>
 995 <span class="c">#   Ar     = Aromatic annotation indicating whether atom is aromatic</span>
 996 <span class="c">#   RA     = Ring atom annotation indicating whether atom is a ring</span>
 997 <span class="c">#   FC&lt;+n/-n&gt; = Formal charge assigned to atom</span>
 998 <span class="c">#   MN&lt;n&gt; = Mass number indicating isotope other than most abundant isotope</span>
 999 <span class="c">#   SM&lt;n&gt; = Spin multiplicity of atom. Possible values: 1 (singlet), 2 (doublet) or 3 (triplet)</span>
1000 <span class="c">#</span>
1001 <span class="c"># Then:</span>
1002 <span class="c">#</span>
1003 <span class="c">#   Atom type generated by AtomTypes::AtomicInvariantsAtomTypes class corresponds to:</span>
1004 <span class="c">#</span>
1005 <span class="c">#     AS.X&lt;n&gt;.BO&lt;n&gt;.LBO&lt;n&gt;.&lt;SB&gt;&lt;n&gt;.&lt;DB&gt;&lt;n&gt;.&lt;TB&gt;&lt;n&gt;.H&lt;n&gt;.Ar.RA.FC&lt;+n/-n&gt;.MN&lt;n&gt;.SM&lt;n&gt;</span>
1006 <span class="c">#</span>
1007 <span class="c"># Except for AS which is a required atomic invariant in atom types, all other atomic invariants are</span>
1008 <span class="c"># optional.</span>
1009 <span class="c">#</span>
1010 <span class="c"># Default atomic invariants used for generating inital atom identifiers are [ Ref 24 ]:</span>
1011 <span class="c">#</span>
1012 <span class="c">#   AS, X&lt;n&gt;, BO&lt;n&gt;, H&lt;n&gt;, FC&lt;+n/-n&gt;, MN&lt;n&gt;</span>
1013 <span class="c">#</span>
1014 <span class="c"># In addition to usage of abbreviations for specifying atomic invariants, the following descriptive words</span>
1015 <span class="c"># are also allowed:</span>
1016 <span class="c">#</span>
1017 <span class="c"># X : NumOfNonHydrogenAtomNeighbors or NumOfHeavyAtomNeighbors</span>
1018 <span class="c"># BO : SumOfBondOrdersToNonHydrogenAtoms or SumOfBondOrdersToHeavyAtoms</span>
1019 <span class="c"># LBO : LargestBondOrderToNonHydrogenAtoms or LargestBondOrderToHeavyAtoms</span>
1020 <span class="c"># SB :  NumOfSingleBondsToNonHydrogenAtoms or NumOfSingleBondsToHeavyAtoms</span>
1021 <span class="c"># DB : NumOfDoubleBondsToNonHydrogenAtoms or NumOfDoubleBondsToHeavyAtoms</span>
1022 <span class="c"># TB : NumOfTripleBondsToNonHydrogenAtoms or NumOfTripleBondsToHeavyAtoms</span>
1023 <span class="c"># H :  NumOfImplicitAndExplicitHydrogens</span>
1024 <span class="c"># Ar : Aromatic</span>
1025 <span class="c"># RA : RingAtom</span>
1026 <span class="c"># FC : FormalCharge</span>
1027 <span class="c"># MN : MassNumber</span>
1028 <span class="c"># SM : SpinMultiplicity</span>
1029 <span class="c">#</span>
<a name="_InitializeAtomicInvariantsAtomTypesInformation-"></a>1030 <span class="k">sub </span><span class="m">_InitializeAtomicInvariantsAtomTypesInformation</span> <span class="s">{</span>
1031   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1032 
1033   <span class="c"># Default atomic invariants to use for generating initial atom identifiers are: AS, X, BO, LBO, H, FC</span>
1034   <span class="c">#</span>
1035   <span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">AtomicInvariantsToUse</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1036   <span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">AtomicInvariantsToUse</span>}} = <span class="s">(</span><span class="q">&#39;AS&#39;</span><span class="cm">,</span> <span class="q">&#39;X&#39;</span><span class="cm">,</span> <span class="q">&#39;BO&#39;</span><span class="cm">,</span> <span class="q">&#39;H&#39;</span><span class="cm">,</span> <span class="q">&#39;FC&#39;</span><span class="cm">,</span> <span class="q">&#39;MN&#39;</span><span class="s">)</span><span class="sc">;</span>
1037 
1038   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
1039 <span class="s">}</span>
1040 
1041 <span class="c"># Initialize functional class atom types, generated by AtomTypes::FunctionalClassAtomTypes</span>
1042 <span class="c"># class, to use for generating initial atom identifiers...</span>
1043 <span class="c">#</span>
1044 <span class="c"># Let:</span>
1045 <span class="c">#   HBD: HydrogenBondDonor</span>
1046 <span class="c">#   HBA: HydrogenBondAcceptor</span>
1047 <span class="c">#   PI :  PositivelyIonizable</span>
1048 <span class="c">#   NI : NegativelyIonizable</span>
1049 <span class="c">#   Ar : Aromatic</span>
1050 <span class="c">#   Hal : Halogen</span>
1051 <span class="c">#   H : Hydrophobic</span>
1052 <span class="c">#   RA : RingAtom</span>
1053 <span class="c">#   CA : ChainAtom</span>
1054 <span class="c">#</span>
1055 <span class="c"># Then:</span>
1056 <span class="c">#</span>
1057 <span class="c">#   Functiononal class atom type specification for an atom corresponds to:</span>
1058 <span class="c">#</span>
1059 <span class="c">#     Ar.CA.H.HBA.HBD.Hal.NI.PI.RA</span>
1060 <span class="c">#</span>
1061 <span class="c">#   Default functional classes used are: HBD, HBA, PI, NI, Ar, Hal</span>
1062 <span class="c">#</span>
1063 <span class="c">#   FunctionalAtomTypes are assigned using the following definitions [ Ref 60-61, Ref 65-66 ]:</span>
1064 <span class="c">#</span>
1065 <span class="c">#     HydrogenBondDonor: NH, NH2, OH</span>
1066 <span class="c">#     HydrogenBondAcceptor: N[!H], O</span>
1067 <span class="c">#     PositivelyIonizable: +, NH2</span>
1068 <span class="c">#     NegativelyIonizable: -, C(=O)OH, S(=O)OH, P(=O)OH</span>
1069 <span class="c">#</span>
<a name="_InitializeFunctionalClassAtomTypesInformation-"></a>1070 <span class="k">sub </span><span class="m">_InitializeFunctionalClassAtomTypesInformation</span> <span class="s">{</span>
1071   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1072 
1073   <span class="c"># Default functional class atom typess to use for generating initial atom identifiers</span>
1074   <span class="c"># are: HBD, HBA, PI, NI, Ar, Hal</span>
1075   <span class="c">#</span>
1076   <span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">FunctionalClassesToUse</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1077   <span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">FunctionalClassesToUse</span>}} = <span class="s">(</span><span class="q">&#39;HBD&#39;</span><span class="cm">,</span> <span class="q">&#39;HBA&#39;</span><span class="cm">,</span> <span class="q">&#39;PI&#39;</span><span class="cm">,</span> <span class="q">&#39;NI&#39;</span><span class="cm">,</span> <span class="q">&#39;Ar&#39;</span><span class="cm">,</span> <span class="q">&#39;Hal&#39;</span><span class="s">)</span><span class="sc">;</span>
1078 
1079   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
1080 <span class="s">}</span>
1081 
1082 <span class="c"># Set atomic invariants to use for generation of intial atom indentifiers...</span>
1083 <span class="c">#</span>
<a name="SetAtomicInvariantsToUse-"></a>1084 <span class="k">sub </span><span class="m">SetAtomicInvariantsToUse</span> <span class="s">{</span>
1085   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">@Values</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1086   <span class="k">my</span><span class="s">(</span><span class="i">$FirstValue</span><span class="cm">,</span> <span class="i">$TypeOfFirstValue</span><span class="cm">,</span> <span class="i">$AtomicInvariant</span><span class="cm">,</span> <span class="i">$SpecifiedAtomicInvariant</span><span class="cm">,</span> <span class="i">@SpecifiedAtomicInvariants</span><span class="cm">,</span> <span class="i">@AtomicInvariantsToUse</span><span class="s">)</span><span class="sc">;</span>
1087 
1088   <span class="k">if</span> <span class="s">(</span>!<span class="i">@Values</span><span class="s">)</span> <span class="s">{</span>
1089     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;SetAtomicInvariantsToUse: No values specified...&quot;</span><span class="sc">;</span>
1090     <span class="k">return</span><span class="sc">;</span>
1091   <span class="s">}</span>
1092 
1093   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomIdentifierType</span>} !~ <span class="q">/^AtomicInvariantsAtomTypes$/i</span><span class="s">)</span> <span class="s">{</span>
1094     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;SetFunctionalAtomTypesToUse: AtomicInvariantsToUse can&#39;t be set for InitialAtomIdentifierType of $This-&gt;{AtomIdentifierType}...&quot;</span><span class="sc">;</span>
1095     <span class="k">return</span><span class="sc">;</span>
1096   <span class="s">}</span>
1097 
1098   <span class="i">$FirstValue</span> = <span class="i">$Values</span>[<span class="n">0</span>]<span class="sc">;</span>
1099   <span class="i">$TypeOfFirstValue</span> = <span class="k">ref</span> <span class="i">$FirstValue</span><span class="sc">;</span>
1100 
1101   <span class="i">@SpecifiedAtomicInvariants</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1102   <span class="i">@AtomicInvariantsToUse</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1103 
1104   <span class="k">if</span> <span class="s">(</span><span class="i">$TypeOfFirstValue</span> =~ <span class="q">/^ARRAY/</span><span class="s">)</span> <span class="s">{</span>
1105     <span class="k">push</span> <span class="i">@SpecifiedAtomicInvariants</span><span class="cm">,</span> <span class="i">@</span>{<span class="i">$FirstValue</span>}<span class="sc">;</span>
1106   <span class="s">}</span>
1107   <span class="k">else</span> <span class="s">{</span>
1108     <span class="k">push</span> <span class="i">@SpecifiedAtomicInvariants</span><span class="cm">,</span> <span class="i">@Values</span><span class="sc">;</span>
1109   <span class="s">}</span>
1110 
1111   <span class="c"># Make sure specified AtomicInvariants are valid...</span>
1112   <span class="k">for</span> <span class="i">$SpecifiedAtomicInvariant</span> <span class="s">(</span><span class="i">@SpecifiedAtomicInvariants</span><span class="s">)</span> <span class="s">{</span>
1113     <span class="k">if</span> <span class="s">(</span>!<span class="i">AtomTypes::AtomicInvariantsAtomTypes::IsAtomicInvariantAvailable</span><span class="s">(</span><span class="i">$SpecifiedAtomicInvariant</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1114       <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;SetAtomicInvariantsToUse: Specified atomic invariant, $SpecifiedAtomicInvariant, is not supported...\n &quot;</span><span class="sc">;</span>
1115     <span class="s">}</span>
1116     <span class="i">$AtomicInvariant</span> = <span class="i">$SpecifiedAtomicInvariant</span><span class="sc">;</span>
1117     <span class="k">push</span> <span class="i">@AtomicInvariantsToUse</span><span class="cm">,</span> <span class="i">$AtomicInvariant</span><span class="sc">;</span>
1118   <span class="s">}</span>
1119 
1120   <span class="c"># Set atomic invariants to use...</span>
1121   <span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">AtomicInvariantsToUse</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1122   <span class="k">push</span> <span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">AtomicInvariantsToUse</span>}}<span class="cm">,</span> <span class="i">@AtomicInvariantsToUse</span><span class="sc">;</span>
1123 
1124   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
1125 <span class="s">}</span>
1126 
1127 <span class="c"># Set functional classes to use for generation of intial atom indentifiers...</span>
1128 <span class="c">#</span>
<a name="SetFunctionalClassesToUse-"></a>1129 <span class="k">sub </span><span class="m">SetFunctionalClassesToUse</span> <span class="s">{</span>
1130   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">@Values</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1131   <span class="k">my</span><span class="s">(</span><span class="i">$FirstValue</span><span class="cm">,</span> <span class="i">$TypeOfFirstValue</span><span class="cm">,</span> <span class="i">$FunctionalClass</span><span class="cm">,</span> <span class="i">$SpecifiedFunctionalClass</span><span class="cm">,</span> <span class="i">@SpecifiedFunctionalClasses</span><span class="cm">,</span> <span class="i">@FunctionalClassesToUse</span><span class="s">)</span><span class="sc">;</span>
1132 
1133   <span class="k">if</span> <span class="s">(</span>!<span class="i">@Values</span><span class="s">)</span> <span class="s">{</span>
1134     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;SetFunctionalClassesToUse: No values specified...&quot;</span><span class="sc">;</span>
1135     <span class="k">return</span><span class="sc">;</span>
1136   <span class="s">}</span>
1137 
1138   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomIdentifierType</span>} !~ <span class="q">/^FunctionalClassAtomTypes$/i</span><span class="s">)</span> <span class="s">{</span>
1139     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;SetFunctionalClassesToUse: FunctionalClassesToUse can&#39;t be set for InitialAtomIdentifierType of $This-&gt;{AtomIdentifierType}...&quot;</span><span class="sc">;</span>
1140     <span class="k">return</span><span class="sc">;</span>
1141   <span class="s">}</span>
1142 
1143   <span class="i">$FirstValue</span> = <span class="i">$Values</span>[<span class="n">0</span>]<span class="sc">;</span>
1144   <span class="i">$TypeOfFirstValue</span> = <span class="k">ref</span> <span class="i">$FirstValue</span><span class="sc">;</span>
1145 
1146   <span class="i">@SpecifiedFunctionalClasses</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1147   <span class="i">@FunctionalClassesToUse</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1148 
1149   <span class="k">if</span> <span class="s">(</span><span class="i">$TypeOfFirstValue</span> =~ <span class="q">/^ARRAY/</span><span class="s">)</span> <span class="s">{</span>
1150     <span class="k">push</span> <span class="i">@SpecifiedFunctionalClasses</span><span class="cm">,</span> <span class="i">@</span>{<span class="i">$FirstValue</span>}<span class="sc">;</span>
1151   <span class="s">}</span>
1152   <span class="k">else</span> <span class="s">{</span>
1153     <span class="k">push</span> <span class="i">@SpecifiedFunctionalClasses</span><span class="cm">,</span> <span class="i">@Values</span><span class="sc">;</span>
1154   <span class="s">}</span>
1155 
1156   <span class="c"># Make sure specified FunctionalClasses are valid...</span>
1157   <span class="k">for</span> <span class="i">$SpecifiedFunctionalClass</span> <span class="s">(</span><span class="i">@SpecifiedFunctionalClasses</span><span class="s">)</span> <span class="s">{</span>
1158     <span class="k">if</span> <span class="s">(</span>!<span class="i">AtomTypes::FunctionalClassAtomTypes::IsFunctionalClassAvailable</span><span class="s">(</span><span class="i">$SpecifiedFunctionalClass</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1159       <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;SetFunctionalClassesToUse: Specified functional class, $SpecifiedFunctionalClass, is not supported...\n &quot;</span><span class="sc">;</span>
1160     <span class="s">}</span>
1161     <span class="k">push</span> <span class="i">@FunctionalClassesToUse</span><span class="cm">,</span> <span class="i">$SpecifiedFunctionalClass</span><span class="sc">;</span>
1162   <span class="s">}</span>
1163 
1164   <span class="c"># Set functional classes to use...</span>
1165   <span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">FunctionalClassesToUse</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1166   <span class="k">push</span> <span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">FunctionalClassesToUse</span>}}<span class="cm">,</span> <span class="i">@FunctionalClassesToUse</span><span class="sc">;</span>
1167 
1168   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
1169 <span class="s">}</span>
1170 
1171 <span class="c"># Return a string containg data for ExtendedConnectivityFingerprints object...</span>
<a name="StringifyExtendedConnectivityFingerprints-"></a>1172 <span class="k">sub </span><span class="m">StringifyExtendedConnectivityFingerprints</span> <span class="s">{</span>
1173   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1174   <span class="k">my</span><span class="s">(</span><span class="i">$ExtendedConnectivityFingerprintsString</span><span class="s">)</span><span class="sc">;</span>
1175 
1176   <span class="i">$ExtendedConnectivityFingerprintsString</span> = <span class="q">&quot;InitialAtomIdentifierType: $This-&gt;{AtomIdentifierType}; NeighborhoodRadius: $This-&gt;{NeighborhoodRadius}&quot;</span><span class="sc">;</span>
1177 
1178   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomIdentifierType</span>} =~ <span class="q">/^AtomicInvariantsAtomTypes$/i</span><span class="s">)</span> <span class="s">{</span>
1179     <span class="k">my</span><span class="s">(</span><span class="i">$AtomicInvariant</span><span class="cm">,</span> <span class="i">@AtomicInvariants</span><span class="cm">,</span> <span class="i">@AtomicInvariantsOrder</span><span class="cm">,</span> <span class="i">%AvailableAtomicInvariants</span><span class="s">)</span><span class="sc">;</span>
1180 
1181     <span class="i">@AtomicInvariantsOrder</span> = <span class="i">AtomTypes::AtomicInvariantsAtomTypes::GetAtomicInvariantsOrder</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1182     <span class="i">%AvailableAtomicInvariants</span> = <span class="i">AtomTypes::AtomicInvariantsAtomTypes::GetAvailableAtomicInvariants</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1183 
1184     <span class="k">for</span> <span class="i">$AtomicInvariant</span> <span class="s">(</span><span class="i">@AtomicInvariantsOrder</span><span class="s">)</span> <span class="s">{</span>
1185       <span class="k">push</span> <span class="i">@AtomicInvariants</span><span class="cm">,</span> <span class="q">&quot;$AtomicInvariant: $AvailableAtomicInvariants{$AtomicInvariant}&quot;</span><span class="sc">;</span>
1186     <span class="s">}</span>
1187 
1188     <span class="i">$ExtendedConnectivityFingerprintsString</span> .= <span class="q">&quot;; AtomicInvariantsToUse: &lt;&quot;</span> . <span class="i">TextUtil::JoinWords</span><span class="s">(</span>\<span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">AtomicInvariantsToUse</span>}}<span class="cm">,</span> <span class="q">&quot;, &quot;</span><span class="cm">,</span> <span class="n">0</span><span class="s">)</span> . <span class="q">&quot;&gt;&quot;</span><span class="sc">;</span>
1189     <span class="i">$ExtendedConnectivityFingerprintsString</span> .= <span class="q">&quot;; AtomicInvariantsOrder: &lt;&quot;</span> . <span class="i">TextUtil::JoinWords</span><span class="s">(</span>\<span class="i">@AtomicInvariantsOrder</span><span class="cm">,</span> <span class="q">&quot;, &quot;</span><span class="cm">,</span> <span class="n">0</span><span class="s">)</span> . <span class="q">&quot;&gt;&quot;</span><span class="sc">;</span>
1190     <span class="i">$ExtendedConnectivityFingerprintsString</span> .= <span class="q">&quot;; AvailableAtomicInvariants: &lt;&quot;</span> . <span class="i">TextUtil::JoinWords</span><span class="s">(</span>\<span class="i">@AtomicInvariants</span><span class="cm">,</span> <span class="q">&quot;, &quot;</span><span class="cm">,</span> <span class="n">0</span><span class="s">)</span> . <span class="q">&quot;&gt;&quot;</span><span class="sc">;</span>
1191   <span class="s">}</span>
1192   <span class="k">elsif</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomIdentifierType</span>} =~ <span class="q">/^FunctionalClassAtomTypes$/i</span><span class="s">)</span> <span class="s">{</span>
1193     <span class="k">my</span><span class="s">(</span><span class="i">$FunctionalClass</span><span class="cm">,</span> <span class="i">@FunctionalClasses</span><span class="cm">,</span> <span class="i">@FunctionalClassesOrder</span><span class="cm">,</span> <span class="i">%AvailableFunctionalClasses</span><span class="s">)</span><span class="sc">;</span>
1194 
1195     <span class="i">@FunctionalClassesOrder</span> = <span class="i">AtomTypes::FunctionalClassAtomTypes::GetFunctionalClassesOrder</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1196     <span class="i">%AvailableFunctionalClasses</span> = <span class="i">AtomTypes::FunctionalClassAtomTypes::GetAvailableFunctionalClasses</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1197 
1198     <span class="k">for</span> <span class="i">$FunctionalClass</span> <span class="s">(</span><span class="i">@FunctionalClassesOrder</span><span class="s">)</span> <span class="s">{</span>
1199       <span class="k">push</span> <span class="i">@FunctionalClasses</span><span class="cm">,</span> <span class="q">&quot;$FunctionalClass: $AvailableFunctionalClasses{$FunctionalClass}&quot;</span><span class="sc">;</span>
1200     <span class="s">}</span>
1201 
1202     <span class="i">$ExtendedConnectivityFingerprintsString</span> .= <span class="q">&quot;; FunctionalClassesToUse: &lt;&quot;</span> . <span class="i">TextUtil::JoinWords</span><span class="s">(</span>\<span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">FunctionalClassesToUse</span>}}<span class="cm">,</span> <span class="q">&quot;, &quot;</span><span class="cm">,</span> <span class="n">0</span><span class="s">)</span> . <span class="q">&quot;&gt;&quot;</span><span class="sc">;</span>
1203     <span class="i">$ExtendedConnectivityFingerprintsString</span> .= <span class="q">&quot;; FunctionalClassesOrder: &lt;&quot;</span> . <span class="i">TextUtil::JoinWords</span><span class="s">(</span>\<span class="i">@FunctionalClassesOrder</span><span class="cm">,</span> <span class="q">&quot;, &quot;</span><span class="cm">,</span> <span class="n">0</span><span class="s">)</span> . <span class="q">&quot;&gt;&quot;</span><span class="sc">;</span>
1204     <span class="i">$ExtendedConnectivityFingerprintsString</span> .= <span class="q">&quot;; AvailableFunctionalClasses: &lt;&quot;</span> . <span class="i">TextUtil::JoinWords</span><span class="s">(</span>\<span class="i">@FunctionalClasses</span><span class="cm">,</span> <span class="q">&quot;, &quot;</span><span class="cm">,</span> <span class="n">0</span><span class="s">)</span> . <span class="q">&quot;&gt;&quot;</span><span class="sc">;</span>
1205   <span class="s">}</span>
1206 
1207   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">Type</span>} =~ <span class="q">/^ExtendedConnectivityBits$/i</span><span class="s">)</span> <span class="s">{</span>
1208     <span class="c"># Size...</span>
1209     <span class="i">$ExtendedConnectivityFingerprintsString</span> .= <span class="q">&quot;; Size: $This-&gt;{Size}; MinSize: $This-&gt;{MinSize}; MaxSize: $This-&gt;{MaxSize}&quot;</span><span class="sc">;</span>
1210 
1211     <span class="c"># Fingerprint bit density and num of bits set...</span>
1212     <span class="k">my</span><span class="s">(</span><span class="i">$NumOfSetBits</span><span class="cm">,</span> <span class="i">$BitDensity</span><span class="s">)</span><span class="sc">;</span>
1213     <span class="i">$NumOfSetBits</span> = <span class="i">$This</span>-&gt;{<span class="w">FingerprintsBitVector</span>}<span class="i">-&gt;GetNumOfSetBits</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1214     <span class="i">$BitDensity</span> = <span class="i">$This</span>-&gt;{<span class="w">FingerprintsBitVector</span>}<span class="i">-&gt;GetFingerprintsBitDensity</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1215     <span class="i">$ExtendedConnectivityFingerprintsString</span> .= <span class="q">&quot;; NumOfOnBits: $NumOfSetBits; BitDensity: $BitDensity&quot;</span><span class="sc">;</span>
1216 
1217     <span class="i">$ExtendedConnectivityFingerprintsString</span> .= <span class="q">&quot;; FingerprintsBitVector: &lt; $This-&gt;{FingerprintsBitVector} &gt;&quot;</span><span class="sc">;</span>
1218   <span class="s">}</span>
1219   <span class="k">else</span> <span class="s">{</span>
1220     <span class="c"># Number of identifiers...</span>
1221     <span class="i">$ExtendedConnectivityFingerprintsString</span> .= <span class="q">&quot;; NumOfIdentifiers: &quot;</span> . <span class="i">$This</span>-&gt;{<span class="w">FingerprintsVector</span>}<span class="i">-&gt;GetNumOfValues</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1222 
1223     <span class="c"># FingerprintsVector...</span>
1224     <span class="i">$ExtendedConnectivityFingerprintsString</span> .= <span class="q">&quot;; FingerprintsVector: &lt; $This-&gt;{FingerprintsVector} &gt;&quot;</span><span class="sc">;</span>
1225   <span class="s">}</span>
1226 
1227   <span class="k">return</span> <span class="i">$ExtendedConnectivityFingerprintsString</span><span class="sc">;</span>
1228 <span class="s">}</span>
1229 
<a name="EOF-"></a></pre>
<p>&nbsp;</p>
<br />
<center>
<img src="../../../images/h2o2.png">
</center>
</body>
</html>
