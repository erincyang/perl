<html>
<head>
<title>MayaChemTools:Code:FileIO::FingerprintsSDFileIO.pm</title>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<link rel="stylesheet" type="text/css" href="../../../css/MayaChemToolsCode.css">
</head>
<body leftmargin="20" rightmargin="20" topmargin="10" bottommargin="10">
<br/>
<center>
<a href="http://www.mayachemtools.org" title="MayaChemTools Home"><img src="../../../images/MayaChemToolsLogo.gif" border="0" alt="MayaChemTools"></a>
</center>
<br/>
<pre>
<a name="package-FileIO::FingerprintsSDFileIO-"></a>   1 <span class="k">package </span><span class="i">FileIO::FingerprintsSDFileIO</span><span class="sc">;</span>
   2 <span class="c">#</span>
   3 <span class="c"># $RCSfile: FingerprintsSDFileIO.pm,v $</span>
   4 <span class="c"># $Date: 2017/01/12 18:59:14 $</span>
   5 <span class="c"># $Revision: 1.20 $</span>
   6 <span class="c">#</span>
   7 <span class="c"># Author: Manish Sud &lt;msud@san.rr.com&gt;</span>
   8 <span class="c">#</span>
   9 <span class="c"># Copyright (C) 2017 Manish Sud. All rights reserved.</span>
  10 <span class="c">#</span>
  11 <span class="c"># This file is part of MayaChemTools.</span>
  12 <span class="c">#</span>
  13 <span class="c"># MayaChemTools is free software; you can redistribute it and/or modify it under</span>
  14 <span class="c"># the terms of the GNU Lesser General Public License as published by the Free</span>
  15 <span class="c"># Software Foundation; either version 3 of the License, or (at your option) any</span>
  16 <span class="c"># later version.</span>
  17 <span class="c">#</span>
  18 <span class="c"># MayaChemTools is distributed in the hope that it will be useful, but without</span>
  19 <span class="c"># any warranty; without even the implied warranty of merchantability of fitness</span>
  20 <span class="c"># for a particular purpose.  See the GNU Lesser General Public License for more</span>
  21 <span class="c"># details.</span>
  22 <span class="c">#</span>
  23 <span class="c"># You should have received a copy of the GNU Lesser General Public License</span>
  24 <span class="c"># along with MayaChemTools; if not, see &lt;http://www.gnu.org/licenses/&gt; or</span>
  25 <span class="c"># write to the Free Software Foundation Inc., 59 Temple Place, Suite 330,</span>
  26 <span class="c"># Boston, MA, 02111-1307, USA.</span>
  27 <span class="c">#</span>
  28 
  29 <span class="k">use</span> <span class="w">strict</span><span class="sc">;</span>
  30 <span class="k">use</span> <span class="w">Carp</span><span class="sc">;</span>
  31 <span class="k">use</span> <span class="w">Exporter</span><span class="sc">;</span>
  32 <span class="k">use</span> <span class="w">Scalar::Util</span> <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  33 <span class="k">use</span> <span class="w">TextUtil</span> <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  34 <span class="k">use</span> <span class="w">FileUtil</span> <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  35 <span class="k">use</span> <span class="w">SDFileUtil</span> <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  36 <span class="k">use</span> <span class="w">Fingerprints::FingerprintsStringUtil</span> <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  37 <span class="k">use</span> <span class="w">FileIO::FileIO</span><span class="sc">;</span>
  38 
  39 <span class="k">use</span> <span class="w">vars</span> <span class="q">qw(@ISA @EXPORT @EXPORT_OK %EXPORT_TAGS)</span><span class="sc">;</span>
  40 
  41 <span class="i">@ISA</span> = <span class="q">qw(FileIO::FileIO Exporter)</span><span class="sc">;</span>
  42 <span class="i">@EXPORT</span> = <span class="q">qw()</span><span class="sc">;</span>
  43 <span class="i">@EXPORT_OK</span> = <span class="q">qw(IsFingerprintsSDFile)</span><span class="sc">;</span>
  44 
  45 <span class="i">%EXPORT_TAGS</span> = <span class="s">(</span><span class="w">all</span>  <span class="cm">=&gt;</span> <span class="s">[</span><span class="i">@EXPORT</span><span class="cm">,</span> <span class="i">@EXPORT_OK</span><span class="s">]</span><span class="s">)</span><span class="sc">;</span>
  46 
  47 <span class="c"># Setup class variables...</span>
  48 <span class="k">my</span><span class="s">(</span><span class="i">$ClassName</span><span class="s">)</span><span class="sc">;</span>
  49 <span class="i">_InitializeClass</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  50 
  51 <span class="c"># Class constructor...</span>
<a name="new-"></a>  52 <span class="k">sub </span><span class="m">new</span> <span class="s">{</span>
  53   <span class="k">my</span><span class="s">(</span><span class="i">$Class</span><span class="cm">,</span> <span class="i">%NamesAndValues</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
  54 
  55   <span class="c"># Initialize object...</span>
  56   <span class="k">my</span> <span class="i">$This</span> = <span class="i">$Class</span><span class="i">-&gt;SUPER::new</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  57   <span class="k">bless</span> <span class="i">$This</span><span class="cm">,</span> <span class="k">ref</span><span class="s">(</span><span class="i">$Class</span><span class="s">)</span> || <span class="i">$Class</span><span class="sc">;</span>
  58   <span class="i">$This</span><span class="i">-&gt;_InitializeFingerprintsSDFileIO</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  59 
  60   <span class="i">$This</span><span class="i">-&gt;_InitializeFingerprintsSDFileIOProperties</span><span class="s">(</span><span class="i">%NamesAndValues</span><span class="s">)</span><span class="sc">;</span>
  61 
  62   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
  63 <span class="s">}</span>
  64 
  65 <span class="c"># Initialize object data...</span>
  66 <span class="c">#</span>
<a name="_InitializeFingerprintsSDFileIO-"></a>  67 <span class="k">sub </span><span class="m">_InitializeFingerprintsSDFileIO</span> <span class="s">{</span>
  68   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
  69 
  70   <span class="c"># Fingerprints string data format during read/write...</span>
  71   <span class="c">#</span>
  72   <span class="c"># For file read:</span>
  73   <span class="c">#</span>
  74   <span class="c"># AutoDetect  - automatically detect format of fingerprints string</span>
  75   <span class="c"># FingerprintsBitVectorString - Bit vector fingerprints string format</span>
  76   <span class="c"># FingerprintsVectorString - Vector fingerprints string format</span>
  77   <span class="c">#</span>
  78   <span class="c"># Default value: AutoDetect</span>
  79   <span class="c">#</span>
  80   <span class="c"># For file write:</span>
  81   <span class="c">#</span>
  82   <span class="c"># FingerprintsBitVectorString - Bit vector fingerprints string format</span>
  83   <span class="c"># FingerprintsVectorString - Vector fingerprints string format</span>
  84   <span class="c">#</span>
  85   <span class="c"># Default value: undef</span>
  86   <span class="c">#</span>
  87   <span class="i">$This</span>-&gt;{<span class="w">FingerprintsStringMode</span>} = <span class="k">undef</span><span class="sc">;</span>
  88 
  89   <span class="c"># For file read:</span>
  90   <span class="c">#</span>
  91   <span class="c">#   o Fingerprints bit-vector and vector object for current fingerprints string</span>
  92   <span class="c">#</span>
  93   <span class="c"># For file write:</span>
  94   <span class="c">#</span>
  95   <span class="c">#   o Fingerprints bit-vector and vector object for current fingerprints string</span>
  96   <span class="c">#   o Any supported fingerprints object: PathLengthFingerprints, ExtendedConnectivity, and so on.</span>
  97   <span class="c">#</span>
  98   <span class="i">$This</span>-&gt;{<span class="w">FingerprintsObject</span>} = <span class="k">undef</span><span class="sc">;</span>
  99 
 100   <span class="c"># Fingerprints SD file data field label during read/write</span>
 101   <span class="c">#</span>
 102   <span class="c"># For file read:</span>
 103   <span class="c">#</span>
 104   <span class="c"># Value of AutoDetect implies use first data field containing the word Fingerprints in its</span>
 105   <span class="c"># data field label to retrieve fingerprints string data. Othwewise, a valid data field name</span>
 106   <span class="c"># must be specified.</span>
 107   <span class="c">#</span>
 108   <span class="c"># For file write:</span>
 109   <span class="c">#</span>
 110   <span class="c"># Data field label to use for writing fingerprints string. Default: Fingerprints</span>
 111   <span class="c">#</span>
 112   <span class="i">$This</span>-&gt;{<span class="w">FingerprintsFieldLabel</span>} = <span class="k">undef</span><span class="sc">;</span>
 113 
 114   <span class="c"># Fingepritns string for current line during read/write...</span>
 115   <span class="i">$This</span>-&gt;{<span class="w">FingerprintsString</span>} = <span class="k">undef</span><span class="sc">;</span>
 116 
 117   <span class="c"># First compound data string read/write...</span>
 118   <span class="i">$This</span>-&gt;{<span class="w">FirstCompoundDataIO</span>} = <span class="n">1</span><span class="sc">;</span>
 119 
 120   <span class="c"># Current fingerprints string data compound number during read/write...</span>
 121   <span class="i">$This</span>-&gt;{<span class="w">CompoundNum</span>} = <span class="n">0</span><span class="sc">;</span>
 122 
 123   <span class="c"># Compound data string during read/write...</span>
 124   <span class="i">$This</span>-&gt;{<span class="w">CompoundString</span>} = <span class="k">undef</span><span class="sc">;</span>
 125 
 126   <span class="c"># Initialize parameters for read...</span>
 127   <span class="i">$This</span><span class="i">-&gt;_InitializeFingerprintsSDFileIORead</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 128 
 129   <span class="c"># Initialize parameters for write...</span>
 130   <span class="i">$This</span><span class="i">-&gt;_InitializeFingerprintsSDFileIOWrite</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 131 
 132   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 133 <span class="s">}</span>
 134 
 135 <span class="c"># Initialize class ...</span>
<a name="_InitializeClass-"></a> 136 <span class="k">sub </span><span class="m">_InitializeClass</span> <span class="s">{</span>
 137   <span class="c">#Class name...</span>
 138   <span class="i">$ClassName</span> = <span class="w">__PACKAGE__</span><span class="sc">;</span>
 139 
 140 <span class="s">}</span>
 141 
 142 <span class="c"># Initialize object data for reading fingerprints SD file...</span>
 143 <span class="c">#</span>
<a name="_InitializeFingerprintsSDFileIORead-"></a> 144 <span class="k">sub </span><span class="m">_InitializeFingerprintsSDFileIORead</span> <span class="s">{</span>
 145   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 146 
 147   <span class="c"># Compound ID mode to use for retrieving compound IDs for fingerprints...</span>
 148   <span class="c">#</span>
 149   <span class="c"># Specify how to generate compound IDs: use a SD file datafield value; use molname line from</span>
 150   <span class="c"># SD file; generate a sequential ID with specific prefix; use combination of both MolName and</span>
 151   <span class="c"># LabelPrefix with usage of LabelPrefix values for empty molname lines.</span>
 152   <span class="c">#</span>
 153   <span class="c"># Possible values: DataField, MolName, LabelPrefix, or MolNameOrLabelPrefix. Default: LabelPrefix.</span>
 154   <span class="c">#</span>
 155   <span class="c"># For MolNameAndLabelPrefix value of CompoundIDMode, molname line in SD file takes precedence over</span>
 156   <span class="c"># sequential compound IDs generated using LabelPrefix and only empty molname values are replaced</span>
 157   <span class="c"># with sequential compound IDs.</span>
 158   <span class="c">#</span>
 159   <span class="i">$This</span>-&gt;{<span class="w">CompoundIDMode</span>} = <span class="q">&#39;LabelPrefix&#39;</span><span class="sc">;</span>
 160 
 161   <span class="c">#</span>
 162   <span class="c"># Compound ID data field label name whose value is used as compound ID during DatafField value of</span>
 163   <span class="c"># CompoundIDMode</span>
 164   <span class="c">#</span>
 165   <span class="i">$This</span>-&gt;{<span class="w">CompoundIDFieldLabel</span>} = <span class="k">undef</span><span class="sc">;</span>
 166 
 167   <span class="c"># A prefix string used for generating compound IDs like LabelPrefixString&lt;Number&gt; during LabelPrefix</span>
 168   <span class="c"># or MolNameOrLabelPrefix value of  CompoundIDMode. Default value, Cmpd, generates compound IDs</span>
 169   <span class="c"># which look like Cmpd&lt;Number&gt;.</span>
 170   <span class="c">#</span>
 171   <span class="i">$This</span>-&gt;{<span class="w">CompoundIDPrefix</span>} = <span class="q">&#39;Cmpd&#39;</span><span class="sc">;</span>
 172 
 173   <span class="c"># By default, the fingerprints data corresponding to FingerprintsCol is assumed to</span>
 174   <span class="c"># be valid and no validation is performed before generating fingerprints objects...</span>
 175   <span class="c">#</span>
 176   <span class="i">$This</span>-&gt;{<span class="w">ValidateData</span>} = <span class="n">1</span><span class="sc">;</span>
 177 
 178   <span class="c"># Level of detail to print during validation of data for invalid or missing data...</span>
 179   <span class="i">$This</span>-&gt;{<span class="w">DetailLevel</span>} = <span class="n">1</span><span class="sc">;</span>
 180 
 181   <span class="c"># Number of missing and invalid fingerprints string data compound strings...</span>
 182   <span class="i">$This</span>-&gt;{<span class="w">NumOfCmpdsWithMissingData</span>} = <span class="n">0</span><span class="sc">;</span>
 183   <span class="i">$This</span>-&gt;{<span class="w">NumOfCmpdsWithInvalidData</span>} = <span class="n">0</span><span class="sc">;</span>
 184 
 185   <span class="c"># Compound ID for current fingerprints string...</span>
 186   <span class="i">$This</span>-&gt;{<span class="w">CompoundID</span>} = <span class="k">undef</span><span class="sc">;</span>
 187 
 188   <span class="c"># Compound data field labels and values map for current compound data...</span>
 189   <span class="i">%</span>{<span class="i">$This</span>-&gt;{<span class="w">DataFieldLabelsAndValues</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 190 
 191   <span class="c"># Status of data in fingerprints SD file...</span>
 192   <span class="i">$This</span>-&gt;{<span class="w">ValidFileData</span>} = <span class="n">0</span><span class="sc">;</span>
 193 
 194   <span class="i">$This</span>-&gt;{<span class="w">ValidCompoundIDField</span>} = <span class="n">0</span><span class="sc">;</span>
 195   <span class="i">$This</span>-&gt;{<span class="w">ValidFingerprintsField</span>} = <span class="n">0</span><span class="sc">;</span>
 196 
 197   <span class="i">$This</span>-&gt;{<span class="w">ValidFingerprintsStringMode</span>} = <span class="n">0</span><span class="sc">;</span>
 198 
 199   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 200 <span class="s">}</span>
 201 
 202 <span class="c"># Initialize object data for writing fingerprints SD file...</span>
 203 <span class="c">#</span>
<a name="_InitializeFingerprintsSDFileIOWrite-"></a> 204 <span class="k">sub </span><span class="m">_InitializeFingerprintsSDFileIOWrite</span> <span class="s">{</span>
 205   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 206 
 207   <span class="c"># Fingerprints bit vector string format...</span>
 208   <span class="c">#</span>
 209   <span class="c"># Possible values: BinaryString or HexadecimalString [Default]</span>
 210   <span class="c">#</span>
 211   <span class="c"># Default BitStringFormat is set during first write using Fingerprints::FingerprintsStringUtil::GetDefaultBitStringFormat.</span>
 212   <span class="c">#</span>
 213   <span class="i">$This</span>-&gt;{<span class="w">BitStringFormat</span>} = <span class="k">undef</span><span class="sc">;</span>
 214 
 215   <span class="c"># Bits order in fingerprints bit vector string...</span>
 216   <span class="c">#</span>
 217   <span class="c"># Ascending - First bit in each byte as the lowest bit [Default]</span>
 218   <span class="c"># Descending - First bit in each byte as the highest bit</span>
 219   <span class="c">#</span>
 220   <span class="c"># Default BitsOrder is set during first write using Fingerprints::FingerprintsStringUtil::GetDefaultBitsOrder.</span>
 221   <span class="c">#</span>
 222   <span class="i">$This</span>-&gt;{<span class="w">BitsOrder</span>} = <span class="k">undef</span><span class="sc">;</span>
 223 
 224   <span class="c"># Fingerprints vector string format...</span>
 225   <span class="c">#</span>
 226   <span class="c"># Possible values: IDsAndValuesString, IDsAndValuesPairsString, ValuesAndIDsString, ValuesAndIDsPairsString, ValuesString</span>
 227   <span class="c">#</span>
 228   <span class="c"># Default VectorStringFormat is set during first write using Fingerprints::FingerprintsStringUtil::GetDefaultVectorStringFormat.</span>
 229   <span class="c"># For fingerprints vector object containing vector NumericalValues, it corresponds to IDsAndValuesString; othwerwise,</span>
 230   <span class="c"># it&#39;s set to ValuesString.</span>
 231   <span class="c">#</span>
 232   <span class="i">$This</span>-&gt;{<span class="w">VectorStringFormat</span>} = <span class="k">undef</span><span class="sc">;</span>
 233 
 234   <span class="c"># Overwriting existing file...</span>
 235   <span class="i">$This</span>-&gt;{<span class="w">Overwrite</span>} = <span class="n">0</span><span class="sc">;</span>
 236 
 237   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 238 <span class="s">}</span>
 239 
 240 <span class="c"># Initialize object values...</span>
<a name="_InitializeFingerprintsSDFileIOProperties-"></a> 241 <span class="k">sub </span><span class="m">_InitializeFingerprintsSDFileIOProperties</span> <span class="s">{</span>
 242   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">%NamesAndValues</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 243 
 244   <span class="c"># All other property names and values along with all Set/Get&lt;PropertyName&gt; methods</span>
 245   <span class="c"># are implemented on-demand using ObjectProperty class.</span>
 246 
 247   <span class="k">my</span><span class="s">(</span><span class="i">$Name</span><span class="cm">,</span> <span class="i">$Value</span><span class="cm">,</span> <span class="i">$MethodName</span><span class="s">)</span><span class="sc">;</span>
 248   <span class="k">while</span> <span class="s">(</span><span class="s">(</span><span class="i">$Name</span><span class="cm">,</span> <span class="i">$Value</span><span class="s">)</span> = <span class="k">each</span>  <span class="i">%NamesAndValues</span><span class="s">)</span> <span class="s">{</span>
 249     <span class="i">$MethodName</span> = <span class="q">&quot;Set${Name}&quot;</span><span class="sc">;</span>
 250     <span class="i">$This</span><span class="i">-&gt;$MethodName</span><span class="s">(</span><span class="i">$Value</span><span class="s">)</span><span class="sc">;</span>
 251   <span class="s">}</span>
 252 
 253   <span class="k">if</span> <span class="s">(</span>!<span class="k">exists</span> <span class="i">$NamesAndValues</span>{<span class="w">Name</span>}<span class="s">)</span> <span class="s">{</span>
 254     <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;New: Object can&#39;t be instantiated without specifying file name...&quot;</span><span class="sc">;</span>
 255   <span class="s">}</span>
 256 
 257   <span class="c"># Make sure it&#39;s a fingerprints file...</span>
 258   <span class="i">$Name</span> = <span class="i">$NamesAndValues</span>{<span class="w">Name</span>}<span class="sc">;</span>
 259   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;IsFingerprintsSDFile</span><span class="s">(</span><span class="i">$Name</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 260     <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;New: Object can&#39;t be instantiated: File, $Name, doesn&#39;t appear to be fingerprints format...&quot;</span><span class="sc">;</span>
 261   <span class="s">}</span>
 262 
 263   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;GetMode</span><span class="s">(</span><span class="s">)</span> =~ <span class="q">/^Read$/i</span><span class="s">)</span> <span class="s">{</span>
 264     <span class="i">$This</span><span class="i">-&gt;_InitializeFingerprintsSDFileIOReadProperties</span><span class="s">(</span><span class="i">%NamesAndValues</span><span class="s">)</span><span class="sc">;</span>
 265   <span class="s">}</span>
 266   <span class="k">elsif</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;GetMode</span><span class="s">(</span><span class="s">)</span> =~ <span class="q">/^(Write|Append)$/i</span><span class="s">)</span> <span class="s">{</span>
 267     <span class="i">$This</span><span class="i">-&gt;_InitializeFingerprintsSDFileIOWriteProperties</span><span class="s">(</span><span class="i">%NamesAndValues</span><span class="s">)</span><span class="sc">;</span>
 268   <span class="s">}</span>
 269 
 270   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 271 <span class="s">}</span>
 272 
 273 <span class="c"># Initialize object properties for reading fingerprints SD file...</span>
 274 <span class="c">#</span>
<a name="_InitializeFingerprintsSDFileIOReadProperties-"></a> 275 <span class="k">sub </span><span class="m">_InitializeFingerprintsSDFileIOReadProperties</span> <span class="s">{</span>
 276   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">%NamesAndValues</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 277 
 278   <span class="c"># Set default value for FingerprintsStringMode...</span>
 279   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span>-&gt;{<span class="w">FingerprintsStringMode</span>}<span class="s">)</span> <span class="s">{</span>
 280     <span class="i">$This</span>-&gt;{<span class="w">FingerprintsStringMode</span>} = <span class="q">&#39;AutoDetect&#39;</span><span class="sc">;</span>
 281   <span class="s">}</span>
 282 
 283   <span class="c"># Set default value for FingerprintsFieldLabel...</span>
 284   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span>-&gt;{<span class="w">FingerprintsFieldLabel</span>}<span class="s">)</span> <span class="s">{</span>
 285     <span class="i">$This</span>-&gt;{<span class="w">FingerprintsFieldLabel</span>} = <span class="q">&#39;AutoDetect&#39;</span><span class="sc">;</span>
 286   <span class="s">}</span>
 287 
 288   <span class="c"># Check compound ID data field...</span>
 289   <span class="k">if</span> <span class="s">(</span><span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">CompoundIDMode</span>} =~ <span class="q">/^DataField$/i</span><span class="s">)</span> &amp;&amp; <span class="s">(</span>!<span class="k">defined</span><span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">CompoundIDFieldLabel</span>}<span class="s">)</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 290     <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;: Object can&#39;t be instantiated: Compound ID data field lable must be specifed using \&quot;CompoundIDFieldLabel\&quot; during \&quot;DataField\&quot; value of \&quot;CompoundIDMode\&quot;...&quot;</span><span class="sc">;</span>
 291   <span class="s">}</span>
 292 
 293   <span class="i">$This</span><span class="i">-&gt;_PrepareForReadingFingerprintsSDFileData</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 294 
 295   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 296 <span class="s">}</span>
 297 
 298 <span class="c"># Initialize object properties for writing fingerprints SD file...</span>
 299 <span class="c">#</span>
<a name="_InitializeFingerprintsSDFileIOWriteProperties-"></a> 300 <span class="k">sub </span><span class="m">_InitializeFingerprintsSDFileIOWriteProperties</span> <span class="s">{</span>
 301   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">%NamesAndValues</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 302 
 303   <span class="c"># Check FingerprintsStringMode value...</span>
 304   <span class="k">if</span> <span class="s">(</span>!<span class="k">exists</span> <span class="i">$NamesAndValues</span>{<span class="w">FingerprintsStringMode</span>}<span class="s">)</span> <span class="s">{</span>
 305     <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;New: Object can&#39;t be instantiated without specifying FingerprintsStringMode...&quot;</span><span class="sc">;</span>
 306   <span class="s">}</span>
 307 
 308   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">FingerprintsStringMode</span>} !~ <span class="q">/^(FingerprintsBitVectorString|FingerprintsVectorString)$/i</span><span class="s">)</span> <span class="s">{</span>
 309     <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;: Object can&#39;t be instantiated: FingerprintsStringMode value, $This-&gt;{FingerprintsStringMode}, is not valid; Supported values for write/append: FingerprintsBitVectorString or FingerprintsVectorString...&quot;</span><span class="sc">;</span>
 310   <span class="s">}</span>
 311 
 312   <span class="c"># Set default value for FingerprintsFieldLabel...</span>
 313   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span>-&gt;{<span class="w">FingerprintsFieldLabel</span>}<span class="s">)</span> <span class="s">{</span>
 314     <span class="i">$This</span>-&gt;{<span class="w">FingerprintsFieldLabel</span>} = <span class="q">&#39;Fingerprints&#39;</span><span class="sc">;</span>
 315   <span class="s">}</span>
 316 
 317   <span class="i">$This</span><span class="i">-&gt;_PrepareForWritingFingerprintsSDFileData</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 318 
 319   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 320 <span class="s">}</span>
 321 
 322 <span class="c"># Set FingerprintsStringMode...</span>
 323 <span class="c">#</span>
<a name="SetFingerprintsStringMode-"></a> 324 <span class="k">sub </span><span class="m">SetFingerprintsStringMode</span> <span class="s">{</span>
 325   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Value</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 326 
 327   <span class="c"># AutoDetect - automatically detect format of fingerprints string</span>
 328   <span class="c"># FingerprintsBitVectorString - Bit vector fingerprints string format</span>
 329   <span class="c"># FingerprintsVectorString - Vector fingerprints string format</span>
 330 
 331   <span class="k">if</span> <span class="s">(</span><span class="i">$Value</span> !~ <span class="q">/^(AutoDetect|FingerprintsBitVectorString|FingerprintsVectorString)$/i</span><span class="s">)</span> <span class="s">{</span>
 332     <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;SetFingerprintsStringMode: FingerprintsStringMode value, $Value, is not valid; Supported values: AutoDetect, FingerprintsBitVectorString or FingerprintsVectorString...&quot;</span><span class="sc">;</span>
 333   <span class="s">}</span>
 334 
 335   <span class="i">$This</span>-&gt;{<span class="w">FingerprintsStringMode</span>} = <span class="i">$Value</span><span class="sc">;</span>
 336 
 337   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 338 <span class="s">}</span>
 339 
 340 <span class="c"># Set CompoundIDMode...</span>
 341 <span class="c">#</span>
<a name="SetCompoundIDMode-"></a> 342 <span class="k">sub </span><span class="m">SetCompoundIDMode</span> <span class="s">{</span>
 343   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Value</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 344 
 345   <span class="k">if</span> <span class="s">(</span><span class="i">$Value</span> !~ <span class="q">/^(DataField|MolName|LabelPrefix|MolNameOrLabelPrefix)$/i</span><span class="s">)</span> <span class="s">{</span>
 346     <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;SetFingerprintsStringMode: CompoundIDMode value, $Value, is not valid; Supported values: DataField, MolName, LabelPrefix, or MolNameOrLabelPrefix...&quot;</span><span class="sc">;</span>
 347   <span class="s">}</span>
 348 
 349   <span class="i">$This</span>-&gt;{<span class="w">CompoundIDMode</span>} = <span class="i">$Value</span><span class="sc">;</span>
 350 
 351   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 352 <span class="s">}</span>
 353 
 354 <span class="c"># Set DetailLevel...</span>
 355 <span class="c">#</span>
<a name="SetDetailLevel-"></a> 356 <span class="k">sub </span><span class="m">SetDetailLevel</span> <span class="s">{</span>
 357   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Value</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 358 
 359   <span class="k">if</span> <span class="s">(</span>!<span class="i">TextUtil::IsPositiveInteger</span><span class="s">(</span><span class="i">$Value</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 360     <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;SetDetailLevel: DetailLevel value, $Value, is not valid; Supported values: &gt; 0...&quot;</span><span class="sc">;</span>
 361   <span class="s">}</span>
 362 
 363   <span class="i">$This</span>-&gt;{<span class="w">DetailLevel</span>} = <span class="i">$Value</span><span class="sc">;</span>
 364 
 365   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 366 <span class="s">}</span>
 367 
 368 <span class="c"># Set BitStringFormat...</span>
 369 <span class="c">#</span>
<a name="SetBitStringFormat-"></a> 370 <span class="k">sub </span><span class="m">SetBitStringFormat</span> <span class="s">{</span>
 371   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Value</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 372 
 373   <span class="k">if</span> <span class="s">(</span><span class="i">$Value</span> !~ <span class="q">/^(BinaryString|HexadecimalString)$/i</span><span class="s">)</span> <span class="s">{</span>
 374     <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;SetBitStringFormat: BitStringFormat value, $Value, is not valid; Supported values: BinaryString or HexadecimalString...&quot;</span><span class="sc">;</span>
 375   <span class="s">}</span>
 376 
 377   <span class="i">$This</span>-&gt;{<span class="w">BitStringFormat</span>} = <span class="i">$Value</span><span class="sc">;</span>
 378 
 379   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 380 <span class="s">}</span>
 381 
 382 <span class="c"># Set BitsOrder...</span>
 383 <span class="c">#</span>
<a name="SetBitsOrder-"></a> 384 <span class="k">sub </span><span class="m">SetBitsOrder</span> <span class="s">{</span>
 385   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Value</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 386 
 387   <span class="c"># Ascending - First bit in each byte as the lowest bit</span>
 388   <span class="c"># Descending - First bit in each byte as the highest bit</span>
 389   <span class="c">#</span>
 390   <span class="k">if</span> <span class="s">(</span><span class="i">$Value</span> !~ <span class="q">/^(Ascending|Descending)$/i</span><span class="s">)</span> <span class="s">{</span>
 391     <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;SetBitsOrder: FingerprintsStringMode value, $Value, is not valid; Supported values: Ascending or Descending...&quot;</span><span class="sc">;</span>
 392   <span class="s">}</span>
 393 
 394   <span class="i">$This</span>-&gt;{<span class="w">BitsOrder</span>} = <span class="i">$Value</span><span class="sc">;</span>
 395 
 396   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 397 <span class="s">}</span>
 398 
 399 <span class="c"># Set VectorStringFormat...</span>
 400 <span class="c">#</span>
<a name="SetVectorStringFormat-"></a> 401 <span class="k">sub </span><span class="m">SetVectorStringFormat</span> <span class="s">{</span>
 402   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Value</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 403 
 404   <span class="c"># Possible values: IDsAndValuesString, IDsAndValuesPairsString, ValuesAndIDsString, ValuesAndIDsPairsString, ValuesString</span>
 405 
 406   <span class="k">if</span> <span class="s">(</span><span class="i">$Value</span> !~ <span class="q">/^(IDsAndValuesString|IDsAndValuesPairsString|ValuesAndIDsString|ValuesAndIDsPairsString|ValuesString)$/i</span><span class="s">)</span> <span class="s">{</span>
 407     <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;SetVectorStringFormat: FingerprintsStringMode value, $Value, is not valid; Supported values: IDsAndValuesString, IDsAndValuesPairsString, ValuesAndIDsString, ValuesAndIDsPairsString, or ValuesString...&quot;</span><span class="sc">;</span>
 408   <span class="s">}</span>
 409 
 410   <span class="i">$This</span>-&gt;{<span class="w">VectorStringFormat</span>} = <span class="i">$Value</span><span class="sc">;</span>
 411 
 412   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 413 <span class="s">}</span>
 414 
 415 <span class="c"># Get compound string for current compound with optional removal of fingerprints data..</span>
 416 <span class="c">#</span>
<a name="GetCompoundString-"></a> 417 <span class="k">sub </span><span class="m">GetCompoundString</span> <span class="s">{</span>
 418   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$RemoveFingerprintsData</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 419 
 420   <span class="i">$RemoveFingerprintsData</span> = <span class="k">defined</span> <span class="i">$RemoveFingerprintsData</span> ? <span class="i">$RemoveFingerprintsData</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 421 
 422   <span class="k">if</span> <span class="s">(</span><span class="i">$RemoveFingerprintsData</span> &amp;&amp; <span class="i">$This</span><span class="i">-&gt;_IsFingerprintsDataPresentInCompoundString</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 423     <span class="k">return</span> <span class="i">SDFileUtil::RemoveCmpdDataHeaderLabelAndValue</span><span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">CompoundString</span>}<span class="cm">,</span> <span class="i">$This</span>-&gt;{<span class="w">FingerprintsFieldLabel</span>}<span class="s">)</span><span class="sc">;</span>
 424   <span class="s">}</span>
 425 
 426   <span class="k">return</span> <span class="i">$This</span>-&gt;{<span class="w">CompoundString</span>}<span class="sc">;</span>
 427 <span class="s">}</span>
 428 
 429 <span class="c"># Set compound string for current compound..</span>
 430 <span class="c">#</span>
<a name="SetCompoundString-"></a> 431 <span class="k">sub </span><span class="m">SetCompoundString</span> <span class="s">{</span>
 432   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$CompoundString</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 433 
 434   <span class="i">$This</span>-&gt;{<span class="w">CompoundString</span>} = <span class="i">$CompoundString</span><span class="sc">;</span>
 435 
 436   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 437 <span class="s">}</span>
 438 
 439 <span class="c"># Get fingerprints object for current compound using fingerprints, fingerprints bit-vector</span>
 440 <span class="c"># fingerprints vector object. Fingerprints object correspond to any of supported fingerprints</span>
 441 <span class="c"># objects such as PathLengthFingerprints, ExtendedConnectivity, and so on.</span>
 442 <span class="c">#</span>
<a name="GetFingerprints-"></a> 443 <span class="k">sub </span><span class="m">GetFingerprints</span> <span class="s">{</span>
 444   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 445 
 446   <span class="k">return</span> <span class="i">$This</span>-&gt;{<span class="w">FingerprintsObject</span>}<span class="sc">;</span>
 447 <span class="s">}</span>
 448 
 449 <span class="c"># Set fingerprints object for current compound...</span>
 450 <span class="c">#</span>
<a name="SetFingerprints-"></a> 451 <span class="k">sub </span><span class="m">SetFingerprints</span> <span class="s">{</span>
 452   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$FingerprintsObject</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 453 
 454   <span class="i">$This</span>-&gt;{<span class="w">FingerprintsObject</span>} = <span class="i">$FingerprintsObject</span><span class="sc">;</span>
 455 
 456   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 457 <span class="s">}</span>
 458 
 459 <span class="c"># Get fingerprints string  for current compound...</span>
 460 <span class="c">#</span>
<a name="GetFingerprintsString-"></a> 461 <span class="k">sub </span><span class="m">GetFingerprintsString</span> <span class="s">{</span>
 462   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 463 
 464   <span class="k">return</span> <span class="i">$This</span>-&gt;{<span class="w">FingerprintsString</span>} ? <span class="i">$This</span>-&gt;{<span class="w">FingerprintsString</span>} <span class="co">:</span> <span class="q">&#39;None&#39;</span><span class="sc">;</span>
 465 <span class="s">}</span>
 466 
 467 <span class="c"># Set fingerprints string for current compound...</span>
 468 <span class="c">#</span>
<a name="SetFingerprintsString-"></a> 469 <span class="k">sub </span><span class="m">SetFingerprintsString</span> <span class="s">{</span>
 470   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$FingerprintsString</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 471 
 472   <span class="i">$This</span>-&gt;{<span class="w">FingerprintsString</span>} = <span class="i">$FingerprintsString</span><span class="sc">;</span>
 473 
 474   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 475 <span class="s">}</span>
 476 
 477 <span class="c"># Does fingerprints SD file contain valid data?</span>
 478 <span class="c">#</span>
<a name="IsFingerprintsFileDataValid-"></a> 479 <span class="k">sub </span><span class="m">IsFingerprintsFileDataValid</span> <span class="s">{</span>
 480   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 481 
 482   <span class="k">return</span> <span class="i">$This</span>-&gt;{<span class="w">ValidFileData</span>} ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 483 <span class="s">}</span>
 484 
 485 <span class="c"># Does current compound contains valid fingerprints object data?</span>
 486 <span class="c">#</span>
<a name="IsFingerprintsDataValid-"></a> 487 <span class="k">sub </span><span class="m">IsFingerprintsDataValid</span> <span class="s">{</span>
 488   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 489 
 490   <span class="k">return</span> <span class="k">defined</span> <span class="i">$This</span>-&gt;{<span class="w">FingerprintsObject</span>} ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 491 <span class="s">}</span>
 492 
 493 <span class="c"># Read next available compound data string,  process it and generate appropriate fingerprints</span>
 494 <span class="c"># objects...</span>
 495 <span class="c">#</span>
<a name="Read-"></a> 496 <span class="k">sub </span><span class="m">Read</span> <span class="s">{</span>
 497   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 498 
 499   <span class="c"># Read compound data string...</span>
 500   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;_ReadCompoundDataString</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 501     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
 502   <span class="s">}</span>
 503 
 504   <span class="c"># No need to process invalid SD file with invalid data...</span>
 505   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span>-&gt;{<span class="w">ValidFileData</span>}<span class="s">)</span> <span class="s">{</span>
 506     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">ValidateData</span>}<span class="s">)</span> <span class="s">{</span>
 507       <span class="i">$This</span>-&gt;{<span class="w">NumOfCmpdsWithMissingData</span>} += <span class="n">1</span><span class="sc">;</span>
 508     <span class="s">}</span>
 509     <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 510   <span class="s">}</span>
 511 
 512   <span class="c"># Perform data validation...</span>
 513   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">ValidateData</span>}<span class="s">)</span> <span class="s">{</span>
 514     <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;_ValidateReadCompoundDataString</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 515       <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 516     <span class="s">}</span>
 517   <span class="s">}</span>
 518 
 519   <span class="c"># Setup fingerprints string after checking again to handle problematic data for</span>
 520   <span class="c"># non-validated compound string data...</span>
 521   <span class="c">#</span>
 522   <span class="k">my</span><span class="s">(</span><span class="i">$FingerprintsFieldLabel</span><span class="s">)</span><span class="sc">;</span>
 523   <span class="i">$FingerprintsFieldLabel</span> = <span class="i">$This</span>-&gt;{<span class="w">FingerprintsFieldLabel</span>}<span class="sc">;</span>
 524   <span class="k">if</span> <span class="s">(</span><span class="k">exists</span> <span class="i">$This</span>-&gt;{<span class="w">DataFieldLabelsAndValues</span>}{<span class="i">$FingerprintsFieldLabel</span>}<span class="s">)</span> <span class="s">{</span>
 525     <span class="i">$This</span>-&gt;{<span class="w">FingerprintsString</span>} = <span class="i">$This</span>-&gt;{<span class="w">DataFieldLabelsAndValues</span>}{<span class="i">$FingerprintsFieldLabel</span>}<span class="sc">;</span>
 526   <span class="s">}</span>
 527 
 528   <span class="c"># Generate fingeprints object...</span>
 529   <span class="i">$This</span><span class="i">-&gt;_GenerateFingerprintsObject</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 530 
 531   <span class="c"># Setup fingerprints compound ID for fingerprints string...</span>
 532   <span class="i">$This</span><span class="i">-&gt;_GenerateCompoundID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 533 
 534   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 535 <span class="s">}</span>
 536 
 537 <span class="c"># Read next available compound data string,  process it and generate appropriate fingerprints</span>
 538 <span class="c"># objects...</span>
 539 <span class="c">#</span>
<a name="Next-"></a> 540 <span class="k">sub </span><span class="m">Next</span> <span class="s">{</span>
 541   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 542 
 543   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;Read</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 544 <span class="s">}</span>
 545 
 546 <span class="c"># Read compound data string...</span>
 547 <span class="c">#</span>
<a name="_ReadCompoundDataString-"></a> 548 <span class="k">sub </span><span class="m">_ReadCompoundDataString</span> <span class="s">{</span>
 549   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 550   <span class="k">my</span><span class="s">(</span><span class="i">@CmpdLines</span><span class="s">)</span><span class="sc">;</span>
 551 
 552   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">FirstCompoundDataIO</span>}<span class="s">)</span> <span class="s">{</span>
 553     <span class="i">$This</span><span class="i">-&gt;_ProcessFirstCompoundDataStringRead</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 554   <span class="s">}</span>
 555 
 556   <span class="c"># Initialize data for current compound data string...</span>
 557   <span class="i">$This</span><span class="i">-&gt;_InitializeReadCompoundDataString</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 558 
 559   <span class="c"># Get next compound data line...</span>
 560   <span class="i">$This</span>-&gt;{<span class="w">CompoundString</span>} = <span class="i">SDFileUtil::ReadCmpdString</span><span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">FileHandle</span>}<span class="s">)</span><span class="sc">;</span>
 561   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span>-&gt;{<span class="w">CompoundString</span>}<span class="s">)</span> <span class="s">{</span>
 562     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
 563   <span class="s">}</span>
 564 
 565   <span class="i">$This</span>-&gt;{<span class="w">CompoundNum</span>} += <span class="n">1</span><span class="sc">;</span>
 566 
 567   <span class="c"># Set up data field labels and values...</span>
 568   <span class="i">@CmpdLines</span> = <span class="k">split</span> <span class="q">&quot;\n&quot;</span><span class="cm">,</span> <span class="i">$This</span>-&gt;{<span class="w">CompoundString</span>}<span class="sc">;</span>
 569   <span class="i">%</span>{<span class="i">$This</span>-&gt;{<span class="w">DataFieldLabelsAndValues</span>}} = <span class="i">SDFileUtil::GetCmpdDataHeaderLabelsAndValues</span><span class="s">(</span>\<span class="i">@CmpdLines</span><span class="s">)</span><span class="sc">;</span>
 570 
 571   <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
 572 <span class="s">}</span>
 573 
 574 <span class="c"># Initialize compound data string for reading...</span>
 575 <span class="c">#</span>
<a name="_InitializeReadCompoundDataString-"></a> 576 <span class="k">sub </span><span class="m">_InitializeReadCompoundDataString</span> <span class="s">{</span>
 577   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 578 
 579   <span class="i">$This</span>-&gt;{<span class="w">CompoundID</span>} = <span class="k">undef</span><span class="sc">;</span>
 580   <span class="i">$This</span>-&gt;{<span class="w">CompoundString</span>} = <span class="k">undef</span><span class="sc">;</span>
 581 
 582   <span class="i">%</span>{<span class="i">$This</span>-&gt;{<span class="w">DataFieldLabelsAndValues</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 583 
 584   <span class="i">$This</span>-&gt;{<span class="w">FingerprintsObject</span>} = <span class="k">undef</span><span class="sc">;</span>
 585   <span class="i">$This</span>-&gt;{<span class="w">FingerprintsString</span>} = <span class="k">undef</span><span class="sc">;</span>
 586 
 587   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 588 <span class="s">}</span>
 589 
 590 <span class="c"># Validate compound data string containing fingerprints data...</span>
 591 <span class="c">#</span>
<a name="_ValidateReadCompoundDataString-"></a> 592 <span class="k">sub </span><span class="m">_ValidateReadCompoundDataString</span> <span class="s">{</span>
 593   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 594   <span class="k">my</span><span class="s">(</span><span class="i">$FingerprintsFieldLabel</span><span class="s">)</span><span class="sc">;</span>
 595 
 596   <span class="i">$FingerprintsFieldLabel</span> = <span class="i">$This</span>-&gt;{<span class="w">FingerprintsFieldLabel</span>}<span class="sc">;</span>
 597 
 598   <span class="c"># Check for missing data...</span>
 599   <span class="k">if</span> <span class="s">(</span>!<span class="k">exists</span> <span class="i">$This</span>-&gt;{<span class="w">DataFieldLabelsAndValues</span>}{<span class="i">$FingerprintsFieldLabel</span>}<span class="s">)</span> <span class="s">{</span>
 600     <span class="c"># Missing data...</span>
 601     <span class="i">$This</span>-&gt;{<span class="w">NumOfCmpdsWithMissingData</span>} += <span class="n">1</span><span class="sc">;</span>
 602     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">DetailLevel</span>} &gt;= <span class="n">3</span><span class="s">)</span> <span class="s">{</span>
 603       <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;_ValidateReadCompoundDataString: Compound number $This-&gt;{CompoundNum} contains no fingerprints data: $This-&gt;{CompoundString}...&quot;</span><span class="sc">;</span>
 604     <span class="s">}</span>
 605     <span class="k">elsif</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">DetailLevel</span>} &gt;= <span class="n">2</span><span class="s">)</span> <span class="s">{</span>
 606       <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;_ValidateReadCompoundDataString: Compound number $This-&gt;{CompoundNum} contains no fingerprints data...&quot;</span><span class="sc">;</span>
 607     <span class="s">}</span>
 608     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
 609   <span class="s">}</span>
 610 
 611   <span class="c"># Check for invalid data...</span>
 612   <span class="k">my</span><span class="s">(</span><span class="i">$InvalidFingerprintsData</span><span class="cm">,</span> <span class="i">$FingerprintsType</span><span class="cm">,</span> <span class="i">$FingerprintsDescription</span><span class="s">)</span><span class="sc">;</span>
 613 
 614   <span class="i">$InvalidFingerprintsData</span> = <span class="n">0</span><span class="sc">;</span>
 615 
 616   <span class="k">if</span> <span class="s">(</span><span class="i">Fingerprints::FingerprintsStringUtil::AreFingerprintsStringValuesValid</span><span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">DataFieldLabelsAndValues</span>}{<span class="i">$FingerprintsFieldLabel</span>}<span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 617     <span class="s">(</span><span class="i">$FingerprintsType</span><span class="cm">,</span> <span class="i">$FingerprintsDescription</span><span class="s">)</span> = <span class="i">Fingerprints::FingerprintsStringUtil::GetFingerprintsStringTypeAndDescription</span><span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">DataFieldLabelsAndValues</span>}{<span class="i">$FingerprintsFieldLabel</span>}<span class="s">)</span><span class="sc">;</span>
 618     <span class="k">if</span> <span class="s">(</span><span class="k">defined</span><span class="s">(</span><span class="i">$FingerprintsType</span><span class="s">)</span> &amp;&amp; <span class="k">defined</span><span class="s">(</span><span class="i">$FingerprintsDescription</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 619       <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">FirstFingerprintsStringType</span>} !~ <span class="q">/^$FingerprintsType$/i</span> || <span class="i">$This</span>-&gt;{<span class="w">FirstFingerprintsStringDescription</span>} !~ <span class="q">/^$FingerprintsDescription$/i</span><span class="s">)</span> <span class="s">{</span>
 620         <span class="i">$InvalidFingerprintsData</span> = <span class="n">1</span><span class="sc">;</span>
 621       <span class="s">}</span>
 622     <span class="s">}</span>
 623     <span class="k">else</span> <span class="s">{</span>
 624       <span class="i">$InvalidFingerprintsData</span> = <span class="n">1</span><span class="sc">;</span>
 625     <span class="s">}</span>
 626   <span class="s">}</span>
 627   <span class="k">else</span> <span class="s">{</span>
 628     <span class="i">$InvalidFingerprintsData</span> = <span class="n">1</span><span class="sc">;</span>
 629   <span class="s">}</span>
 630 
 631   <span class="k">if</span> <span class="s">(</span><span class="i">$InvalidFingerprintsData</span><span class="s">)</span> <span class="s">{</span>
 632     <span class="i">$This</span>-&gt;{<span class="w">NumOfCmpdsWithInvalidData</span>} += <span class="n">1</span><span class="sc">;</span>
 633     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">DetailLevel</span>} &gt;= <span class="n">3</span><span class="s">)</span> <span class="s">{</span>
 634       <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;_ValidateReadCompoundDataString: Compound number $This-&gt;{CompoundNum} contains invalid fingerprints data: $This-&gt;{DataLine}...&quot;</span><span class="sc">;</span>
 635     <span class="s">}</span>
 636     <span class="k">elsif</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">DetailLevel</span>} &gt;= <span class="n">2</span><span class="s">)</span> <span class="s">{</span>
 637       <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;_ValidateReadCompoundDataString: Compound number $This-&gt;{CompoundNum} contains invalid fingerprints data...&quot;</span><span class="sc">;</span>
 638     <span class="s">}</span>
 639     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
 640   <span class="s">}</span>
 641 
 642   <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
 643 <span class="s">}</span>
 644 
 645 <span class="c"># Setup fingerprints compound ID for fingerprints string...</span>
<a name="_GenerateCompoundID-"></a> 646 <span class="k">sub </span><span class="m">_GenerateCompoundID</span> <span class="s">{</span>
 647   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 648   <span class="k">my</span><span class="s">(</span><span class="i">$CompoundID</span><span class="cm">,</span> <span class="i">$MolName</span><span class="s">)</span><span class="sc">;</span>
 649 
 650   <span class="i">$CompoundID</span> = <span class="q">&#39;&#39;</span><span class="sc">;</span>
 651 
 652   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">CompoundIDMode</span>} =~ <span class="q">/^LabelPrefix$/i</span><span class="s">)</span> <span class="s">{</span>
 653     <span class="i">$CompoundID</span> = <span class="q">&quot;$This-&gt;{CompoundIDPrefix}$This-&gt;{CompoundNum}&quot;</span><span class="sc">;</span>
 654   <span class="s">}</span>
 655   <span class="k">elsif</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">CompoundIDMode</span>} =~ <span class="q">/^DataField$/i</span><span class="s">)</span> <span class="s">{</span>
 656     <span class="k">my</span><span class="s">(</span><span class="i">$SpecifiedDataField</span><span class="s">)</span><span class="sc">;</span>
 657     <span class="i">$SpecifiedDataField</span> = <span class="i">$This</span>-&gt;{<span class="w">CompoundIDFieldLabel</span>}<span class="sc">;</span>
 658     <span class="i">$CompoundID</span> = <span class="k">exists</span> <span class="i">$This</span>-&gt;{<span class="w">DataFieldLabelsAndValues</span>}{<span class="i">$SpecifiedDataField</span>} ?  <span class="i">$This</span>-&gt;{<span class="w">DataFieldLabelsAndValues</span>}{<span class="i">$SpecifiedDataField</span>} <span class="co">:</span> <span class="q">&#39;&#39;</span><span class="sc">;</span>
 659   <span class="s">}</span>
 660   <span class="k">elsif</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">CompoundIDMode</span>} =~ <span class="q">/^MolNameOrLabelPrefix$/i</span><span class="s">)</span> <span class="s">{</span>
 661     <span class="s">(</span><span class="i">$MolName</span><span class="s">)</span> = <span class="k">split</span> <span class="q">&quot;\n&quot;</span><span class="cm">,</span> <span class="i">$This</span>-&gt;{<span class="w">CompoundString</span>}<span class="sc">;</span>
 662     <span class="i">$CompoundID</span> = <span class="i">TextUtil::IsNotEmpty</span><span class="s">(</span><span class="i">$MolName</span><span class="s">)</span> ? <span class="i">$MolName</span> <span class="co">:</span> <span class="q">&quot;$This-&gt;{CompoundIDPrefix}$This-&gt;{CompoundNum}&quot;</span><span class="sc">;</span>
 663   <span class="s">}</span>
 664   <span class="k">elsif</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">CompoundIDMode</span>} =~ <span class="q">/^MolName$/i</span><span class="s">)</span> <span class="s">{</span>
 665     <span class="s">(</span><span class="i">$MolName</span><span class="s">)</span> = <span class="k">split</span> <span class="q">&quot;\n&quot;</span><span class="cm">,</span> <span class="i">$This</span>-&gt;{<span class="w">CompoundString</span>}<span class="sc">;</span>
 666     <span class="i">$CompoundID</span> = <span class="i">$MolName</span><span class="sc">;</span>
 667   <span class="s">}</span>
 668 
 669   <span class="i">$This</span>-&gt;{<span class="w">CompoundID</span>} = <span class="i">$CompoundID</span><span class="sc">;</span>
 670 
 671   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 672 <span class="s">}</span>
 673 
 674 <span class="c"># Process first compound data string read...</span>
 675 <span class="c">#</span>
<a name="_ProcessFirstCompoundDataStringRead-"></a> 676 <span class="k">sub </span><span class="m">_ProcessFirstCompoundDataStringRead</span> <span class="s">{</span>
 677   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 678   <span class="k">my</span><span class="s">(</span><span class="i">$Line</span><span class="cm">,</span> <span class="i">$FileHandle</span><span class="s">)</span><span class="sc">;</span>
 679 
 680   <span class="i">$This</span>-&gt;{<span class="w">FirstCompoundDataIO</span>} = <span class="n">0</span><span class="sc">;</span>
 681 
 682   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 683 <span class="s">}</span>
 684 
 685 <span class="c"># Get ready for reading fingerprints SD file...</span>
 686 <span class="c">#</span>
<a name="_PrepareForReadingFingerprintsSDFileData-"></a> 687 <span class="k">sub </span><span class="m">_PrepareForReadingFingerprintsSDFileData</span> <span class="s">{</span>
 688   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 689 
 690   <span class="c"># Retrieve SD file data fields information....</span>
 691   <span class="i">$This</span><span class="i">-&gt;_RetrieveSDFileDataFields</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 692 
 693   <span class="c"># Validate compound and fingerprints field information...</span>
 694   <span class="i">$This</span><span class="i">-&gt;_ValidateReadCompoundIDField</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 695   <span class="i">$This</span><span class="i">-&gt;_ValidateReadFingerprintsField</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 696 
 697   <span class="c"># Validate fingeprints string mode information...</span>
 698   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">ValidFingerprintsField</span>}<span class="s">)</span> <span class="s">{</span>
 699     <span class="i">$This</span><span class="i">-&gt;_ValidateReadFingerprintsStringMode</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 700   <span class="s">}</span>
 701 
 702   <span class="c"># Set status of SD file data...</span>
 703   <span class="i">$This</span>-&gt;{<span class="w">ValidFileData</span>} = <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">ValidCompoundIDField</span>} &amp;&amp; <span class="i">$This</span>-&gt;{<span class="w">ValidFingerprintsField</span>} &amp;&amp; <span class="i">$This</span>-&gt;{<span class="w">ValidFingerprintsStringMode</span>}<span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 704 
 705   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 706 <span class="s">}</span>
 707 
 708 <span class="c"># Retrieve information data fields and fingerprints string...</span>
 709 <span class="c">#</span>
<a name="_RetrieveSDFileDataFields-"></a> 710 <span class="k">sub </span><span class="m">_RetrieveSDFileDataFields</span> <span class="s">{</span>
 711   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 712   <span class="k">my</span><span class="s">(</span><span class="i">$SDFile</span><span class="cm">,</span> <span class="i">$CmpdString</span><span class="cm">,</span> <span class="i">@CmpdLines</span><span class="s">)</span><span class="sc">;</span>
 713 
 714   <span class="i">$SDFile</span> = <span class="i">$This</span>-&gt;{<span class="w">Name</span>}<span class="sc">;</span>
 715 
 716   <span class="k">if</span> <span class="s">(</span>!<span class="s">(</span><span class="k">-e</span> <span class="i">$SDFile</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 717     <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;New: Object can&#39;t be instantiated: File, $SDFile, doesn&#39;t exist...&quot;</span><span class="sc">;</span>
 718   <span class="s">}</span>
 719 
 720   <span class="k">if</span> <span class="s">(</span>!<span class="k">open</span> <span class="w">SDFILE</span><span class="cm">,</span> <span class="q">&quot;$SDFile&quot;</span><span class="s">)</span> <span class="s">{</span>
 721     <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;New: Object can&#39;t be instantiated: Couldn&#39;t open input SD file $SDFile: $! ...&quot;</span><span class="sc">;</span>
 722   <span class="s">}</span>
 723   <span class="i">$CmpdString</span> = <span class="i">SDFileUtil::ReadCmpdString</span><span class="s">(</span>\<span class="i">*SDFILE</span><span class="s">)</span><span class="sc">;</span>
 724   <span class="k">close</span> <span class="w">SDFILE</span><span class="sc">;</span>
 725 
 726   <span class="c"># Set up data field labels and values for first compound string data...</span>
 727   <span class="i">@CmpdLines</span> = <span class="k">split</span> <span class="q">&quot;\n&quot;</span><span class="cm">,</span> <span class="i">$CmpdString</span><span class="sc">;</span>
 728 
 729   <span class="i">%</span>{<span class="i">$This</span>-&gt;{<span class="w">FirstDataFieldLabelsAndValues</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 730   <span class="i">%</span>{<span class="i">$This</span>-&gt;{<span class="w">FirstDataFieldLabelsAndValues</span>}} = <span class="i">SDFileUtil::GetCmpdDataHeaderLabelsAndValues</span><span class="s">(</span>\<span class="i">@CmpdLines</span><span class="s">)</span><span class="sc">;</span>
 731 
 732   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 733 <span class="s">}</span>
 734 
 735 <span class="c"># Validate compound ID field information...</span>
 736 <span class="c">#</span>
<a name="_ValidateReadCompoundIDField-"></a> 737 <span class="k">sub </span><span class="m">_ValidateReadCompoundIDField</span> <span class="s">{</span>
 738   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 739   <span class="k">my</span><span class="s">(</span><span class="i">$SpecifiedDataField</span><span class="s">)</span><span class="sc">;</span>
 740 
 741   <span class="i">$This</span>-&gt;{<span class="w">ValidCompoundIDField</span>} = <span class="n">0</span><span class="sc">;</span>
 742 
 743   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">CompoundIDMode</span>} =~ <span class="q">/^DataField$/i</span><span class="s">)</span> <span class="s">{</span>
 744     <span class="i">$SpecifiedDataField</span> = <span class="i">$This</span>-&gt;{<span class="w">CompoundIDFieldLabel</span>}<span class="sc">;</span>
 745     <span class="k">if</span> <span class="s">(</span>! <span class="k">exists</span> <span class="i">$This</span>-&gt;{<span class="w">FirstDataFieldLabelsAndValues</span>}{<span class="i">$SpecifiedDataField</span>}<span class="s">)</span> <span class="s">{</span>
 746       <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;_ValidateReadCompoundIDField: Compound ID data field, $SpecifiedDataField, specified using \&quot;CompoundIDField\&quot; in \&quot;DataField\&quot; \&quot;CompoundIDMode\&quot; doesn&#39;t exist...&quot;</span><span class="sc">;</span>
 747       <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
 748     <span class="s">}</span>
 749   <span class="s">}</span>
 750 
 751   <span class="i">$This</span>-&gt;{<span class="w">ValidCompoundIDField</span>} = <span class="n">1</span><span class="sc">;</span>
 752 
 753   <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
 754 <span class="s">}</span>
 755 
 756 <span class="c"># Validate fingerprints string field information...</span>
 757 <span class="c">#</span>
<a name="_ValidateReadFingerprintsField-"></a> 758 <span class="k">sub </span><span class="m">_ValidateReadFingerprintsField</span> <span class="s">{</span>
 759   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 760   <span class="k">my</span><span class="s">(</span><span class="i">$FingerprintsFieldLabel</span><span class="s">)</span><span class="sc">;</span>
 761 
 762   <span class="i">$This</span>-&gt;{<span class="w">ValidFingerprintsField</span>} = <span class="n">0</span><span class="sc">;</span>
 763 
 764   <span class="i">$FingerprintsFieldLabel</span> = <span class="q">&#39;&#39;</span><span class="sc">;</span>
 765 
 766   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">FingerprintsFieldLabel</span>} !~ <span class="q">/^AutoDetect$/i</span><span class="s">)</span> <span class="s">{</span>
 767     <span class="i">$FingerprintsFieldLabel</span> = <span class="i">$This</span>-&gt;{<span class="w">FingerprintsFieldLabel</span>}<span class="sc">;</span>
 768     <span class="k">if</span> <span class="s">(</span>! <span class="k">exists</span> <span class="i">$This</span>-&gt;{<span class="w">FirstDataFieldLabelsAndValues</span>}{<span class="i">$FingerprintsFieldLabel</span>}<span class="s">)</span> <span class="s">{</span>
 769       <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;_ValidateReadFingerprintsField: Fingerprints data field value, $FingerprintsFieldLabel, specified using \&quot;FingerprintsFieldLabel\&quot; doesn&#39;t exist...&quot;</span><span class="sc">;</span>
 770       <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
 771     <span class="s">}</span>
 772   <span class="s">}</span>
 773   <span class="k">else</span> <span class="s">{</span>
 774     <span class="c"># Make sure default fingerprints field does exist...</span>
 775     <span class="k">my</span><span class="s">(</span><span class="i">$FingerprintsFieldFound</span><span class="cm">,</span> <span class="i">$DataFieldLabel</span><span class="s">)</span><span class="sc">;</span>
 776     <span class="i">$FingerprintsFieldFound</span> = <span class="n">0</span><span class="sc">;</span>
 777 
 778     <span class="j">DATAFIELDLABEL:</span> <span class="k">for</span> <span class="i">$DataFieldLabel</span> <span class="s">(</span><span class="k">keys</span> <span class="i">%</span>{<span class="i">$This</span>-&gt;{<span class="w">FirstDataFieldLabelsAndValues</span>}}<span class="s">)</span> <span class="s">{</span>
 779       <span class="k">if</span> <span class="s">(</span><span class="i">$DataFieldLabel</span> =~ <span class="q">/Fingerprints/i</span><span class="s">)</span> <span class="s">{</span>
 780         <span class="i">$FingerprintsFieldFound</span> = <span class="n">1</span><span class="sc">;</span>
 781         <span class="i">$FingerprintsFieldLabel</span> = <span class="i">$DataFieldLabel</span><span class="sc">;</span>
 782         <span class="k">last</span> <span class="j">DATAFIELDLABEL</span><span class="sc">;</span>
 783       <span class="s">}</span>
 784     <span class="s">}</span>
 785     <span class="k">if</span> <span class="s">(</span>!<span class="i">$FingerprintsFieldFound</span><span class="s">)</span> <span class="s">{</span>
 786       <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;_ValidateReadFingerprintsField: Data field label containing \&quot;Fingerprints\&quot; string in its name doesn&#39;t exist...&quot;</span><span class="sc">;</span>
 787       <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
 788     <span class="s">}</span>
 789   <span class="s">}</span>
 790 
 791   <span class="i">$This</span>-&gt;{<span class="w">ValidFingerprintsField</span>} = <span class="n">1</span><span class="sc">;</span>
 792   <span class="i">$This</span>-&gt;{<span class="w">FingerprintsFieldLabel</span>} = <span class="i">$FingerprintsFieldLabel</span><span class="sc">;</span>
 793 
 794   <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
 795 <span class="s">}</span>
 796 
 797 <span class="c"># Validate fingerprints string mode information...</span>
 798 <span class="c">#</span>
<a name="_ValidateReadFingerprintsStringMode-"></a> 799 <span class="k">sub </span><span class="m">_ValidateReadFingerprintsStringMode</span> <span class="s">{</span>
 800   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 801   <span class="k">my</span><span class="s">(</span><span class="i">$FingerprintsBitVectorStringMode</span><span class="cm">,</span> <span class="i">$FingerprintsVectorStringMode</span><span class="cm">,</span> <span class="i">$FirstFingerprintsStringType</span><span class="cm">,</span> <span class="i">$FirstFingerprintsStringDescription</span><span class="cm">,</span> <span class="i">$FingerprintsFieldLabel</span><span class="cm">,</span> <span class="i">$FingerprintsType</span><span class="cm">,</span> <span class="i">$FingerprintsDescription</span><span class="s">)</span><span class="sc">;</span>
 802 
 803   <span class="i">$This</span>-&gt;{<span class="w">ValidFingerprintsStringMode</span>} = <span class="n">0</span><span class="sc">;</span>
 804 
 805   <span class="i">$This</span>-&gt;{<span class="w">FingerprintsBitVectorStringMode</span>} = <span class="n">0</span><span class="sc">;</span>
 806   <span class="i">$This</span>-&gt;{<span class="w">FingerprintsVectorStringMode</span>} = <span class="n">0</span><span class="sc">;</span>
 807 
 808   <span class="i">$This</span>-&gt;{<span class="w">FirstFingerprintsStringType</span>} = <span class="q">&#39;&#39;</span><span class="sc">;</span>
 809   <span class="i">$This</span>-&gt;{<span class="w">FirstFingerprintsStringDescription</span>} = <span class="q">&#39;&#39;</span><span class="sc">;</span>
 810 
 811   <span class="i">$FingerprintsBitVectorStringMode</span> = <span class="n">0</span><span class="sc">;</span>
 812   <span class="i">$FingerprintsVectorStringMode</span> = <span class="n">0</span><span class="sc">;</span>
 813 
 814   <span class="i">$FirstFingerprintsStringType</span> = <span class="q">&#39;&#39;</span><span class="sc">;</span>
 815   <span class="i">$FirstFingerprintsStringDescription</span> = <span class="q">&#39;&#39;</span><span class="sc">;</span>
 816 
 817   <span class="i">$FingerprintsFieldLabel</span> = <span class="i">$This</span>-&gt;{<span class="w">FingerprintsFieldLabel</span>}<span class="sc">;</span>
 818 
 819   <span class="s">(</span><span class="i">$FingerprintsType</span><span class="cm">,</span> <span class="i">$FingerprintsDescription</span><span class="s">)</span> = <span class="i">Fingerprints::FingerprintsStringUtil::GetFingerprintsStringTypeAndDescription</span><span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">FirstDataFieldLabelsAndValues</span>}{<span class="i">$FingerprintsFieldLabel</span>}<span class="s">)</span><span class="sc">;</span>
 820 
 821   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">FingerprintsStringMode</span>} =~ <span class="q">/^FingerprintsBitVectorString$/i</span><span class="s">)</span> <span class="s">{</span>
 822     <span class="k">if</span> <span class="s">(</span><span class="i">$FingerprintsType</span> !~ <span class="q">/^FingerprintsBitVector$/i</span><span class="s">)</span> <span class="s">{</span>
 823       <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;_ValidateReadFingerprintsStringMode: First fingerprint string data type, $FingerprintsType, doesn&#39;t match value, FingerprintsBitVectorString, specified using \&quot;FingerprintsStringMode\&quot;...&quot;</span><span class="sc">;</span>
 824       <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
 825     <span class="s">}</span>
 826     <span class="i">$FingerprintsBitVectorStringMode</span> = <span class="n">1</span><span class="sc">;</span>
 827     <span class="i">$FirstFingerprintsStringType</span> = <span class="q">&#39;FingerprintsBitVector&#39;</span><span class="sc">;</span>
 828     <span class="i">$FirstFingerprintsStringDescription</span> = <span class="i">$FingerprintsDescription</span><span class="sc">;</span>
 829   <span class="s">}</span>
 830   <span class="k">elsif</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">FingerprintsStringMode</span>} =~ <span class="q">/^FingerprintsVectorString$/i</span><span class="s">)</span> <span class="s">{</span>
 831     <span class="k">if</span> <span class="s">(</span><span class="i">$FingerprintsType</span> !~ <span class="q">/^FingerprintsVector$/i</span><span class="s">)</span> <span class="s">{</span>
 832       <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;_ValidateReadFingerprintsStringMode: First fingerprint string data type, $FingerprintsType, doesn&#39;t match value, FingerprintsVectorString, specified using \&quot;FingerprintsStringMode\&quot;...&quot;</span><span class="sc">;</span>
 833       <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
 834     <span class="s">}</span>
 835     <span class="i">$FingerprintsVectorStringMode</span> = <span class="n">1</span><span class="sc">;</span>
 836     <span class="i">$FirstFingerprintsStringType</span> = <span class="q">&#39;FingerprintsVector&#39;</span><span class="sc">;</span>
 837     <span class="i">$FirstFingerprintsStringDescription</span> = <span class="i">$FingerprintsDescription</span><span class="sc">;</span>
 838   <span class="s">}</span>
 839   <span class="k">else</span> <span class="s">{</span>
 840     <span class="c"># AutoDetect mode...</span>
 841     <span class="k">if</span> <span class="s">(</span><span class="i">$FingerprintsType</span> =~ <span class="q">/^FingerprintsBitVector$/i</span><span class="s">)</span> <span class="s">{</span>
 842       <span class="i">$FingerprintsBitVectorStringMode</span> = <span class="n">1</span><span class="sc">;</span>
 843     <span class="s">}</span>
 844     <span class="k">elsif</span> <span class="s">(</span><span class="i">$FingerprintsType</span> =~ <span class="q">/^FingerprintsVector$/i</span><span class="s">)</span> <span class="s">{</span>
 845       <span class="i">$FingerprintsVectorStringMode</span> = <span class="n">1</span><span class="sc">;</span>
 846     <span class="s">}</span>
 847     <span class="k">else</span> <span class="s">{</span>
 848       <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;_ValidateReadFingerprintsStringMode: First fingerprint string data type, $FingerprintsType, identified during, AutoDetect, value of \&quot;FingerprintsStringMode\&quot; is not valid; Supported fingerprints types: FingerprintBitVector or FingerprintsVector...&quot;</span><span class="sc">;</span>
 849       <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
 850     <span class="s">}</span>
 851     <span class="i">$FirstFingerprintsStringType</span> = <span class="i">$FingerprintsType</span><span class="sc">;</span>
 852     <span class="i">$FirstFingerprintsStringDescription</span> = <span class="i">$FingerprintsDescription</span><span class="sc">;</span>
 853   <span class="s">}</span>
 854 
 855   <span class="i">$This</span>-&gt;{<span class="w">ValidFingerprintsStringMode</span>} = <span class="n">1</span><span class="sc">;</span>
 856 
 857   <span class="i">$This</span>-&gt;{<span class="w">FingerprintsBitVectorStringMode</span>} = <span class="i">$FingerprintsBitVectorStringMode</span><span class="sc">;</span>
 858   <span class="i">$This</span>-&gt;{<span class="w">FingerprintsVectorStringMode</span>} = <span class="i">$FingerprintsVectorStringMode</span><span class="sc">;</span>
 859 
 860   <span class="i">$This</span>-&gt;{<span class="w">FirstFingerprintsStringType</span>} = <span class="i">$FirstFingerprintsStringType</span><span class="sc">;</span>
 861   <span class="i">$This</span>-&gt;{<span class="w">FirstFingerprintsStringDescription</span>} = <span class="i">$FirstFingerprintsStringDescription</span><span class="sc">;</span>
 862 
 863   <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
 864 <span class="s">}</span>
 865 
 866 <span class="c"># Write fingerprints string generated from specified fingerprints, fingerprints-bit vector, or</span>
 867 <span class="c"># fingerprints vector object and other data to SD file...</span>
 868 <span class="c">#</span>
<a name="WriteFingerprints-"></a> 869 <span class="k">sub </span><span class="m">WriteFingerprints</span> <span class="s">{</span>
 870   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$FingerprintsObject</span><span class="cm">,</span> <span class="i">$CompoundString</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 871 
 872   <span class="c"># Initialize data for current compound...</span>
 873   <span class="i">$This</span><span class="i">-&gt;_InitializeWriteCompoundDataString</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 874 
 875   <span class="c"># Set fingerprints object...</span>
 876   <span class="i">$This</span>-&gt;{<span class="w">FingerprintsObject</span>} = <span class="i">$FingerprintsObject</span><span class="sc">;</span>
 877 
 878   <span class="c"># Generate fingerprints string...</span>
 879   <span class="i">$This</span><span class="i">-&gt;_GenerateFingerprintsString</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 880 
 881   <span class="c"># Set and update compound string...</span>
 882   <span class="i">$This</span>-&gt;{<span class="w">CompoundString</span>} = <span class="i">$CompoundString</span><span class="sc">;</span>
 883   <span class="i">$This</span><span class="i">-&gt;_AddFingerprintsDataToCompoundString</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 884 
 885   <span class="c"># Write it out...</span>
 886   <span class="i">$This</span><span class="i">-&gt;_WriteCompoundDataString</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 887 
 888   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 889 <span class="s">}</span>
 890 
 891 <span class="c"># Write fingerprints string and other data to SD file...</span>
 892 <span class="c">#</span>
 893 <span class="c"># Note:</span>
 894 <span class="c">#   o FingerprintsStringMode, BitStringFormat, BitsOrder, VectorStringFormat values</span>
 895 <span class="c">#     are ignored during writing of fingerprints and it&#39;s written to the file as it is.</span>
 896 <span class="c">#   o CompoundString contains no fingerprints data</span>
 897 <span class="c">#</span>
<a name="WriteFingerprintsString-"></a> 898 <span class="k">sub </span><span class="m">WriteFingerprintsString</span> <span class="s">{</span>
 899   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$FingerprintsString</span><span class="cm">,</span> <span class="i">$CompoundString</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 900 
 901   <span class="c"># Initialize data for current compound...</span>
 902   <span class="i">$This</span><span class="i">-&gt;_InitializeWriteCompoundDataString</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 903 
 904   <span class="c"># Set fingerprints string...</span>
 905   <span class="i">$This</span>-&gt;{<span class="w">FingerprintsString</span>} = <span class="i">$FingerprintsString</span><span class="sc">;</span>
 906 
 907   <span class="c"># Generate fingerprints object...</span>
 908   <span class="i">$This</span><span class="i">-&gt;_GenerateFingerprintsObject</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 909 
 910   <span class="c"># Set and update compound string...</span>
 911   <span class="i">$This</span>-&gt;{<span class="w">CompoundString</span>} = <span class="i">$CompoundString</span><span class="sc">;</span>
 912   <span class="i">$This</span><span class="i">-&gt;_AddFingerprintsDataToCompoundString</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 913 
 914   <span class="c"># Write it out...</span>
 915   <span class="i">$This</span><span class="i">-&gt;_WriteCompoundDataString</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 916 
 917   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 918 <span class="s">}</span>
 919 
 920 <span class="c"># Initialize compound data string for writing...</span>
 921 <span class="c">#</span>
<a name="_InitializeWriteCompoundDataString-"></a> 922 <span class="k">sub </span><span class="m">_InitializeWriteCompoundDataString</span> <span class="s">{</span>
 923   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 924 
 925   <span class="i">$This</span>-&gt;{<span class="w">CompoundString</span>} = <span class="k">undef</span><span class="sc">;</span>
 926 
 927   <span class="i">$This</span>-&gt;{<span class="w">FingerprintsObject</span>} = <span class="k">undef</span><span class="sc">;</span>
 928   <span class="i">$This</span>-&gt;{<span class="w">FingerprintsString</span>} = <span class="k">undef</span><span class="sc">;</span>
 929 
 930   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 931 <span class="s">}</span>
 932 
 933 <span class="c"># Writi compound data string...</span>
 934 <span class="c">#</span>
<a name="_WriteCompoundDataString-"></a> 935 <span class="k">sub </span><span class="m">_WriteCompoundDataString</span> <span class="s">{</span>
 936   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 937   <span class="k">my</span><span class="s">(</span><span class="i">$FileHandle</span><span class="s">)</span><span class="sc">;</span>
 938 
 939   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">FirstCompoundDataIO</span>}<span class="s">)</span> <span class="s">{</span>
 940     <span class="i">$This</span><span class="i">-&gt;_ProcessFirstCompoundDataStringWrite</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 941   <span class="s">}</span>
 942 
 943   <span class="i">$This</span>-&gt;{<span class="w">CompoundNum</span>} += <span class="n">1</span><span class="sc">;</span>
 944   <span class="i">$FileHandle</span> = <span class="i">$This</span>-&gt;{<span class="w">FileHandle</span>}<span class="sc">;</span>
 945 
 946   <span class="k">print</span> <span class="i">$FileHandle</span> <span class="q">&quot;$This-&gt;{CompoundString}\n&quot;</span><span class="sc">;</span>
 947 
 948   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 949 <span class="s">}</span>
 950 
 951 <span class="c"># Process first compound data string write...</span>
 952 <span class="c">#</span>
<a name="_ProcessFirstCompoundDataStringWrite-"></a> 953 <span class="k">sub </span><span class="m">_ProcessFirstCompoundDataStringWrite</span> <span class="s">{</span>
 954   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 955   <span class="k">my</span><span class="s">(</span><span class="i">$Line</span><span class="cm">,</span> <span class="i">$FileHandle</span><span class="s">)</span><span class="sc">;</span>
 956 
 957   <span class="i">$This</span>-&gt;{<span class="w">FirstCompoundDataIO</span>} = <span class="n">0</span><span class="sc">;</span>
 958 
 959   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 960 <span class="s">}</span>
 961 
 962 <span class="c"># Get ready for writing fingerprints SD file...</span>
 963 <span class="c">#</span>
<a name="_PrepareForWritingFingerprintsSDFileData-"></a> 964 <span class="k">sub </span><span class="m">_PrepareForWritingFingerprintsSDFileData</span> <span class="s">{</span>
 965   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 966   <span class="k">my</span><span class="s">(</span><span class="i">$SDFile</span><span class="s">)</span><span class="sc">;</span>
 967 
 968   <span class="i">$SDFile</span> = <span class="i">$This</span>-&gt;{<span class="w">Name</span>}<span class="sc">;</span>
 969   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span>-&gt;{<span class="w">Overwrite</span>}<span class="s">)</span> <span class="s">{</span>
 970     <span class="k">if</span> <span class="s">(</span><span class="k">-e</span> <span class="i">$SDFile</span><span class="s">)</span> <span class="s">{</span>
 971       <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;New: Object can&#39;t be instantiated: File, $SDFile, already exist. Use overwrite option...&quot;</span><span class="sc">;</span>
 972     <span class="s">}</span>
 973   <span class="s">}</span>
 974 
 975   <span class="c"># Setup FingerprintsStringMode status...</span>
 976 
 977   <span class="i">$This</span>-&gt;{<span class="w">FingerprintsBitVectorStringMode</span>} = <span class="n">0</span><span class="sc">;</span>
 978   <span class="i">$This</span>-&gt;{<span class="w">FingerprintsVectorStringMode</span>} = <span class="n">0</span><span class="sc">;</span>
 979   <span class="i">$This</span>-&gt;{<span class="w">ValidFingerprintsStringMode</span>} = <span class="n">0</span><span class="sc">;</span>
 980 
 981   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">FingerprintsStringMode</span>} =~ <span class="q">/^FingerprintsBitVectorString$/i</span><span class="s">)</span> <span class="s">{</span>
 982     <span class="i">$This</span>-&gt;{<span class="w">FingerprintsBitVectorStringMode</span>} = <span class="n">1</span><span class="sc">;</span>
 983   <span class="s">}</span>
 984   <span class="k">elsif</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">FingerprintsStringMode</span>} =~ <span class="q">/^FingerprintsVectorString$/i</span><span class="s">)</span> <span class="s">{</span>
 985     <span class="i">$This</span>-&gt;{<span class="w">FingerprintsVectorStringMode</span>} = <span class="n">1</span><span class="sc">;</span>
 986   <span class="s">}</span>
 987 
 988   <span class="i">$This</span>-&gt;{<span class="w">ValidFingerprintsStringMode</span>} = <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">FingerprintsBitVectorStringMode</span>} || <span class="i">$This</span>-&gt;{<span class="w">FingerprintsVectorStringMode</span>}<span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 989 
 990   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">FingerprintsBitVectorStringMode</span>}<span class="s">)</span> <span class="s">{</span>
 991     <span class="i">$This</span><span class="i">-&gt;_SetDefaultBitStringFormat</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 992     <span class="i">$This</span><span class="i">-&gt;_SetDefaultBitsOrder</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 993   <span class="s">}</span>
 994   <span class="k">elsif</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">FingerprintsVectorStringMode</span>}<span class="s">)</span> <span class="s">{</span>
 995     <span class="i">$This</span><span class="i">-&gt;_SetDefaultVectorStringFormat</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 996   <span class="s">}</span>
 997 
 998   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 999 <span class="s">}</span>
1000 
1001 <span class="c"># Set default value for bit string format...</span>
1002 <span class="c">#</span>
<a name="_SetDefaultBitStringFormat-"></a>1003 <span class="k">sub </span><span class="m">_SetDefaultBitStringFormat</span> <span class="s">{</span>
1004   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1005 
1006   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span>-&gt;{<span class="w">BitStringFormat</span>}<span class="s">)</span> <span class="s">{</span>
1007     <span class="i">$This</span>-&gt;{<span class="w">BitStringFormat</span>} = <span class="i">Fingerprints::FingerprintsStringUtil::GetDefaultBitStringFormat</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1008   <span class="s">}</span>
1009 
1010   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
1011 <span class="s">}</span>
1012 
1013 <span class="c"># Set default value for bit string format...</span>
1014 <span class="c">#</span>
<a name="_SetDefaultBitsOrder-"></a>1015 <span class="k">sub </span><span class="m">_SetDefaultBitsOrder</span> <span class="s">{</span>
1016   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1017 
1018   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span>-&gt;{<span class="w">BitsOrder</span>}<span class="s">)</span> <span class="s">{</span>
1019     <span class="i">$This</span>-&gt;{<span class="w">BitsOrder</span>} = <span class="i">Fingerprints::FingerprintsStringUtil::GetDefaultBitsOrder</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1020   <span class="s">}</span>
1021 
1022   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
1023 <span class="s">}</span>
1024 
1025 <span class="c"># Set default value for vector string format...</span>
1026 <span class="c">#</span>
<a name="_SetDefaultVectorStringFormat-"></a>1027 <span class="k">sub </span><span class="m">_SetDefaultVectorStringFormat</span> <span class="s">{</span>
1028   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1029 
1030   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span>-&gt;{<span class="w">VectorStringFormat</span>} &amp;&amp; <span class="i">$This</span>-&gt;{<span class="w">FingerprintsObject</span>}<span class="s">)</span> <span class="s">{</span>
1031     <span class="i">$This</span>-&gt;{<span class="w">VectorStringFormat</span>} = <span class="i">Fingerprints::FingerprintsStringUtil::GetDefaultVectorStringFormat</span><span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">FingerprintsObject</span>}<span class="s">)</span><span class="sc">;</span>
1032   <span class="s">}</span>
1033 
1034   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
1035 <span class="s">}</span>
1036 
1037 <span class="c"># Add fingerprints data to compound string...</span>
1038 <span class="c">#</span>
<a name="_AddFingerprintsDataToCompoundString-"></a>1039 <span class="k">sub </span><span class="m">_AddFingerprintsDataToCompoundString</span> <span class="s">{</span>
1040   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1041   <span class="k">my</span><span class="s">(</span><span class="i">$CmpdString</span><span class="s">)</span><span class="sc">;</span>
1042 
1043   <span class="c"># Check and remove existing fingerprints data...</span>
1044   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsFingerprintsDataPresentInCompoundString</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1045     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;_AddFingerprintsDataToCompoundString: The compound string already contains fingerprints data corresponding to fingerprints field label $This-&gt;{FingerprintsFieldLabel}; It has been replaced with new fingerprints data...&quot;</span><span class="sc">;</span>
1046     <span class="i">$This</span>-&gt;{<span class="w">CompoundString</span>} = <span class="i">SDFileUtil::RemoveCmpdDataHeaderLabelAndValue</span><span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">CompoundString</span>}<span class="cm">,</span> <span class="i">$This</span>-&gt;{<span class="w">FingerprintsFieldLabel</span>}<span class="s">)</span><span class="sc">;</span>
1047   <span class="s">}</span>
1048 
1049   <span class="i">$CmpdString</span> = <span class="i">$This</span>-&gt;{<span class="w">CompoundString</span>}<span class="sc">;</span>
1050 
1051   <span class="i">$CmpdString</span> =~ <span class="q">s/\$\$\$\$$//</span><span class="sc">;</span>
1052 
1053   <span class="i">$This</span>-&gt;{<span class="w">CompoundString</span>} = <span class="q">&quot;${CmpdString}&gt;  &lt;$This-&gt;{FingerprintsFieldLabel}&gt;\n$This-&gt;{FingerprintsString}\n\n\$\$\$\$&quot;</span><span class="sc">;</span>
1054 
1055   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
1056 <span class="s">}</span>
1057 
1058 <span class="c"># Is fingerprints data already present in compound string?</span>
1059 <span class="c">#</span>
<a name="_IsFingerprintsDataPresentInCompoundString-"></a>1060 <span class="k">sub </span><span class="m">_IsFingerprintsDataPresentInCompoundString</span> <span class="s">{</span>
1061   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1062   <span class="k">my</span><span class="s">(</span><span class="i">$FingerprintsFieldLabel</span><span class="s">)</span><span class="sc">;</span>
1063 
1064   <span class="k">if</span> <span class="s">(</span><span class="i">TextUtil::IsEmpty</span><span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">CompoundString</span>}<span class="s">)</span> || <span class="i">TextUtil::IsEmpty</span><span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">FingerprintsFieldLabel</span>}<span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1065     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
1066   <span class="s">}</span>
1067 
1068   <span class="i">$FingerprintsFieldLabel</span> = <span class="i">$This</span>-&gt;{<span class="w">FingerprintsFieldLabel</span>}<span class="sc">;</span>
1069 
1070   <span class="k">return</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">CompoundString</span>} =~ <span class="q">/&lt;$FingerprintsFieldLabel&gt;/</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1071 <span class="s">}</span>
1072 
1073 <span class="c"># Generate fingerprints object using current fingerprints string...</span>
1074 <span class="c">#</span>
<a name="_GenerateFingerprintsObject-"></a>1075 <span class="k">sub </span><span class="m">_GenerateFingerprintsObject</span> <span class="s">{</span>
1076   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1077 
1078   <span class="i">$This</span>-&gt;{<span class="w">FingerprintsObject</span>} = <span class="k">undef</span><span class="sc">;</span>
1079 
1080   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span>-&gt;{<span class="w">FingerprintsString</span>}<span class="s">)</span> <span class="s">{</span>
1081     <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
1082   <span class="s">}</span>
1083 
1084   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">FingerprintsBitVectorStringMode</span>}<span class="s">)</span> <span class="s">{</span>
1085     <span class="i">$This</span>-&gt;{<span class="w">FingerprintsObject</span>} = <span class="i">Fingerprints::FingerprintsStringUtil::ParseFingerprintsBitVectorString</span><span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">FingerprintsString</span>}<span class="s">)</span><span class="sc">;</span>
1086   <span class="s">}</span>
1087   <span class="k">elsif</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">FingerprintsVectorStringMode</span>}<span class="s">)</span> <span class="s">{</span>
1088     <span class="i">$This</span>-&gt;{<span class="w">FingerprintsObject</span>} = <span class="i">Fingerprints::FingerprintsStringUtil::ParseFingerprintsVectorString</span><span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">FingerprintsString</span>}<span class="s">)</span><span class="sc">;</span>
1089   <span class="s">}</span>
1090   <span class="k">else</span> <span class="s">{</span>
1091     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
1092   <span class="s">}</span>
1093 
1094   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
1095 <span class="s">}</span>
1096 
1097 <span class="c"># Generate fingerprints string using current fingerprints object...</span>
1098 <span class="c">#</span>
<a name="_GenerateFingerprintsString-"></a>1099 <span class="k">sub </span><span class="m">_GenerateFingerprintsString</span> <span class="s">{</span>
1100   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1101 
1102   <span class="i">$This</span>-&gt;{<span class="w">FingerprintsString</span>} = <span class="q">&#39;&#39;</span><span class="sc">;</span>
1103 
1104   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span>-&gt;{<span class="w">FingerprintsObject</span>}<span class="s">)</span> <span class="s">{</span>
1105     <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
1106   <span class="s">}</span>
1107 
1108   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">FingerprintsBitVectorStringMode</span>}<span class="s">)</span> <span class="s">{</span>
1109     <span class="i">$This</span>-&gt;{<span class="w">FingerprintsString</span>} = <span class="i">Fingerprints::FingerprintsStringUtil::GenerateFingerprintsString</span><span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">FingerprintsObject</span>}<span class="cm">,</span> <span class="i">$This</span>-&gt;{<span class="w">BitStringFormat</span>}<span class="cm">,</span> <span class="i">$This</span>-&gt;{<span class="w">BitsOrder</span>}<span class="s">)</span><span class="sc">;</span>
1110   <span class="s">}</span>
1111   <span class="k">elsif</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">FingerprintsVectorStringMode</span>}<span class="s">)</span> <span class="s">{</span>
1112     <span class="i">$This</span>-&gt;{<span class="w">FingerprintsString</span>} = <span class="i">Fingerprints::FingerprintsStringUtil::GenerateFingerprintsString</span><span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">FingerprintsObject</span>}<span class="cm">,</span> <span class="i">$This</span>-&gt;{<span class="w">VectorStringFormat</span>}<span class="s">)</span><span class="sc">;</span>
1113   <span class="s">}</span>
1114 
1115   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
1116 <span class="s">}</span>
1117 
1118 <span class="c"># Is it a fingerprints file?</span>
<a name="IsFingerprintsSDFile-"></a>1119 <span class="k">sub </span><span class="m">IsFingerprintsSDFile ($;$)</span> <span class="s">{</span>
1120   <span class="k">my</span><span class="s">(</span><span class="i">$FirstParameter</span><span class="cm">,</span> <span class="i">$SecondParameter</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1121   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$FileName</span><span class="cm">,</span> <span class="i">$Status</span><span class="s">)</span><span class="sc">;</span>
1122 
1123   <span class="k">if</span> <span class="s">(</span><span class="s">(</span><span class="i">@_</span> == <span class="n">2</span><span class="s">)</span> &amp;&amp; <span class="s">(</span><span class="i">_IsFingerprintsSDFileIO</span><span class="s">(</span><span class="i">$FirstParameter</span><span class="s">)</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1124     <span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$FileName</span><span class="s">)</span> = <span class="s">(</span><span class="i">$FirstParameter</span><span class="cm">,</span> <span class="i">$SecondParameter</span><span class="s">)</span><span class="sc">;</span>
1125   <span class="s">}</span>
1126   <span class="k">else</span> <span class="s">{</span>
1127     <span class="i">$FileName</span> = <span class="i">$FirstParameter</span><span class="sc">;</span>
1128   <span class="s">}</span>
1129 
1130   <span class="c"># Check file extension...</span>
1131   <span class="i">$Status</span> = <span class="i">FileUtil::CheckFileType</span><span class="s">(</span><span class="i">$FileName</span><span class="cm">,</span> <span class="q">&quot;sdf sd&quot;</span><span class="s">)</span><span class="sc">;</span>
1132 
1133   <span class="k">return</span> <span class="i">$Status</span><span class="sc">;</span>
1134 <span class="s">}</span>
1135 
1136 <span class="c"># Is it a FingerprintsSDFileIO object?</span>
<a name="_IsFingerprintsSDFileIO-"></a>1137 <span class="k">sub </span><span class="m">_IsFingerprintsSDFileIO</span> <span class="s">{</span>
1138   <span class="k">my</span><span class="s">(</span><span class="i">$Object</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1139 
1140   <span class="k">return</span> <span class="s">(</span><span class="i">Scalar::Util::blessed</span><span class="s">(</span><span class="i">$Object</span><span class="s">)</span> &amp;&amp; <span class="i">$Object</span><span class="i">-&gt;isa</span><span class="s">(</span><span class="i">$ClassName</span><span class="s">)</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1141 <span class="s">}</span>
1142 
<a name="EOF-"></a></pre>
<p>&nbsp;</p>
<br />
<center>
<img src="../../../images/h2o2.png">
</center>
</body>
</html>
