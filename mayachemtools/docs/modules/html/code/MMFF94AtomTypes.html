<html>
<head>
<title>MayaChemTools:Code:AtomTypes::MMFF94AtomTypes.pm</title>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<link rel="stylesheet" type="text/css" href="../../../css/MayaChemToolsCode.css">
</head>
<body leftmargin="20" rightmargin="20" topmargin="10" bottommargin="10">
<br/>
<center>
<a href="http://www.mayachemtools.org" title="MayaChemTools Home"><img src="../../../images/MayaChemToolsLogo.gif" border="0" alt="MayaChemTools"></a>
</center>
<br/>
<pre>
<a name="package-AtomTypes::MMFF94AtomTypes-"></a>   1 <span class="k">package </span><span class="i">AtomTypes::MMFF94AtomTypes</span><span class="sc">;</span>
   2 <span class="c">#</span>
   3 <span class="c"># $RCSfile: MMFF94AtomTypes.pm,v $</span>
   4 <span class="c"># $Date: 2017/01/12 18:58:31 $</span>
   5 <span class="c"># $Revision: 1.22 $</span>
   6 <span class="c">#</span>
   7 <span class="c"># Author: Manish Sud &lt;msud@san.rr.com&gt;</span>
   8 <span class="c">#</span>
   9 <span class="c"># Copyright (C) 2017 Manish Sud. All rights reserved.</span>
  10 <span class="c">#</span>
  11 <span class="c"># This file is part of MayaChemTools.</span>
  12 <span class="c">#</span>
  13 <span class="c"># MayaChemTools is free software; you can redistribute it and/or modify it under</span>
  14 <span class="c"># the terms of the GNU Lesser General Public License as published by the Free</span>
  15 <span class="c"># Software Foundation; either version 3 of the License, or (at your option) any</span>
  16 <span class="c"># later version.</span>
  17 <span class="c">#</span>
  18 <span class="c"># MayaChemTools is distributed in the hope that it will be useful, but without</span>
  19 <span class="c"># any warranty; without even the implied warranty of merchantability of fitness</span>
  20 <span class="c"># for a particular purpose.  See the GNU Lesser General Public License for more</span>
  21 <span class="c"># details.</span>
  22 <span class="c">#</span>
  23 <span class="c"># You should have received a copy of the GNU Lesser General Public License</span>
  24 <span class="c"># along with MayaChemTools; if not, see &lt;http://www.gnu.org/licenses/&gt; or</span>
  25 <span class="c"># write to the Free Software Foundation Inc., 59 Temple Place, Suite 330,</span>
  26 <span class="c"># Boston, MA, 02111-1307, USA.</span>
  27 <span class="c">#</span>
  28 
  29 <span class="k">use</span> <span class="w">strict</span><span class="sc">;</span>
  30 <span class="k">use</span> <span class="w">Carp</span><span class="sc">;</span>
  31 <span class="k">use</span> <span class="w">Exporter</span><span class="sc">;</span>
  32 <span class="k">use</span> <span class="w">Scalar::Util</span> <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  33 <span class="k">use</span> <span class="w">Text::ParseWords</span><span class="sc">;</span>
  34 <span class="k">use</span> <span class="w">AtomTypes::AtomTypes</span><span class="sc">;</span>
  35 <span class="k">use</span> <span class="w">Molecule</span><span class="sc">;</span>
  36 
  37 <span class="k">use</span> <span class="w">vars</span> <span class="q">qw(@ISA @EXPORT @EXPORT_OK %EXPORT_TAGS)</span><span class="sc">;</span>
  38 
  39 <span class="i">@ISA</span> = <span class="q">qw(AtomTypes::AtomTypes Exporter)</span><span class="sc">;</span>
  40 <span class="i">@EXPORT</span> = <span class="q">qw(GetMMFF94AtomTypesData GetAllPossibleMMFF94AtomTypes GetAllPossibleMMFF94NonHydrogenAtomTypes)</span><span class="sc">;</span>
  41 <span class="i">@EXPORT_OK</span> = <span class="q">qw()</span><span class="sc">;</span>
  42 
  43 <span class="i">%EXPORT_TAGS</span> = <span class="s">(</span><span class="w">all</span>  <span class="cm">=&gt;</span> <span class="s">[</span><span class="i">@EXPORT</span><span class="cm">,</span> <span class="i">@EXPORT_OK</span><span class="s">]</span><span class="s">)</span><span class="sc">;</span>
  44 
  45 <span class="c"># Setup class variables...</span>
  46 <span class="k">my</span><span class="s">(</span><span class="i">$ClassName</span><span class="cm">,</span> <span class="i">%MMFF94AtomTypesDataMap</span><span class="s">)</span><span class="sc">;</span>
  47 <span class="i">_InitializeClass</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  48 
  49 <span class="c"># Overload Perl functions...</span>
  50 <span class="k">use</span> <span class="w">overload</span> <span class="q">&#39;&quot;&quot;&#39;</span> <span class="cm">=&gt;</span> <span class="q">&#39;StringifyMMFF94AtomTypes&#39;</span><span class="sc">;</span>
  51 
  52 <span class="c"># Class constructor...</span>
<a name="new-"></a>  53 <span class="k">sub </span><span class="m">new</span> <span class="s">{</span>
  54   <span class="k">my</span><span class="s">(</span><span class="i">$Class</span><span class="cm">,</span> <span class="i">%NamesAndValues</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
  55 
  56   <span class="c"># Initialize object...</span>
  57   <span class="k">my</span> <span class="i">$This</span> = <span class="i">$Class</span><span class="i">-&gt;SUPER::new</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  58   <span class="k">bless</span> <span class="i">$This</span><span class="cm">,</span> <span class="k">ref</span><span class="s">(</span><span class="i">$Class</span><span class="s">)</span> || <span class="i">$Class</span><span class="sc">;</span>
  59   <span class="i">$This</span><span class="i">-&gt;_InitializeMMFF94AtomTypes</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  60 
  61   <span class="i">$This</span><span class="i">-&gt;_InitializeMMFF94AtomTypesProperties</span><span class="s">(</span><span class="i">%NamesAndValues</span><span class="s">)</span><span class="sc">;</span>
  62 
  63   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
  64 <span class="s">}</span>
  65 
  66 <span class="c"># Initialize class ...</span>
<a name="_InitializeClass-"></a>  67 <span class="k">sub </span><span class="m">_InitializeClass</span> <span class="s">{</span>
  68   <span class="c">#Class name...</span>
  69   <span class="i">$ClassName</span> = <span class="w">__PACKAGE__</span><span class="sc">;</span>
  70 
  71   <span class="c"># Initialize the data hash. It&#39;ll be loaded on demand later...</span>
  72   <span class="i">%MMFF94AtomTypesDataMap</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  73 <span class="s">}</span>
  74 
  75 
  76 <span class="c"># Initialize object data...</span>
  77 <span class="c">#</span>
<a name="_InitializeMMFF94AtomTypes-"></a>  78 <span class="k">sub </span><span class="m">_InitializeMMFF94AtomTypes</span> <span class="s">{</span>
  79   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
  80 
  81   <span class="c"># Type of AtomTypes...</span>
  82   <span class="i">$This</span>-&gt;{<span class="w">Type</span>} = <span class="q">&#39;MMFF94&#39;</span><span class="sc">;</span>
  83 
  84   <span class="c"># By default, MMFF94 atom types are also assigned to hydrogens...</span>
  85   <span class="i">$This</span>-&gt;{<span class="w">IgnoreHydrogens</span>} = <span class="n">0</span><span class="sc">;</span>
  86 
  87   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
  88 <span class="s">}</span>
  89 
  90 <span class="c"># Initialize object properties...</span>
  91 <span class="c">#</span>
<a name="_InitializeMMFF94AtomTypesProperties-"></a>  92 <span class="k">sub </span><span class="m">_InitializeMMFF94AtomTypesProperties</span> <span class="s">{</span>
  93   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">%NamesAndValues</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
  94 
  95   <span class="k">my</span><span class="s">(</span><span class="i">$Name</span><span class="cm">,</span> <span class="i">$Value</span><span class="cm">,</span> <span class="i">$MethodName</span><span class="s">)</span><span class="sc">;</span>
  96   <span class="k">while</span> <span class="s">(</span><span class="s">(</span><span class="i">$Name</span><span class="cm">,</span> <span class="i">$Value</span><span class="s">)</span> = <span class="k">each</span>  <span class="i">%NamesAndValues</span><span class="s">)</span> <span class="s">{</span>
  97     <span class="i">$MethodName</span> = <span class="q">&quot;Set${Name}&quot;</span><span class="sc">;</span>
  98     <span class="i">$This</span><span class="i">-&gt;$MethodName</span><span class="s">(</span><span class="i">$Value</span><span class="s">)</span><span class="sc">;</span>
  99   <span class="s">}</span>
 100 
 101   <span class="c"># Make sure molecule object was specified...</span>
 102   <span class="k">if</span> <span class="s">(</span>!<span class="k">exists</span> <span class="i">$NamesAndValues</span>{<span class="w">Molecule</span>}<span class="s">)</span> <span class="s">{</span>
 103     <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;New: Object can&#39;t be instantiated without specifying molecule...&quot;</span><span class="sc">;</span>
 104   <span class="s">}</span>
 105 
 106   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 107 <span class="s">}</span>
 108 
 109 <span class="c"># Get MMFF94 atom types and associated data loaded from MMFF94 data file as</span>
 110 <span class="c"># a reference to hash with the following hash data format:</span>
 111 <span class="c">#</span>
 112 <span class="c"># @{$MMFF94AtomTypesDataMap{AtomTypes}} - Array of all possible atom types for all atoms</span>
 113 <span class="c"># @{$MMFF94AtomTypesDataMap{NonHydrogenAtomTypes}} - Array of all possible atom types for non-hydrogen atoms</span>
 114 <span class="c"># @{$MMFF94AtomTypesDataMap-&gt;{ColLabels}} - Array of column labels</span>
 115 <span class="c"># %{$MMFF94AtomTypesDataMap-&gt;{DataCol&lt;Num&gt;}} - Hash keys pair: &lt;DataCol&lt;Num&gt;, AtomType&gt;</span>
 116 <span class="c">#</span>
 117 <span class="c"># This functionality can be either invoked as a class function or an</span>
 118 <span class="c"># object method.</span>
 119 <span class="c">#</span>
<a name="GetMMFF94AtomTypesData-"></a> 120 <span class="k">sub </span><span class="m">GetMMFF94AtomTypesData</span> <span class="s">{</span>
 121 
 122   <span class="c"># Make sure data is loaded...</span>
 123   <span class="i">_CheckAndLoadMMFF94AtomTypesData</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 124 
 125   <span class="k">return</span> \<span class="i">%MMFF94AtomTypesDataMap</span><span class="sc">;</span>
 126 <span class="s">}</span>
 127 
 128 <span class="c"># Get all possible MMFF94 atom types corresponding to hydrogen and non-hydrogen</span>
 129 <span class="c"># atoms as an array reference...</span>
 130 <span class="c">#</span>
 131 <span class="c"># This functionality can be either invoked as a class function or an</span>
 132 <span class="c"># object method.</span>
 133 <span class="c">#</span>
<a name="GetAllPossibleMMFF94AtomTypes-"></a> 134 <span class="k">sub </span><span class="m">GetAllPossibleMMFF94AtomTypes</span> <span class="s">{</span>
 135   <span class="k">return</span> <span class="i">_GetAllPossibleMMFF94AtomTypes</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 136 <span class="s">}</span>
 137 
 138 <span class="c"># Get all possible MMFF94 atom types corresponding to non-hydrogen atoms</span>
 139 <span class="c"># as an array reference...</span>
 140 <span class="c">#</span>
 141 <span class="c"># This functionality can be either invoked as a class function or an</span>
 142 <span class="c"># object method.</span>
 143 <span class="c">#</span>
<a name="GetAllPossibleMMFF94NonHydrogenAtomTypes-"></a> 144 <span class="k">sub </span><span class="m">GetAllPossibleMMFF94NonHydrogenAtomTypes</span> <span class="s">{</span>
 145   <span class="k">my</span><span class="s">(</span><span class="i">$NonHydrogensOnly</span><span class="s">)</span><span class="sc">;</span>
 146 
 147   <span class="i">$NonHydrogensOnly</span> = <span class="n">1</span><span class="sc">;</span>
 148   <span class="k">return</span> <span class="i">_GetAllPossibleMMFF94AtomTypes</span><span class="s">(</span><span class="i">$NonHydrogensOnly</span><span class="s">)</span><span class="sc">;</span>
 149 <span class="s">}</span>
 150 
 151 <span class="c"># Get all possible MMFF94 atom types as an array reference...</span>
 152 <span class="c">#</span>
<a name="_GetAllPossibleMMFF94AtomTypes-"></a> 153 <span class="k">sub </span><span class="m">_GetAllPossibleMMFF94AtomTypes</span> <span class="s">{</span>
 154   <span class="k">my</span><span class="s">(</span><span class="i">$NonHydrogensOnly</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 155   <span class="k">my</span><span class="s">(</span><span class="i">$MMFF94AtomTypesDataRef</span><span class="s">)</span><span class="sc">;</span>
 156 
 157   <span class="i">$NonHydrogensOnly</span> = <span class="k">defined</span> <span class="i">$NonHydrogensOnly</span> ? <span class="i">$NonHydrogensOnly</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 158 
 159   <span class="i">$MMFF94AtomTypesDataRef</span> = <span class="i">GetMMFF94AtomTypesData</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 160 
 161   <span class="k">return</span> <span class="i">$NonHydrogensOnly</span> ? \<span class="i">@</span>{<span class="i">$MMFF94AtomTypesDataRef</span>-&gt;{<span class="w">NonHydrogenAtomTypes</span>}}<span class="co">:</span> \<span class="i">@</span>{<span class="i">$MMFF94AtomTypesDataRef</span>-&gt;{<span class="w">AtomTypes</span>}}<span class="sc">;</span>
 162 <span class="s">}</span>
 163 
 164 <span class="c"># Assign MMFF94 [ Ref 83-87 ] atom types to all atoms...</span>
 165 <span class="c">#</span>
 166 <span class="c"># Notes:</span>
 167 <span class="c">#     o 212 MMFF94 atom type symbols are listed</span>
 168 <span class="c">#     o 95 MMFF94 atom type numbers are listed</span>
 169 <span class="c">#     o Atom type numbers from 83 to 86 are not used</span>
 170 <span class="c">#     o Number of atom type symbols for:</span>
 171 <span class="c">#         o C: 34</span>
 172 <span class="c">#         o N: 47</span>
 173 <span class="c">#         o O: 45</span>
 174 <span class="c">#         o P: 7</span>
 175 <span class="c">#         o S: 18</span>
 176 <span class="c">#         o F, Br: 2</span>
 177 <span class="c">#         o Cl: 3</span>
 178 <span class="c">#         o I: 1</span>
 179 <span class="c">#         o H: 41</span>
 180 <span class="c">#         o Fe,Cu, Zn: 2</span>
 181 <span class="c">#         o Li, Na, L, K, Mg, Si, : 1</span>
 182 <span class="c">#</span>
<a name="AssignAtomTypes-"></a> 183 <span class="k">sub </span><span class="m">AssignAtomTypes</span> <span class="s">{</span>
 184   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 185 
 186   <span class="i">$This</span><span class="i">-&gt;_AssignAtomTypesToNonHydrogenAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 187 
 188   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span>-&gt;{<span class="w">IgnoreHydrogens</span>}<span class="s">)</span> <span class="s">{</span>
 189     <span class="i">$This</span><span class="i">-&gt;_AssignAtomTypesToHydrogenAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 190   <span class="s">}</span>
 191 
 192   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 193 <span class="s">}</span>
 194 
 195 <span class="c"># Assign atom types to all non-Hydrogen atoms..</span>
 196 <span class="c">#</span>
<a name="_AssignAtomTypesToNonHydrogenAtoms-"></a> 197 <span class="k">sub </span><span class="m">_AssignAtomTypesToNonHydrogenAtoms</span> <span class="s">{</span>
 198   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 199   <span class="k">my</span><span class="s">(</span><span class="i">$Atom</span><span class="cm">,</span> <span class="i">$AtomType</span><span class="s">)</span><span class="sc">;</span>
 200 
 201   <span class="j">ATOM:</span> <span class="k">for</span> <span class="i">$Atom</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;GetMolecule</span><span class="s">(</span><span class="s">)</span><span class="i">-&gt;GetAtoms</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 202     <span class="k">if</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;IsHydrogen</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 203       <span class="k">next</span> <span class="j">ATOM</span><span class="sc">;</span>
 204     <span class="s">}</span>
 205     <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomType</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 206     <span class="i">$This</span><span class="i">-&gt;SetAtomType</span><span class="s">(</span><span class="i">$Atom</span><span class="cm">,</span> <span class="i">$AtomType</span><span class="s">)</span><span class="sc">;</span>
 207   <span class="s">}</span>
 208   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 209 <span class="s">}</span>
 210 
 211 <span class="c"># Assign atom types to Hydrogen atoms..</span>
 212 <span class="c">#</span>
<a name="_AssignAtomTypesToHydrogenAtoms-"></a> 213 <span class="k">sub </span><span class="m">_AssignAtomTypesToHydrogenAtoms</span> <span class="s">{</span>
 214   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 215   <span class="k">my</span><span class="s">(</span><span class="i">$Atom</span><span class="cm">,</span> <span class="i">$AtomType</span><span class="s">)</span><span class="sc">;</span>
 216 
 217   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">IgnoreHydrogens</span>}<span class="s">)</span> <span class="s">{</span>
 218     <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 219   <span class="s">}</span>
 220 
 221   <span class="j">ATOM:</span> <span class="k">for</span> <span class="i">$Atom</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;GetMolecule</span><span class="s">(</span><span class="s">)</span><span class="i">-&gt;GetAtoms</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 222     <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;IsHydrogen</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 223       <span class="k">next</span> <span class="j">ATOM</span><span class="sc">;</span>
 224     <span class="s">}</span>
 225     <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomTypeForHydrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 226     <span class="i">$This</span><span class="i">-&gt;SetAtomType</span><span class="s">(</span><span class="i">$Atom</span><span class="cm">,</span> <span class="i">$AtomType</span><span class="s">)</span><span class="sc">;</span>
 227   <span class="s">}</span>
 228   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 229 <span class="s">}</span>
 230 
 231 <span class="c"># Get MMFF94 atom type for atom...</span>
 232 <span class="c">#</span>
<a name="_GetAtomType-"></a> 233 <span class="k">sub </span><span class="m">_GetAtomType</span> <span class="s">{</span>
 234   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 235   <span class="k">my</span><span class="s">(</span><span class="i">$AtomType</span><span class="s">)</span><span class="sc">;</span>
 236 
 237   <span class="i">$AtomType</span> = <span class="q">&#39;&#39;</span><span class="sc">;</span>
 238 
 239   <span class="j">ATOM:</span> <span class="s">{</span>
 240     <span class="k">if</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;IsCarbon</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 241       <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomTypeForCarbon</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 242       <span class="k">last</span> <span class="j">ATOM</span><span class="sc">;</span>
 243     <span class="s">}</span>
 244     <span class="k">if</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;IsNitrogen</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 245       <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomTypeForNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 246       <span class="k">last</span> <span class="j">ATOM</span><span class="sc">;</span>
 247     <span class="s">}</span>
 248     <span class="k">if</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;IsOxygen</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 249       <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomTypeForOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 250       <span class="k">last</span> <span class="j">ATOM</span><span class="sc">;</span>
 251     <span class="s">}</span>
 252     <span class="k">if</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;IsPhosphorus</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 253       <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomTypeForPhosphorus</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 254       <span class="k">last</span> <span class="j">ATOM</span><span class="sc">;</span>
 255     <span class="s">}</span>
 256     <span class="k">if</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;IsSulfur</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 257       <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomTypeForSulfur</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 258       <span class="k">last</span> <span class="j">ATOM</span><span class="sc">;</span>
 259     <span class="s">}</span>
 260     <span class="k">if</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;IsHydrogen</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 261       <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomTypeForHydrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 262       <span class="k">last</span> <span class="j">ATOM</span><span class="sc">;</span>
 263     <span class="s">}</span>
 264     <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomTypeForOtherAtoms</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 265   <span class="s">}</span>
 266 
 267   <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
 268 <span class="s">}</span>
 269 
 270 <span class="c"># Get MMFF94 atom type for Carbon atom...</span>
 271 <span class="c">#</span>
 272 <span class="c"># 34 AtomTypeSymbols for element C:</span>
 273 <span class="c">#</span>
 274 <span class="c"># AtomTypeSymbol   AtomTypeNum   AtomTypeDefinition</span>
 275 <span class="c">#   CR       1     ALKYL CARBON, SP3</span>
 276 <span class="c">#   C=C      2     VINYLIC CARBON, SP2</span>
 277 <span class="c">#   CSP2     2     GENERIC SP2 CARBON</span>
 278 <span class="c">#   C=O      3     GENERAL CARBONYL CARBON</span>
 279 <span class="c">#   C=N      3     SP2 CARBON IN C=N</span>
 280 <span class="c">#   CGD      3     GUANIDINE CARBON, DOUBLY BONDED TO N</span>
 281 <span class="c">#   C=OR     3     KETONE OR ALDEHYDE CARBONYL CARBON</span>
 282 <span class="c">#   C=ON     3     AMIDE CARBONYL CARBON</span>
 283 <span class="c">#   CONN     3     UREA CARBONYL CARBON</span>
 284 <span class="c">#   COO      3     CARBOXYLIC ACID OR ESTER CARBONYL CARBON</span>
 285 <span class="c">#   COON     3     CARBAMATE CARBONYL CARBON</span>
 286 <span class="c">#   COOO     3     CARBONIC ACID OR ESTER CARBONYL CARBON</span>
 287 <span class="c">#   C=OS     3     THIOESTER CARBONYL CARBON, DOUBLE BONDED TO O</span>
 288 <span class="c">#   C=S      3     THIOESTER CARBON, DOUBLY BONDED TO S</span>
 289 <span class="c">#   C=SN     3     THIOAMIDE, CARBON, DOUBLY BONDED TO S</span>
 290 <span class="c">#   CSO2     3     CARBON IN &gt;C=SO2</span>
 291 <span class="c">#   CS=O     3     CARBON IN &gt;C=S=O (SULFINYL GROUP)</span>
 292 <span class="c">#   CSS      3     THIOCARBOXYLIC ACID OR ESTER CARBONYL CARBON</span>
 293 <span class="c">#   C=P      3     CARBON DOUBLE BONDED TO PHOSPHOROUS</span>
 294 <span class="c">#   CSP      4     ACETYLENIC CARBON</span>
 295 <span class="c">#   =C=      4     ALLENIC CARBON</span>
 296 <span class="c">#   CR4R     20    CARBON IN 4-MEMBERED RINGS</span>
 297 <span class="c">#   CR3R     22    CARBON IN A 3-MEMBERED RING</span>
 298 <span class="c">#   CE4R     30    OLEFINIC CARBON IN 4-MEMBERED RINGS</span>
 299 <span class="c">#   CB       37    CARBON AS IN BENZENE, PYRROLE</span>
 300 <span class="c">#   CO2M     41    CARBOXYLATE ANION CARBON</span>
 301 <span class="c">#   CS2M     41    CARBON IN THIOCARBOXYLATE ANION</span>
 302 <span class="c">#   CGD+     57    GUANIDINIUM CARBON</span>
 303 <span class="c">#   CNN+     57    C IN +N=C-N RESONANCE STRUCTURES</span>
 304 <span class="c">#   C%       60    ISONITRILE CARBON</span>
 305 <span class="c">#   C5A      63    ALPHA CARBON IN 5-MEMBERED HETEROAROMATIC RING</span>
 306 <span class="c">#   C5B      64    BETA CARBON IN 5-MEMBERED HETEROAROMATIC RING</span>
 307 <span class="c">#   C5       78    GENERAL CARBON IN 5-MEMBERED HETEROAROMATIC RING</span>
 308 <span class="c">#   CIM+     80    C IN N-C-N IN IMIDAZOLIUM ION</span>
 309 <span class="c">#</span>
 310 <span class="c"># Notes:</span>
 311 <span class="c">#     . During atom type assignments, matches are performed starting from specific to generic.</span>
 312 <span class="c">#</span>
<a name="_GetAtomTypeForCarbon-"></a> 313 <span class="k">sub </span><span class="m">_GetAtomTypeForCarbon</span> <span class="s">{</span>
 314   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 315   <span class="k">my</span><span class="s">(</span><span class="i">$AtomType</span><span class="cm">,</span> <span class="i">$NumOfSigmaBonds</span><span class="cm">,</span> <span class="i">$NumOfPiBonds</span><span class="s">)</span><span class="sc">;</span>
 316 
 317   <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
 318 
 319   <span class="s">(</span><span class="i">$NumOfSigmaBonds</span><span class="cm">,</span> <span class="i">$NumOfPiBonds</span><span class="s">)</span> = <span class="s">(</span><span class="q">&#39;0&#39;</span><span class="s">)</span> x <span class="n">2</span><span class="sc">;</span>
 320 
 321   <span class="s">(</span><span class="i">$NumOfSigmaBonds</span><span class="cm">,</span> <span class="i">$NumOfPiBonds</span><span class="s">)</span> = <span class="i">$Atom</span><span class="i">-&gt;GetNumOfSigmaAndPiBondsToNonHydrogenAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 322   <span class="i">$NumOfSigmaBonds</span> += <span class="i">$Atom</span><span class="i">-&gt;GetAtomicInvariantValue</span><span class="s">(</span><span class="q">&#39;H&#39;</span><span class="s">)</span><span class="sc">;</span>
 323 
 324   <span class="j">ATOMTYPE:</span> <span class="s">{</span>
 325 
 326     <span class="c"># Only single bonds...</span>
 327     <span class="k">if</span> <span class="s">(</span><span class="i">$NumOfPiBonds</span> == <span class="n">0</span><span class="s">)</span> <span class="s">{</span>
 328       <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomTypeForCarbonWithOnlySigmaBonds</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 329       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 330     <span class="s">}</span>
 331 
 332     <span class="c"># One double bond...</span>
 333     <span class="k">if</span> <span class="s">(</span><span class="i">$NumOfPiBonds</span> == <span class="n">1</span><span class="s">)</span> <span class="s">{</span>
 334       <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomTypeForCarbonWithOnePiBond</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 335       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 336     <span class="s">}</span>
 337 
 338     <span class="c"># One triple bond or two double bonds...</span>
 339     <span class="k">if</span> <span class="s">(</span><span class="i">$NumOfPiBonds</span> == <span class="n">2</span><span class="s">)</span> <span class="s">{</span>
 340       <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomTypeForCarbonWithTwoPiBonds</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 341       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 342     <span class="s">}</span>
 343 
 344     <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
 345     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;_GetAtomTypeForCarbon: MMFF94 atom type for Carbon cann&#39;t be assigned...&quot;</span><span class="sc">;</span>
 346   <span class="s">}</span>
 347   <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
 348 <span class="s">}</span>
 349 
 350 <span class="c"># Get MMFF94 atom type for Nitrogen atom...</span>
 351 <span class="c">#</span>
 352 <span class="c"># 47 AtomTypeSymbols for element N:</span>
 353 <span class="c">#</span>
 354 <span class="c"># AtomTypeSymbol   AtomTypeNum   AtomTypeDefinition</span>
 355 <span class="c">#   NR       8     NITROGEN IN ALIPHATIC AMINES</span>
 356 <span class="c">#   N=C      9     NITROGEN IN IMINES</span>
 357 <span class="c">#   N=N      9     NITROGEN IN AZO COMPOUNDS</span>
 358 <span class="c">#   NC=O     10    NITROGEN IN AMIDES</span>
 359 <span class="c">#   NC=S     10    NITROGEN IN N-C=S, THIOAMIDE</span>
 360 <span class="c">#   NN=C     10    NITROGEN IN N-N=C</span>
 361 <span class="c">#   NN=N     10    NITROGEN IN N-N=N</span>
 362 <span class="c">#   NR+      34    QUATERNARY NITROGEN, SP3, POSITIVELY CHARGED</span>
 363 <span class="c">#   NPYD     38    NITROGEN, AS IN PYRIDINE</span>
 364 <span class="c">#   NPYL     39    NITROGEN, AS IN PYRROLE</span>
 365 <span class="c">#   NC=C     40    NITROGEN ON N-C=C</span>
 366 <span class="c">#   NC=N     40    NITROGEN IN N-C=N</span>
 367 <span class="c">#   NC=P     40    NITROGEN IN N-C=P</span>
 368 <span class="c">#   NC%C     40    NITROGEN ATTACHED TO C-C TRIPLE BOND</span>
 369 <span class="c">#   NSP      42    NITROGEN, TRIPLE BONDED</span>
 370 <span class="c">#   NSO2     43    NITROGEN IN SULFONAMIDES</span>
 371 <span class="c">#   NSO3     43    NITROGEN IN SULFONAMIDES, THREE Os ON S</span>
 372 <span class="c">#   NPO2     43    NITROGEN IN PHOSPHONAMIDES</span>
 373 <span class="c">#   NPO3     43    NITROGEN IN PHOSPHONAMIDES, THREE Os ON P</span>
 374 <span class="c">#   NC%N     43    NITROGEN ATTACHED TO CYANO GROUP</span>
 375 <span class="c">#   NO2      45    NITRO GROUP NITROGEN</span>
 376 <span class="c">#   NO3      45    NITRATE GROUP NITROGEN</span>
 377 <span class="c">#   N=O      46    NITROSO NITROGEN</span>
 378 <span class="c">#   NAZT     47    TERMINAL NITROGEN IN AZIDO OR DIAZO GROUP</span>
 379 <span class="c">#   NSO      48    DIVALENT NITROGEN REPLACING MONOVALENT O IN SO2 GROUP</span>
 380 <span class="c">#   =N=      53    NITROGEN IN C=N=N OR -N=N=N</span>
 381 <span class="c">#   N+=C     54    POSITIVELY CHARGED IMINIUM NITROGEN</span>
 382 <span class="c">#   N+=N     54    POSITIVELY CHARGED NITROGEN DOUBLE-BONDED TO N</span>
 383 <span class="c">#   NCN+     55    N IN +N=C-N RESONANCE STRUCTURES - FORMAL CHARGE=1/2</span>
 384 <span class="c">#   NGD+     56    GUANIDINIUM-TYPE NITROGEN - FORMAL CHARGE=1/3</span>
 385 <span class="c">#   NPD+     58    PYRIDINIUM-TYPE NITROGEN - FORMAL CHARGE=1</span>
 386 <span class="c">#   NR%      61    ISONITRILE NITROGEN [FC = 0] OR DIAZO NITROGEN [FC = 1]</span>
 387 <span class="c">#   NM       62    DEPROTONATED SULFONAMIDE N-; FORMAL CHARGE=-1</span>
 388 <span class="c">#   N5A      65    ALPHA AROM HETEROCYCLIC 5-RING  NITROGEN</span>
 389 <span class="c">#   N5B      66    BETA AROM HETEROCYCLIC 5-RING  NITROGEN</span>
 390 <span class="c">#   N2OX     67    SP2-HYDRIDIZED N-OXIDE NITROGEN</span>
 391 <span class="c">#   N3OX     68    SP3-HYDRIDIZED N-OXIDE NITROGEN</span>
 392 <span class="c">#   NPOX     69    PYRIDINE N-OXIDE NITROGEN</span>
 393 <span class="c">#   N5M      76    NEGATIVELY CHARGED N IN, E.G, TRI- OR TETRAZOLE ANION</span>
 394 <span class="c">#   N5       79    GENERAL NITROGEN IN 5-MEMBERED HETEROCYCLIC RING</span>
 395 <span class="c">#   NIM+     81    IMIDAZOLIUM-TYPE NITROGEN - FORMAL CHARGE=1/2</span>
 396 <span class="c">#   N5A+     81    POSITIVE N5A NITROGEN - FORMAL CHARGE=1</span>
 397 <span class="c">#   N5B+     81    POSITIVE N5B NITROGEN - FORMAL CHARGE=1</span>
 398 <span class="c">#   N5+      81    POSITIVE N5 NITROGEN - FORMAL CHARGE=1</span>
 399 <span class="c">#   N5AX     82    N-OXIDE NITROGEN IN 5-RING ALPHA POSITION</span>
 400 <span class="c">#   N5BX     82    N-OXIDE NITROGEN IN 5-RING BETA POSITION</span>
 401 <span class="c">#   N5OX     82    N-OXIDE NITROGEN IN GENERAL 5-RING POSITION</span>
 402 <span class="c">#</span>
 403 <span class="c"># Notes:</span>
 404 <span class="c">#   . The current release of MayaChemTools assigns &quot;None&quot; to Oxygens in the following environment</span>
 405 <span class="c">#     as no generic or specific MMFF94 atom types exists to handle them:</span>
 406 <span class="c">#</span>
 407 <span class="c">#      . Terminal Nitrogens attched to Sulfur in &gt;S=N</span>
 408 <span class="c">#</span>
<a name="_GetAtomTypeForNitrogen-"></a> 409 <span class="k">sub </span><span class="m">_GetAtomTypeForNitrogen</span> <span class="s">{</span>
 410   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 411   <span class="k">my</span><span class="s">(</span><span class="i">$AtomType</span><span class="cm">,</span> <span class="i">$NumOfSigmaBonds</span><span class="cm">,</span> <span class="i">$NumOfPiBonds</span><span class="s">)</span><span class="sc">;</span>
 412 
 413   <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
 414 
 415   <span class="s">(</span><span class="i">$NumOfSigmaBonds</span><span class="cm">,</span> <span class="i">$NumOfPiBonds</span><span class="s">)</span> = <span class="s">(</span><span class="q">&#39;0&#39;</span><span class="s">)</span> x <span class="n">2</span><span class="sc">;</span>
 416 
 417   <span class="s">(</span><span class="i">$NumOfSigmaBonds</span><span class="cm">,</span> <span class="i">$NumOfPiBonds</span><span class="s">)</span> = <span class="i">$Atom</span><span class="i">-&gt;GetNumOfSigmaAndPiBondsToNonHydrogenAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 418   <span class="i">$NumOfSigmaBonds</span> += <span class="i">$Atom</span><span class="i">-&gt;GetAtomicInvariantValue</span><span class="s">(</span><span class="q">&#39;H&#39;</span><span class="s">)</span><span class="sc">;</span>
 419 
 420   <span class="j">ATOMTYPE:</span> <span class="s">{</span>
 421 
 422     <span class="c"># Nitrogens in five membered rings...</span>
 423     <span class="k">if</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;IsInRingOfSize</span><span class="s">(</span><span class="n">5</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 424       <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomTypeForFiveMemberedRingNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 425       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 426     <span class="s">}</span>
 427 
 428     <span class="c"># -N(-)-, -N+(-)(-)-, -(N-1)(-)</span>
 429     <span class="k">if</span> <span class="s">(</span><span class="i">$NumOfPiBonds</span> == <span class="n">0</span><span class="s">)</span> <span class="s">{</span>
 430       <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomTypeForNitrogenWithOnlySigmaBonds</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 431       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 432     <span class="s">}</span>
 433 
 434     <span class="c"># -N=, and -N+(=)-</span>
 435     <span class="k">if</span> <span class="s">(</span><span class="i">$NumOfPiBonds</span> == <span class="n">1</span><span class="s">)</span> <span class="s">{</span>
 436       <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomTypeForNitrogenWithOnePiBond</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 437       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 438     <span class="s">}</span>
 439 
 440     <span class="c"># #N, #N+-, and =N+=</span>
 441     <span class="k">if</span> <span class="s">(</span><span class="i">$NumOfPiBonds</span> == <span class="n">2</span><span class="s">)</span> <span class="s">{</span>
 442       <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomTypeForNitrogenWithTwoPiBonds</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 443       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 444     <span class="s">}</span>
 445 
 446     <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
 447     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;_GetAtomTypeForNitrogen: MMFF94 atom type for Nitrogen cann&#39;t be assigned...&quot;</span><span class="sc">;</span>
 448   <span class="s">}</span>
 449   <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
 450 <span class="s">}</span>
 451 
 452 <span class="c"># Get MMFF94 atom type for Oxygen atom...</span>
 453 <span class="c">#</span>
 454 <span class="c"># 45 AtomTypeSymbols for element O:</span>
 455 <span class="c">#</span>
 456 <span class="c"># AtomTypeSymbol   AtomTypeNum   AtomTypeDefinition</span>
 457 <span class="c">#   OR       6     ALCOHOL OR ETHER OXYGEN</span>
 458 <span class="c">#   OC=O     6     ESTER OR CARBOXYLIC ACID -O-</span>
 459 <span class="c">#   OC=C     6     ENOLIC OR PHENOLIC OXYGEN</span>
 460 <span class="c">#   OC=N     6     DIVALENT OXYGEN</span>
 461 <span class="c">#   OC=S     6     THIOESTER OR THIOACID -O-</span>
 462 <span class="c">#   ONO2     6     DIVALENT NITRATE ETHER OXYGEN</span>
 463 <span class="c">#   ON=O     6     DIVALENT NITRITE ETHER OXYGEN</span>
 464 <span class="c">#   OSO3     6     DIVALENT OXYGEN ATTACHED TO SULFUR</span>
 465 <span class="c">#   OSO2     6     DIVALENT OXYGEN ATTACHED TO SULFUR</span>
 466 <span class="c">#   OSO      6     DIVALENT OXYGEN ATTACHED TO SULFUR</span>
 467 <span class="c">#   OS=O     6     DIVALENT OXYGEN ATTACHED TO SULFOXIDE SULFUR</span>
 468 <span class="c">#   -OS      6     GENERAL DIVALENT OXYGEN ATTACHED TO S</span>
 469 <span class="c">#   OPO3     6     DIVALENT OXYGEN ATTACHED TO PHOSPHOROUS</span>
 470 <span class="c">#   OPO2     6     DIVALENT OXYGEN ATTACHED TO PHOSPHOROUS</span>
 471 <span class="c">#   OPO      6     DIVALENT OXYGEN ATTACHED TO PHOSPHOROUS</span>
 472 <span class="c">#   -OP      6     DIVALENT OXYGEN ATTACHED TO PHOSPHOROUS</span>
 473 <span class="c">#   -O-      6     GENERAL DIVALENT O</span>
 474 <span class="c">#   O=C      7     GENERAL C=O</span>
 475 <span class="c">#   O=CN     7     CARBONYL OXYGEN, AMIDES</span>
 476 <span class="c">#   O=CR     7     CARBONYL OXYGEN, ALDEHYDES AND KETONES</span>
 477 <span class="c">#   O=CO     7     CARBONYL OXYGEN, CARBOXYLIC ACIDS AND ESTERS</span>
 478 <span class="c">#   O=N      7     NITROSO OXYGEN</span>
 479 <span class="c">#   O=S      7     O=S IN SULFOXIDES</span>
 480 <span class="c">#   O=S=     7     O=S ON SULFUR DOUBLY BONDED TO, E.G., CARBON</span>
 481 <span class="c">#   O2CM     32    OXYGEN IN CARBOXYLATE ANION</span>
 482 <span class="c">#   OXN      32    N-OXIDE OXYGEN</span>
 483 <span class="c">#   O2N      32    NITRO OXYGEN</span>
 484 <span class="c">#   O2NO     32    NITRO-GROUP OXYGEN IN NITRATE</span>
 485 <span class="c">#   O3N      32    NITRATE ANION OXYGEN</span>
 486 <span class="c">#   O-S      32    SINGLE TERMINAL OXYGEN ON TETRACOORD SULFUR</span>
 487 <span class="c">#   O2S      32    TERMINAL O-S IN SULFONES AND SULFONAMIDES</span>
 488 <span class="c">#   O3S      32    TERMINAL O IN SULFONATES</span>
 489 <span class="c">#   O4S      32    TERMINAL O IN SO4(-3)</span>
 490 <span class="c">#   OSMS     32    TERM O IN THIOSULFINATE ANION - FORMAL CHARGE=-0.5</span>
 491 <span class="c">#   OP       32    TERMINAL O IN PHOSPHOXIDES</span>
 492 <span class="c">#   O2P      32    TERMINAL O IN PHOSPHINATES</span>
 493 <span class="c">#   O3P      32    TERMINAL OXYGEN IN PHOSPHONATES</span>
 494 <span class="c">#   O4P      32    TERMINAL OXYGEN IN PHOSPHATES AND PHOSPHODIESTERS</span>
 495 <span class="c">#   O4CL     32    OXYGEN IN CLO4(-) ANION - FORMAL CHARGE=-0.25</span>
 496 <span class="c">#   OM       35    ALKOXIDE OXYGEN, NEGATIVELY CHARGED</span>
 497 <span class="c">#   OM2      35    OXIDE OXYGEN ON SP2 CARBON, NEGATIVELY CHARGED</span>
 498 <span class="c">#   O+       49    POSITIVELY CHARGED OXONIUM (TRICOORDINATE) OXYGEN</span>
 499 <span class="c">#   O=+      51    POSITIVELY CHARGED OXENIUM (DICOORDINATE) OXYGEN</span>
 500 <span class="c">#   OFUR     59    AROMATIC OXYGEN AS IN FURAN</span>
 501 <span class="c">#   OH2      70    OXYGEN ON WATER</span>
 502 <span class="c">#</span>
 503 <span class="c"># Notes:</span>
 504 <span class="c">#   . The current release of MayaChemTools assigns &quot;None&quot; to Oxygens in the following environment</span>
 505 <span class="c">#     as no generic or specific MMFF94 atom types exists to handle them:</span>
 506 <span class="c">#</span>
 507 <span class="c">#      . Terminal anion Oxygen corresponding to divalent Oxygen attached to Sulfoxide Sulfur in</span>
 508 <span class="c">#        OS=O and divalent Oxygen attached to Sulfur in -OS</span>
 509 <span class="c">#      . Terminal Oxygens attched to Sulfur in =SO2</span>
 510 <span class="c">#      . Terminal anion Oxygen attched to Sulfur in SO2M which is same as OS=O</span>
 511 <span class="c">#</span>
<a name="_GetAtomTypeForOxygen-"></a> 512 <span class="k">sub </span><span class="m">_GetAtomTypeForOxygen</span> <span class="s">{</span>
 513   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 514   <span class="k">my</span><span class="s">(</span><span class="i">$AtomType</span><span class="cm">,</span> <span class="i">$NumOfSigmaBonds</span><span class="cm">,</span> <span class="i">$NumOfPiBonds</span><span class="cm">,</span> <span class="i">$OxygenAttachedToSulfur</span><span class="cm">,</span> <span class="i">$OxygenAttachedToPhosphorus</span><span class="s">)</span><span class="sc">;</span>
 515 
 516   <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
 517 
 518   <span class="s">(</span><span class="i">$NumOfSigmaBonds</span><span class="cm">,</span> <span class="i">$NumOfPiBonds</span><span class="s">)</span> = <span class="s">(</span><span class="q">&#39;0&#39;</span><span class="s">)</span> x <span class="n">2</span><span class="sc">;</span>
 519 
 520   <span class="s">(</span><span class="i">$NumOfSigmaBonds</span><span class="cm">,</span> <span class="i">$NumOfPiBonds</span><span class="s">)</span> = <span class="i">$Atom</span><span class="i">-&gt;GetNumOfSigmaAndPiBondsToNonHydrogenAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 521   <span class="i">$NumOfSigmaBonds</span> += <span class="i">$Atom</span><span class="i">-&gt;GetAtomicInvariantValue</span><span class="s">(</span><span class="q">&#39;H&#39;</span><span class="s">)</span><span class="sc">;</span>
 522 
 523   <span class="i">$OxygenAttachedToSulfur</span> = <span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;S&#39;</span><span class="s">)</span><span class="sc">;</span>
 524   <span class="i">$OxygenAttachedToPhosphorus</span> = <span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;P&#39;</span><span class="s">)</span><span class="sc">;</span>
 525 
 526   <span class="j">ATOMTYPE:</span> <span class="s">{</span>
 527 
 528    <span class="c"># Divalent or terminal Oxygen attached to Sulfur...</span>
 529     <span class="k">if</span> <span class="s">(</span><span class="i">$OxygenAttachedToSulfur</span><span class="s">)</span> <span class="s">{</span>
 530       <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomTypeForOxygenAttachedToSulfur</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 531       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 532     <span class="s">}</span>
 533 
 534    <span class="c"># Divalent or terminal Oxygen attached to Phosphorous...</span>
 535     <span class="k">if</span> <span class="s">(</span><span class="i">$OxygenAttachedToPhosphorus</span><span class="s">)</span> <span class="s">{</span>
 536       <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomTypeForOxygenAttachedToPhosphorus</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 537       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 538     <span class="s">}</span>
 539 
 540     <span class="c"># Only single bonds...</span>
 541     <span class="k">if</span> <span class="s">(</span><span class="i">$NumOfPiBonds</span> == <span class="n">0</span><span class="s">)</span> <span class="s">{</span>
 542       <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomTypeForOxygenWithOnlySigmaBonds</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 543       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 544     <span class="s">}</span>
 545 
 546     <span class="c"># One double bond...</span>
 547     <span class="k">if</span> <span class="s">(</span><span class="i">$NumOfPiBonds</span> == <span class="n">1</span><span class="s">)</span> <span class="s">{</span>
 548       <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomTypeForOxygenWithOnePiBond</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 549       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 550     <span class="s">}</span>
 551 
 552     <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
 553     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;_GetAtomTypeForOxygen: MMFF94 atom type for Oxygen cann&#39;t be assigned...&quot;</span><span class="sc">;</span>
 554   <span class="s">}</span>
 555   <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
 556 <span class="s">}</span>
 557 
 558 <span class="c"># Get MMFF94 atom type for Phosphorus atom...</span>
 559 <span class="c">#</span>
 560 <span class="c"># 7 AtomTypeSymbols for element P:</span>
 561 <span class="c">#</span>
 562 <span class="c"># AtomTypeSymbol   AtomTypeNum   AtomTypeDefinition</span>
 563 <span class="c">#   PO4      25    PHOSPHOROUS IN PHOSPHATES AND PHOSPHODIESTERS</span>
 564 <span class="c">#   PO3      25    TETRACOORDINATE P WITH THREE ATTACHED OXYGENS</span>
 565 <span class="c">#   PO2      25    TETRACOORDINATE P WITH TWO ATTACHED OXYGENS</span>
 566 <span class="c">#   PO       25    TETRACOORDINATE P WITH ONE ATTACHED OXYGEN</span>
 567 <span class="c">#   PTET     25    GENERAL TETRACOORDINATE PHOSPHORUS</span>
 568 <span class="c">#   P        26    TRICOORDINATE P, AS IN PHOSPHINES</span>
 569 <span class="c">#   -P=C     75    PHOSPHOROUS DOUBLY BONDED TO CARBON</span>
 570 <span class="c">#</span>
<a name="_GetAtomTypeForPhosphorus-"></a> 571 <span class="k">sub </span><span class="m">_GetAtomTypeForPhosphorus</span> <span class="s">{</span>
 572   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 573   <span class="k">my</span><span class="s">(</span><span class="i">$AtomType</span><span class="s">)</span><span class="sc">;</span>
 574 
 575   <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
 576 
 577   <span class="j">ATOMTYPE:</span> <span class="s">{</span>
 578 
 579     <span class="c"># PO4 : PHOSPHOROUS IN PHOSPHATES AND PHOSPHODIESTERS</span>
 580     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsPhosphateOrPhosphodiesterPhosphorus</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 581       <span class="i">$AtomType</span> = <span class="q">&#39;PO4&#39;</span><span class="sc">;</span>
 582       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 583     <span class="s">}</span>
 584 
 585     <span class="c"># PO3 : TETRACOORDINATE P WITH THREE ATTACHED OXYGENS</span>
 586     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsPhosphonatePhosphorus</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 587       <span class="i">$AtomType</span> = <span class="q">&#39;PO3&#39;</span><span class="sc">;</span>
 588       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 589     <span class="s">}</span>
 590 
 591     <span class="c"># PO2 : TETRACOORDINATE P WITH TWO ATTACHED OXYGENS</span>
 592     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsPhosphinatePhosphorus</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 593       <span class="i">$AtomType</span> = <span class="q">&#39;PO2&#39;</span><span class="sc">;</span>
 594       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 595     <span class="s">}</span>
 596 
 597     <span class="c"># PO : TETRACOORDINATE P WITH ONE ATTACHED OXYGEN</span>
 598     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsPhosphoxidePhosphorus</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 599       <span class="i">$AtomType</span> = <span class="q">&#39;PO&#39;</span><span class="sc">;</span>
 600       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 601     <span class="s">}</span>
 602 
 603     <span class="c"># -P=C : PHOSPHOROUS DOUBLY BONDED TO CARBON</span>
 604     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsDoublyBondedToCarbonPhosphorous</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 605       <span class="i">$AtomType</span> = <span class="q">&#39;-P=C&#39;</span><span class="sc">;</span>
 606       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 607     <span class="s">}</span>
 608 
 609     <span class="c"># PTET : GENERAL TETRACOORDINATE PHOSPHORUS</span>
 610     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsTetraCoordinatedPhosphorus</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 611       <span class="i">$AtomType</span> = <span class="q">&#39;PTET&#39;</span><span class="sc">;</span>
 612       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 613     <span class="s">}</span>
 614 
 615     <span class="c"># P : TRICOORDINATE P, AS IN PHOSPHINES</span>
 616     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsTriCoordinatedPhosphorus</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 617       <span class="i">$AtomType</span> = <span class="q">&#39;P&#39;</span><span class="sc">;</span>
 618       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 619     <span class="s">}</span>
 620 
 621     <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
 622     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;_GetAtomTypeForPhosphorus: MMFF94 atom type for Phosphorous cann&#39;t be assigned...&quot;</span><span class="sc">;</span>
 623   <span class="s">}</span>
 624 
 625   <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
 626 <span class="s">}</span>
 627 
 628 <span class="c"># Get MMFF94 atom type for Sulfur atom...</span>
 629 <span class="c">#</span>
 630 <span class="c"># 18 AtomTypeSymbols for element S:</span>
 631 <span class="c">#</span>
 632 <span class="c"># AtomTypeSymbol   AtomTypeNum   AtomTypeDefinition</span>
 633 <span class="c">#   S        15    SULFUR IN THIOETHERS AND MERCAPTANS</span>
 634 <span class="c">#   S=C      16    TERMINAL SULFUR DOUBLY BONDED TO CARBON</span>
 635 <span class="c">#   S=O      17    SULFUR IN SULFOXIDES</span>
 636 <span class="c">#   &gt;S=N     17    SULFUR, TRICOORD, DOUBLY BONDED TO N</span>
 637 <span class="c">#   SO2      18    SULFUR IN SULFONES</span>
 638 <span class="c">#   SO2N     18    SULFUR IN SULFONAMIDES</span>
 639 <span class="c">#   SO3      18    SULFONATE SULFUR</span>
 640 <span class="c">#   SO4      18    SULFATE SULFUR</span>
 641 <span class="c">#   =SO2     18    SULFONE SULPHER DOUBLY BONDED TO CARBON</span>
 642 <span class="c">#   SNO      18    SULFUR IN NITROGEN ANALOG OF A SULFONE</span>
 643 <span class="c">#   STHI     44    SULFUR AS IN THIOPHENE</span>
 644 <span class="c">#   S-P      72    TERMINAL SULFUR BONDED TO PHOSPHORUS</span>
 645 <span class="c">#   S2CM     72    TERMINAL SULFUR IN THIOCARBOXYLATE ANION</span>
 646 <span class="c">#   SM       72    TERMINAL SULFUR - FORMAL CHARGE=-1</span>
 647 <span class="c">#   SSMO     72    TERMINAL SULFUR IN THIOSULFINATE GROUP</span>
 648 <span class="c">#   SO2M     73    SULFUR IN NEGATIVELY CHARGED SULFINATE GROUP</span>
 649 <span class="c">#   SSOM     73    TRICOORD SULFUR IN THIOSULFINATE GROUP</span>
 650 <span class="c">#   =S=O     74    SULFINYL SULFUR, EG. IN C=S=O</span>
 651 <span class="c">#</span>
<a name="_GetAtomTypeForSulfur-"></a> 652 <span class="k">sub </span><span class="m">_GetAtomTypeForSulfur</span> <span class="s">{</span>
 653   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 654   <span class="k">my</span><span class="s">(</span><span class="i">$AtomType</span><span class="s">)</span><span class="sc">;</span>
 655 
 656   <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
 657 
 658   <span class="j">ATOMTYPE:</span> <span class="s">{</span>
 659 
 660     <span class="c"># SO4 : SULFATE SULFUR</span>
 661     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsSulfateSulfur</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 662       <span class="i">$AtomType</span> = <span class="q">&#39;SO4&#39;</span><span class="sc">;</span>
 663       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 664     <span class="s">}</span>
 665 
 666     <span class="c"># SO3 : SULFONATE SULFUR</span>
 667     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsSulfonateSulfur</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 668       <span class="i">$AtomType</span> = <span class="q">&#39;SO3&#39;</span><span class="sc">;</span>
 669       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 670     <span class="s">}</span>
 671 
 672     <span class="c"># SO2N : SULFUR IN SULFONAMIDES</span>
 673     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsSulfonamideSulfur</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 674       <span class="i">$AtomType</span> = <span class="q">&#39;SO2N&#39;</span><span class="sc">;</span>
 675       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 676     <span class="s">}</span>
 677 
 678     <span class="c"># SO2 : SULFUR IN SULFONES</span>
 679     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsSulfoneSulfur</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 680       <span class="i">$AtomType</span> = <span class="q">&#39;SO2&#39;</span><span class="sc">;</span>
 681       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 682     <span class="s">}</span>
 683 
 684     <span class="c">#  =SO2: SULFONE SULPHER DOUBLY BONDED TO CARBON</span>
 685     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsDoublyBondedToCarbonSulfoneSulfur</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 686       <span class="i">$AtomType</span> = <span class="q">&#39;=SO2&#39;</span><span class="sc">;</span>
 687       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 688     <span class="s">}</span>
 689 
 690     <span class="c"># SO2M: SULFUR IN NEGATIVELY CHARGED SULFINATE GROUP</span>
 691     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsNegativelyChargedSulfinateSulfur</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 692       <span class="i">$AtomType</span> = <span class="q">&#39;SO2M&#39;</span><span class="sc">;</span>
 693       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 694     <span class="s">}</span>
 695 
 696     <span class="c"># SNO : SULFUR IN NITROGEN ANALOG OF A SULFONE</span>
 697     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsNitrogenAnalogOfSulfoneSulfur</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 698       <span class="i">$AtomType</span> = <span class="q">&#39;SNO&#39;</span><span class="sc">;</span>
 699       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 700     <span class="s">}</span>
 701 
 702     <span class="c"># S=O : SULFUR IN SULFOXIDES</span>
 703     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsSulfoxideSulfur</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 704       <span class="i">$AtomType</span> = <span class="q">&#39;S=O&#39;</span><span class="sc">;</span>
 705       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 706     <span class="s">}</span>
 707 
 708     <span class="c"># &gt;S=N : SULFUR, TRICOORD, DOUBLY BONDED TO N</span>
 709     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsSNTricoordinatedSulfur</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 710       <span class="i">$AtomType</span> = <span class="q">&#39;&gt;S=N&#39;</span><span class="sc">;</span>
 711       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 712     <span class="s">}</span>
 713 
 714     <span class="c"># STHI : SULFUR AS IN THIOPHENE</span>
 715     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsSTHISulfur</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 716       <span class="i">$AtomType</span> = <span class="q">&#39;STHI&#39;</span><span class="sc">;</span>
 717       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 718     <span class="s">}</span>
 719 
 720     <span class="c"># S2CM : TERMINAL SULFUR IN THIOCARBOXYLATE ANION</span>
 721     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsThioCarboxylateAnionTerminalSulfur</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 722       <span class="i">$AtomType</span> = <span class="q">&#39;S2CM&#39;</span><span class="sc">;</span>
 723       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 724     <span class="s">}</span>
 725 
 726     <span class="c"># SSMO : TERMINAL SULFUR IN THIOSULFINATE GROUP</span>
 727     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsThioSulfinateTerminalSulfur</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 728       <span class="i">$AtomType</span> = <span class="q">&#39;SSMO&#39;</span><span class="sc">;</span>
 729       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 730     <span class="s">}</span>
 731 
 732     <span class="c"># SSOM : TRICOORD SULFUR IN THIOSULFINATE GROUP</span>
 733     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsTriCoordinatedThioSulfinateSulfur</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 734       <span class="i">$AtomType</span> = <span class="q">&#39;SSOM&#39;</span><span class="sc">;</span>
 735       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 736     <span class="s">}</span>
 737 
 738     <span class="c">#   =S=O:  SULFINYL SULFUR, EG. IN C=S=O</span>
 739     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsSulfinylSulfur</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 740       <span class="i">$AtomType</span> = <span class="q">&#39;=S=O&#39;</span><span class="sc">;</span>
 741       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 742     <span class="s">}</span>
 743 
 744     <span class="c"># S-P : TERMINAL SULFUR BONDED TO PHOSPHORUS</span>
 745     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsSPTerminalSulfur</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 746       <span class="i">$AtomType</span> = <span class="q">&#39;S-P&#39;</span><span class="sc">;</span>
 747       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 748     <span class="s">}</span>
 749 
 750     <span class="c"># S=C : TERMINAL SULFUR DOUBLY BONDED TO CARBON</span>
 751     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsSCTerminalSulfur</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 752       <span class="i">$AtomType</span> = <span class="q">&#39;S=C&#39;</span><span class="sc">;</span>
 753       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 754     <span class="s">}</span>
 755 
 756     <span class="c"># SM : TERMINAL SULFUR - FORMAL CHARGE=-1</span>
 757     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsNegativelyChargedTerminalSulfur</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 758       <span class="i">$AtomType</span> = <span class="q">&#39;SM&#39;</span><span class="sc">;</span>
 759       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 760     <span class="s">}</span>
 761 
 762     <span class="c"># S : SULFUR IN THIOETHERS AND MERCAPTANS</span>
 763     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsThioEthersOrMercaptansSulfur</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 764       <span class="i">$AtomType</span> = <span class="q">&#39;S&#39;</span><span class="sc">;</span>
 765       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 766     <span class="s">}</span>
 767 
 768     <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
 769     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;_GetAtomTypeForSulfur: MMFF94 atom type for Sulfur cann&#39;t be assigned...&quot;</span><span class="sc">;</span>
 770   <span class="s">}</span>
 771   <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
 772 <span class="s">}</span>
 773 
 774 <span class="c"># Get MMFF94 atom type for Hydrogen atom...</span>
 775 <span class="c">#</span>
 776 <span class="c"># 41 AtomTypeSymbols for element H:</span>
 777 <span class="c">#</span>
 778 <span class="c"># AtomTypeSymbol   AtomTypeNum   AtomTypeDefinition</span>
 779 <span class="c">#   HC       5     H  ATTACHED TO C</span>
 780 <span class="c">#   HSI      5     H ATTACHED TO SI</span>
 781 <span class="c">#   HOR      21    HYDROGEN IN ALCOHOLS</span>
 782 <span class="c">#   HO       21    GENERAL H ON OXYGEN</span>
 783 <span class="c">#   HOM      21    HYDROGEN IN HYDROXIDE ANION</span>
 784 <span class="c">#   HNR      23    H-N(SP3)</span>
 785 <span class="c">#   H3N      23    H-N(SP3), AMMONIA</span>
 786 <span class="c">#   HPYL     23    H-N IN PYRROLE</span>
 787 <span class="c">#   HNOX     23    H-N IN IN A N-OXIDE</span>
 788 <span class="c">#   HNM      23    H ON DICOORD, NEGATIVELY CHARGED NITROGEN</span>
 789 <span class="c">#   HN       23    GENERAL H ON NITROGEN</span>
 790 <span class="c">#   HOCO     24    H-O IN CARBOXYLIC ACIDS</span>
 791 <span class="c">#   HOP      24    HYDROGEN ON OXYGEN ATTACHED TO PHOSPHOROUS</span>
 792 <span class="c">#   HN=N     27    AZO HYDROGEN</span>
 793 <span class="c">#   HN=C     27    IMINE HYDROGEN</span>
 794 <span class="c">#   HNCO     28    AMIDE HYDROGEN</span>
 795 <span class="c">#   HNCS     28    THIOAMIDE HYDROGEN</span>
 796 <span class="c">#   HNCC     28    H-N IN ENAMINES</span>
 797 <span class="c">#   HNCN     28    H-N IN H-N-C=N</span>
 798 <span class="c">#   HNNC     28    H-N IN H-N-N=C</span>
 799 <span class="c">#   HNNN     28    H-N IN H-N-N=N</span>
 800 <span class="c">#   HNSO     28    H-N IN SULFONAMIDE</span>
 801 <span class="c">#   HNPO     28    H-N IN PHOSPHONAMIDE</span>
 802 <span class="c">#   HNC%     28    HYDROGEN ON N ATTACHED TO TRIPLY BONDED CARBON</span>
 803 <span class="c">#   HSP2     28    GENERAL H ON SP2 NITROGEN</span>
 804 <span class="c">#   HOCC     29    H-O IN ENOLS AND PHENOLS</span>
 805 <span class="c">#   HOCN     29    H-O IN HO-C=N</span>
 806 <span class="c">#   HOH      31    HYDROGEN IN H2O</span>
 807 <span class="c">#   HOS      33    H ON OXYGEN ATTACHED TO SULFUR</span>
 808 <span class="c">#   HNR+     36    H ON QUATERNARY NITROGEN</span>
 809 <span class="c">#   HIM+     36    H ON IMIDAZOLIUM-TYPE NITROGEN</span>
 810 <span class="c">#   HPD+     36    H ON PROTONATED PYRIDINE NITROGEN</span>
 811 <span class="c">#   HNN+     36    H ON AMIDINIUM-TYPE NITROGEN</span>
 812 <span class="c">#   HNC+     36    H ON PROTONATED IMINE NITROGEN</span>
 813 <span class="c">#   HGD+     36    H ON GUANIDINIUM-TYPE NITROGEN</span>
 814 <span class="c">#   HN5+     36    H ON N5+, N5A+ OR N5B+</span>
 815 <span class="c">#   HO+      50    HYDROGEN ON O+ OXYGEN</span>
 816 <span class="c">#   HO=+     52    HYDROGEN ON OXENIUM OXYGEN</span>
 817 <span class="c">#   HS       71    H ATTACHED TO DIVALENT, DICOORDINATE S</span>
 818 <span class="c">#   HS=N     71    H ATTACHED TO TETRAVALENT, TRICOODR S DBL BONDED TO N</span>
 819 <span class="c">#   HP       71    H ATTACHED TO TRI- OR TETRACOORDINATE PHOSPHORUS</span>
 820 <span class="c">#</span>
<a name="_GetAtomTypeForHydrogen-"></a> 821 <span class="k">sub </span><span class="m">_GetAtomTypeForHydrogen</span> <span class="s">{</span>
 822   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 823   <span class="k">my</span><span class="s">(</span><span class="i">$AtomType</span><span class="cm">,</span> <span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
 824 
 825   <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
 826 
 827   <span class="c"># Get non-hydrogen atom neighbor...</span>
 828   <span class="i">$AtomNeighbor</span> = <span class="i">$Atom</span><span class="i">-&gt;GetNonHydrogenNeighborOfHydrogenAtom</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 829   <span class="k">if</span> <span class="s">(</span>!<span class="i">$AtomNeighbor</span><span class="s">)</span> <span class="s">{</span>
 830     <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
 831   <span class="s">}</span>
 832 
 833   <span class="j">ATOMNEIGHBOR:</span> <span class="s">{</span>
 834     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomNeighbor</span><span class="i">-&gt;IsCarbon</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 835       <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomTypeForHydrogenAttachedToCarbon</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
 836       <span class="k">last</span> <span class="j">ATOMNEIGHBOR</span><span class="sc">;</span>
 837     <span class="s">}</span>
 838     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomNeighbor</span><span class="i">-&gt;IsNitrogen</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 839       <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomTypeForHydrogenAttachedToNitrogen</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
 840       <span class="k">last</span> <span class="j">ATOMNEIGHBOR</span><span class="sc">;</span>
 841     <span class="s">}</span>
 842     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomNeighbor</span><span class="i">-&gt;IsOxygen</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 843       <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomTypeForHydrogenAttachedToOxygen</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
 844       <span class="k">last</span> <span class="j">ATOMNEIGHBOR</span><span class="sc">;</span>
 845     <span class="s">}</span>
 846     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomNeighbor</span><span class="i">-&gt;IsPhosphorus</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 847       <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomTypeForHydrogenAttachedToPhosphorus</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
 848       <span class="k">last</span> <span class="j">ATOMNEIGHBOR</span><span class="sc">;</span>
 849     <span class="s">}</span>
 850     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomNeighbor</span><span class="i">-&gt;IsSulfur</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 851       <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomTypeForHydrogenAttachedToSulfur</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
 852       <span class="k">last</span> <span class="j">ATOMNEIGHBOR</span><span class="sc">;</span>
 853     <span class="s">}</span>
 854     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomNeighbor</span><span class="i">-&gt;IsSilicon</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 855       <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomTypeForHydrogenAttachedToSilicon</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
 856       <span class="k">last</span> <span class="j">ATOMNEIGHBOR</span><span class="sc">;</span>
 857     <span class="s">}</span>
 858     <span class="i">$AtomType</span> = <span class="q">&quot;None&quot;</span><span class="sc">;</span>
 859     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;_GetAtomTypeForHydrogen: MMFF94 atom type for Hydrogen cann&#39;t be assigned...&quot;</span><span class="sc">;</span>
 860   <span class="s">}</span>
 861   <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
 862 <span class="s">}</span>
 863 
 864 <span class="c"># Get MMFF94 atom type for atoms other than Carbon, Nitrogen, Oxygen, Phosporus,</span>
 865 <span class="c"># Sulfur and Hydrogen...</span>
 866 <span class="c">#</span>
 867 <span class="c"># AtomTypeSymbol   AtomTypeNum   AtomTypeDefinition</span>
 868 <span class="c">#   LI+      92    LITHIUM CATION</span>
 869 <span class="c">#   F        11    FLUORINE</span>
 870 <span class="c">#   F-       89    FLUORIDE ANION</span>
 871 <span class="c">#   NA+      93    SODIUM CATION</span>
 872 <span class="c">#   MG+2     99    DIPOSITIVE MAGNESIUM CATION</span>
 873 <span class="c">#   SI       19    SILICON</span>
 874 <span class="c">#   CL       12    CHLORINE</span>
 875 <span class="c">#   CLO4     77    CHLORINE IN PERCHLORATE ANION, CLO4(-)</span>
 876 <span class="c">#   CL-      90    CHLORIDE ANION</span>
 877 <span class="c">#   K+       94    POTASSIUM CATION</span>
 878 <span class="c">#   CA+2     96    DIPOSITIVE CALCIUM</span>
 879 <span class="c">#   FE+2     87    IRON +2 CATION</span>
 880 <span class="c">#   FE+3     88    IROM +3 CATION</span>
 881 <span class="c">#   CU+1     97    MONOPOSITIVE COPPER</span>
 882 <span class="c">#   CU+2     98    DIPOSITIVE COPPER</span>
 883 <span class="c">#   ZINC     95    DIPOSITIVE ZINC</span>
 884 <span class="c">#   ZN+2     95    DIPOSITIVE ZINC</span>
 885 <span class="c">#   BR       13    BROMINE</span>
 886 <span class="c">#   BR-      91    BROMIDE ANION</span>
 887 <span class="c">#   I        14    IODINE</span>
 888 <span class="c">#</span>
 889 <span class="c">#</span>
<a name="_GetAtomTypeForOtherAtoms-"></a> 890 <span class="k">sub </span><span class="m">_GetAtomTypeForOtherAtoms</span> <span class="s">{</span>
 891   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 892   <span class="k">my</span><span class="s">(</span><span class="i">$AtomType</span><span class="cm">,</span> <span class="i">$AtomSymbol</span><span class="cm">,</span> <span class="i">$FormalCharge</span><span class="cm">,</span> <span class="i">$CallingMethod</span><span class="cm">,</span> <span class="i">@AllowedFormalCharges</span><span class="s">)</span><span class="sc">;</span>
 893 
 894   <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
 895 
 896   <span class="i">$AtomSymbol</span> = <span class="i">$Atom</span><span class="i">-&gt;GetAtomSymbol</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 897   <span class="i">$FormalCharge</span> = <span class="i">$Atom</span><span class="i">-&gt;GetFormalCharge</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 898 
 899   <span class="i">$CallingMethod</span> = <span class="q">&quot;_GetAtomTypeForOtherAtoms&quot;</span><span class="sc">;</span>
 900   <span class="i">@AllowedFormalCharges</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 901 
 902   <span class="j">ATOMSYMBOL:</span> <span class="s">{</span>
 903     <span class="c"># FLUORINE</span>
 904     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomSymbol</span> =~ <span class="q">/^F$/i</span><span class="s">)</span> <span class="s">{</span>
 905       <span class="c">#  F : FLUORINE;  F- :  FLUORIDE ANION</span>
 906       <span class="i">$AtomType</span> = <span class="s">(</span><span class="i">$FormalCharge</span> == <span class="n">-1</span><span class="s">)</span> ? <span class="q">&#39;F-&#39;</span> <span class="co">:</span> <span class="q">&#39;F&#39;</span><span class="sc">;</span>
 907       <span class="i">@AllowedFormalCharges</span> = <span class="s">(</span><span class="q">&#39;0&#39;</span><span class="cm">,</span> <span class="q">&#39;-1&#39;</span><span class="s">)</span><span class="sc">;</span>
 908       <span class="k">last</span> <span class="j">ATOMSYMBOL</span><span class="sc">;</span>
 909     <span class="s">}</span>
 910     <span class="c"># CHLORINE</span>
 911     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomSymbol</span> =~ <span class="q">/^Cl$/i</span><span class="s">)</span> <span class="s">{</span>
 912       <span class="c"># CL : CHLORINE; CLO4 : CHLORINE IN PERCHLORATE ANION, CLO4(-);</span>
 913       <span class="c"># CL- : CHLORIDE ANION</span>
 914       <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_IsPerChlorateAnionChlorine</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span> ? <span class="q">&#39;CLO4&#39;</span> <span class="co">:</span> <span class="s">(</span><span class="s">(</span><span class="i">$FormalCharge</span> == <span class="n">-1</span><span class="s">)</span> ? <span class="q">&#39;CL-&#39;</span> <span class="co">:</span> <span class="q">&#39;CL&#39;</span><span class="s">)</span><span class="sc">;</span>
 915       <span class="i">@AllowedFormalCharges</span> = <span class="s">(</span><span class="q">&#39;0&#39;</span><span class="cm">,</span> <span class="q">&#39;-1&#39;</span><span class="s">)</span><span class="sc">;</span>
 916       <span class="k">last</span> <span class="j">ATOMSYMBOL</span><span class="sc">;</span>
 917     <span class="s">}</span>
 918     <span class="c"># BROMINE</span>
 919     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomSymbol</span> =~ <span class="q">/^Br$/i</span><span class="s">)</span> <span class="s">{</span>
 920       <span class="c"># BR : BROMINE; BR- : BROMIDE ANION</span>
 921       <span class="i">$AtomType</span> = <span class="s">(</span><span class="i">$FormalCharge</span> == <span class="n">-1</span><span class="s">)</span> ? <span class="q">&#39;BR-&#39;</span> <span class="co">:</span> <span class="q">&#39;BR&#39;</span><span class="sc">;</span>
 922       <span class="i">@AllowedFormalCharges</span> = <span class="s">(</span><span class="q">&#39;0&#39;</span><span class="cm">,</span> <span class="q">&#39;-1&#39;</span><span class="s">)</span><span class="sc">;</span>
 923       <span class="k">last</span> <span class="j">ATOMSYMBOL</span><span class="sc">;</span>
 924     <span class="s">}</span>
 925     <span class="c"># IODINE</span>
 926     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomSymbol</span> =~ <span class="q">/^I$/i</span><span class="s">)</span> <span class="s">{</span>
 927       <span class="i">$AtomType</span> = <span class="q">&#39;I&#39;</span><span class="sc">;</span>
 928       <span class="i">@AllowedFormalCharges</span> = <span class="s">(</span><span class="q">&#39;0&#39;</span><span class="s">)</span><span class="sc">;</span>
 929       <span class="k">last</span> <span class="j">ATOMSYMBOL</span><span class="sc">;</span>
 930     <span class="s">}</span>
 931     <span class="c"># LI+ : LITHIUM CATION</span>
 932     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomSymbol</span> =~ <span class="q">/^Li$/i</span><span class="s">)</span> <span class="s">{</span>
 933       <span class="i">$AtomType</span> = <span class="q">&#39;LI+&#39;</span><span class="sc">;</span>
 934       <span class="i">@AllowedFormalCharges</span> = <span class="s">(</span><span class="q">&#39;+1&#39;</span><span class="s">)</span><span class="sc">;</span>
 935       <span class="k">last</span> <span class="j">ATOMSYMBOL</span><span class="sc">;</span>
 936     <span class="s">}</span>
 937     <span class="c"># NA+ : SODIUM CATION</span>
 938     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomSymbol</span> =~ <span class="q">/^Na$/i</span><span class="s">)</span> <span class="s">{</span>
 939       <span class="i">$AtomType</span> = <span class="q">&#39;NA+&#39;</span><span class="sc">;</span>
 940       <span class="i">@AllowedFormalCharges</span> = <span class="s">(</span><span class="q">&#39;+1&#39;</span><span class="s">)</span><span class="sc">;</span>
 941       <span class="k">last</span> <span class="j">ATOMSYMBOL</span><span class="sc">;</span>
 942     <span class="s">}</span>
 943     <span class="c"># MG+2 : DIPOSITIVE MAGNESIUM CATION</span>
 944     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomSymbol</span> =~ <span class="q">/^Mg$/i</span><span class="s">)</span> <span class="s">{</span>
 945       <span class="i">$AtomType</span> = <span class="q">&#39;MG+2&#39;</span><span class="sc">;</span>
 946       <span class="i">@AllowedFormalCharges</span> = <span class="s">(</span><span class="q">&#39;+2&#39;</span><span class="s">)</span><span class="sc">;</span>
 947       <span class="k">last</span> <span class="j">ATOMSYMBOL</span><span class="sc">;</span>
 948     <span class="s">}</span>
 949     <span class="c"># SI : SILICON</span>
 950     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomSymbol</span> =~ <span class="q">/^Si$/i</span><span class="s">)</span> <span class="s">{</span>
 951       <span class="i">$AtomType</span> = <span class="q">&#39;SI&#39;</span><span class="sc">;</span>
 952       <span class="i">@AllowedFormalCharges</span> = <span class="s">(</span><span class="q">&#39;0&#39;</span><span class="s">)</span><span class="sc">;</span>
 953       <span class="k">last</span> <span class="j">ATOMSYMBOL</span><span class="sc">;</span>
 954     <span class="s">}</span>
 955     <span class="c"># K+ : POTASSIUM CATION</span>
 956     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomSymbol</span> =~ <span class="q">/^K$/i</span><span class="s">)</span> <span class="s">{</span>
 957       <span class="i">$AtomType</span> = <span class="q">&#39;K+&#39;</span><span class="sc">;</span>
 958       <span class="i">@AllowedFormalCharges</span> = <span class="s">(</span><span class="q">&#39;+1&#39;</span><span class="s">)</span><span class="sc">;</span>
 959       <span class="k">last</span> <span class="j">ATOMSYMBOL</span><span class="sc">;</span>
 960     <span class="s">}</span>
 961     <span class="c"># CA+2 : DIPOSITIVE CALCIUM</span>
 962     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomSymbol</span> =~ <span class="q">/^Ca$/i</span><span class="s">)</span> <span class="s">{</span>
 963       <span class="i">$AtomType</span> = <span class="q">&#39;CA+2&#39;</span><span class="sc">;</span>
 964       <span class="i">@AllowedFormalCharges</span> = <span class="s">(</span><span class="q">&#39;+2&#39;</span><span class="s">)</span><span class="sc">;</span>
 965       <span class="k">last</span> <span class="j">ATOMSYMBOL</span><span class="sc">;</span>
 966     <span class="s">}</span>
 967     <span class="c"># IRON</span>
 968     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomSymbol</span> =~ <span class="q">/^Fe$/i</span><span class="s">)</span> <span class="s">{</span>
 969       <span class="c"># FE+2 : IRON +2 CATION; FE+3 : IROM +3 CATION</span>
 970       <span class="i">$AtomType</span> = <span class="s">(</span><span class="i">$FormalCharge</span> == <span class="n">3</span><span class="s">)</span> ? <span class="q">&#39;FE+3&#39;</span> <span class="co">:</span> <span class="q">&#39;FE+2&#39;</span><span class="sc">;</span>
 971       <span class="i">@AllowedFormalCharges</span> = <span class="s">(</span><span class="q">&#39;+2&#39;</span><span class="cm">,</span> <span class="q">&#39;+3&#39;</span><span class="s">)</span><span class="sc">;</span>
 972       <span class="k">last</span> <span class="j">ATOMSYMBOL</span><span class="sc">;</span>
 973     <span class="s">}</span>
 974     <span class="c"># COPPER</span>
 975     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomSymbol</span> =~ <span class="q">/^Cu$/i</span><span class="s">)</span> <span class="s">{</span>
 976       <span class="c"># CU+1 : MONOPOSITIVE COPPER; CU+2 : DIPOSITIVE COPPER</span>
 977       <span class="i">$AtomType</span> = <span class="s">(</span><span class="i">$FormalCharge</span> == <span class="n">1</span><span class="s">)</span> ? <span class="q">&#39;CU+1&#39;</span> <span class="co">:</span> <span class="q">&#39;CU+2&#39;</span><span class="sc">;</span>
 978       <span class="i">@AllowedFormalCharges</span> = <span class="s">(</span><span class="q">&#39;+1&#39;</span><span class="cm">,</span> <span class="q">&#39;+2&#39;</span><span class="s">)</span><span class="sc">;</span>
 979       <span class="k">last</span> <span class="j">ATOMSYMBOL</span><span class="sc">;</span>
 980     <span class="s">}</span>
 981     <span class="c"># ZINC</span>
 982     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomSymbol</span> =~ <span class="q">/^Zn$/i</span><span class="s">)</span> <span class="s">{</span>
 983       <span class="c"># ZN+2 : DIPOSITIVE ZINC</span>
 984       <span class="i">$AtomType</span> = <span class="q">&#39;Zn+2&#39;</span><span class="sc">;</span>
 985       <span class="i">@AllowedFormalCharges</span> = <span class="s">(</span><span class="q">&#39;+2&#39;</span><span class="s">)</span><span class="sc">;</span>
 986       <span class="k">last</span> <span class="j">ATOMSYMBOL</span><span class="sc">;</span>
 987     <span class="s">}</span>
 988     <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
 989     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;_GetAtomTypeForOtherAtoms: MMFF94 atom type for $AtomSymbol cann&#39;t be assigned...&quot;</span><span class="sc">;</span>
 990   <span class="s">}</span>
 991   <span class="k">if</span> <span class="s">(</span><span class="i">@AllowedFormalCharges</span><span class="s">)</span> <span class="s">{</span>
 992     <span class="i">$This</span><span class="i">-&gt;_CheckFormalChargeMismatch</span><span class="s">(</span><span class="i">$CallingMethod</span><span class="cm">,</span> <span class="i">$AtomSymbol</span><span class="cm">,</span> <span class="i">$AtomType</span><span class="cm">,</span> <span class="i">$FormalCharge</span><span class="cm">,</span> \<span class="i">@AllowedFormalCharges</span><span class="s">)</span><span class="sc">;</span>
 993   <span class="s">}</span>
 994   <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
 995 <span class="s">}</span>
 996 
 997 <span class="c"># Check any formal charge mismatches...</span>
 998 <span class="c">#</span>
<a name="_CheckFormalChargeMismatch-"></a> 999 <span class="k">sub </span><span class="m">_CheckFormalChargeMismatch</span> <span class="s">{</span>
1000   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$CallingMethod</span><span class="cm">,</span> <span class="i">$AtomSymbol</span><span class="cm">,</span> <span class="i">$AssignedAtomType</span><span class="cm">,</span> <span class="i">$FormalCharge</span><span class="cm">,</span> <span class="i">$AllowedFormalChargesRef</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1001   <span class="k">my</span><span class="s">(</span><span class="i">$AllowedFormalCharge</span><span class="cm">,</span> <span class="i">$FormalChargeMismatch</span><span class="s">)</span><span class="sc">;</span>
1002 
1003   <span class="i">$FormalChargeMismatch</span> = <span class="n">1</span><span class="sc">;</span>
1004 
1005   <span class="j">FORMALCHARGE:</span> <span class="k">for</span> <span class="i">$AllowedFormalCharge</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$AllowedFormalChargesRef</span>}<span class="s">)</span> <span class="s">{</span>
1006     <span class="k">if</span> <span class="s">(</span><span class="i">$AllowedFormalCharge</span> == <span class="i">$FormalCharge</span><span class="s">)</span> <span class="s">{</span>
1007       <span class="i">$FormalChargeMismatch</span> = <span class="n">0</span><span class="sc">;</span>
1008       <span class="k">last</span> <span class="j">FORMALCHARGE</span><span class="sc">;</span>
1009     <span class="s">}</span>
1010   <span class="s">}</span>
1011   <span class="k">if</span> <span class="s">(</span><span class="i">$FormalChargeMismatch</span><span class="s">)</span> <span class="s">{</span>
1012     <span class="k">my</span><span class="s">(</span><span class="i">$AllowedFormalCharges</span><span class="s">)</span><span class="sc">;</span>
1013     <span class="i">$AllowedFormalCharges</span> = <span class="i">TextUtil::JoinWords</span><span class="s">(</span><span class="i">$AllowedFormalChargesRef</span><span class="cm">,</span> <span class="q">&quot;,&quot;</span><span class="cm">,</span> <span class="n">0</span><span class="s">)</span><span class="sc">;</span>
1014 
1015     <span class="w">carp</span> <span class="q">&quot;\nWarning: ${ClassName}-&gt;${CallingMethod}:_CheckFormalChargeMismatch: MMFF94 atom for $AtomSymbol with formal charge, $FormalCharge, cann&#39;t be assigned: Formal charge, $FormalCharge, is different from allowed formal charge(s): $AllowedFormalCharges. Default UFF atom type, $AssignedAtomType, has been assigned...&quot;</span><span class="sc">;</span>
1016   <span class="s">}</span>
1017 
1018   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
1019 <span class="s">}</span>
1020 
1021 <span class="c"># Get MMFF94 atom type for Carbon with only sigma bonds...</span>
1022 <span class="c">#</span>
<a name="_GetAtomTypeForCarbonWithOnlySigmaBonds-"></a>1023 <span class="k">sub </span><span class="m">_GetAtomTypeForCarbonWithOnlySigmaBonds</span> <span class="s">{</span>
1024   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1025   <span class="k">my</span><span class="s">(</span><span class="i">$AtomType</span><span class="s">)</span><span class="sc">;</span>
1026 
1027   <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
1028 
1029   <span class="j">ATOMTYPE:</span> <span class="s">{</span>
1030     <span class="c"># CR4R : CARBON IN 4-MEMBERED RINGS</span>
1031     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsFourMemberedRingCarbon</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1032       <span class="i">$AtomType</span> = <span class="q">&#39;CR4R&#39;</span><span class="sc">;</span>
1033       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1034     <span class="s">}</span>
1035 
1036     <span class="c"># CR3R : CARBON IN A 3-MEMBERED RING</span>
1037     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsThreeMemberedRingCarbon</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1038       <span class="i">$AtomType</span> = <span class="q">&#39;CR3R&#39;</span><span class="sc">;</span>
1039       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1040     <span class="s">}</span>
1041 
1042     <span class="c">#  CR : ALKYL CARBON, SP3</span>
1043     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsAlkylCarbon</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1044       <span class="i">$AtomType</span> = <span class="q">&#39;CR&#39;</span><span class="sc">;</span>
1045       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1046     <span class="s">}</span>
1047 
1048     <span class="c"># As far as I can tell, MMFF94 doesn&#39;t have a generic atom type for SP3 carbon. So the current</span>
1049     <span class="c"># release of MayaChemTools package used CR as defaul SP3 carbon.</span>
1050     <span class="c">#</span>
1051     <span class="i">$AtomType</span> = <span class="q">&#39;CR&#39;</span><span class="sc">;</span>
1052   <span class="s">}</span>
1053 
1054   <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
1055 <span class="s">}</span>
1056 
1057 <span class="c"># Get MMFF94 atom type for Carbon with one pi bond...</span>
1058 <span class="c">#</span>
<a name="_GetAtomTypeForCarbonWithOnePiBond-"></a>1059 <span class="k">sub </span><span class="m">_GetAtomTypeForCarbonWithOnePiBond</span> <span class="s">{</span>
1060   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1061   <span class="k">my</span><span class="s">(</span><span class="i">$AtomType</span><span class="s">)</span><span class="sc">;</span>
1062 
1063   <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
1064 
1065   <span class="j">ATOMTYPE:</span> <span class="s">{</span>
1066     <span class="c"># CR3R :  CARBON IN 3-MEMBERED RINGS</span>
1067     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsThreeMemberedRingOlefinicCarbon</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1068       <span class="i">$AtomType</span> = <span class="q">&#39;CR3R&#39;</span><span class="sc">;</span>
1069       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1070     <span class="s">}</span>
1071 
1072     <span class="c"># CE4R :  OLEFINIC CARBON IN 4-MEMBERED RINGS</span>
1073     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsFourMemberedRingOlefinicCarbon</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1074       <span class="i">$AtomType</span> = <span class="q">&#39;CE4R&#39;</span><span class="sc">;</span>
1075       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1076     <span class="s">}</span>
1077 
1078     <span class="c"># CIM+ : C IN N-C-N IN IMIDAZOLIUM ION</span>
1079     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsImidazoliumCarbon</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1080       <span class="i">$AtomType</span> = <span class="q">&#39;CIM+&#39;</span><span class="sc">;</span>
1081       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1082     <span class="s">}</span>
1083 
1084     <span class="c"># C5A : ALPHA CARBON IN 5-MEMBERED HETEROAROMATIC RING</span>
1085     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsFiveMemberedHeteroAromaticRingAlphaCarbon</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1086       <span class="i">$AtomType</span> = <span class="q">&#39;C5A&#39;</span><span class="sc">;</span>
1087       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1088     <span class="s">}</span>
1089 
1090     <span class="c"># C5B : BETA CARBON IN 5-MEMBERED HETEROAROMATIC RING</span>
1091     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsFiveMemberedHeteroAromaticRingBetaCarbon</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1092       <span class="i">$AtomType</span> = <span class="q">&#39;C5B&#39;</span><span class="sc">;</span>
1093       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1094     <span class="s">}</span>
1095 
1096     <span class="c"># C5 : GENERAL CARBON IN 5-MEMBERED HETEROAROMATIC RING</span>
1097     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsFiveMemberedHeteroAromaticRingCarbon</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1098       <span class="i">$AtomType</span> = <span class="q">&#39;C5&#39;</span><span class="sc">;</span>
1099       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1100     <span class="s">}</span>
1101 
1102     <span class="c"># CB : CARBON AS IN BENZENE, PYRROLE</span>
1103     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsRingAromaticCarbon</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1104       <span class="i">$AtomType</span> = <span class="q">&#39;CB&#39;</span><span class="sc">;</span>
1105       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1106     <span class="s">}</span>
1107 
1108     <span class="c"># C=C : VINYLIC CARBON, SP2</span>
1109     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsVinylicCarbon</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1110       <span class="i">$AtomType</span> = <span class="q">&#39;C=C&#39;</span><span class="sc">;</span>
1111       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1112     <span class="s">}</span>
1113 
1114     <span class="c"># C=OR : KETONE OR ALDEHYDE CARBONYL CARBON</span>
1115     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsKetoneOrAldehydeCarbonylCarbon</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1116       <span class="i">$AtomType</span> = <span class="q">&#39;C=OR&#39;</span><span class="sc">;</span>
1117       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1118     <span class="s">}</span>
1119 
1120     <span class="c"># C=ON : AMIDE CARBONYL CARBON</span>
1121     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsAmideCarbonylCarbon</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1122       <span class="i">$AtomType</span> = <span class="q">&#39;C=ON&#39;</span><span class="sc">;</span>
1123       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1124     <span class="s">}</span>
1125 
1126     <span class="c"># CONN : UREA CARBONYL CARBON</span>
1127     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsUreaCarbonylCarbon</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1128       <span class="i">$AtomType</span> = <span class="q">&#39;CONN&#39;</span><span class="sc">;</span>
1129       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1130     <span class="s">}</span>
1131 
1132     <span class="c"># COO : CARBOXYLIC ACID OR ESTER CARBONYL CARBON</span>
1133     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsCarboxylicAcidOrEsterCarbonylCarbon</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1134       <span class="i">$AtomType</span> = <span class="q">&#39;COO&#39;</span><span class="sc">;</span>
1135       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1136     <span class="s">}</span>
1137 
1138     <span class="c"># CO2M : CARBOXYLATE ANION CARBON</span>
1139     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsCarboxylateAnionCarbon</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1140       <span class="i">$AtomType</span> = <span class="q">&#39;CO2M&#39;</span><span class="sc">;</span>
1141       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1142     <span class="s">}</span>
1143 
1144     <span class="c"># COON: CARBAMATE CARBONYL CARBON</span>
1145     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsCarbamateCarbonylCarbon</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1146       <span class="i">$AtomType</span> = <span class="q">&#39;COON&#39;</span><span class="sc">;</span>
1147       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1148     <span class="s">}</span>
1149 
1150     <span class="c"># COOO: CARBONIC ACID OR ESTER CARBONYL CARBON</span>
1151     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsCarbonicAcidOrEsterCarbonylCarbon</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1152       <span class="i">$AtomType</span> = <span class="q">&#39;COOO&#39;</span><span class="sc">;</span>
1153       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1154     <span class="s">}</span>
1155 
1156     <span class="c"># C=OS : THIOESTER CARBONYL CARBON, DOUBLE BONDED TO O</span>
1157     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsThioEsterCarbonylCarbon</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1158       <span class="i">$AtomType</span> = <span class="q">&#39;C=OS&#39;</span><span class="sc">;</span>
1159       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1160     <span class="s">}</span>
1161 
1162     <span class="c"># C=O : GENERAL CARBONYL CARBON</span>
1163     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsGeneralCarbonylCarbon</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1164       <span class="i">$AtomType</span> = <span class="q">&#39;C=O&#39;</span><span class="sc">;</span>
1165       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1166     <span class="s">}</span>
1167 
1168     <span class="c"># C=SN : THIOAMIDE, CARBON, DOUBLY BONDED TO S</span>
1169     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsThioAmideCarbon</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1170       <span class="i">$AtomType</span> = <span class="q">&#39;C=SN&#39;</span><span class="sc">;</span>
1171       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1172     <span class="s">}</span>
1173 
1174     <span class="c"># CSO2 : CARBON IN &gt;C=SO2</span>
1175     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsSulfonylCarbon</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1176       <span class="i">$AtomType</span> = <span class="q">&#39;CSO2&#39;</span><span class="sc">;</span>
1177       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1178     <span class="s">}</span>
1179 
1180     <span class="c"># CS=O :  CARBON IN &gt;C=S=O (SULFINYL GROUP)</span>
1181     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsSulfinylCarbon</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1182       <span class="i">$AtomType</span> = <span class="q">&#39;CS=O&#39;</span><span class="sc">;</span>
1183       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1184     <span class="s">}</span>
1185 
1186     <span class="c"># CSS : THIOCARBOXYLIC ACID OR ESTER CARBONYL CARBON</span>
1187     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsThioCarboxylicAcidOrEsterCarbonylCarbon</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1188       <span class="i">$AtomType</span> = <span class="q">&#39;CSS&#39;</span><span class="sc">;</span>
1189       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1190     <span class="s">}</span>
1191 
1192     <span class="c"># CS2M : CARBON IN THIOCARBOXYLATE ANION</span>
1193     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsThioCarboxylateAnionCarbon</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1194       <span class="i">$AtomType</span> = <span class="q">&#39;CS2M&#39;</span><span class="sc">;</span>
1195       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1196     <span class="s">}</span>
1197 
1198     <span class="c"># C=S : THIOESTER CARBON, DOUBLY BONDED TO S</span>
1199     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsThioEsterCarbon</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1200       <span class="i">$AtomType</span> = <span class="q">&#39;C=S&#39;</span><span class="sc">;</span>
1201       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1202     <span class="s">}</span>
1203 
1204     <span class="c"># C=P : CARBON DOUBLE BONDED TO PHOSPHOROUS</span>
1205     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsDoublyBondedToPhosphorousCarbon</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1206       <span class="i">$AtomType</span> = <span class="q">&#39;C=P&#39;</span><span class="sc">;</span>
1207       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1208     <span class="s">}</span>
1209 
1210     <span class="c"># CGD : GUANIDINE CARBON, DOUBLY BONDED TO N</span>
1211     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsGuandineCarbon</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1212       <span class="i">$AtomType</span> = <span class="q">&#39;CGD&#39;</span><span class="sc">;</span>
1213       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1214     <span class="s">}</span>
1215 
1216     <span class="c"># CGD+ : GUANIDINIUM CARBON</span>
1217     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsGuandiniumCarbon</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1218       <span class="i">$AtomType</span> = <span class="q">&#39;CGD+&#39;</span><span class="sc">;</span>
1219       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1220     <span class="s">}</span>
1221 
1222     <span class="c">#CNN+ : C IN +N=C-N RESONANCE STRUCTURES</span>
1223     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsNCNResonaceStructuresCarbon</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1224       <span class="i">$AtomType</span> = <span class="q">&#39;CNN+&#39;</span><span class="sc">;</span>
1225       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1226     <span class="s">}</span>
1227 
1228     <span class="c"># C=N : SP2 CARBON IN C=N</span>
1229     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsDoublyBondedToNitrogenSP2Carbon</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1230       <span class="i">$AtomType</span> = <span class="q">&#39;C=N&#39;</span><span class="sc">;</span>
1231       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1232     <span class="s">}</span>
1233 
1234     <span class="c"># CSP2 : GENERIC SP2 CARBON</span>
1235     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsGenericSP2Carbon</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1236       <span class="i">$AtomType</span> = <span class="q">&#39;CSP2&#39;</span><span class="sc">;</span>
1237       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1238     <span class="s">}</span>
1239 
1240     <span class="i">$AtomType</span> = <span class="q">&#39;CSP2&#39;</span><span class="sc">;</span>
1241     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;_GetAtomTypeForCarbonWithOnePiBond: MMFF94 atom type for Carbon cann&#39;t be assigned; Default MMFF94 atom type, $AtomType, has been assigned...\n&quot;</span><span class="sc">;</span>
1242   <span class="s">}</span>
1243 
1244   <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
1245 <span class="s">}</span>
1246 
1247 <span class="c"># Get MMFF94 atom type for Carbon with two pi bonds...</span>
1248 <span class="c">#</span>
<a name="_GetAtomTypeForCarbonWithTwoPiBonds-"></a>1249 <span class="k">sub </span><span class="m">_GetAtomTypeForCarbonWithTwoPiBonds</span> <span class="s">{</span>
1250   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1251   <span class="k">my</span><span class="s">(</span><span class="i">$AtomType</span><span class="s">)</span><span class="sc">;</span>
1252 
1253   <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
1254 
1255   <span class="j">ATOMTYPE:</span> <span class="s">{</span>
1256     <span class="c"># =C= : ALLENIC CARBON</span>
1257     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsAllenicCarbon</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1258       <span class="i">$AtomType</span> = <span class="q">&#39;=C=&#39;</span><span class="sc">;</span>
1259       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1260     <span class="s">}</span>
1261 
1262     <span class="c"># C% : ISONITRILE CARBON ( R-N+#C- )</span>
1263     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsIsoNitrileCarbon</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1264       <span class="i">$AtomType</span> = <span class="q">&#39;C%&#39;</span><span class="sc">;</span>
1265       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1266     <span class="s">}</span>
1267 
1268     <span class="c"># CSP : ACETYLENIC CARBON</span>
1269     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsAcetylenicCarbon</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1270       <span class="i">$AtomType</span> = <span class="q">&#39;CSP&#39;</span><span class="sc">;</span>
1271       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1272     <span class="s">}</span>
1273 
1274     <span class="i">$AtomType</span> = <span class="q">&#39;CSP&#39;</span><span class="sc">;</span>
1275     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;_GetAtomTypeForCarbonWithTwoPiBonds: MMFF94 atom type for Carbon cann&#39;t be assigned; Default MMFF94 atom type, $AtomType, has been assigned...\n&quot;</span><span class="sc">;</span>
1276   <span class="s">}</span>
1277 
1278   <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
1279 <span class="s">}</span>
1280 
1281 
1282 <span class="c"># CR4R : CARBON IN 4-MEMBERED RINGS</span>
1283 <span class="c">#</span>
<a name="_IsFourMemberedRingCarbon-"></a>1284 <span class="k">sub </span><span class="m">_IsFourMemberedRingCarbon</span> <span class="s">{</span>
1285   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1286 
1287   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.RA4.T4.TSB4&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1288 <span class="s">}</span>
1289 
1290 <span class="c"># CR4R : CARBON IN 3-MEMBERED RINGS</span>
1291 <span class="c">#</span>
<a name="_IsThreeMemberedRingCarbon-"></a>1292 <span class="k">sub </span><span class="m">_IsThreeMemberedRingCarbon</span> <span class="s">{</span>
1293   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1294 
1295   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.RA3.T4.TSB4&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1296 <span class="s">}</span>
1297 
1298 <span class="c">#  CR : ALKYL CARBON, SP3</span>
1299 <span class="c">#</span>
<a name="_IsAlkylCarbon-"></a>1300 <span class="k">sub </span><span class="m">_IsAlkylCarbon</span> <span class="s">{</span>
1301   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1302 
1303   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.T4.TSB4&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;C,H&#39;</span><span class="cm">,</span> <span class="q">&#39;C,H&#39;</span><span class="cm">,</span> <span class="q">&#39;C,H&#39;</span><span class="cm">,</span> <span class="q">&#39;C,H&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1304 <span class="s">}</span>
1305 
1306 <span class="c"># C5A : ALPHA CARBON IN 5-MEMBERED HETEROAROMATIC RING</span>
1307 <span class="c">#</span>
<a name="_IsFiveMemberedHeteroAromaticRingAlphaCarbon-"></a>1308 <span class="k">sub </span><span class="m">_IsFiveMemberedHeteroAromaticRingAlphaCarbon</span> <span class="s">{</span>
1309   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1310 
1311   <span class="c"># Is it an aromatic atom in a five membered ring?</span>
1312   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.Ar.RA5&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1313     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
1314   <span class="s">}</span>
1315 
1316   <span class="c"># Is it part of a five membered ring containing hetero atom at alpha position?</span>
1317   <span class="k">my</span><span class="s">(</span><span class="i">$RingAtomsRef</span><span class="s">)</span><span class="sc">;</span>
1318 
1319   <span class="k">for</span> <span class="i">$RingAtomsRef</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetRingsWithSize</span><span class="s">(</span><span class="n">5</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1320     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsAtomPositionAlphaInHeteroAromaticRing</span><span class="s">(</span><span class="i">$Atom</span><span class="cm">,</span> <span class="i">$RingAtomsRef</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1321       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
1322     <span class="s">}</span>
1323   <span class="s">}</span>
1324   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
1325 <span class="s">}</span>
1326 
1327 <span class="c"># C5B : BETA CARBON IN 5-MEMBERED HETEROAROMATIC RING</span>
1328 <span class="c">#</span>
<a name="_IsFiveMemberedHeteroAromaticRingBetaCarbon-"></a>1329 <span class="k">sub </span><span class="m">_IsFiveMemberedHeteroAromaticRingBetaCarbon</span> <span class="s">{</span>
1330   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1331 
1332   <span class="c"># Is it an aromatic atom in a five membered ring?</span>
1333   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.Ar.RA5&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1334     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
1335   <span class="s">}</span>
1336 
1337   <span class="c"># Is it part of five membered rings containing hetero atom at beta position?</span>
1338   <span class="k">my</span><span class="s">(</span><span class="i">$RingAtomsRef</span><span class="s">)</span><span class="sc">;</span>
1339 
1340   <span class="k">for</span> <span class="i">$RingAtomsRef</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetRingsWithSize</span><span class="s">(</span><span class="n">5</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1341     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsAtomPositionBetaInHeteroAromaticRing</span><span class="s">(</span><span class="i">$Atom</span><span class="cm">,</span> <span class="i">$RingAtomsRef</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1342       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
1343     <span class="s">}</span>
1344   <span class="s">}</span>
1345   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
1346 <span class="s">}</span>
1347 
1348 
1349 <span class="c"># C5 : GENERAL CARBON IN 5-MEMBERED HETEROAROMATIC RING</span>
1350 <span class="c">#</span>
<a name="_IsFiveMemberedHeteroAromaticRingCarbon-"></a>1351 <span class="k">sub </span><span class="m">_IsFiveMemberedHeteroAromaticRingCarbon</span> <span class="s">{</span>
1352   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1353 
1354   <span class="c"># Is it an aromatic atom in a five membered ring?</span>
1355   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.Ar.RA5&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1356     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
1357   <span class="s">}</span>
1358 
1359   <span class="c"># Is it part of five membered rings containing at least one hetero atom?</span>
1360   <span class="k">my</span><span class="s">(</span><span class="i">$RingAtomsRef</span><span class="cm">,</span> <span class="i">$RingIsAromatic</span><span class="cm">,</span> <span class="i">$NumOfHeteroAtoms</span><span class="s">)</span><span class="sc">;</span>
1361   <span class="k">for</span> <span class="i">$RingAtomsRef</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetRingsWithSize</span><span class="s">(</span><span class="n">5</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1362     <span class="s">(</span><span class="i">$RingIsAromatic</span><span class="cm">,</span> <span class="i">$NumOfHeteroAtoms</span><span class="s">)</span> = <span class="i">$This</span><span class="i">-&gt;_GetHeteroAtomsInformationInRing</span><span class="s">(</span><span class="i">$RingAtomsRef</span><span class="s">)</span><span class="sc">;</span>
1363     <span class="k">if</span> <span class="s">(</span><span class="i">$RingIsAromatic</span> &amp;&amp; <span class="i">$NumOfHeteroAtoms</span> &gt;= <span class="n">1</span><span class="s">)</span> <span class="s">{</span>
1364       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
1365     <span class="s">}</span>
1366   <span class="s">}</span>
1367   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
1368 <span class="s">}</span>
1369 
1370 <span class="c"># CR3R :  OLEFINIC CARBON IN 3-MEMBERED RINGS</span>
1371 <span class="c">#</span>
1372 <span class="c"># Notes:</span>
1373 <span class="c">#    . MMFF94 atom type for olefinic Carbon in 3-membered rings is same as SP3 Carbon.</span>
1374 <span class="c">#</span>
<a name="_IsThreeMemberedRingOlefinicCarbon-"></a>1375 <span class="k">sub </span><span class="m">_IsThreeMemberedRingOlefinicCarbon</span> <span class="s">{</span>
1376   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1377 
1378   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.RA3.T3.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;*&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1379 <span class="s">}</span>
1380 
1381 <span class="c"># CE4R :  OLEFINIC CARBON IN 4-MEMBERED RINGS</span>
1382 <span class="c">#</span>
<a name="_IsFourMemberedRingOlefinicCarbon-"></a>1383 <span class="k">sub </span><span class="m">_IsFourMemberedRingOlefinicCarbon</span> <span class="s">{</span>
1384   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1385 
1386   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.RA4.T3.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;*&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1387 <span class="s">}</span>
1388 
1389 <span class="c"># CB : CARBON AS IN BENZENE, PYRROLE</span>
1390 <span class="c">#</span>
1391 <span class="c"># Notes:</span>
1392 <span class="c">#    . MayaChemTools assigns all aromatic carbons, other than five membered</span>
1393 <span class="c">#      hetero aromatic ring Carbons, as CB.</span>
1394 <span class="c">#</span>
<a name="_IsRingAromaticCarbon-"></a>1395 <span class="k">sub </span><span class="m">_IsRingAromaticCarbon</span> <span class="s">{</span>
1396   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1397 
1398   <span class="k">return</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.Ar.RA&#39;</span><span class="s">)</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1399 <span class="s">}</span>
1400 
1401 <span class="c"># C=C : VINYLIC CARBON, SP2</span>
1402 <span class="c">#</span>
<a name="_IsVinylicCarbon-"></a>1403 <span class="k">sub </span><span class="m">_IsVinylicCarbon</span> <span class="s">{</span>
1404   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1405 
1406   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.T3.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;C&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;C,H&#39;</span><span class="cm">,</span> <span class="q">&#39;C,H&#39;</span><span class="cm">,</span> <span class="q">&#39;C,H&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1407 <span class="s">}</span>
1408 
1409 <span class="c"># C=OR : KETONE OR ALDEHYDE CARBONYL CARBON</span>
1410 <span class="c">#</span>
<a name="_IsKetoneOrAldehydeCarbonylCarbon-"></a>1411 <span class="k">sub </span><span class="m">_IsKetoneOrAldehydeCarbonylCarbon</span> <span class="s">{</span>
1412   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1413 
1414   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.T3.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;C,H&#39;</span><span class="cm">,</span> <span class="q">&#39;C,H&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1415 <span class="s">}</span>
1416 
1417 <span class="c"># C=ON : AMIDE CARBONYL CARBON</span>
1418 <span class="c">#</span>
<a name="_IsAmideCarbonylCarbon-"></a>1419 <span class="k">sub </span><span class="m">_IsAmideCarbonylCarbon</span> <span class="s">{</span>
1420   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1421 
1422   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.T3.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;N&#39;</span><span class="cm">,</span> <span class="q">&#39;C,H&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1423 <span class="s">}</span>
1424 
1425 <span class="c"># CONN : UREA CARBONYL CARBON : R-(R&#39;-)N-C(=O)-N(-R&quot;)-R&#39;&#39;&#39;</span>
1426 <span class="c">#</span>
<a name="_IsUreaCarbonylCarbon-"></a>1427 <span class="k">sub </span><span class="m">_IsUreaCarbonylCarbon</span> <span class="s">{</span>
1428   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1429 
1430   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.X3.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;N&#39;</span><span class="cm">,</span> <span class="q">&#39;N&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1431 <span class="s">}</span>
1432 
1433 <span class="c"># COO : CARBOXYLIC ACID OR ESTER CARBONYL CARBON</span>
1434 <span class="c">#</span>
<a name="_IsCarboxylicAcidOrEsterCarbonylCarbon-"></a>1435 <span class="k">sub </span><span class="m">_IsCarboxylicAcidOrEsterCarbonylCarbon</span> <span class="s">{</span>
1436   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1437 
1438   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.T3.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;O.X1.FC0,O.X2&#39;</span><span class="cm">,</span> <span class="q">&#39;C,H&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;C&#39;</span><span class="cm">,</span> <span class="q">&#39;C,H&#39;</span><span class="cm">,</span> <span class="q">&#39;C,H&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1439 <span class="s">}</span>
1440 
1441 <span class="c"># CO2M : CARBOXYLATE ANION CARBON</span>
1442 <span class="c">#</span>
<a name="_IsCarboxylateAnionCarbon-"></a>1443 <span class="k">sub </span><span class="m">_IsCarboxylateAnionCarbon</span> <span class="s">{</span>
1444   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1445 
1446   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.T3.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;O.X1.FC-1&#39;</span><span class="cm">,</span> <span class="q">&#39;C,H&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;C&#39;</span><span class="cm">,</span> <span class="q">&#39;C,H&#39;</span><span class="cm">,</span> <span class="q">&#39;C,H&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1447 <span class="s">}</span>
1448 
1449 <span class="c"># COON: CARBAMATE CARBONYL CARBON : R-O-C(=O)-N(-R&#39;)-R&quot;</span>
1450 <span class="c">#</span>
<a name="_IsCarbamateCarbonylCarbon-"></a>1451 <span class="k">sub </span><span class="m">_IsCarbamateCarbonylCarbon</span> <span class="s">{</span>
1452   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1453 
1454   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.X3.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;N&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1455 <span class="s">}</span>
1456 
1457 <span class="c"># COOO: CARBONIC ACID OR ESTER CARBONYL CARBON:  R-O-C(=O)-O-R&#39;</span>
1458 <span class="c">#</span>
<a name="_IsCarbonicAcidOrEsterCarbonylCarbon-"></a>1459 <span class="k">sub </span><span class="m">_IsCarbonicAcidOrEsterCarbonylCarbon</span> <span class="s">{</span>
1460   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1461 
1462   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.X3.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1463 <span class="s">}</span>
1464 
1465 <span class="c"># C=OS : THIOESTER CARBONYL CARBON, DOUBLE BONDED TO O</span>
1466 <span class="c">#</span>
<a name="_IsThioEsterCarbonylCarbon-"></a>1467 <span class="k">sub </span><span class="m">_IsThioEsterCarbonylCarbon</span> <span class="s">{</span>
1468   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1469 
1470   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.T3.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;S&#39;</span><span class="cm">,</span> <span class="q">&#39;C,H&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1471 <span class="s">}</span>
1472 
1473 <span class="c"># C=O : GENERAL CARBONYL CARBON</span>
1474 <span class="c">#</span>
<a name="_IsGeneralCarbonylCarbon-"></a>1475 <span class="k">sub </span><span class="m">_IsGeneralCarbonylCarbon</span> <span class="s">{</span>
1476   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1477 
1478   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.T3.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1479 <span class="s">}</span>
1480 
1481 <span class="c"># C=SN : THIOAMIDE, CARBON, DOUBLY BONDED TO S</span>
1482 <span class="c">#</span>
<a name="_IsThioAmideCarbon-"></a>1483 <span class="k">sub </span><span class="m">_IsThioAmideCarbon</span> <span class="s">{</span>
1484   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1485 
1486   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.T3.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;S&#39;</span><span class="cm">,</span> <span class="q">&#39;N&#39;</span><span class="cm">,</span> <span class="q">&#39;C,H&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1487 <span class="s">}</span>
1488 
1489 <span class="c"># CSO2 : CARBON IN &gt;C=SO2</span>
1490 <span class="c">#</span>
<a name="_IsSulfonylCarbon-"></a>1491 <span class="k">sub </span><span class="m">_IsSulfonylCarbon</span> <span class="s">{</span>
1492   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1493   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
1494 
1495   <span class="c"># Is it connected to a sulfone Sulfur?</span>
1496   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;S&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1497     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsDoublyBondedToCarbonSulfoneSulfur</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1498       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
1499     <span class="s">}</span>
1500   <span class="s">}</span>
1501   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
1502 <span class="s">}</span>
1503 
1504 
1505 <span class="c"># CS=O :  CARBON IN &gt;C=S=O (SULFINYL GROUP)</span>
1506 <span class="c">#</span>
<a name="_IsSulfinylCarbon-"></a>1507 <span class="k">sub </span><span class="m">_IsSulfinylCarbon</span> <span class="s">{</span>
1508   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1509   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
1510 
1511   <span class="c"># Is it connected to a sulfinyl Sulfur?</span>
1512   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;S&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1513     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsSulfinylSulfur</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1514       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
1515     <span class="s">}</span>
1516   <span class="s">}</span>
1517   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
1518 <span class="s">}</span>
1519 
1520 <span class="c"># CSS : THIOCARBOXYLIC ACID OR ESTER CARBONYL CARBON</span>
1521 <span class="c">#</span>
<a name="_IsThioCarboxylicAcidOrEsterCarbonylCarbon-"></a>1522 <span class="k">sub </span><span class="m">_IsThioCarboxylicAcidOrEsterCarbonylCarbon</span> <span class="s">{</span>
1523   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1524 
1525   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.T3.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;S&#39;</span><span class="cm">,</span> <span class="q">&#39;S.X1.FC0,S.X2&#39;</span><span class="cm">,</span> <span class="q">&#39;C,H&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;C&#39;</span><span class="cm">,</span> <span class="q">&#39;C,H&#39;</span><span class="cm">,</span> <span class="q">&#39;C,H&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1526 <span class="s">}</span>
1527 
1528 <span class="c"># CS2M : CARBON IN THIOCARBOXYLATE ANION</span>
1529 <span class="c">#</span>
<a name="_IsThioCarboxylateAnionCarbon-"></a>1530 <span class="k">sub </span><span class="m">_IsThioCarboxylateAnionCarbon</span> <span class="s">{</span>
1531   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1532 
1533   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.T3.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;S&#39;</span><span class="cm">,</span> <span class="q">&#39;S.X1.FC-1&#39;</span><span class="cm">,</span> <span class="q">&#39;C,H&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;C&#39;</span><span class="cm">,</span> <span class="q">&#39;C,H&#39;</span><span class="cm">,</span> <span class="q">&#39;C,H&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1534 <span class="s">}</span>
1535 
1536 <span class="c"># C=S : THIOESTER CARBON, DOUBLY BONDED TO S</span>
1537 <span class="c">#</span>
<a name="_IsThioEsterCarbon-"></a>1538 <span class="k">sub </span><span class="m">_IsThioEsterCarbon</span> <span class="s">{</span>
1539   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1540 
1541   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.T3.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;S.X1&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1542 <span class="s">}</span>
1543 
1544 <span class="c"># C=P : CARBON DOUBLE BONDED TO PHOSPHOROUS</span>
1545 <span class="c">#</span>
<a name="_IsDoublyBondedToPhosphorousCarbon-"></a>1546 <span class="k">sub </span><span class="m">_IsDoublyBondedToPhosphorousCarbon</span> <span class="s">{</span>
1547   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1548 
1549   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.T3.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;P.X1&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1550 <span class="s">}</span>
1551 
1552 <span class="c"># CIM+ : C IN N-C-N IN IMIDAZOLIUM ION</span>
1553 <span class="c">#</span>
1554 <span class="c"># Notes:</span>
1555 <span class="c">#    . Imidazole is five membered ring contain  C*=C-N-C=N* (* - Ring bond)</span>
1556 <span class="c">#    . Imidazolium ion is where N in C=N has a formal charge of +1 and has an extra substituent</span>
1557 <span class="c">#</span>
<a name="_IsImidazoliumCarbon-"></a>1558 <span class="k">sub </span><span class="m">_IsImidazoliumCarbon</span> <span class="s">{</span>
1559   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1560 
1561   <span class="c"># Is it in a 5 membered aromatic ring surrounded by two aromatic Nitrogens?</span>
1562   <span class="c">#</span>
1563   <span class="k">if</span> <span class="s">(</span>!<span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.Ar.RA5.TR1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;N.Ar.RA5.TR1.FC0&#39;</span><span class="cm">,</span> <span class="q">&#39;N.Ar.RA5.TR1.FC+1&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;=&#39;</span><span class="s">]</span><span class="s">)</span> ||
1564        <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.Ar.RA5.TR1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;N.Ar.RA5.TR1.!FC0&#39;</span><span class="cm">,</span> <span class="q">&#39;N.Ar.RA5.TR1.!FC0&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;=&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1565     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
1566   <span class="s">}</span>
1567 
1568   <span class="c"># Check to make sure ring contains only two Nitrogen hetero atom...</span>
1569   <span class="k">my</span><span class="s">(</span><span class="i">$RingAtomsRef</span><span class="cm">,</span> <span class="i">$RingIsAromatic</span><span class="cm">,</span> <span class="i">$NumOfHeteroAtoms</span><span class="cm">,</span> <span class="i">$HeteroAtomSymbolsRef</span><span class="s">)</span><span class="sc">;</span>
1570 
1571   <span class="s">(</span><span class="i">$RingAtomsRef</span><span class="s">)</span> = <span class="i">$Atom</span><span class="i">-&gt;GetRingsWithSize</span><span class="s">(</span><span class="n">5</span><span class="s">)</span><span class="sc">;</span>
1572   <span class="s">(</span><span class="i">$RingIsAromatic</span><span class="cm">,</span> <span class="i">$NumOfHeteroAtoms</span><span class="cm">,</span> <span class="i">$HeteroAtomSymbolsRef</span><span class="s">)</span> = <span class="i">$This</span><span class="i">-&gt;_GetHeteroAtomsInformationInRing</span><span class="s">(</span><span class="i">$RingAtomsRef</span><span class="s">)</span><span class="sc">;</span>
1573 
1574   <span class="k">if</span> <span class="s">(</span><span class="i">$NumOfHeteroAtoms</span> != <span class="n">2</span><span class="s">)</span> <span class="s">{</span>
1575     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
1576   <span class="s">}</span>
1577 
1578   <span class="k">return</span> <span class="s">(</span><span class="k">exists</span><span class="s">(</span><span class="i">$HeteroAtomSymbolsRef</span>-&gt;{<span class="w">N</span>}<span class="s">)</span> &amp;&amp; <span class="s">(</span><span class="i">$HeteroAtomSymbolsRef</span>-&gt;{<span class="w">N</span>} == <span class="n">2</span><span class="s">)</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1579 <span class="s">}</span>
1580 
1581 <span class="c"># CNN+ : C IN +N=C-N RESONANCE STRUCTURES</span>
1582 <span class="c">#</span>
<a name="_IsNCNResonaceStructuresCarbon-"></a>1583 <span class="k">sub </span><span class="m">_IsNCNResonaceStructuresCarbon</span> <span class="s">{</span>
1584   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1585 
1586   <span class="c"># Match +1 formal charge on Nitrogen...</span>
1587   <span class="k">if</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.T3.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;N.FC+1&#39;</span><span class="cm">,</span> <span class="q">&#39;N.FC0&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1588     <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
1589   <span class="s">}</span>
1590 
1591   <span class="c"># Match non-zero (+1/2) formal charge on Nitrogen with single, double or resonnace bonds...</span>
1592   <span class="k">if</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.T3.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;N.!FC0&#39;</span><span class="cm">,</span> <span class="q">&#39;N.!FC0&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-,=,:&#39;</span><span class="cm">,</span> <span class="q">&#39;-,=,:&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1593     <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
1594   <span class="s">}</span>
1595 
1596   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
1597 <span class="s">}</span>
1598 
1599 <span class="c"># CGD : GUANIDINE CARBON, DOUBLY BONDED TO N</span>
1600 <span class="c">#</span>
<a name="_IsGuandineCarbon-"></a>1601 <span class="k">sub </span><span class="m">_IsGuandineCarbon</span> <span class="s">{</span>
1602   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1603 
1604   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.X3.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;N.FC0&#39;</span><span class="cm">,</span> <span class="q">&#39;N.FC0&#39;</span><span class="cm">,</span> <span class="q">&#39;N.FC0&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1605 <span class="s">}</span>
1606 
1607 <span class="c"># CGD+ : GUANIDINIUM CARBON</span>
1608 <span class="c">#</span>
<a name="_IsGuandiniumCarbon-"></a>1609 <span class="k">sub </span><span class="m">_IsGuandiniumCarbon</span> <span class="s">{</span>
1610   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1611 
1612   <span class="c"># Match +1 formal charge on a Nitrogen with explicitly single and double bonds...</span>
1613   <span class="k">if</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.X3.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;N.FC+1&#39;</span><span class="cm">,</span> <span class="q">&#39;N.FC0&#39;</span><span class="cm">,</span> <span class="q">&#39;N.FC0&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1614     <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
1615   <span class="s">}</span>
1616 
1617   <span class="c"># Match +1/3 formal charge on each Nitrogen with single, double or resonance bonds...</span>
1618   <span class="k">if</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.X3.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;N.!FC0&#39;</span><span class="cm">,</span> <span class="q">&#39;N.!FC0&#39;</span><span class="cm">,</span> <span class="q">&#39;N.!FC0&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-,=,:&#39;</span><span class="cm">,</span> <span class="q">&#39;-,=,:&#39;</span><span class="cm">,</span> <span class="q">&#39;-,=,:&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1619     <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
1620   <span class="s">}</span>
1621 
1622   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
1623 <span class="s">}</span>
1624 
1625 <span class="c"># C=N : SP2 CARBON IN C=N</span>
1626 <span class="c">#</span>
<a name="_IsDoublyBondedToNitrogenSP2Carbon-"></a>1627 <span class="k">sub </span><span class="m">_IsDoublyBondedToNitrogenSP2Carbon</span> <span class="s">{</span>
1628   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1629 
1630   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.T3.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;N&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1631 <span class="s">}</span>
1632 
1633 <span class="c"># CSP2 : GENERIC SP2 CARBON</span>
1634 <span class="c">#</span>
<a name="_IsGenericSP2Carbon-"></a>1635 <span class="k">sub </span><span class="m">_IsGenericSP2Carbon</span> <span class="s">{</span>
1636   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1637 
1638   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.T3.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;*&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1639 <span class="s">}</span>
1640 
1641 <span class="c"># =C= : ALLENIC CARBON</span>
1642 <span class="c">#</span>
<a name="_IsAllenicCarbon-"></a>1643 <span class="k">sub </span><span class="m">_IsAllenicCarbon</span> <span class="s">{</span>
1644   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1645 
1646   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.X2.DB2&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;*&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;=&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1647 <span class="s">}</span>
1648 
1649 <span class="c"># C% : ISONITRILE CARBON ( R-N+#C- )</span>
1650 <span class="c">#</span>
<a name="_IsIsoNitrileCarbon-"></a>1651 <span class="k">sub </span><span class="m">_IsIsoNitrileCarbon</span> <span class="s">{</span>
1652   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1653 
1654   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.X1.TB1.FC-1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;N.T2.TB1.FC+1&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;#&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;C,H&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1655 <span class="s">}</span>
1656 
1657 <span class="c"># CSP : ACETYLENIC CARBON</span>
1658 <span class="c">#</span>
<a name="_IsAcetylenicCarbon-"></a>1659 <span class="k">sub </span><span class="m">_IsAcetylenicCarbon</span> <span class="s">{</span>
1660   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1661 
1662   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.T2.TB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;*&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;#&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1663 <span class="s">}</span>
1664 
1665 <span class="c"># Get MMFF94 atom type Nitrogen in five membered ring...</span>
1666 <span class="c">#</span>
1667 <span class="c"># Note:</span>
1668 <span class="c">#    . The method handles both SP3 and SP2 five membered ring Nitrogens.</span>
1669 <span class="c">#</span>
<a name="_GetAtomTypeForFiveMemberedRingNitrogen-"></a>1670 <span class="k">sub </span><span class="m">_GetAtomTypeForFiveMemberedRingNitrogen</span> <span class="s">{</span>
1671   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1672   <span class="k">my</span><span class="s">(</span><span class="i">$AtomType</span><span class="s">)</span><span class="sc">;</span>
1673 
1674   <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
1675 
1676   <span class="j">ATOMTYPE:</span> <span class="s">{</span>
1677 
1678     <span class="c"># NIM+ : IMIDAZOLIUM-TYPE NITROGEN - FORMAL CHARGE=1/2</span>
1679     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsImidazoliumNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1680       <span class="i">$AtomType</span> = <span class="q">&#39;NIM+&#39;</span><span class="sc">;</span>
1681       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1682     <span class="s">}</span>
1683 
1684     <span class="c"># N5A+ : POSITIVE N5A NITROGEN - FORMAL CHARGE=1</span>
1685     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsPositivelyChargedFiveMemberedHeteroAromaticRingAlphaNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1686       <span class="i">$AtomType</span> = <span class="q">&#39;N5A+&#39;</span><span class="sc">;</span>
1687       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1688     <span class="s">}</span>
1689 
1690     <span class="c"># N5A : ALPHA AROM HETEROCYCLIC 5-RING  NITROGEN</span>
1691     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsFiveMemberedHeteroAromaticRingAlphaNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1692       <span class="i">$AtomType</span> = <span class="q">&#39;N5A&#39;</span><span class="sc">;</span>
1693       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1694     <span class="s">}</span>
1695 
1696     <span class="c"># N5B+ : POSITIVE N5B NITROGEN - FORMAL CHARGE=1</span>
1697     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsPositivelyChargedFiveMemberedHeteroAromaticRingBetaNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1698       <span class="i">$AtomType</span> = <span class="q">&#39;N5B+&#39;</span><span class="sc">;</span>
1699       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1700     <span class="s">}</span>
1701 
1702     <span class="c"># N5B : BETA AROM HETEROCYCLIC 5-RING  NITROGEN</span>
1703     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsFiveMemberedHeteroAromaticRingBetaNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1704       <span class="i">$AtomType</span> = <span class="q">&#39;N5B&#39;</span><span class="sc">;</span>
1705       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1706     <span class="s">}</span>
1707 
1708     <span class="c"># N5AX : N-OXIDE NITROGEN IN 5-RING ALPHA POSITION</span>
1709     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsNOxideFiveMemberedHeteroCyclicRingAlphaNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1710       <span class="i">$AtomType</span> = <span class="q">&#39;N5AX&#39;</span><span class="sc">;</span>
1711       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1712     <span class="s">}</span>
1713 
1714     <span class="c"># N5BX : N-OXIDE NITROGEN IN 5-RING BETA POSITION</span>
1715     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsNOxideFiveMemberedHeteroCyclicRingBetaNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1716       <span class="i">$AtomType</span> = <span class="q">&#39;N5BX&#39;</span><span class="sc">;</span>
1717       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1718     <span class="s">}</span>
1719 
1720     <span class="c"># N5OX : N-OXIDE NITROGEN IN GENERAL 5-RING POSITION</span>
1721     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsNOxideFiveMemberedHeteroCyclicRingNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1722       <span class="i">$AtomType</span> = <span class="q">&#39;N5OX&#39;</span><span class="sc">;</span>
1723       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1724     <span class="s">}</span>
1725 
1726     <span class="c"># N5M : NEGATIVELY CHARGED N IN, E.G, TRI- OR TETRAZOLE ANION</span>
1727     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsNegativelyChargedFiveMemberedHeteroCyclicRingNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1728       <span class="i">$AtomType</span> = <span class="q">&#39;N5M&#39;</span><span class="sc">;</span>
1729       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1730     <span class="s">}</span>
1731 
1732     <span class="c"># N5+ : POSITIVE N5 NITROGEN - FORMAL CHARGE=1</span>
1733     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsPositivelyChargedFiveMemberedHeteroCyclicRingNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1734       <span class="i">$AtomType</span> = <span class="q">&#39;N5+&#39;</span><span class="sc">;</span>
1735       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1736     <span class="s">}</span>
1737 
1738     <span class="c"># N5 : GENERAL NITROGEN IN 5-MEMBERED HETEROCYCLIC RING</span>
1739     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsFiveMemberedHeteroCyclicRingNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1740       <span class="i">$AtomType</span> = <span class="q">&#39;N5&#39;</span><span class="sc">;</span>
1741       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1742     <span class="s">}</span>
1743 
1744     <span class="i">$AtomType</span> = <span class="q">&#39;N5&#39;</span><span class="sc">;</span>
1745   <span class="s">}</span>
1746 
1747   <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
1748 <span class="s">}</span>
1749 
1750 <span class="c"># Get MMFF94 atom type for Nitrogen with only sigma bonds...</span>
1751 <span class="c">#</span>
<a name="_GetAtomTypeForNitrogenWithOnlySigmaBonds-"></a>1752 <span class="k">sub </span><span class="m">_GetAtomTypeForNitrogenWithOnlySigmaBonds</span> <span class="s">{</span>
1753   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1754   <span class="k">my</span><span class="s">(</span><span class="i">$AtomType</span><span class="s">)</span><span class="sc">;</span>
1755 
1756   <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
1757 
1758   <span class="j">ATOMTYPE:</span> <span class="s">{</span>
1759 
1760     <span class="c"># NPYL : NITROGEN, AS IN PYRROLE</span>
1761     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsPyrroleNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1762       <span class="i">$AtomType</span> = <span class="q">&#39;NPYL&#39;</span><span class="sc">;</span>
1763       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1764     <span class="s">}</span>
1765 
1766     <span class="c"># NC=O : NITROGEN IN AMIDES</span>
1767     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsAmideNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1768       <span class="i">$AtomType</span> = <span class="q">&#39;NC=O&#39;</span><span class="sc">;</span>
1769       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1770     <span class="s">}</span>
1771 
1772     <span class="c"># NC=S : NITROGEN IN N-C=S, THIOAMIDE</span>
1773     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsThioAmideNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1774       <span class="i">$AtomType</span> = <span class="q">&#39;NC=S&#39;</span><span class="sc">;</span>
1775       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1776     <span class="s">}</span>
1777 
1778     <span class="c"># NN=C : NITROGEN IN N-N=C</span>
1779     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsNNCNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1780       <span class="i">$AtomType</span> = <span class="q">&#39;NN=C&#39;</span><span class="sc">;</span>
1781       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1782     <span class="s">}</span>
1783 
1784     <span class="c"># NGD+ : GUANIDINIUM-TYPE NITROGEN - FORMAL CHARGE=1/3</span>
1785     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsGuanidiniumNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1786       <span class="i">$AtomType</span> = <span class="q">&#39;NGD+&#39;</span><span class="sc">;</span>
1787       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1788     <span class="s">}</span>
1789 
1790     <span class="c"># NCN+ :  N IN +N=C-N RESONANCE STRUCTURES - FORMAL CHARGE=1/2</span>
1791     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsNCNResonaceStructuresNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1792       <span class="i">$AtomType</span> = <span class="q">&#39;NCN+&#39;</span><span class="sc">;</span>
1793       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1794     <span class="s">}</span>
1795 
1796     <span class="c"># NN=N : NITROGEN IN N-N=N</span>
1797     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsNNNNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1798       <span class="i">$AtomType</span> = <span class="q">&#39;NN=N&#39;</span><span class="sc">;</span>
1799       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1800     <span class="s">}</span>
1801 
1802     <span class="c">#  NC=C : NITROGEN ON N-C=C</span>
1803     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsNCCNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1804       <span class="i">$AtomType</span> = <span class="q">&#39;NC=C&#39;</span><span class="sc">;</span>
1805       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1806     <span class="s">}</span>
1807 
1808     <span class="c"># NC=N : NITROGEN IN N-C=N</span>
1809     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsNCNNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1810       <span class="i">$AtomType</span> = <span class="q">&#39;NC=N&#39;</span><span class="sc">;</span>
1811       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1812     <span class="s">}</span>
1813 
1814     <span class="c"># NC=P : NITROGEN IN N-C=P</span>
1815     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsNCPNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1816       <span class="i">$AtomType</span> = <span class="q">&#39;NC=P&#39;</span><span class="sc">;</span>
1817       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1818     <span class="s">}</span>
1819 
1820     <span class="c"># NM : DEPROTONATED SULFONAMIDE N-; FORMAL CHARGE=-1</span>
1821     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsDeprotonatedSulfonamideNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1822       <span class="i">$AtomType</span> = <span class="q">&#39;NM&#39;</span><span class="sc">;</span>
1823       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1824     <span class="s">}</span>
1825 
1826     <span class="c"># NSO2 : NITROGEN IN SULFONAMIDES</span>
1827     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsNSO2SulfonamideNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1828       <span class="i">$AtomType</span> = <span class="q">&#39;NSO2&#39;</span><span class="sc">;</span>
1829       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1830     <span class="s">}</span>
1831 
1832     <span class="c"># NSO3 : NITROGEN IN SULFONAMIDES, THREE Os ON S</span>
1833     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsNSO3SulfonamideNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1834       <span class="i">$AtomType</span> = <span class="q">&#39;NSO3&#39;</span><span class="sc">;</span>
1835       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1836     <span class="s">}</span>
1837 
1838     <span class="c"># NPO2 : NITROGEN IN PHOSPHONAMIDES</span>
1839     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsNPO2PhosphonamideNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1840       <span class="i">$AtomType</span> = <span class="q">&#39;NPO2&#39;</span><span class="sc">;</span>
1841       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1842     <span class="s">}</span>
1843 
1844     <span class="c"># NPO3 : NITROGEN IN PHOSPHONAMIDES, THREE Os ON P</span>
1845     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsNPO3PhosphonamideNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1846       <span class="i">$AtomType</span> = <span class="q">&#39;NPO3&#39;</span><span class="sc">;</span>
1847       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1848     <span class="s">}</span>
1849 
1850     <span class="c">#  NC%N : NITROGEN ATTACHED TO CYANO GROUP</span>
1851     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsAttachedToCyanoNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1852       <span class="i">$AtomType</span> = <span class="q">&#39;NC%N&#39;</span><span class="sc">;</span>
1853       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1854     <span class="s">}</span>
1855 
1856     <span class="c"># N3OX : SP3-HYDRIDIZED N-OXIDE NITROGEN</span>
1857     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsSP3NOxideNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1858       <span class="i">$AtomType</span> = <span class="q">&#39;N3OX&#39;</span><span class="sc">;</span>
1859       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1860     <span class="s">}</span>
1861 
1862     <span class="c">#  NC%C : NITROGEN ATTACHED TO C-C TRIPLE BOND</span>
1863     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsAttchedToCCTripleBondNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1864       <span class="i">$AtomType</span> = <span class="q">&#39;NC%C&#39;</span><span class="sc">;</span>
1865       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1866     <span class="s">}</span>
1867 
1868     <span class="c"># NR : NITROGEN IN ALIPHATIC AMINES</span>
1869     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsAliphaticAmineNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1870       <span class="i">$AtomType</span> = <span class="q">&#39;NR&#39;</span><span class="sc">;</span>
1871       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1872     <span class="s">}</span>
1873 
1874     <span class="c"># NR+ : QUATERNARY NITROGEN, SP3, POSITIVELY CHARGED</span>
1875     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsAliphaticAmineQuaternaryNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1876       <span class="i">$AtomType</span> = <span class="q">&#39;NR+&#39;</span><span class="sc">;</span>
1877       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1878     <span class="s">}</span>
1879 
1880     <span class="i">$AtomType</span> = <span class="q">&#39;NR&#39;</span><span class="sc">;</span>
1881   <span class="s">}</span>
1882 
1883   <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
1884 <span class="s">}</span>
1885 
1886 <span class="c"># Get MMFF94 atom type for Nitrogen with one pi bond...</span>
1887 <span class="c">#</span>
<a name="_GetAtomTypeForNitrogenWithOnePiBond-"></a>1888 <span class="k">sub </span><span class="m">_GetAtomTypeForNitrogenWithOnePiBond</span> <span class="s">{</span>
1889   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1890   <span class="k">my</span><span class="s">(</span><span class="i">$AtomType</span><span class="s">)</span><span class="sc">;</span>
1891 
1892   <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
1893 
1894   <span class="j">ATOMTYPE:</span> <span class="s">{</span>
1895 
1896     <span class="c"># NPOX : PYRIDINE N-OXIDE NITROGEN</span>
1897     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsPyridineNOxideNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1898       <span class="i">$AtomType</span> = <span class="q">&#39;NPOX&#39;</span><span class="sc">;</span>
1899       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1900     <span class="s">}</span>
1901 
1902     <span class="c"># NPD+ : PYRIDINIUM-TYPE NITROGEN - FORMAL CHARGE=1</span>
1903     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsPyridiniumNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1904       <span class="i">$AtomType</span> = <span class="q">&#39;NPD+&#39;</span><span class="sc">;</span>
1905       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1906     <span class="s">}</span>
1907 
1908     <span class="c"># NPYD : NITROGEN, AS IN PYRIDINE</span>
1909     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsPyridineNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1910       <span class="i">$AtomType</span> = <span class="q">&#39;NPYD&#39;</span><span class="sc">;</span>
1911       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1912     <span class="s">}</span>
1913 
1914     <span class="c"># N2OX : SP2-HYDRIDIZED N-OXIDE NITROGEN</span>
1915     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsSP2NOxideNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1916       <span class="i">$AtomType</span> = <span class="q">&#39;N2OX&#39;</span><span class="sc">;</span>
1917       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1918     <span class="s">}</span>
1919 
1920     <span class="c"># NAZT : TERMINAL NITROGEN IN AZIDO OR DIAZO GROUP</span>
1921     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsNAZTNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1922       <span class="i">$AtomType</span> = <span class="q">&#39;NAZT&#39;</span><span class="sc">;</span>
1923       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1924     <span class="s">}</span>
1925 
1926     <span class="c"># NR% :  ISONITRILE NITROGEN [FC = 0] OR DIAZO NITROGEN [FC = 1]</span>
1927     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsIsoNitrileOrDiAzoNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1928       <span class="i">$AtomType</span> = <span class="q">&#39;NR%&#39;</span><span class="sc">;</span>
1929       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1930     <span class="s">}</span>
1931 
1932     <span class="c"># NGD+ : GUANIDINIUM-TYPE NITROGEN - FORMAL CHARGE=1/3</span>
1933     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsGuanidiniumNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1934       <span class="i">$AtomType</span> = <span class="q">&#39;NGD+&#39;</span><span class="sc">;</span>
1935       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1936     <span class="s">}</span>
1937 
1938     <span class="c"># NCN+ :  N IN +N=C-N RESONANCE STRUCTURES - FORMAL CHARGE=1/2</span>
1939     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsNCNResonaceStructuresNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1940       <span class="i">$AtomType</span> = <span class="q">&#39;NCN+&#39;</span><span class="sc">;</span>
1941       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1942     <span class="s">}</span>
1943 
1944     <span class="c"># N=C : NITROGEN IN IMINES</span>
1945     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsImineNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1946       <span class="i">$AtomType</span> = <span class="q">&#39;N=C&#39;</span><span class="sc">;</span>
1947       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1948     <span class="s">}</span>
1949 
1950     <span class="c"># N+=C : POSITIVELY CHARGED IMINIUM NITROGEN</span>
1951     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsPositivelyChargedIminiumNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1952       <span class="i">$AtomType</span> = <span class="q">&#39;N+=C&#39;</span><span class="sc">;</span>
1953       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1954     <span class="s">}</span>
1955 
1956     <span class="c"># N=N :  NITROGEN IN AZO COMPOUNDS</span>
1957     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsAzoNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1958       <span class="i">$AtomType</span> = <span class="q">&#39;N=N&#39;</span><span class="sc">;</span>
1959       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1960     <span class="s">}</span>
1961 
1962     <span class="c"># N+=N : POSITIVELY CHARGED NITROGEN DOUBLE-BONDED TO N</span>
1963     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsPositivelyChargedAzoNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1964       <span class="i">$AtomType</span> = <span class="q">&#39;N+=N&#39;</span><span class="sc">;</span>
1965       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1966     <span class="s">}</span>
1967 
1968     <span class="c"># NO2 : NITRO GROUP NITROGEN</span>
1969     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsNitroNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1970       <span class="i">$AtomType</span> = <span class="q">&#39;NO2&#39;</span><span class="sc">;</span>
1971       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1972     <span class="s">}</span>
1973 
1974     <span class="c"># NO3 : NITRATE GROUP NITROGEN</span>
1975     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsNitrateNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1976       <span class="i">$AtomType</span> = <span class="q">&#39;NO3&#39;</span><span class="sc">;</span>
1977       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1978     <span class="s">}</span>
1979 
1980     <span class="c"># N=O : NITROSO NITROGEN</span>
1981     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsNitrosoNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1982       <span class="i">$AtomType</span> = <span class="q">&#39;N=O&#39;</span><span class="sc">;</span>
1983       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1984     <span class="s">}</span>
1985 
1986     <span class="c"># NSO : DIVALENT NITROGEN REPLACING MONOVALENT O IN SO2 GROUP</span>
1987     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsNSONitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1988       <span class="i">$AtomType</span> = <span class="q">&#39;NSO&#39;</span><span class="sc">;</span>
1989       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1990     <span class="s">}</span>
1991 
1992     <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
1993     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;_GetAtomTypeForNitrogenWithOnePiBond: MMFF94 atom type for Nitrogen cann&#39;t be assigned; Default MMFF94 atom type, $AtomType, has been assigned...\n&quot;</span><span class="sc">;</span>
1994   <span class="s">}</span>
1995 
1996   <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
1997 <span class="s">}</span>
1998 
1999 <span class="c"># Get MMFF94 atom type for Nitrogen with two pi bonds...</span>
2000 <span class="c">#</span>
<a name="_GetAtomTypeForNitrogenWithTwoPiBonds-"></a>2001 <span class="k">sub </span><span class="m">_GetAtomTypeForNitrogenWithTwoPiBonds</span> <span class="s">{</span>
2002   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2003   <span class="k">my</span><span class="s">(</span><span class="i">$AtomType</span><span class="s">)</span><span class="sc">;</span>
2004 
2005   <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
2006 
2007   <span class="j">ATOMTYPE:</span> <span class="s">{</span>
2008 
2009     <span class="c"># NAZT : TERMINAL NITROGEN IN AZIDO OR DIAZO GROUP</span>
2010     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsNAZTNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2011       <span class="i">$AtomType</span> = <span class="q">&#39;NAZT&#39;</span><span class="sc">;</span>
2012       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
2013     <span class="s">}</span>
2014 
2015     <span class="c"># NR% :  ISONITRILE NITROGEN [FC = 0] OR DIAZO NITROGEN [FC = 1]</span>
2016     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsIsoNitrileOrDiAzoNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2017       <span class="i">$AtomType</span> = <span class="q">&#39;NR%&#39;</span><span class="sc">;</span>
2018       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
2019     <span class="s">}</span>
2020 
2021     <span class="c">#  =N= : NITROGEN IN C=N=N OR -N=N=N</span>
2022     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsTwoDoublyBondedNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2023       <span class="i">$AtomType</span> = <span class="q">&#39;=N=&#39;</span><span class="sc">;</span>
2024       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
2025     <span class="s">}</span>
2026 
2027     <span class="c"># NSP : NITROGEN, TRIPLE BONDED</span>
2028     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsTriplyBondedSPNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2029       <span class="i">$AtomType</span> = <span class="q">&#39;NSP&#39;</span><span class="sc">;</span>
2030       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
2031     <span class="s">}</span>
2032 
2033     <span class="i">$AtomType</span> = <span class="q">&#39;NSP&#39;</span><span class="sc">;</span>
2034   <span class="s">}</span>
2035 
2036   <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
2037 <span class="s">}</span>
2038 
2039 <span class="c"># NR : NITROGEN IN ALIPHATIC AMINES</span>
2040 <span class="c">#</span>
<a name="_IsAliphaticAmineNitrogen-"></a>2041 <span class="k">sub </span><span class="m">_IsAliphaticAmineNitrogen</span> <span class="s">{</span>
2042   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2043 
2044   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.T3&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;C,H&#39;</span><span class="cm">,</span> <span class="q">&#39;C,H&#39;</span><span class="cm">,</span> <span class="q">&#39;C,H&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span><span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
2045 <span class="s">}</span>
2046 
2047 <span class="c"># NR+ : QUATERNARY NITROGEN, SP3, POSITIVELY CHARGED</span>
2048 <span class="c">#</span>
<a name="_IsAliphaticAmineQuaternaryNitrogen-"></a>2049 <span class="k">sub </span><span class="m">_IsAliphaticAmineQuaternaryNitrogen</span> <span class="s">{</span>
2050   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2051 
2052   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.T4.FC+1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;C,H&#39;</span><span class="cm">,</span> <span class="q">&#39;C,H&#39;</span><span class="cm">,</span> <span class="q">&#39;C,H&#39;</span><span class="cm">,</span> <span class="q">&#39;C,H&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span><span class="q">&#39;-&#39;</span><span class="cm">,</span><span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
2053 <span class="s">}</span>
2054 
2055 <span class="c"># NC=O : NITROGEN IN AMIDES</span>
2056 <span class="c">#</span>
<a name="_IsAmideNitrogen-"></a>2057 <span class="k">sub </span><span class="m">_IsAmideNitrogen</span> <span class="s">{</span>
2058   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2059   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
2060 
2061   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.T3.TSB3&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2062     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2063   <span class="s">}</span>
2064 
2065   <span class="c"># Is it attached to amide carbonyl Carbon?</span>
2066   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;C.T3.DB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2067     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsAmideCarbonylCarbon</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2068       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2069     <span class="s">}</span>
2070   <span class="s">}</span>
2071   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2072 <span class="s">}</span>
2073 
2074 <span class="c"># NC=S : NITROGEN IN N-C=S, THIOAMIDE</span>
2075 <span class="c">#</span>
<a name="_IsThioAmideNitrogen-"></a>2076 <span class="k">sub </span><span class="m">_IsThioAmideNitrogen</span> <span class="s">{</span>
2077   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2078   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
2079 
2080   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.T3.TSB3&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2081     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2082   <span class="s">}</span>
2083 
2084   <span class="c"># Is it attached to thioamide Carbon?</span>
2085   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;C.T3.DB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2086     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsThioAmideCarbon</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2087       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2088     <span class="s">}</span>
2089   <span class="s">}</span>
2090   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2091 <span class="s">}</span>
2092 
2093 <span class="c"># NN=C : NITROGEN IN N-N=C</span>
2094 <span class="c">#</span>
<a name="_IsNNCNitrogen-"></a>2095 <span class="k">sub </span><span class="m">_IsNNCNitrogen</span> <span class="s">{</span>
2096   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2097   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
2098 
2099   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.T3.TSB3&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2100     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2101   <span class="s">}</span>
2102 
2103   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;N.DB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2104     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomNeighbor</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.T2.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;C.T3&#39;</span><span class="cm">,</span> <span class="q">&#39;N.T3&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2105       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2106     <span class="s">}</span>
2107   <span class="s">}</span>
2108   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2109 <span class="s">}</span>
2110 
2111 <span class="c"># NN=N : NITROGEN IN N-N=N</span>
2112 <span class="c">#</span>
<a name="_IsNNNNitrogen-"></a>2113 <span class="k">sub </span><span class="m">_IsNNNNitrogen</span> <span class="s">{</span>
2114   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2115   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
2116 
2117   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.T3.TSB3&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2118     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2119   <span class="s">}</span>
2120 
2121   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;N.DB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2122     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomNeighbor</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.T2.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;N.T2&#39;</span><span class="cm">,</span> <span class="q">&#39;N.T3&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2123       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2124     <span class="s">}</span>
2125   <span class="s">}</span>
2126   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2127 <span class="s">}</span>
2128 
2129 <span class="c"># NPYD : NITROGEN, AS IN PYRIDINE</span>
2130 <span class="c">#</span>
<a name="_IsPyridineNitrogen-"></a>2131 <span class="k">sub </span><span class="m">_IsPyridineNitrogen</span> <span class="s">{</span>
2132   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2133 
2134   <span class="c"># Is it an aromatic Nitrogen in only one six membered ring?</span>
2135   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.Ar.RA6.TR1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2136     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2137   <span class="s">}</span>
2138 
2139   <span class="c"># Is it part of six membered ring containing only one hetero atom?</span>
2140   <span class="k">my</span><span class="s">(</span><span class="i">$RingAtomsRef</span><span class="cm">,</span> <span class="i">$RingIsAromatic</span><span class="cm">,</span> <span class="i">$NumOfHeteroAtoms</span><span class="s">)</span><span class="sc">;</span>
2141   <span class="k">for</span> <span class="i">$RingAtomsRef</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetRingsWithSize</span><span class="s">(</span><span class="n">6</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2142     <span class="s">(</span><span class="i">$RingIsAromatic</span><span class="cm">,</span> <span class="i">$NumOfHeteroAtoms</span><span class="s">)</span> = <span class="i">$This</span><span class="i">-&gt;_GetHeteroAtomsInformationInRing</span><span class="s">(</span><span class="i">$RingAtomsRef</span><span class="s">)</span><span class="sc">;</span>
2143     <span class="k">if</span> <span class="s">(</span><span class="i">$RingIsAromatic</span> &amp;&amp; <span class="i">$NumOfHeteroAtoms</span> == <span class="n">1</span><span class="s">)</span> <span class="s">{</span>
2144       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2145     <span class="s">}</span>
2146   <span class="s">}</span>
2147   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2148 <span class="s">}</span>
2149 
2150 <span class="c"># NPYL : NITROGEN, AS IN PYRROLE</span>
2151 <span class="c">#</span>
<a name="_IsPyrroleNitrogen-"></a>2152 <span class="k">sub </span><span class="m">_IsPyrroleNitrogen</span> <span class="s">{</span>
2153   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2154 
2155   <span class="c"># Is it an aromatic Nitrogen in only one five membered ring?</span>
2156   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.Ar.RA5.TR1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2157     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2158   <span class="s">}</span>
2159 
2160   <span class="c"># Is it part of five membered ring containing only one hetero atom?</span>
2161   <span class="k">my</span><span class="s">(</span><span class="i">$RingAtomsRef</span><span class="cm">,</span> <span class="i">$RingIsAromatic</span><span class="cm">,</span> <span class="i">$NumOfHeteroAtoms</span><span class="s">)</span><span class="sc">;</span>
2162   <span class="k">for</span> <span class="i">$RingAtomsRef</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetRingsWithSize</span><span class="s">(</span><span class="n">5</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2163     <span class="s">(</span><span class="i">$RingIsAromatic</span><span class="cm">,</span> <span class="i">$NumOfHeteroAtoms</span><span class="s">)</span> = <span class="i">$This</span><span class="i">-&gt;_GetHeteroAtomsInformationInRing</span><span class="s">(</span><span class="i">$RingAtomsRef</span><span class="s">)</span><span class="sc">;</span>
2164     <span class="k">if</span> <span class="s">(</span><span class="i">$RingIsAromatic</span> &amp;&amp; <span class="i">$NumOfHeteroAtoms</span> == <span class="n">1</span><span class="s">)</span> <span class="s">{</span>
2165       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2166     <span class="s">}</span>
2167   <span class="s">}</span>
2168   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2169 <span class="s">}</span>
2170 
2171 <span class="c">#  NC=C : NITROGEN ON N-C=C</span>
2172 <span class="c">#</span>
<a name="_IsNCCNitrogen-"></a>2173 <span class="k">sub </span><span class="m">_IsNCCNitrogen</span> <span class="s">{</span>
2174   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2175   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
2176 
2177   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.T3.TSB3&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2178     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2179   <span class="s">}</span>
2180 
2181   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;C.DB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2182     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomNeighbor</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.T3.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;C.T3&#39;</span><span class="cm">,</span> <span class="q">&#39;N.T3&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span><span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2183       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2184     <span class="s">}</span>
2185   <span class="s">}</span>
2186   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2187 <span class="s">}</span>
2188 
2189 <span class="c"># NC=N : NITROGEN IN N-C=N</span>
2190 <span class="c">#</span>
<a name="_IsNCNNitrogen-"></a>2191 <span class="k">sub </span><span class="m">_IsNCNNitrogen</span> <span class="s">{</span>
2192   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2193   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
2194 
2195   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.T3.TSB3&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2196     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2197   <span class="s">}</span>
2198 
2199   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;C.DB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2200     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomNeighbor</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.T3.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;N.T2&#39;</span><span class="cm">,</span> <span class="q">&#39;N.T3&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span><span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2201       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2202     <span class="s">}</span>
2203   <span class="s">}</span>
2204   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2205 <span class="s">}</span>
2206 
2207 <span class="c"># NC=P : NITROGEN IN N-C=P</span>
2208 <span class="c">#</span>
<a name="_IsNCPNitrogen-"></a>2209 <span class="k">sub </span><span class="m">_IsNCPNitrogen</span> <span class="s">{</span>
2210   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2211   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
2212 
2213   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.T3.TSB3&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2214     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2215   <span class="s">}</span>
2216 
2217   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;C.DB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2218     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomNeighbor</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.T3.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;P.X1&#39;</span><span class="cm">,</span> <span class="q">&#39;N.T3&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2219       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2220     <span class="s">}</span>
2221   <span class="s">}</span>
2222   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2223 <span class="s">}</span>
2224 
2225 <span class="c">#  NC%C : NITROGEN ATTACHED TO C-C TRIPLE BOND</span>
2226 <span class="c">#</span>
<a name="_IsAttchedToCCTripleBondNitrogen-"></a>2227 <span class="k">sub </span><span class="m">_IsAttchedToCCTripleBondNitrogen</span> <span class="s">{</span>
2228   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2229   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
2230 
2231   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.T3.TSB3&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2232     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2233   <span class="s">}</span>
2234 
2235   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;C.TB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2236     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomNeighbor</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.X2.TB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;C.T2&#39;</span><span class="cm">,</span> <span class="q">&#39;N.T3&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;#&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2237       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2238     <span class="s">}</span>
2239   <span class="s">}</span>
2240   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2241 <span class="s">}</span>
2242 
2243 <span class="c"># NSO2 : NITROGEN IN SULFONAMIDES</span>
2244 <span class="c">#</span>
<a name="_IsNSO2SulfonamideNitrogen-"></a>2245 <span class="k">sub </span><span class="m">_IsNSO2SulfonamideNitrogen</span> <span class="s">{</span>
2246   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2247   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
2248 
2249   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.T3.TSB3&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2250     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2251   <span class="s">}</span>
2252 
2253   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;S.T4.DB2&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2254     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomNeighbor</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;S.T4.DB2&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;N&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;!O&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2255       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2256     <span class="s">}</span>
2257   <span class="s">}</span>
2258   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2259 <span class="s">}</span>
2260 
2261 <span class="c"># NSO3 : NITROGEN IN SULFONAMIDES, THREE Os ON S</span>
2262 <span class="c">#</span>
<a name="_IsNSO3SulfonamideNitrogen-"></a>2263 <span class="k">sub </span><span class="m">_IsNSO3SulfonamideNitrogen</span> <span class="s">{</span>
2264   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2265   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
2266 
2267   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.T3.TSB3&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2268     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2269   <span class="s">}</span>
2270 
2271   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;S.T4.DB2&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2272     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomNeighbor</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;S.X4.DB2&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;N&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2273       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2274     <span class="s">}</span>
2275   <span class="s">}</span>
2276   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2277 <span class="s">}</span>
2278 
2279 <span class="c"># NPO2 : NITROGEN IN PHOSPHONAMIDES</span>
2280 <span class="c">#</span>
<a name="_IsNPO2PhosphonamideNitrogen-"></a>2281 <span class="k">sub </span><span class="m">_IsNPO2PhosphonamideNitrogen</span> <span class="s">{</span>
2282   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2283   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
2284 
2285   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.T3.TSB3&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2286     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2287   <span class="s">}</span>
2288 
2289   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;P.DB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2290     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomNeighbor</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;P.T4.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;N&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;!O&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2291       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2292     <span class="s">}</span>
2293   <span class="s">}</span>
2294   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2295 <span class="s">}</span>
2296 
2297 <span class="c"># NPO3 : NITROGEN IN PHOSPHONAMIDES, THREE Os ON P</span>
2298 <span class="c">#</span>
<a name="_IsNPO3PhosphonamideNitrogen-"></a>2299 <span class="k">sub </span><span class="m">_IsNPO3PhosphonamideNitrogen</span> <span class="s">{</span>
2300   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2301   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
2302 
2303   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.T3.TSB3&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2304     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2305   <span class="s">}</span>
2306 
2307   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;P.DB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2308     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomNeighbor</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;P.X4.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;N&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2309       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2310     <span class="s">}</span>
2311   <span class="s">}</span>
2312   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2313 <span class="s">}</span>
2314 
2315 <span class="c">#  NC%N : NITROGEN ATTACHED TO CYANO GROUP</span>
2316 <span class="c">#</span>
<a name="_IsAttachedToCyanoNitrogen-"></a>2317 <span class="k">sub </span><span class="m">_IsAttachedToCyanoNitrogen</span> <span class="s">{</span>
2318   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2319   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
2320 
2321   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.T3.TSB3&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2322     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2323   <span class="s">}</span>
2324 
2325   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;C.TB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2326     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomNeighbor</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.T2.TB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;N&#39;</span><span class="cm">,</span> <span class="q">&#39;N&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;#&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2327       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2328     <span class="s">}</span>
2329   <span class="s">}</span>
2330   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2331 <span class="s">}</span>
2332 
2333 <span class="c"># NM : DEPROTONATED SULFONAMIDE N-; FORMAL CHARGE=-1</span>
2334 <span class="c">#</span>
<a name="_IsDeprotonatedSulfonamideNitrogen-"></a>2335 <span class="k">sub </span><span class="m">_IsDeprotonatedSulfonamideNitrogen</span> <span class="s">{</span>
2336   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2337   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
2338 
2339   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.T2.FC-1.TSB2&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2340     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2341   <span class="s">}</span>
2342 
2343   <span class="c"># Is it attached to sulfonamide Sulfur?</span>
2344   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;S.T4.DB2&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2345     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsSulfonamideSulfur</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2346       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2347     <span class="s">}</span>
2348   <span class="s">}</span>
2349   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2350 <span class="s">}</span>
2351 
2352 <span class="c"># N=C : NITROGEN IN IMINES</span>
2353 <span class="c">#</span>
<a name="_IsImineNitrogen-"></a>2354 <span class="k">sub </span><span class="m">_IsImineNitrogen</span> <span class="s">{</span>
2355   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2356 
2357   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.T2.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;C&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
2358 <span class="s">}</span>
2359 
2360 <span class="c"># N+=C : POSITIVELY CHARGED IMINIUM NITROGEN</span>
2361 <span class="c">#</span>
<a name="_IsPositivelyChargedIminiumNitrogen-"></a>2362 <span class="k">sub </span><span class="m">_IsPositivelyChargedIminiumNitrogen</span> <span class="s">{</span>
2363   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2364 
2365   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.DB1.FC+1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;C&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
2366 <span class="s">}</span>
2367 
2368 <span class="c"># N=N :  NITROGEN IN AZO COMPOUNDS</span>
2369 <span class="c">#</span>
<a name="_IsAzoNitrogen-"></a>2370 <span class="k">sub </span><span class="m">_IsAzoNitrogen</span> <span class="s">{</span>
2371   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2372 
2373   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.T2.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;N&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
2374 <span class="s">}</span>
2375 
2376 <span class="c"># N+=N : POSITIVELY CHARGED NITROGEN DOUBLE-BONDED TO N</span>
2377 <span class="c">#</span>
<a name="_IsPositivelyChargedAzoNitrogen-"></a>2378 <span class="k">sub </span><span class="m">_IsPositivelyChargedAzoNitrogen</span> <span class="s">{</span>
2379   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2380 
2381   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.DB1.FC+1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;N&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
2382 <span class="s">}</span>
2383 
2384 <span class="c"># NO2 : NITRO GROUP NITROGEN</span>
2385 <span class="c">#</span>
<a name="_IsNitroNitrogen-"></a>2386 <span class="k">sub </span><span class="m">_IsNitroNitrogen</span> <span class="s">{</span>
2387   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2388 
2389   <span class="c"># R-N+(=O)-(O-)</span>
2390   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.T3.DB1.FC+1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;O.FC-1&#39;</span><span class="cm">,</span> <span class="q">&#39;!O&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
2391 <span class="s">}</span>
2392 
2393 <span class="c"># NO3 : NITRATE GROUP NITROGEN</span>
2394 <span class="c">#</span>
<a name="_IsNitrateNitrogen-"></a>2395 <span class="k">sub </span><span class="m">_IsNitrateNitrogen</span> <span class="s">{</span>
2396   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2397 
2398   <span class="c"># (O-)-N+(=O)-(O-) or R-O-N+(=O)-(O-)</span>
2399   <span class="c">#</span>
2400   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.T3.DB1.FC+1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;O.FC-1&#39;</span><span class="cm">,</span> <span class="q">&#39;O.T2.FC0&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
2401 <span class="s">}</span>
2402 
2403 <span class="c"># N=O : NITROSO NITROGEN</span>
2404 <span class="c">#</span>
<a name="_IsNitrosoNitrogen-"></a>2405 <span class="k">sub </span><span class="m">_IsNitrosoNitrogen</span> <span class="s">{</span>
2406   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2407 
2408   <span class="c"># R-N=O</span>
2409   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.T2.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
2410 <span class="s">}</span>
2411 
2412 <span class="c"># NAZT : TERMINAL NITROGEN IN AZIDO OR DIAZO GROUP</span>
2413 <span class="c">#</span>
<a name="_IsNAZTNitrogen-"></a>2414 <span class="k">sub </span><span class="m">_IsNAZTNitrogen</span> <span class="s">{</span>
2415   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2416 
2417   <span class="k">return</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsAzidoTerminalNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span> || <span class="i">$This</span><span class="i">-&gt;_IsDiazoTerminalNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
2418 <span class="s">}</span>
2419 
2420 <span class="c"># TERMINAL NITROGEN IN AZIDO GROUP</span>
2421 <span class="c">#</span>
<a name="_IsAzidoTerminalNitrogen-"></a>2422 <span class="k">sub </span><span class="m">_IsAzidoTerminalNitrogen</span> <span class="s">{</span>
2423   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2424   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
2425 
2426   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.X1.DB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2427     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2428   <span class="s">}</span>
2429 
2430   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;N.DB2&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2431     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsAzidoGroupMiddleNitrogen</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2432       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2433     <span class="s">}</span>
2434   <span class="s">}</span>
2435   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2436 <span class="s">}</span>
2437 
2438 <span class="c"># TERMINAL NITROGEN IN  DIAZO GROUP</span>
2439 <span class="c">#</span>
<a name="_IsDiazoTerminalNitrogen-"></a>2440 <span class="k">sub </span><span class="m">_IsDiazoTerminalNitrogen</span> <span class="s">{</span>
2441   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2442   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
2443 
2444   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.X1.TB1,N.X1.DB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2445     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2446   <span class="s">}</span>
2447 
2448   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;N.DB2,N.TB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2449     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsDiazoGroupMiddleNitrogen</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2450       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2451     <span class="s">}</span>
2452   <span class="s">}</span>
2453   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2454 <span class="s">}</span>
2455 
2456 <span class="c"># Azido group: R-N=N+=N-</span>
2457 <span class="c">#</span>
<a name="_IsAzidoGroupMiddleNitrogen-"></a>2458 <span class="k">sub </span><span class="m">_IsAzidoGroupMiddleNitrogen</span> <span class="s">{</span>
2459   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2460 
2461   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.X2.DB2.FC+1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;N.X1.FC-1&#39;</span><span class="cm">,</span> <span class="q">&#39;N.T2.FC0&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;=&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
2462 <span class="s">}</span>
2463 
2464 <span class="c"># Diazo group: R&#39;-(C-)(-R&quot;)-(N+)#N or R&#39;-C(-R&quot;)=(N+)=(N-)</span>
2465 <span class="c">#</span>
<a name="_IsDiazoGroupMiddleNitrogen-"></a>2466 <span class="k">sub </span><span class="m">_IsDiazoGroupMiddleNitrogen</span> <span class="s">{</span>
2467   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2468 
2469   <span class="c"># Diazo group: R&#39;-C(-R&quot;)=(N+)=(N-)</span>
2470   <span class="k">if</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.X2.DB2.FC+1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;C.T3.FC0&#39;</span><span class="cm">,</span> <span class="q">&#39;N.X1.FC-1&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;=&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2471     <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2472   <span class="s">}</span>
2473 
2474   <span class="c"># Diazo group: R&#39;-(C-)(-R&quot;)-(N+)#N</span>
2475   <span class="k">if</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.X2.TB1.FC+1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;C.T3.FC-1&#39;</span><span class="cm">,</span> <span class="q">&#39;N.X1.FC0&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;#&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2476     <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2477   <span class="s">}</span>
2478 
2479   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2480 <span class="s">}</span>
2481 
2482 <span class="c"># NSO : DIVALENT NITROGEN REPLACING MONOVALENT O IN SO2 GROUP</span>
2483 <span class="c">#</span>
<a name="_IsNSONitrogen-"></a>2484 <span class="k">sub </span><span class="m">_IsNSONitrogen</span> <span class="s">{</span>
2485   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2486   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
2487 
2488   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.T2.DB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2489     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2490   <span class="s">}</span>
2491 
2492   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;S.DB2&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2493     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomNeighbor</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;S.DB2&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;N&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;=&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2494       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2495     <span class="s">}</span>
2496   <span class="s">}</span>
2497   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2498 <span class="s">}</span>
2499 
2500 <span class="c"># NCN+ :  N IN +N=C-N RESONANCE STRUCTURES - FORMAL CHARGE=1/2</span>
2501 <span class="c">#</span>
2502 <span class="c"># Notes:</span>
2503 <span class="c">#    . This method is called invoked for both SP and SP2 Nitrogens to check and assign</span>
2504 <span class="c">#      NCN+ to both Nitrogens.</span>
2505 <span class="c">#</span>
<a name="_IsNCNResonaceStructuresNitrogen-"></a>2506 <span class="k">sub </span><span class="m">_IsNCNResonaceStructuresNitrogen</span> <span class="s">{</span>
2507   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2508   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
2509 
2510   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2511     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2512   <span class="s">}</span>
2513 
2514   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;C.DB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2515     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsNCNResonaceStructuresCarbon</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2516       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2517     <span class="s">}</span>
2518   <span class="s">}</span>
2519   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2520 <span class="s">}</span>
2521 
2522 <span class="c"># NGD+ : GUANIDINIUM-TYPE NITROGEN - FORMAL CHARGE=1/3</span>
2523 <span class="c">#</span>
2524 <span class="c"># Notes:</span>
2525 <span class="c">#    . This method is called invoked for both SP and SP2 Nitrogens to check and assign</span>
2526 <span class="c">#      NGD+ to all three Guanidinium Nitrogens.</span>
2527 <span class="c">#</span>
<a name="_IsGuanidiniumNitrogen-"></a>2528 <span class="k">sub </span><span class="m">_IsGuanidiniumNitrogen</span> <span class="s">{</span>
2529   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2530   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
2531 
2532   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2533     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2534   <span class="s">}</span>
2535 
2536   <span class="c"># Is it attached to Guandinium Carbon?</span>
2537   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;C.DB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2538     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsGuandiniumCarbon</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2539       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2540     <span class="s">}</span>
2541   <span class="s">}</span>
2542   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2543 <span class="s">}</span>
2544 
2545 <span class="c"># NPD+ : PYRIDINIUM-TYPE NITROGEN - FORMAL CHARGE=1</span>
2546 <span class="c">#</span>
<a name="_IsPyridiniumNitrogen-"></a>2547 <span class="k">sub </span><span class="m">_IsPyridiniumNitrogen</span> <span class="s">{</span>
2548   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2549 
2550   <span class="k">return</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsPyridineNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span> &amp;&amp; <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.FC+1&#39;</span><span class="s">)</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
2551 <span class="s">}</span>
2552 
2553 <span class="c"># NR% :  ISONITRILE NITROGEN [FC = 0] OR DIAZO NITROGEN [FC = 1]</span>
2554 <span class="c">#</span>
2555 <span class="c"># Notes:</span>
2556 <span class="c">#    . This method is called invoked for both SP and SP2 Nitrogens to check and assign</span>
2557 <span class="c">#      NR%.</span>
2558 <span class="c">#</span>
<a name="_IsIsoNitrileOrDiAzoNitrogen-"></a>2559 <span class="k">sub </span><span class="m">_IsIsoNitrileOrDiAzoNitrogen</span> <span class="s">{</span>
2560   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2561 
2562   <span class="k">return</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsIsoNitrileNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span> || <span class="i">$This</span><span class="i">-&gt;_IsDiAzoNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
2563 <span class="s">}</span>
2564 
2565 <span class="c"># Isonitrile nitrogen: R-N+#C-</span>
2566 <span class="c">#</span>
2567 <span class="c"># Notes:</span>
2568 <span class="c">#    . MayaChemTools assumes isonitrile Nitrogen to have a formal charge of +1; otherwise</span>
2569 <span class="c">#      it won&#39;t be an isonitrile group. It&#39;s not clear why it would be zero as indicated in</span>
2570 <span class="c">#      MMFF documentation.</span>
2571 <span class="c">#</span>
<a name="_IsIsoNitrileNitrogen-"></a>2572 <span class="k">sub </span><span class="m">_IsIsoNitrileNitrogen</span> <span class="s">{</span>
2573   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2574   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
2575 
2576   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.FC+1.TB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2577     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2578   <span class="s">}</span>
2579 
2580   <span class="c"># Is it attached to isonitrile Carbon?</span>
2581   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;C.TB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2582     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsIsoNitrileCarbon</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2583       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2584     <span class="s">}</span>
2585   <span class="s">}</span>
2586   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2587 <span class="s">}</span>
2588 
2589 <span class="c"># Diazo group: R1-(C-)(-R2)-(N+)#N or R1-C(-R2)=(N+)=(N-)</span>
2590 <span class="c">#</span>
<a name="_IsDiAzoNitrogen-"></a>2591 <span class="k">sub </span><span class="m">_IsDiAzoNitrogen</span> <span class="s">{</span>
2592   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2593   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
2594 
2595   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_IsDiazoGroupMiddleNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
2596 <span class="s">}</span>
2597 
2598 <span class="c"># N5A : ALPHA AROM HETEROCYCLIC 5-RING  NITROGEN</span>
2599 <span class="c">#</span>
<a name="_IsFiveMemberedHeteroAromaticRingAlphaNitrogen-"></a>2600 <span class="k">sub </span><span class="m">_IsFiveMemberedHeteroAromaticRingAlphaNitrogen</span> <span class="s">{</span>
2601   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2602 
2603   <span class="c"># Is it an aromatic atom in a five membered ring?</span>
2604   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.Ar.RA5.FC0&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2605     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2606   <span class="s">}</span>
2607 
2608   <span class="c"># Is it part of five membered rings containing hetero atom at alpha position?</span>
2609   <span class="k">my</span><span class="s">(</span><span class="i">$RingAtomsRef</span><span class="s">)</span><span class="sc">;</span>
2610 
2611   <span class="k">for</span> <span class="i">$RingAtomsRef</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetRingsWithSize</span><span class="s">(</span><span class="n">5</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2612     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsAtomPositionAlphaInHeteroAromaticRing</span><span class="s">(</span><span class="i">$Atom</span><span class="cm">,</span> <span class="i">$RingAtomsRef</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2613       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2614     <span class="s">}</span>
2615   <span class="s">}</span>
2616   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2617 <span class="s">}</span>
2618 
2619 <span class="c"># N5B : BETA AROM HETEROCYCLIC 5-RING  NITROGEN</span>
2620 <span class="c">#</span>
<a name="_IsFiveMemberedHeteroAromaticRingBetaNitrogen-"></a>2621 <span class="k">sub </span><span class="m">_IsFiveMemberedHeteroAromaticRingBetaNitrogen</span> <span class="s">{</span>
2622   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2623 
2624   <span class="c"># Is it an aromatic atom in a five membered ring?</span>
2625   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.Ar.RA5.FC0&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2626     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2627   <span class="s">}</span>
2628 
2629   <span class="c"># Is it part of five membered rings containing hetero atom at beta position?</span>
2630   <span class="k">my</span><span class="s">(</span><span class="i">$RingAtomsRef</span><span class="s">)</span><span class="sc">;</span>
2631 
2632   <span class="k">for</span> <span class="i">$RingAtomsRef</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetRingsWithSize</span><span class="s">(</span><span class="n">5</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2633     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsAtomPositionBetaInHeteroAromaticRing</span><span class="s">(</span><span class="i">$Atom</span><span class="cm">,</span> <span class="i">$RingAtomsRef</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2634       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2635     <span class="s">}</span>
2636   <span class="s">}</span>
2637   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2638 <span class="s">}</span>
2639 
2640 <span class="c"># N5A+ : POSITIVE N5A NITROGEN - FORMAL CHARGE=1</span>
2641 <span class="c">#</span>
<a name="_IsPositivelyChargedFiveMemberedHeteroAromaticRingAlphaNitrogen-"></a>2642 <span class="k">sub </span><span class="m">_IsPositivelyChargedFiveMemberedHeteroAromaticRingAlphaNitrogen</span> <span class="s">{</span>
2643   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2644 
2645   <span class="c"># Is it an aromatic atom in a five membered ring?</span>
2646   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.Ar.RA5.FC+1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2647     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2648   <span class="s">}</span>
2649 
2650   <span class="c"># Is it part of five membered rings containing hetero atom at alpha position?</span>
2651   <span class="k">my</span><span class="s">(</span><span class="i">$RingAtomsRef</span><span class="s">)</span><span class="sc">;</span>
2652 
2653   <span class="k">for</span> <span class="i">$RingAtomsRef</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetRingsWithSize</span><span class="s">(</span><span class="n">5</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2654     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsAtomPositionAlphaInHeteroAromaticRing</span><span class="s">(</span><span class="i">$Atom</span><span class="cm">,</span> <span class="i">$RingAtomsRef</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2655       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2656     <span class="s">}</span>
2657   <span class="s">}</span>
2658   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2659 <span class="s">}</span>
2660 
2661 <span class="c"># N5B+ : POSITIVE N5B NITROGEN - FORMAL CHARGE=1</span>
2662 <span class="c">#</span>
<a name="_IsPositivelyChargedFiveMemberedHeteroAromaticRingBetaNitrogen-"></a>2663 <span class="k">sub </span><span class="m">_IsPositivelyChargedFiveMemberedHeteroAromaticRingBetaNitrogen</span> <span class="s">{</span>
2664   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2665 
2666   <span class="c"># Is it an aromatic atom in a five membered ring?</span>
2667   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.Ar.RA5.FC+1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2668     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2669   <span class="s">}</span>
2670 
2671   <span class="c"># Is it part of five membered rings containing hetero atom at beta position?</span>
2672   <span class="k">my</span><span class="s">(</span><span class="i">$RingAtomsRef</span><span class="s">)</span><span class="sc">;</span>
2673 
2674   <span class="k">for</span> <span class="i">$RingAtomsRef</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetRingsWithSize</span><span class="s">(</span><span class="n">5</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2675     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsAtomPositionBetaInHeteroAromaticRing</span><span class="s">(</span><span class="i">$Atom</span><span class="cm">,</span> <span class="i">$RingAtomsRef</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2676       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2677     <span class="s">}</span>
2678   <span class="s">}</span>
2679   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2680 <span class="s">}</span>
2681 
2682 <span class="c"># N2OX : SP2-HYDRIDIZED N-OXIDE NITROGEN</span>
2683 <span class="c">#</span>
<a name="_IsSP2NOxideNitrogen-"></a>2684 <span class="k">sub </span><span class="m">_IsSP2NOxideNitrogen</span> <span class="s">{</span>
2685   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2686 
2687   <span class="c"># R=(R&#39;-)(N+)-(O-)</span>
2688   <span class="c">#</span>
2689   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.FC+1.DB1.T3&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O.X1.FC-1&#39;</span><span class="cm">,</span> <span class="q">&#39;C&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
2690 <span class="s">}</span>
2691 
2692 <span class="c"># N3OX : SP3-HYDRIDIZED N-OXIDE NITROGEN</span>
2693 <span class="c">#</span>
<a name="_IsSP3NOxideNitrogen-"></a>2694 <span class="k">sub </span><span class="m">_IsSP3NOxideNitrogen</span> <span class="s">{</span>
2695   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2696 
2697   <span class="c"># R-(R&#39;-)(R&quot;-)(N+)-(O-)</span>
2698   <span class="c">#</span>
2699   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.FC+1.T4&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O.X1.FC-1&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
2700 <span class="s">}</span>
2701 
2702 <span class="c"># NPOX : PYRIDINE N-OXIDE NITROGEN</span>
2703 <span class="c">#</span>
<a name="_IsPyridineNOxideNitrogen-"></a>2704 <span class="k">sub </span><span class="m">_IsPyridineNOxideNitrogen</span> <span class="s">{</span>
2705   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2706 
2707   <span class="k">return</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsPyridineNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span> &amp;&amp; <span class="i">$This</span><span class="i">-&gt;_IsSP2NOxideNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
2708 <span class="s">}</span>
2709 
2710 <span class="c"># N5M : NEGATIVELY CHARGED N IN, E.G, TRI- OR TETRAZOLE ANION</span>
2711 <span class="c">#</span>
<a name="_IsNegativelyChargedFiveMemberedHeteroCyclicRingNitrogen-"></a>2712 <span class="k">sub </span><span class="m">_IsNegativelyChargedFiveMemberedHeteroCyclicRingNitrogen</span> <span class="s">{</span>
2713   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2714 
2715   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.RA5.FC-1&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
2716 <span class="s">}</span>
2717 
2718 <span class="c"># N5 : GENERAL NITROGEN IN 5-MEMBERED HETEROCYCLIC RING</span>
2719 <span class="c">#</span>
<a name="_IsFiveMemberedHeteroCyclicRingNitrogen-"></a>2720 <span class="k">sub </span><span class="m">_IsFiveMemberedHeteroCyclicRingNitrogen</span> <span class="s">{</span>
2721   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2722 
2723   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.RA5&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
2724 <span class="s">}</span>
2725 
2726 <span class="c"># N5+ : POSITIVE N5 NITROGEN - FORMAL CHARGE=1</span>
2727 <span class="c">#</span>
<a name="_IsPositivelyChargedFiveMemberedHeteroCyclicRingNitrogen-"></a>2728 <span class="k">sub </span><span class="m">_IsPositivelyChargedFiveMemberedHeteroCyclicRingNitrogen</span> <span class="s">{</span>
2729   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2730 
2731   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.RA5.FC+1&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
2732 <span class="s">}</span>
2733 
2734 <span class="c"># N5AX : N-OXIDE NITROGEN IN 5-RING ALPHA POSITION</span>
2735 <span class="c">#</span>
<a name="_IsNOxideFiveMemberedHeteroCyclicRingAlphaNitrogen-"></a>2736 <span class="k">sub </span><span class="m">_IsNOxideFiveMemberedHeteroCyclicRingAlphaNitrogen</span> <span class="s">{</span>
2737   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2738 
2739   <span class="c"># Is it a N-oxide Nitrogen atom in a five membered ring?</span>
2740   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.RA5.FC+1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O.X1.FC-1.!RA&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2741     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2742   <span class="s">}</span>
2743 
2744   <span class="c"># Is it part of five membered rings containing hetero atom at alpha position?</span>
2745   <span class="k">my</span><span class="s">(</span><span class="i">$RingAtomsRef</span><span class="s">)</span><span class="sc">;</span>
2746 
2747   <span class="k">for</span> <span class="i">$RingAtomsRef</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetRingsWithSize</span><span class="s">(</span><span class="n">5</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2748     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsAtomPositionAlphaInHeteroRing</span><span class="s">(</span><span class="i">$Atom</span><span class="cm">,</span> <span class="i">$RingAtomsRef</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2749       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2750     <span class="s">}</span>
2751   <span class="s">}</span>
2752   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2753 <span class="s">}</span>
2754 
2755 <span class="c"># N5BX : N-OXIDE NITROGEN IN 5-RING BETA POSITION</span>
2756 <span class="c">#</span>
<a name="_IsNOxideFiveMemberedHeteroCyclicRingBetaNitrogen-"></a>2757 <span class="k">sub </span><span class="m">_IsNOxideFiveMemberedHeteroCyclicRingBetaNitrogen</span> <span class="s">{</span>
2758   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2759 
2760   <span class="c"># Is it a N-oxide Nitrogen atom in a five membered ring?</span>
2761   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.RA5.FC+1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O.X1.FC-1.!RA&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2762     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2763   <span class="s">}</span>
2764 
2765   <span class="c"># Is it part of five membered rings containing hetero atom at alpha position?</span>
2766   <span class="k">my</span><span class="s">(</span><span class="i">$RingAtomsRef</span><span class="s">)</span><span class="sc">;</span>
2767 
2768   <span class="k">for</span> <span class="i">$RingAtomsRef</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetRingsWithSize</span><span class="s">(</span><span class="n">5</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2769     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsAtomPositionBetaInHeteroRing</span><span class="s">(</span><span class="i">$Atom</span><span class="cm">,</span> <span class="i">$RingAtomsRef</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2770       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2771     <span class="s">}</span>
2772   <span class="s">}</span>
2773   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2774 <span class="s">}</span>
2775 
2776 <span class="c"># N5OX : N-OXIDE NITROGEN IN GENERAL 5-RING POSITION</span>
2777 <span class="c">#</span>
<a name="_IsNOxideFiveMemberedHeteroCyclicRingNitrogen-"></a>2778 <span class="k">sub </span><span class="m">_IsNOxideFiveMemberedHeteroCyclicRingNitrogen</span> <span class="s">{</span>
2779   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2780 
2781   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.FC+1.RA5&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O.X1.FC-1.!RA&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
2782 <span class="s">}</span>
2783 
2784 <span class="c"># NIM+ : IMIDAZOLIUM-TYPE NITROGEN - FORMAL CHARGE=1/2</span>
2785 <span class="c">#</span>
2786 <span class="c"># Notes:</span>
2787 <span class="c">#    . MayaChemTools assigns NIM+ to both the Nitrogens around Imidazolium Carbon.</span>
2788 <span class="c">#</span>
<a name="_IsImidazoliumNitrogen-"></a>2789 <span class="k">sub </span><span class="m">_IsImidazoliumNitrogen</span> <span class="s">{</span>
2790   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2791   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
2792 
2793   <span class="c"># Is it an aromatic Nitrogen in only one five membered ring?</span>
2794   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.Ar.RA5.TR1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2795     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2796   <span class="s">}</span>
2797 
2798   <span class="c"># Is it attached to Imidazolium Carbon?</span>
2799   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;C.RA5&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2800     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsImidazoliumCarbon</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2801       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2802     <span class="s">}</span>
2803   <span class="s">}</span>
2804   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2805 <span class="s">}</span>
2806 
2807 <span class="c"># =N= : NITROGEN IN C=N=N OR -N=N=N</span>
2808 <span class="c">#</span>
2809 <span class="c"># Notes:</span>
2810 <span class="c">#    . MayaChemTools assign =N= to all doubly bonded Nitrogen atoms</span>
2811 <span class="c">#      irrespective of whether it has explcit formal charge of +1.</span>
2812 <span class="c">#</span>
<a name="_IsTwoDoublyBondedNitrogen-"></a>2813 <span class="k">sub </span><span class="m">_IsTwoDoublyBondedNitrogen</span> <span class="s">{</span>
2814   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2815 
2816   <span class="k">if</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.DB2&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;N&#39;</span><span class="cm">,</span> <span class="q">&#39;N&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;=&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2817     <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2818   <span class="s">}</span>
2819   <span class="k">if</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.DB2&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;C&#39;</span><span class="cm">,</span> <span class="q">&#39;N&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;=&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2820     <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2821   <span class="s">}</span>
2822   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2823 <span class="s">}</span>
2824 
2825 <span class="c"># NSP : NITROGEN, TRIPLE BONDED</span>
2826 <span class="c">#</span>
<a name="_IsTriplyBondedSPNitrogen-"></a>2827 <span class="k">sub </span><span class="m">_IsTriplyBondedSPNitrogen</span> <span class="s">{</span>
2828   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2829 
2830   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.TB1&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
2831 <span class="s">}</span>
2832 
2833 
2834 <span class="c"># Get MMFF94 atom type for divalent or terminal Oxygen attached to Sulfur...</span>
2835 <span class="c">#</span>
<a name="_GetAtomTypeForOxygenAttachedToSulfur-"></a>2836 <span class="k">sub </span><span class="m">_GetAtomTypeForOxygenAttachedToSulfur</span> <span class="s">{</span>
2837   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2838   <span class="k">my</span><span class="s">(</span><span class="i">$AtomType</span><span class="s">)</span><span class="sc">;</span>
2839 
2840   <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
2841 
2842   <span class="j">ATOMTYPE:</span> <span class="s">{</span>
2843 
2844     <span class="c"># OSMS : TERM O IN THIOSULFINATE ANION - FORMAL CHARGE=-0.5</span>
2845     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsThioSulfinateTerminalOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2846       <span class="i">$AtomType</span> = <span class="q">&#39;OSMS&#39;</span><span class="sc">;</span>
2847       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
2848     <span class="s">}</span>
2849 
2850     <span class="c"># OSO3 : DIVALENT OXYGEN ATTACHED TO SULFUR</span>
2851     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsOSO3DivalentOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2852       <span class="i">$AtomType</span> = <span class="q">&#39;OSO3&#39;</span><span class="sc">;</span>
2853       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
2854     <span class="s">}</span>
2855 
2856     <span class="c"># OSO2 : DIVALENT OXYGEN ATTACHED TO SULFUR</span>
2857     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsOSO2DivalentOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2858       <span class="i">$AtomType</span> = <span class="q">&#39;OSO2&#39;</span><span class="sc">;</span>
2859       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
2860     <span class="s">}</span>
2861 
2862     <span class="c"># OSO : DIVALENT OXYGEN ATTACHED TO SULFUR</span>
2863     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsOSODivalentOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2864       <span class="i">$AtomType</span> = <span class="q">&#39;OSO&#39;</span><span class="sc">;</span>
2865       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
2866     <span class="s">}</span>
2867 
2868     <span class="c"># OS=O : DIVALENT OXYGEN ATTACHED TO SULFOXIDE SULFUR</span>
2869     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsSulfoxideDivalentOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2870       <span class="i">$AtomType</span> = <span class="q">&#39;OS=O&#39;</span><span class="sc">;</span>
2871       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
2872     <span class="s">}</span>
2873 
2874     <span class="c"># -OS : GENERAL DIVALENT OXYGEN ATTACHED TO S</span>
2875     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsOSDivalentOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2876       <span class="i">$AtomType</span> = <span class="q">&#39; -OS&#39;</span><span class="sc">;</span>
2877       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
2878     <span class="s">}</span>
2879 
2880     <span class="c"># O4S : TERMINAL O IN SO4(-3)</span>
2881     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsSulfateTerminalOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2882       <span class="i">$AtomType</span> = <span class="q">&#39;O4S&#39;</span><span class="sc">;</span>
2883       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
2884     <span class="s">}</span>
2885 
2886     <span class="c"># O3S : TERMINAL O IN SULFONATES</span>
2887     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsSulfonateTerminalOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2888       <span class="i">$AtomType</span> = <span class="q">&#39;O3S&#39;</span><span class="sc">;</span>
2889       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
2890     <span class="s">}</span>
2891 
2892     <span class="c"># O2S : TERMINAL O-S IN SULFONES AND SULFONAMIDES</span>
2893     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsSulfoneOrSulfonamideTerminalOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2894       <span class="i">$AtomType</span> = <span class="q">&#39;O2S&#39;</span><span class="sc">;</span>
2895       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
2896     <span class="s">}</span>
2897 
2898     <span class="c"># O=S : O=S IN SULFOXIDES</span>
2899     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsSulfoxideOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2900       <span class="i">$AtomType</span> = <span class="q">&#39;O=S&#39;</span><span class="sc">;</span>
2901       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
2902     <span class="s">}</span>
2903 
2904     <span class="c"># O=S= :  O=S ON SULFUR DOUBLY BONDED TO, E.G., CARBON</span>
2905     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsDoublyBondedOSOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2906       <span class="i">$AtomType</span> = <span class="q">&#39;O=S=&#39;</span><span class="sc">;</span>
2907       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
2908     <span class="s">}</span>
2909 
2910     <span class="c"># O-S : SINGLE TERMINAL OXYGEN ON TETRACOORD SULFUR</span>
2911     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsOSTerminalOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2912       <span class="i">$AtomType</span> = <span class="q">&#39;O-S&#39;</span><span class="sc">;</span>
2913       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
2914     <span class="s">}</span>
2915 
2916     <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
2917     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;_GetAtomTypeForOxygenAttachedToSulfur: MMFF94 atom type for Oxygen cann&#39;t be assigned...&quot;</span><span class="sc">;</span>
2918   <span class="s">}</span>
2919 
2920   <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
2921 <span class="s">}</span>
2922 
2923 <span class="c"># Get MMFF94 atom type for divalent or terminal Oxygen attached to Phosphorus...</span>
2924 <span class="c">#</span>
<a name="_GetAtomTypeForOxygenAttachedToPhosphorus-"></a>2925 <span class="k">sub </span><span class="m">_GetAtomTypeForOxygenAttachedToPhosphorus</span> <span class="s">{</span>
2926   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2927   <span class="k">my</span><span class="s">(</span><span class="i">$AtomType</span><span class="s">)</span><span class="sc">;</span>
2928 
2929   <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
2930 
2931   <span class="j">ATOMTYPE:</span> <span class="s">{</span>
2932 
2933     <span class="c"># OPO3 : DIVALENT OXYGEN ATTACHED TO PHOSPHOROUS</span>
2934     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsOPO3DivalentOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2935       <span class="i">$AtomType</span> = <span class="q">&#39;OPO3&#39;</span><span class="sc">;</span>
2936       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
2937     <span class="s">}</span>
2938 
2939     <span class="c"># OPO2 : DIVALENT OXYGEN ATTACHED TO PHOSPHOROUS</span>
2940     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsOPO2DivalentOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2941       <span class="i">$AtomType</span> = <span class="q">&#39;OPO2&#39;</span><span class="sc">;</span>
2942       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
2943     <span class="s">}</span>
2944 
2945     <span class="c"># OPO : DIVALENT OXYGEN ATTACHED TO PHOSPHOROUS</span>
2946     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsOPODivalentOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2947       <span class="i">$AtomType</span> = <span class="q">&#39;OPO&#39;</span><span class="sc">;</span>
2948       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
2949     <span class="s">}</span>
2950 
2951     <span class="c"># -OP : DIVALENT OXYGEN ATTACHED TO PHOSPHOROUS</span>
2952     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsOPDivalentOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2953       <span class="i">$AtomType</span> = <span class="q">&#39;-OP&#39;</span><span class="sc">;</span>
2954       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
2955     <span class="s">}</span>
2956 
2957     <span class="c"># O4P : TERMINAL OXYGEN IN PHOSPHATES AND PHOSPHODIESTERS</span>
2958     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsPhosphateOrPhosphodiesterTerminalOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2959       <span class="i">$AtomType</span> = <span class="q">&#39;O4P&#39;</span><span class="sc">;</span>
2960       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
2961     <span class="s">}</span>
2962 
2963     <span class="c"># O3P : TERMINAL OXYGEN IN PHOSPHONATES</span>
2964     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsPhosphonateTerminalOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2965       <span class="i">$AtomType</span> = <span class="q">&#39;O3P&#39;</span><span class="sc">;</span>
2966       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
2967     <span class="s">}</span>
2968 
2969     <span class="c"># O2P : TERMINAL O IN PHOSPHINATES</span>
2970     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsPhosphinateTerminalOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2971       <span class="i">$AtomType</span> = <span class="q">&#39;O2P&#39;</span><span class="sc">;</span>
2972       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
2973     <span class="s">}</span>
2974 
2975     <span class="c"># OP : TERMINAL O IN PHOSPHOXIDES</span>
2976     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsPhosphoxideTerminalOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2977       <span class="i">$AtomType</span> = <span class="q">&#39;OP&#39;</span><span class="sc">;</span>
2978       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
2979     <span class="s">}</span>
2980 
2981     <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
2982     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;_GetAtomTypeForOxygenAttachedToPhosphorus: MMFF94 atom type for Oxygen cann&#39;t be assigned...&quot;</span><span class="sc">;</span>
2983   <span class="s">}</span>
2984 
2985   <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
2986 <span class="s">}</span>
2987 
2988 <span class="c"># Get MMFF94 atom type for Oxygen with only sigma bonds...</span>
2989 <span class="c">#</span>
<a name="_GetAtomTypeForOxygenWithOnlySigmaBonds-"></a>2990 <span class="k">sub </span><span class="m">_GetAtomTypeForOxygenWithOnlySigmaBonds</span> <span class="s">{</span>
2991   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2992   <span class="k">my</span><span class="s">(</span><span class="i">$AtomType</span><span class="s">)</span><span class="sc">;</span>
2993 
2994   <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
2995 
2996   <span class="j">ATOMTYPE:</span> <span class="s">{</span>
2997 
2998     <span class="c"># OFUR : AROMATIC OXYGEN AS IN FURAN</span>
2999     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsAromaticOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3000       <span class="i">$AtomType</span> = <span class="q">&#39;OFUR&#39;</span><span class="sc">;</span>
3001       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
3002     <span class="s">}</span>
3003 
3004     <span class="c"># OC=O : ESTER OR CARBOXYLIC ACID -O-</span>
3005     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsEsterOrCarboxylicAcidOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3006       <span class="i">$AtomType</span> = <span class="q">&#39;OC=O&#39;</span><span class="sc">;</span>
3007       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
3008     <span class="s">}</span>
3009 
3010     <span class="c"># O2CM : OXYGEN IN CARBOXYLATE ANION</span>
3011     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsCarboxylateAnionOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3012       <span class="i">$AtomType</span> = <span class="q">&#39;O2CM&#39;</span><span class="sc">;</span>
3013       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
3014     <span class="s">}</span>
3015 
3016     <span class="c"># OC=C : ENOLIC OR PHENOLIC OXYGEN</span>
3017     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsEnolicOrPhenolicOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3018       <span class="i">$AtomType</span> = <span class="q">&#39;OC=C &#39;</span><span class="sc">;</span>
3019       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
3020     <span class="s">}</span>
3021 
3022     <span class="c"># OC=N : DIVALENT OXYGEN</span>
3023     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsOCNDivalentOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3024       <span class="i">$AtomType</span> = <span class="q">&#39;OC=N&#39;</span><span class="sc">;</span>
3025       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
3026     <span class="s">}</span>
3027 
3028     <span class="c"># OC=S : THIOESTER OR THIOACID -O-</span>
3029     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsThioEsterOrThioAcidOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3030       <span class="i">$AtomType</span> = <span class="q">&#39;OC=S&#39;</span><span class="sc">;</span>
3031       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
3032     <span class="s">}</span>
3033 
3034     <span class="c"># ON=O : DIVALENT NITRITE ETHER OXYGEN</span>
3035     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsDivalentNitriteEtherOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3036       <span class="i">$AtomType</span> = <span class="q">&#39;ON=O&#39;</span><span class="sc">;</span>
3037       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
3038     <span class="s">}</span>
3039 
3040     <span class="c"># ONO2 : DIVALENT NITRATE ETHER OXYGEN</span>
3041     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsDivalentNitrateEtherOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3042       <span class="i">$AtomType</span> = <span class="q">&#39;ONO2&#39;</span><span class="sc">;</span>
3043       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
3044     <span class="s">}</span>
3045 
3046     <span class="c"># O3N : NITRATE ANION OXYGEN</span>
3047     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsNitrateAnionOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3048       <span class="i">$AtomType</span> = <span class="q">&#39;O3N&#39;</span><span class="sc">;</span>
3049       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
3050     <span class="s">}</span>
3051 
3052     <span class="c"># O2N : NITRO OXYGEN</span>
3053     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsNitroOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3054       <span class="i">$AtomType</span> = <span class="q">&#39;O2N&#39;</span><span class="sc">;</span>
3055       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
3056     <span class="s">}</span>
3057 
3058     <span class="c"># OXN : N-OXIDE OXYGEN</span>
3059     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsNOxideOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3060       <span class="i">$AtomType</span> = <span class="q">&#39;OXN&#39;</span><span class="sc">;</span>
3061       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
3062     <span class="s">}</span>
3063 
3064     <span class="c"># OM2 : OXIDE OXYGEN ON SP2 CARBON, NEGATIVELY CHARGED</span>
3065     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsNegativelyChargedSP2OxideOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3066       <span class="i">$AtomType</span> = <span class="q">&#39;OM2&#39;</span><span class="sc">;</span>
3067       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
3068     <span class="s">}</span>
3069 
3070     <span class="c"># OM : ALKOXIDE OXYGEN, NEGATIVELY CHARGED</span>
3071     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsNegativelyChargedAlkoxideOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3072       <span class="i">$AtomType</span> = <span class="q">&#39;OM&#39;</span><span class="sc">;</span>
3073       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
3074     <span class="s">}</span>
3075 
3076     <span class="c"># O4CL : OXYGEN IN CLO4(-) ANION - FORMAL CHARGE=-0.25</span>
3077     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsPerChlorateAnionOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3078       <span class="i">$AtomType</span> = <span class="q">&#39;O4CL&#39;</span><span class="sc">;</span>
3079       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
3080     <span class="s">}</span>
3081 
3082     <span class="c"># O+ : POSITIVELY CHARGED OXONIUM (TRICOORDINATE) OXYGEN</span>
3083     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsPositivelyChargedOxoniumOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3084       <span class="i">$AtomType</span> = <span class="q">&#39;O+&#39;</span><span class="sc">;</span>
3085       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
3086     <span class="s">}</span>
3087 
3088     <span class="c"># OH2 : OXYGEN ON WATER</span>
3089     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsWaterOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3090       <span class="i">$AtomType</span> = <span class="q">&#39;OH2&#39;</span><span class="sc">;</span>
3091       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
3092     <span class="s">}</span>
3093 
3094     <span class="c"># OR : ALCOHOL OR ETHER OXYGEN</span>
3095     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsAlcoholOrEtherOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3096       <span class="i">$AtomType</span> = <span class="q">&#39;OR&#39;</span><span class="sc">;</span>
3097       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
3098     <span class="s">}</span>
3099 
3100     <span class="c"># GENERAL DIVALENT O</span>
3101     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsDivalentOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3102       <span class="i">$AtomType</span> = <span class="q">&#39;-O-&#39;</span><span class="sc">;</span>
3103       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
3104     <span class="s">}</span>
3105 
3106     <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
3107     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;_GetAtomTypeForOxygenWithOnlySigmaBonds: MMFF94 atom type for Oxygen cann&#39;t be assigned...&quot;</span><span class="sc">;</span>
3108   <span class="s">}</span>
3109 
3110   <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
3111 <span class="s">}</span>
3112 
3113 <span class="c"># Get MMFF94 atom type for Oxygen with only sigma bonds...</span>
3114 <span class="c">#</span>
<a name="_GetAtomTypeForOxygenWithOnePiBond-"></a>3115 <span class="k">sub </span><span class="m">_GetAtomTypeForOxygenWithOnePiBond</span> <span class="s">{</span>
3116   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3117   <span class="k">my</span><span class="s">(</span><span class="i">$AtomType</span><span class="s">)</span><span class="sc">;</span>
3118 
3119   <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
3120 
3121   <span class="j">ATOMTYPE:</span> <span class="s">{</span>
3122 
3123     <span class="c"># OFUR : AROMATIC OXYGEN AS IN FURAN</span>
3124     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsAromaticOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3125       <span class="i">$AtomType</span> = <span class="q">&#39;OFUR&#39;</span><span class="sc">;</span>
3126       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
3127     <span class="s">}</span>
3128 
3129     <span class="c"># O=+ : POSITIVELY CHARGED OXENIUM (DICOORDINATE) OXYGEN</span>
3130     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsPositivelyChargedOxeniumOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3131       <span class="i">$AtomType</span> = <span class="q">&#39;O=+&#39;</span><span class="sc">;</span>
3132       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
3133     <span class="s">}</span>
3134 
3135     <span class="c"># O=CN : CARBONYL OXYGEN, AMIDES</span>
3136     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsAmideCarbonylOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3137       <span class="i">$AtomType</span> = <span class="q">&#39;O=CN&#39;</span><span class="sc">;</span>
3138       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
3139     <span class="s">}</span>
3140 
3141     <span class="c"># O=CO : CARBONYL OXYGEN, CARBOXYLIC ACIDS AND ESTERS</span>
3142     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsCarbobylCarboxylicAcidsOrEstersOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3143       <span class="i">$AtomType</span> = <span class="q">&#39;O=CO&#39;</span><span class="sc">;</span>
3144       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
3145     <span class="s">}</span>
3146 
3147     <span class="c"># O=CR : CARBONYL OXYGEN, ALDEHYDES AND KETONES</span>
3148     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsCarbonylAldehydeOrKetoneOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3149       <span class="i">$AtomType</span> = <span class="q">&#39;O=CR&#39;</span><span class="sc">;</span>
3150       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
3151     <span class="s">}</span>
3152 
3153     <span class="c"># O=C : GENERAL C=O</span>
3154     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsCarbonylOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3155       <span class="i">$AtomType</span> = <span class="q">&#39;O=C&#39;</span><span class="sc">;</span>
3156       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
3157     <span class="s">}</span>
3158 
3159     <span class="c"># O2NO : NITRO-GROUP OXYGEN IN NITRATE</span>
3160     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsNitroGroupNitrateOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3161       <span class="i">$AtomType</span> = <span class="q">&#39;O2NO&#39;</span><span class="sc">;</span>
3162       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
3163     <span class="s">}</span>
3164 
3165     <span class="c"># O2N : NITRO OXYGEN</span>
3166     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsNitroOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3167       <span class="i">$AtomType</span> = <span class="q">&#39;O2N&#39;</span><span class="sc">;</span>
3168       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
3169     <span class="s">}</span>
3170 
3171     <span class="c"># O=N : NITROSO OXYGEN</span>
3172     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsNitrosoOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3173       <span class="i">$AtomType</span> = <span class="q">&#39;O=N&#39;</span><span class="sc">;</span>
3174       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
3175     <span class="s">}</span>
3176 
3177     <span class="c"># O4CL : OXYGEN IN CLO4(-) ANION - FORMAL CHARGE=-0.25</span>
3178     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsPerChlorateAnionOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3179       <span class="i">$AtomType</span> = <span class="q">&#39;O4CL&#39;</span><span class="sc">;</span>
3180       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
3181     <span class="s">}</span>
3182 
3183     <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
3184     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;_GetAtomTypeForOxygenWithOnePiBond: MMFF94 atom type for Oxygen cann&#39;t be assigned...&quot;</span><span class="sc">;</span>
3185   <span class="s">}</span>
3186 
3187   <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
3188 <span class="s">}</span>
3189 
3190 <span class="c"># OR : ALCOHOL OR ETHER OXYGEN</span>
3191 <span class="c">#</span>
<a name="_IsAlcoholOrEtherOxygen-"></a>3192 <span class="k">sub </span><span class="m">_IsAlcoholOrEtherOxygen</span> <span class="s">{</span>
3193   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3194 
3195   <span class="k">return</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsAlcoholOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span> || <span class="i">$This</span><span class="i">-&gt;_IsEtherOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
3196 <span class="s">}</span>
3197 
3198 <span class="c"># Alcohol Oxygen..</span>
3199 <span class="c">#</span>
<a name="_IsAlcoholOxygen-"></a>3200 <span class="k">sub </span><span class="m">_IsAlcoholOxygen</span> <span class="s">{</span>
3201   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3202 
3203   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.TSB2&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;C&#39;</span><span class="cm">,</span> <span class="q">&#39;H&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
3204 <span class="s">}</span>
3205 
3206 <span class="c"># Ether Oxygen..</span>
3207 <span class="c">#</span>
<a name="_IsEtherOxygen-"></a>3208 <span class="k">sub </span><span class="m">_IsEtherOxygen</span> <span class="s">{</span>
3209   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3210 
3211   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.TSB2&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;C&#39;</span><span class="cm">,</span> <span class="q">&#39;C&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
3212 <span class="s">}</span>
3213 
3214 
3215 <span class="c"># OC=O : ESTER OR CARBOXYLIC ACID -O-</span>
3216 <span class="c">#</span>
3217 <span class="c"># Notes:</span>
3218 <span class="c">#    . Carboxylate anion Oxygen is matched using O2CM atom type.</span>
3219 <span class="c">#</span>
<a name="_IsEsterOrCarboxylicAcidOxygen-"></a>3220 <span class="k">sub </span><span class="m">_IsEsterOrCarboxylicAcidOxygen</span> <span class="s">{</span>
3221   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3222   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
3223 
3224   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.TSB2&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3225     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3226   <span class="s">}</span>
3227 
3228   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;C.DB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3229     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsCarboxylicAcidOrEsterCarbonylCarbon</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3230       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3231     <span class="s">}</span>
3232   <span class="s">}</span>
3233   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3234 <span class="s">}</span>
3235 
3236 <span class="c"># OC=C : ENOLIC OR PHENOLIC OXYGEN</span>
3237 <span class="c">#</span>
<a name="_IsEnolicOrPhenolicOxygen-"></a>3238 <span class="k">sub </span><span class="m">_IsEnolicOrPhenolicOxygen</span> <span class="s">{</span>
3239   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3240   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
3241 
3242   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.TSB2&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3243     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3244   <span class="s">}</span>
3245 
3246   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;C.DB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3247     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomNeighbor</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.T3.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;C&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3248       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3249     <span class="s">}</span>
3250   <span class="s">}</span>
3251   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3252 <span class="s">}</span>
3253 
3254 <span class="c"># OC=N : DIVALENT OXYGEN</span>
3255 <span class="c">#</span>
<a name="_IsOCNDivalentOxygen-"></a>3256 <span class="k">sub </span><span class="m">_IsOCNDivalentOxygen</span> <span class="s">{</span>
3257   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3258   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
3259 
3260   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.TSB2&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3261     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3262   <span class="s">}</span>
3263 
3264   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;C.DB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3265     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomNeighbor</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.T3.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;N&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3266       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3267     <span class="s">}</span>
3268   <span class="s">}</span>
3269   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3270 <span class="s">}</span>
3271 
3272 <span class="c"># OC=S : THIOESTER OR THIOACID -O-</span>
3273 <span class="c">#</span>
<a name="_IsThioEsterOrThioAcidOxygen-"></a>3274 <span class="k">sub </span><span class="m">_IsThioEsterOrThioAcidOxygen</span> <span class="s">{</span>
3275   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3276   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
3277 
3278   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.TSB2,O.X1.FC-1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3279     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3280   <span class="s">}</span>
3281 
3282   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;C.DB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3283     <span class="c"># Thio ester, acid or anion Oxygen...</span>
3284     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomNeighbor</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.T3.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;S&#39;</span><span class="cm">,</span> <span class="q">&#39;O.X1.FC0,O.X2,O.X1.FC-1&#39;</span><span class="cm">,</span> <span class="q">&#39;C,H&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;C&#39;</span><span class="cm">,</span> <span class="q">&#39;C,H&#39;</span><span class="cm">,</span> <span class="q">&#39;C,H&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3285       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3286     <span class="s">}</span>
3287   <span class="s">}</span>
3288   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3289 <span class="s">}</span>
3290 
3291 <span class="c"># ONO2 : DIVALENT NITRATE ETHER OXYGEN</span>
3292 <span class="c">#</span>
3293 <span class="c"># Notes:</span>
3294 <span class="c">#    . Nitrate anion Oxygen is matched using O3N atom type.</span>
3295 <span class="c">#    . Divalent Oxygen in Nitrate with one Hydrogen atom is not treated as ether ONO2.</span>
3296 <span class="c">#</span>
<a name="_IsDivalentNitrateEtherOxygen-"></a>3297 <span class="k">sub </span><span class="m">_IsDivalentNitrateEtherOxygen</span> <span class="s">{</span>
3298   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3299   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
3300 
3301   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.X2&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3302     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3303   <span class="s">}</span>
3304 
3305   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;N.DB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3306     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsNitrateNitrogen</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3307       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3308     <span class="s">}</span>
3309   <span class="s">}</span>
3310   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3311 <span class="s">}</span>
3312 
3313 <span class="c"># ON=O : DIVALENT NITRITE ETHER OXYGEN</span>
3314 <span class="c">#</span>
3315 <span class="c"># Notes:</span>
3316 <span class="c">#    . Divalent Oxygen in Nitrite with one Hydrogen atom is not treated as ether ON=O.</span>
3317 <span class="c">#</span>
<a name="_IsDivalentNitriteEtherOxygen-"></a>3318 <span class="k">sub </span><span class="m">_IsDivalentNitriteEtherOxygen</span> <span class="s">{</span>
3319   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3320   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
3321 
3322   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.X2&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3323     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3324   <span class="s">}</span>
3325 
3326   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;N.DB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3327     <span class="c"># R-O-N=O</span>
3328     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomNeighbor</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.T2.DB1.FC0&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;O.FC0&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3329       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3330     <span class="s">}</span>
3331   <span class="s">}</span>
3332   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3333 <span class="s">}</span>
3334 
3335 <span class="c"># OSO3 : DIVALENT OXYGEN ATTACHED TO SULFUR</span>
3336 <span class="c">#</span>
3337 <span class="c"># Notes:</span>
3338 <span class="c">#    . It corresponds to divalent Oxygen in Sulfates.</span>
3339 <span class="c">#    . Oxygen attached to one heavy atom and one Hydrogen atom is treated as divalent</span>
3340 <span class="c">#      Oxygen and matched to OSO3.</span>
3341 <span class="c">#    . Anion Oxygen attached to one heavy atom with no Hydrogen atom is treated as terminal</span>
3342 <span class="c">#      Oxygen and matched to O4S.</span>
3343 <span class="c">#</span>
<a name="_IsOSO3DivalentOxygen-"></a>3344 <span class="k">sub </span><span class="m">_IsOSO3DivalentOxygen</span> <span class="s">{</span>
3345   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3346   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
3347 
3348   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.TSB2&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;S.T4&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3349     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3350   <span class="s">}</span>
3351 
3352   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;S.T4&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3353     <span class="c"># R&#39;-O-S(=O)(=O)-O-R&quot;</span>
3354     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsSulfateSulfur</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3355       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3356     <span class="s">}</span>
3357   <span class="s">}</span>
3358   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3359 <span class="s">}</span>
3360 
3361 <span class="c"># OSO2 : DIVALENT OXYGEN ATTACHED TO SULFUR</span>
3362 <span class="c">#</span>
3363 <span class="c"># Notes:</span>
3364 <span class="c">#    . It corresponds to divalent Oxygen in Sulfonates, Sulfones and so on.</span>
3365 <span class="c">#    . Oxygen attached to one heavy atom and one Hydrogen atom is treated as divalent</span>
3366 <span class="c">#      Oxygen and matched to OSO2.</span>
3367 <span class="c">#    . Anion Oxygen attached to one heavy atom with no Hydrogen atom is treated as terminal</span>
3368 <span class="c">#      Oxygen and matched to O3S.</span>
3369 <span class="c">#</span>
<a name="_IsOSO2DivalentOxygen-"></a>3370 <span class="k">sub </span><span class="m">_IsOSO2DivalentOxygen</span> <span class="s">{</span>
3371   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3372   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
3373 
3374   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.TSB2&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;S.T4&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3375     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3376   <span class="s">}</span>
3377 
3378   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;S.T4&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3379     <span class="c"># R&#39;-O-S(=O)(=O)-R&quot;</span>
3380     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsSulfonateSulfur</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3381       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3382     <span class="s">}</span>
3383   <span class="s">}</span>
3384   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3385 <span class="s">}</span>
3386 
3387 <span class="c"># OSO : DIVALENT OXYGEN ATTACHED TO SULFUR</span>
3388 <span class="c">#</span>
3389 <span class="c"># Notes:</span>
3390 <span class="c">#    . It corresponds to divalent Oxygen attached to Sulfur with single bond.</span>
3391 <span class="c">#    . Oxygen attached to one heavy atom and one Hydrogen atom is treated as divalent</span>
3392 <span class="c">#      Oxygen and matched to OSO.</span>
3393 <span class="c">#</span>
<a name="_IsOSODivalentOxygen-"></a>3394 <span class="k">sub </span><span class="m">_IsOSODivalentOxygen</span> <span class="s">{</span>
3395   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3396   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
3397 
3398   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.TSB2&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;S.T2&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3399     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3400   <span class="s">}</span>
3401 
3402   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;S.T2.DB0&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3403     <span class="c"># R&#39;-O-S-O-R&quot;</span>
3404     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomNeighbor</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;S&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3405       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3406     <span class="s">}</span>
3407   <span class="s">}</span>
3408   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3409 <span class="s">}</span>
3410 
3411 <span class="c"># OS=O : DIVALENT OXYGEN ATTACHED TO SULFOXIDE SULFUR</span>
3412 <span class="c">#</span>
3413 <span class="c"># Notes:</span>
3414 <span class="c">#    . It corresponds to divalent Oxygen in Sulfoxides.</span>
3415 <span class="c">#    . Oxygen attached to one heavy atom and one Hydrogen atom is treated as divalent</span>
3416 <span class="c">#      Oxygen and matched to OS=O.</span>
3417 <span class="c">#</span>
<a name="_IsSulfoxideDivalentOxygen-"></a>3418 <span class="k">sub </span><span class="m">_IsSulfoxideDivalentOxygen</span> <span class="s">{</span>
3419   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3420   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
3421 
3422   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.TSB2&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;S.T3&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3423     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3424   <span class="s">}</span>
3425 
3426   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;S.T3.DB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3427     <span class="c"># R&#39;-O-S(=O)-R&quot;</span>
3428     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomNeighbor</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;S.T3.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3429       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3430     <span class="s">}</span>
3431   <span class="s">}</span>
3432   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3433 <span class="s">}</span>
3434 
3435 <span class="c"># -OS : GENERAL DIVALENT OXYGEN ATTACHED TO S</span>
3436 <span class="c">#</span>
3437 <span class="c"># Notes:</span>
3438 <span class="c">#    . It covers any divalent Oxygen attached to Sulfur.</span>
3439 <span class="c">#</span>
<a name="_IsOSDivalentOxygen-"></a>3440 <span class="k">sub </span><span class="m">_IsOSDivalentOxygen</span> <span class="s">{</span>
3441   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3442   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
3443 
3444   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.TSB2&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;S&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3445     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3446   <span class="s">}</span>
3447 
3448   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;S&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3449     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomNeighbor</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;S&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3450       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3451     <span class="s">}</span>
3452   <span class="s">}</span>
3453   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3454 <span class="s">}</span>
3455 
3456 <span class="c"># OPO3 : DIVALENT OXYGEN ATTACHED TO PHOSPHOROUS</span>
3457 <span class="c">#</span>
3458 <span class="c"># Notes:</span>
3459 <span class="c">#    . It corresponds to divalent Oxygen in Phopsphates or Phosphodiesters.</span>
3460 <span class="c">#</span>
<a name="_IsOPO3DivalentOxygen-"></a>3461 <span class="k">sub </span><span class="m">_IsOPO3DivalentOxygen</span> <span class="s">{</span>
3462   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3463   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
3464 
3465   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.TSB2&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3466     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3467   <span class="s">}</span>
3468 
3469   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;P.T4&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3470     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsPhosphateOrPhosphodiesterPhosphorus</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3471       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3472     <span class="s">}</span>
3473   <span class="s">}</span>
3474   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3475 <span class="s">}</span>
3476 
3477 <span class="c"># OPO2 : DIVALENT OXYGEN ATTACHED TO PHOSPHOROUS</span>
3478 <span class="c">#</span>
3479 <span class="c"># Notes:</span>
3480 <span class="c">#    . It corresponds to divalent Oxygen in Phopsphonates or their esters.</span>
3481 <span class="c">#</span>
<a name="_IsOPO2DivalentOxygen-"></a>3482 <span class="k">sub </span><span class="m">_IsOPO2DivalentOxygen</span> <span class="s">{</span>
3483   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3484   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
3485 
3486   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.TSB2&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3487     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3488   <span class="s">}</span>
3489 
3490   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;P.T4&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3491     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsPhosphonatePhosphorus</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3492       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3493     <span class="s">}</span>
3494   <span class="s">}</span>
3495   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3496 <span class="s">}</span>
3497 
3498 <span class="c"># OPO : DIVALENT OXYGEN ATTACHED TO PHOSPHOROUS</span>
3499 <span class="c">#</span>
3500 <span class="c"># Notes:</span>
3501 <span class="c">#    . It corresponds to divalent Oxygen in Phopsphinates.</span>
3502 <span class="c">#</span>
<a name="_IsOPODivalentOxygen-"></a>3503 <span class="k">sub </span><span class="m">_IsOPODivalentOxygen</span> <span class="s">{</span>
3504   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3505   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
3506 
3507   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.TSB2&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3508     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3509   <span class="s">}</span>
3510 
3511   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;P.T4&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3512     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsPhosphinatePhosphorus</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3513       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3514     <span class="s">}</span>
3515   <span class="s">}</span>
3516   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3517 <span class="s">}</span>
3518 
3519 <span class="c"># -OP : DIVALENT OXYGEN ATTACHED TO PHOSPHOROUS</span>
3520 <span class="c">#</span>
<a name="_IsOPDivalentOxygen-"></a>3521 <span class="k">sub </span><span class="m">_IsOPDivalentOxygen</span> <span class="s">{</span>
3522   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3523   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
3524 
3525   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.TSB2&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3526     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3527   <span class="s">}</span>
3528 
3529   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;P&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3530     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomNeighbor</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;P&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3531       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3532     <span class="s">}</span>
3533   <span class="s">}</span>
3534   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3535 <span class="s">}</span>
3536 
3537 <span class="c"># -O- : GENERAL DIVALENT O</span>
3538 <span class="c">#</span>
<a name="_IsDivalentOxygen-"></a>3539 <span class="k">sub </span><span class="m">_IsDivalentOxygen</span> <span class="s">{</span>
3540   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3541 
3542   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.TSB2&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
3543 <span class="s">}</span>
3544 
3545 <span class="c"># O=C : GENERAL C=O</span>
3546 <span class="c">#</span>
<a name="_IsCarbonylOxygen-"></a>3547 <span class="k">sub </span><span class="m">_IsCarbonylOxygen</span> <span class="s">{</span>
3548   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3549 
3550   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.T1.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;C&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
3551 <span class="s">}</span>
3552 
3553 <span class="c"># O=CN : CARBONYL OXYGEN, AMIDES</span>
3554 <span class="c">#</span>
<a name="_IsAmideCarbonylOxygen-"></a>3555 <span class="k">sub </span><span class="m">_IsAmideCarbonylOxygen</span> <span class="s">{</span>
3556   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3557   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
3558 
3559   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.T1.DB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3560     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3561   <span class="s">}</span>
3562 
3563   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;C.DB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3564     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsAmideCarbonylCarbon</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3565       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3566     <span class="s">}</span>
3567   <span class="s">}</span>
3568   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3569 <span class="s">}</span>
3570 
3571 <span class="c"># O=CR : CARBONYL OXYGEN, ALDEHYDES AND KETONES</span>
3572 <span class="c">#</span>
<a name="_IsCarbonylAldehydeOrKetoneOxygen-"></a>3573 <span class="k">sub </span><span class="m">_IsCarbonylAldehydeOrKetoneOxygen</span> <span class="s">{</span>
3574   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3575   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
3576 
3577   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.T1.DB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3578     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3579   <span class="s">}</span>
3580 
3581   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;C.DB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3582     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsKetoneOrAldehydeCarbonylCarbon</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3583       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3584     <span class="s">}</span>
3585   <span class="s">}</span>
3586   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3587 <span class="s">}</span>
3588 
3589 <span class="c"># O=CO : CARBONYL OXYGEN, CARBOXYLIC ACIDS AND ESTERS</span>
3590 <span class="c">#</span>
<a name="_IsCarbobylCarboxylicAcidsOrEstersOxygen-"></a>3591 <span class="k">sub </span><span class="m">_IsCarbobylCarboxylicAcidsOrEstersOxygen</span> <span class="s">{</span>
3592   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3593   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
3594 
3595   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.T1.DB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3596     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3597   <span class="s">}</span>
3598 
3599   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;C.DB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3600     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsCarboxylicAcidOrEsterCarbonylCarbon</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3601       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3602     <span class="s">}</span>
3603   <span class="s">}</span>
3604   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3605 <span class="s">}</span>
3606 
3607 <span class="c"># O=N : NITROSO OXYGEN</span>
3608 <span class="c">#</span>
<a name="_IsNitrosoOxygen-"></a>3609 <span class="k">sub </span><span class="m">_IsNitrosoOxygen</span> <span class="s">{</span>
3610   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3611 
3612   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.T1.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;N&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
3613 <span class="s">}</span>
3614 
3615 <span class="c"># O=S : O=S IN SULFOXIDES</span>
3616 <span class="c">#</span>
<a name="_IsSulfoxideOxygen-"></a>3617 <span class="k">sub </span><span class="m">_IsSulfoxideOxygen</span> <span class="s">{</span>
3618   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3619   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
3620 
3621   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.T1.DB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3622     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3623   <span class="s">}</span>
3624 
3625   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;S.DB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3626     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsSulfoxideSulfur</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3627       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3628     <span class="s">}</span>
3629   <span class="s">}</span>
3630   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3631 <span class="s">}</span>
3632 
3633 <span class="c"># O=S= :  O=S ON SULFUR DOUBLY BONDED TO, E.G., CARBON</span>
3634 <span class="c">#</span>
<a name="_IsDoublyBondedOSOxygen-"></a>3635 <span class="k">sub </span><span class="m">_IsDoublyBondedOSOxygen</span> <span class="s">{</span>
3636   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3637   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
3638 
3639   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.T1.DB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3640     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3641   <span class="s">}</span>
3642 
3643   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;S.DB2&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3644     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomNeighbor</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;S&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;!O&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;=&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3645       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3646     <span class="s">}</span>
3647   <span class="s">}</span>
3648   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3649 <span class="s">}</span>
3650 
3651 <span class="c"># O2CM : OXYGEN IN CARBOXYLATE ANION</span>
3652 <span class="c">#</span>
<a name="_IsCarboxylateAnionOxygen-"></a>3653 <span class="k">sub </span><span class="m">_IsCarboxylateAnionOxygen</span> <span class="s">{</span>
3654   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3655   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
3656 
3657   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.X1.FC-1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3658     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3659   <span class="s">}</span>
3660 
3661   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;C.T3.DB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3662     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsCarboxylateAnionCarbon</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3663       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3664     <span class="s">}</span>
3665   <span class="s">}</span>
3666   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3667 <span class="s">}</span>
3668 
3669 <span class="c"># OXN : N-OXIDE OXYGEN</span>
3670 <span class="c">#</span>
<a name="_IsNOxideOxygen-"></a>3671 <span class="k">sub </span><span class="m">_IsNOxideOxygen</span> <span class="s">{</span>
3672   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3673 
3674   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.X1.FC-1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;N.FC+1&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
3675 <span class="s">}</span>
3676 
3677 <span class="c"># O2N : NITRO OXYGEN</span>
3678 <span class="c">#</span>
<a name="_IsNitroOxygen-"></a>3679 <span class="k">sub </span><span class="m">_IsNitroOxygen</span> <span class="s">{</span>
3680   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3681   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
3682 
3683   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.X1.DB1,O.X1.FC-1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3684     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3685   <span class="s">}</span>
3686 
3687   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;N.T3.DB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3688     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsNitroNitrogen</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3689       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3690     <span class="s">}</span>
3691   <span class="s">}</span>
3692   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3693 <span class="s">}</span>
3694 
3695 <span class="c"># O2NO : NITRO-GROUP OXYGEN IN NITRATE</span>
3696 <span class="c">#</span>
<a name="_IsNitroGroupNitrateOxygen-"></a>3697 <span class="k">sub </span><span class="m">_IsNitroGroupNitrateOxygen</span> <span class="s">{</span>
3698   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3699   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
3700 
3701   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.X1.DB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3702     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3703   <span class="s">}</span>
3704 
3705   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;N.T3.DB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3706     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsNitrateNitrogen</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3707       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3708     <span class="s">}</span>
3709   <span class="s">}</span>
3710   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3711 <span class="s">}</span>
3712 
3713 <span class="c"># O3N : NITRATE ANION OXYGEN</span>
3714 <span class="c">#</span>
<a name="_IsNitrateAnionOxygen-"></a>3715 <span class="k">sub </span><span class="m">_IsNitrateAnionOxygen</span> <span class="s">{</span>
3716   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3717   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
3718 
3719   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.X1.FC-1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3720     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3721   <span class="s">}</span>
3722 
3723   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;N.T3.DB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3724     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsNitrateNitrogen</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3725       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3726     <span class="s">}</span>
3727   <span class="s">}</span>
3728   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3729 <span class="s">}</span>
3730 
3731 <span class="c"># O-S : SINGLE TERMINAL OXYGEN ON TETRACOORD SULFUR</span>
3732 <span class="c">#</span>
<a name="_IsOSTerminalOxygen-"></a>3733 <span class="k">sub </span><span class="m">_IsOSTerminalOxygen</span> <span class="s">{</span>
3734   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3735   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
3736 
3737   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.X1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;S.T4&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3738     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3739   <span class="s">}</span>
3740 
3741   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;S.T4&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3742     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomNeighbor</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;S&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O.X1&#39;</span><span class="cm">,</span> <span class="q">&#39;!O&#39;</span><span class="cm">,</span> <span class="q">&#39;!O&#39;</span><span class="cm">,</span> <span class="q">&#39;!O&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3743       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3744     <span class="s">}</span>
3745   <span class="s">}</span>
3746   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3747 <span class="s">}</span>
3748 
3749 <span class="c"># O2S : TERMINAL O-S IN SULFONES AND SULFONAMIDES</span>
3750 <span class="c">#</span>
<a name="_IsSulfoneOrSulfonamideTerminalOxygen-"></a>3751 <span class="k">sub </span><span class="m">_IsSulfoneOrSulfonamideTerminalOxygen</span> <span class="s">{</span>
3752   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3753   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
3754 
3755   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.X1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;S.T4&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3756     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3757   <span class="s">}</span>
3758 
3759   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;S.T4&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3760     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsSulfonamideSulfur</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span> || <span class="i">$This</span><span class="i">-&gt;_IsSulfoneSulfur</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3761       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3762     <span class="s">}</span>
3763   <span class="s">}</span>
3764   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3765 <span class="s">}</span>
3766 
3767 <span class="c"># O3S : TERMINAL O IN SULFONATES</span>
3768 <span class="c">#</span>
3769 <span class="c"># Notes:</span>
3770 <span class="c">#    . It corresponds to monovalent Oxygen in Sulfonates.</span>
3771 <span class="c">#    . Anion Oxygen attached to one heavy atom with no Hydrogen atom is treated as terminal</span>
3772 <span class="c">#      Oxygen and matched to O3S.</span>
3773 <span class="c">#</span>
<a name="_IsSulfonateTerminalOxygen-"></a>3774 <span class="k">sub </span><span class="m">_IsSulfonateTerminalOxygen</span> <span class="s">{</span>
3775   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3776   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
3777 
3778   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.X1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;S.T4&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3779     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3780   <span class="s">}</span>
3781 
3782   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;S.T4&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3783     <span class="c"># R&#39;-O-S(=O)(=O)-R&quot;, [O-]-S(=O)(=O)-R&quot;,</span>
3784     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsSulfonateSulfur</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3785       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3786     <span class="s">}</span>
3787   <span class="s">}</span>
3788   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3789 <span class="s">}</span>
3790 
3791 <span class="c"># O4S : TERMINAL O IN SO4(-3)</span>
3792 <span class="c">#</span>
3793 <span class="c"># Notes:</span>
3794 <span class="c">#    . It corresponds to monovalent Oxygen in Sulfates.</span>
3795 <span class="c">#    . As far I can tell, SO4 should have a formal charge of -2.</span>
3796 <span class="c">#    . Anion Oxygen attached to one heavy atom with no Hydrogen atom is treated as terminal</span>
3797 <span class="c">#      Oxygen and matched to O4S.</span>
3798 <span class="c">#</span>
<a name="_IsSulfateTerminalOxygen-"></a>3799 <span class="k">sub </span><span class="m">_IsSulfateTerminalOxygen</span> <span class="s">{</span>
3800   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3801   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
3802 
3803   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.X1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;S.T4&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3804     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3805   <span class="s">}</span>
3806 
3807   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;S.T4&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3808     <span class="c"># R&#39;-O-S(=O)(=O)-O-R&quot;, R&#39;-O-S(=O)(=O)-[O-]</span>
3809     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsSulfateSulfur</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3810       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3811     <span class="s">}</span>
3812   <span class="s">}</span>
3813   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3814 <span class="s">}</span>
3815 
3816 <span class="c"># OSMS : TERM O IN THIOSULFINATE ANION - FORMAL CHARGE=-0.5</span>
3817 <span class="c">#</span>
<a name="_IsThioSulfinateTerminalOxygen-"></a>3818 <span class="k">sub </span><span class="m">_IsThioSulfinateTerminalOxygen</span> <span class="s">{</span>
3819   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3820   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
3821 
3822   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.X1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;S.FC+1&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3823     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3824   <span class="s">}</span>
3825 
3826   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;S.FC+1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3827     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsThioSulfinateSulfur</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3828       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3829     <span class="s">}</span>
3830   <span class="s">}</span>
3831   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3832 <span class="s">}</span>
3833 
3834 <span class="c"># OP : TERMINAL O IN PHOSPHOXIDES</span>
3835 <span class="c">#</span>
<a name="_IsPhosphoxideTerminalOxygen-"></a>3836 <span class="k">sub </span><span class="m">_IsPhosphoxideTerminalOxygen</span> <span class="s">{</span>
3837   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3838   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
3839 
3840   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.X1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;P.T4&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3841     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3842   <span class="s">}</span>
3843 
3844   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;P.T4&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3845     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsPhosphoxidePhosphorus</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3846       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3847     <span class="s">}</span>
3848   <span class="s">}</span>
3849   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3850 <span class="s">}</span>
3851 
3852 <span class="c"># O2P : TERMINAL O IN PHOSPHINATES</span>
3853 <span class="c">#</span>
<a name="_IsPhosphinateTerminalOxygen-"></a>3854 <span class="k">sub </span><span class="m">_IsPhosphinateTerminalOxygen</span> <span class="s">{</span>
3855   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3856   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
3857 
3858   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.X1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;P.T4&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3859     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3860   <span class="s">}</span>
3861 
3862   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;P.T4&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3863     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsPhosphinatePhosphorus</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3864       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3865     <span class="s">}</span>
3866   <span class="s">}</span>
3867   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3868 <span class="s">}</span>
3869 
3870 <span class="c"># O3P : TERMINAL OXYGEN IN PHOSPHONATES</span>
3871 <span class="c">#</span>
<a name="_IsPhosphonateTerminalOxygen-"></a>3872 <span class="k">sub </span><span class="m">_IsPhosphonateTerminalOxygen</span> <span class="s">{</span>
3873   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3874   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
3875 
3876   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.X1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;P.T4&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3877     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3878   <span class="s">}</span>
3879 
3880   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;P.T4&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3881     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsPhosphonatePhosphorus</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3882       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3883     <span class="s">}</span>
3884   <span class="s">}</span>
3885   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3886 <span class="s">}</span>
3887 
3888 <span class="c"># O4P : TERMINAL OXYGEN IN PHOSPHATES AND PHOSPHODIESTERS</span>
3889 <span class="c">#</span>
<a name="_IsPhosphateOrPhosphodiesterTerminalOxygen-"></a>3890 <span class="k">sub </span><span class="m">_IsPhosphateOrPhosphodiesterTerminalOxygen</span> <span class="s">{</span>
3891   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3892   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
3893 
3894   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.X1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;P.T4&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3895     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3896   <span class="s">}</span>
3897 
3898   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;P.T4&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3899     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsPhosphateOrPhosphodiesterPhosphorus</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3900       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3901     <span class="s">}</span>
3902   <span class="s">}</span>
3903   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3904 <span class="s">}</span>
3905 
3906 <span class="c"># O4CL : OXYGEN IN CLO4(-) ANION - FORMAL CHARGE=-0.25</span>
3907 <span class="c">#</span>
<a name="_IsPerChlorateAnionOxygen-"></a>3908 <span class="k">sub </span><span class="m">_IsPerChlorateAnionOxygen</span> <span class="s">{</span>
3909   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3910   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
3911 
3912   <span class="c"># All Oxygens in PerChlorate anion and ester are matched to O4Cl...</span>
3913   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;Cl&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3914     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3915   <span class="s">}</span>
3916 
3917   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;Cl&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3918     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsPerChlorateAnionChlorine</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3919       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3920     <span class="s">}</span>
3921   <span class="s">}</span>
3922   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3923 <span class="s">}</span>
3924 
3925 <span class="c"># OM : ALKOXIDE OXYGEN, NEGATIVELY CHARGED</span>
3926 <span class="c">#</span>
<a name="_IsNegativelyChargedAlkoxideOxygen-"></a>3927 <span class="k">sub </span><span class="m">_IsNegativelyChargedAlkoxideOxygen</span> <span class="s">{</span>
3928   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3929 
3930   <span class="c"># R-(O-)</span>
3931 
3932   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.FC-1.T1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;C,H&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
3933 <span class="s">}</span>
3934 
3935 <span class="c"># OM2 : OXIDE OXYGEN ON SP2 CARBON, NEGATIVELY CHARGED</span>
3936 <span class="c">#</span>
<a name="_IsNegativelyChargedSP2OxideOxygen-"></a>3937 <span class="k">sub </span><span class="m">_IsNegativelyChargedSP2OxideOxygen</span> <span class="s">{</span>
3938   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3939 
3940   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.FC-1.T1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;C.DB1.T3&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
3941 <span class="s">}</span>
3942 
3943 <span class="c"># O+ : POSITIVELY CHARGED OXONIUM (TRICOORDINATE) OXYGEN</span>
3944 <span class="c">#</span>
<a name="_IsPositivelyChargedOxoniumOxygen-"></a>3945 <span class="k">sub </span><span class="m">_IsPositivelyChargedOxoniumOxygen</span> <span class="s">{</span>
3946   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3947 
3948   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.FC+1.T3.DB0&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
3949 <span class="s">}</span>
3950 
3951 <span class="c"># O=+ : POSITIVELY CHARGED OXENIUM (DICOORDINATE) OXYGEN</span>
3952 <span class="c">#</span>
<a name="_IsPositivelyChargedOxeniumOxygen-"></a>3953 <span class="k">sub </span><span class="m">_IsPositivelyChargedOxeniumOxygen</span> <span class="s">{</span>
3954   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3955 
3956   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.FC+1.T2.DB1&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
3957 <span class="s">}</span>
3958 
3959 <span class="c"># OFUR : AROMATIC OXYGEN AS IN FURAN</span>
3960 <span class="c">#</span>
<a name="_IsAromaticOxygen-"></a>3961 <span class="k">sub </span><span class="m">_IsAromaticOxygen</span> <span class="s">{</span>
3962   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3963 
3964   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.Ar.RA5&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
3965 <span class="s">}</span>
3966 
3967 <span class="c"># OH2 : OXYGEN ON WATER</span>
3968 <span class="c">#</span>
<a name="_IsWaterOxygen-"></a>3969 <span class="k">sub </span><span class="m">_IsWaterOxygen</span> <span class="s">{</span>
3970   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3971 
3972   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.T2.TSB2&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;H&#39;</span><span class="cm">,</span> <span class="q">&#39;H&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
3973 <span class="s">}</span>
3974 
3975 <span class="c"># PO4 : PHOSPHOROUS IN PHOSPHATES AND PHOSPHODIESTERS</span>
3976 <span class="c">#</span>
<a name="_IsPhosphateOrPhosphodiesterPhosphorus-"></a>3977 <span class="k">sub </span><span class="m">_IsPhosphateOrPhosphodiesterPhosphorus</span> <span class="s">{</span>
3978   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3979 
3980   <span class="c"># Phosphate: R-O-P(=O)(-O)-O; Phosphate diester: R&#39;-O-P(=O)(-O)-O-R&quot;</span>
3981 
3982   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;P.T4.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
3983 <span class="s">}</span>
3984 
3985 <span class="c"># PO3 : TETRACOORDINATE P WITH THREE ATTACHED OXYGENS</span>
3986 <span class="c">#</span>
<a name="_IsPhosphonatePhosphorus-"></a>3987 <span class="k">sub </span><span class="m">_IsPhosphonatePhosphorus</span> <span class="s">{</span>
3988   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3989 
3990   <span class="c"># Phosphonate: R-P(=O)(-O)-O; Phosphonate ester: R&#39;-P(=O)(-O)-O-R&quot;</span>
3991 
3992   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;P.T4.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;!O&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
3993 <span class="s">}</span>
3994 
3995 <span class="c"># PO2 : TETRACOORDINATE P WITH TWO ATTACHED OXYGENS</span>
3996 <span class="c">#</span>
<a name="_IsPhosphinatePhosphorus-"></a>3997 <span class="k">sub </span><span class="m">_IsPhosphinatePhosphorus</span> <span class="s">{</span>
3998   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3999 
4000   <span class="c"># Phosphinate: R-P(=O)(-O)-R&quot;; Phosphinate ester: R&#39;-P(=O)(-O)-R&quot;</span>
4001 
4002   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;P.T4.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;!O&#39;</span><span class="cm">,</span> <span class="q">&#39;!O&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4003 <span class="s">}</span>
4004 
4005 <span class="c"># PO : TETRACOORDINATE P WITH ONE ATTACHED OXYGEN</span>
4006 <span class="c">#</span>
<a name="_IsPhosphoxidePhosphorus-"></a>4007 <span class="k">sub </span><span class="m">_IsPhosphoxidePhosphorus</span> <span class="s">{</span>
4008   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4009 
4010   <span class="c"># Phosphoxide: R-P(=O)(-R&quot;)-R&#39;&#39;&#39;</span>
4011 
4012   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;P.T4.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;!O&#39;</span><span class="cm">,</span> <span class="q">&#39;!O&#39;</span><span class="cm">,</span> <span class="q">&#39;!O&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4013 <span class="s">}</span>
4014 
4015 <span class="c"># PTET : GENERAL TETRACOORDINATE PHOSPHORUS</span>
4016 <span class="c">#</span>
<a name="_IsTetraCoordinatedPhosphorus-"></a>4017 <span class="k">sub </span><span class="m">_IsTetraCoordinatedPhosphorus</span> <span class="s">{</span>
4018   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4019 
4020   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;P.T4&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4021 <span class="s">}</span>
4022 
4023 <span class="c"># P : TRICOORDINATE P, AS IN PHOSPHINES</span>
4024 <span class="c">#</span>
<a name="_IsTriCoordinatedPhosphorus-"></a>4025 <span class="k">sub </span><span class="m">_IsTriCoordinatedPhosphorus</span> <span class="s">{</span>
4026   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4027 
4028   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;P.T3&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4029 <span class="s">}</span>
4030 
4031 <span class="c"># -P=C : PHOSPHOROUS DOUBLY BONDED TO CARBON</span>
4032 <span class="c">#</span>
<a name="_IsDoublyBondedToCarbonPhosphorous-"></a>4033 <span class="k">sub </span><span class="m">_IsDoublyBondedToCarbonPhosphorous</span> <span class="s">{</span>
4034   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4035 
4036   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;P.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;C&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4037 <span class="s">}</span>
4038 
4039 <span class="c"># S : SULFUR IN THIOETHERS AND MERCAPTANS</span>
4040 <span class="c">#</span>
<a name="_IsThioEthersOrMercaptansSulfur-"></a>4041 <span class="k">sub </span><span class="m">_IsThioEthersOrMercaptansSulfur</span> <span class="s">{</span>
4042   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4043 
4044   <span class="k">return</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsThioEtherSulfur</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span> || <span class="i">$This</span><span class="i">-&gt;_IsMercaptansSulfur</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4045 
4046   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
4047 <span class="s">}</span>
4048 
4049 <span class="c"># Thioethers: R&#39;-S-R&quot;</span>
4050 <span class="c">#</span>
<a name="_IsThioEtherSulfur-"></a>4051 <span class="k">sub </span><span class="m">_IsThioEtherSulfur</span> <span class="s">{</span>
4052   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4053   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
4054 
4055   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;S.X2.T2&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;C&#39;</span><span class="cm">,</span> <span class="q">&#39;C&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4056 <span class="s">}</span>
4057 
4058 <span class="c"># Mercaptans or Thiols: R-S-H</span>
4059 <span class="c">#</span>
<a name="_IsMercaptansSulfur-"></a>4060 <span class="k">sub </span><span class="m">_IsMercaptansSulfur</span> <span class="s">{</span>
4061   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4062 
4063   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;S.T2&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;C&#39;</span><span class="cm">,</span> <span class="q">&#39;C,H&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4064 <span class="s">}</span>
4065 
4066 <span class="c"># Is it a divalent dicoordinated Sulfur...</span>
4067 <span class="c">#</span>
<a name="_IsDivalentDiCoordinatedSulfur-"></a>4068 <span class="k">sub </span><span class="m">_IsDivalentDiCoordinatedSulfur</span> <span class="s">{</span>
4069   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4070 
4071   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;S.T2.FC0&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;*&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4072 <span class="s">}</span>
4073 
4074 <span class="c"># S=C : TERMINAL SULFUR DOUBLY BONDED TO CARBON</span>
4075 <span class="c">#</span>
<a name="_IsSCTerminalSulfur-"></a>4076 <span class="k">sub </span><span class="m">_IsSCTerminalSulfur</span> <span class="s">{</span>
4077   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4078 
4079   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;S.X1.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;C&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4080 <span class="s">}</span>
4081 
4082 <span class="c"># &gt;S=N : SULFUR, TRICOORD, DOUBLY BONDED TO N</span>
4083 <span class="c">#</span>
<a name="_IsSNTricoordinatedSulfur-"></a>4084 <span class="k">sub </span><span class="m">_IsSNTricoordinatedSulfur</span> <span class="s">{</span>
4085   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4086 
4087   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;S.T3.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;N&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4088 <span class="s">}</span>
4089 
4090 <span class="c"># S=O : SULFUR IN SULFOXIDES</span>
4091 <span class="c">#</span>
<a name="_IsSulfoxideSulfur-"></a>4092 <span class="k">sub </span><span class="m">_IsSulfoxideSulfur</span> <span class="s">{</span>
4093   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4094 
4095   <span class="c"># Sulfone: R&#39;-S(=O)-R&quot;, R&#39;-S(=O)-O-R&quot;, and so on...</span>
4096 
4097   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;S.T3.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4098 <span class="s">}</span>
4099 
4100 <span class="c"># SO2 : SULFUR IN SULFONES</span>
4101 <span class="c">#</span>
<a name="_IsSulfoneSulfur-"></a>4102 <span class="k">sub </span><span class="m">_IsSulfoneSulfur</span> <span class="s">{</span>
4103   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4104 
4105   <span class="c"># Sulfone: R&#39;-S(=O)(=O)-R&quot;</span>
4106 
4107   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;S.T4.DB2&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;!O&#39;</span><span class="cm">,</span> <span class="q">&#39;!O&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4108 <span class="s">}</span>
4109 
4110 <span class="c">#  =SO2: SULFONE SULPHER DOUBLY BONDED TO CARBON</span>
4111 <span class="c">#</span>
<a name="_IsDoublyBondedToCarbonSulfoneSulfur-"></a>4112 <span class="k">sub </span><span class="m">_IsDoublyBondedToCarbonSulfoneSulfur</span> <span class="s">{</span>
4113   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4114 
4115   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;S.T3.DB3&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;C&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;=&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4116 <span class="s">}</span>
4117 
4118 <span class="c"># SO2N : SULFUR IN SULFONAMIDES</span>
4119 <span class="c">#</span>
<a name="_IsSulfonamideSulfur-"></a>4120 <span class="k">sub </span><span class="m">_IsSulfonamideSulfur</span> <span class="s">{</span>
4121   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4122 
4123   <span class="c"># Sulfonamide: R-S(=O)(=O)-N(-R)(-R&quot;)</span>
4124 
4125   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;S.T4.DB2&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;N&#39;</span><span class="cm">,</span> <span class="q">&#39;!O&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4126 <span class="s">}</span>
4127 
4128 <span class="c"># SO3 : SULFONATE SULFUR</span>
4129 <span class="c">#</span>
<a name="_IsSulfonateSulfur-"></a>4130 <span class="k">sub </span><span class="m">_IsSulfonateSulfur</span> <span class="s">{</span>
4131   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4132 
4133   <span class="c"># Sulfonate ion: R&#39;-S(=O)(=O)-(O-); Sulfonate ester: R&#39;-S(=O)(=O)-O-R&quot;</span>
4134 
4135   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;S.T4.DB2&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;!O&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4136 <span class="s">}</span>
4137 
4138 <span class="c"># SO4 : SULFATE SULFUR</span>
4139 <span class="c">#</span>
<a name="_IsSulfateSulfur-"></a>4140 <span class="k">sub </span><span class="m">_IsSulfateSulfur</span> <span class="s">{</span>
4141   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4142 
4143   <span class="c"># Sulfate ion: (O-)-S(=O)(=O)-(O-); Sulfate esters: R-O-S(=O)(=O)-O-R&quot;</span>
4144 
4145   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;S.T4.DB2&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4146 <span class="s">}</span>
4147 
4148 <span class="c"># SNO : SULFUR IN NITROGEN ANALOG OF A SULFONE</span>
4149 <span class="c">#</span>
<a name="_IsNitrogenAnalogOfSulfoneSulfur-"></a>4150 <span class="k">sub </span><span class="m">_IsNitrogenAnalogOfSulfoneSulfur</span> <span class="s">{</span>
4151   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4152 
4153   <span class="c"># Sulfone: R&#39;-S(=N)(=O)-R&quot;</span>
4154 
4155   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;S.T4.DB2&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;N&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;!O&#39;</span><span class="cm">,</span> <span class="q">&#39;!O&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4156 <span class="s">}</span>
4157 
4158 <span class="c"># STHI : SULFUR AS IN THIOPHENE</span>
4159 <span class="c">#</span>
<a name="_IsSTHISulfur-"></a>4160 <span class="k">sub </span><span class="m">_IsSTHISulfur</span> <span class="s">{</span>
4161   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4162 
4163   <span class="c"># Is it an aromatic atom in a five membered ring?</span>
4164   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;S.Ar.RA5.FC0&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4165     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
4166   <span class="s">}</span>
4167 
4168   <span class="c"># Is it part of five membered ring containing only one hetero atom?</span>
4169   <span class="k">my</span><span class="s">(</span><span class="i">$RingAtomsRef</span><span class="cm">,</span> <span class="i">$RingIsAromatic</span><span class="cm">,</span> <span class="i">$NumOfHeteroAtoms</span><span class="s">)</span><span class="sc">;</span>
4170 
4171   <span class="k">for</span> <span class="i">$RingAtomsRef</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetRingsWithSize</span><span class="s">(</span><span class="n">5</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4172     <span class="s">(</span><span class="i">$RingIsAromatic</span><span class="cm">,</span> <span class="i">$NumOfHeteroAtoms</span><span class="s">)</span> = <span class="i">$This</span><span class="i">-&gt;_GetHeteroAtomsInformationInRing</span><span class="s">(</span><span class="i">$RingAtomsRef</span><span class="s">)</span><span class="sc">;</span>
4173     <span class="k">if</span> <span class="s">(</span><span class="i">$RingIsAromatic</span> &amp;&amp; <span class="i">$NumOfHeteroAtoms</span> == <span class="n">1</span><span class="s">)</span> <span class="s">{</span>
4174       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
4175     <span class="s">}</span>
4176   <span class="s">}</span>
4177   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
4178 <span class="s">}</span>
4179 
4180 <span class="c"># S-P : TERMINAL SULFUR BONDED TO PHOSPHORUS</span>
4181 <span class="c">#</span>
<a name="_IsSPTerminalSulfur-"></a>4182 <span class="k">sub </span><span class="m">_IsSPTerminalSulfur</span> <span class="s">{</span>
4183   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4184 
4185   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;S.X1.T2&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;P&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4186 <span class="s">}</span>
4187 
4188 <span class="c"># S2CM : TERMINAL SULFUR IN THIOCARBOXYLATE ANION</span>
4189 <span class="c">#</span>
<a name="_IsThioCarboxylateAnionTerminalSulfur-"></a>4190 <span class="k">sub </span><span class="m">_IsThioCarboxylateAnionTerminalSulfur</span> <span class="s">{</span>
4191   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4192   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
4193 
4194   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;S.X1.FC-1, S.X1.DB1.FC0&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4195     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
4196   <span class="s">}</span>
4197 
4198   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;C.DB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4199     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsThioCarboxylateAnionCarbon</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4200       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
4201     <span class="s">}</span>
4202   <span class="s">}</span>
4203   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
4204 <span class="s">}</span>
4205 
4206 <span class="c"># SM : TERMINAL SULFUR - FORMAL CHARGE=-1</span>
4207 <span class="c">#</span>
<a name="_IsNegativelyChargedTerminalSulfur-"></a>4208 <span class="k">sub </span><span class="m">_IsNegativelyChargedTerminalSulfur</span> <span class="s">{</span>
4209   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4210 
4211   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;S.X1.FC-1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;*&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4212 <span class="s">}</span>
4213 
4214 <span class="c"># SSMO : TERMINAL SULFUR IN THIOSULFINATE GROUP</span>
4215 <span class="c">#</span>
<a name="_IsThioSulfinateTerminalSulfur-"></a>4216 <span class="k">sub </span><span class="m">_IsThioSulfinateTerminalSulfur</span> <span class="s">{</span>
4217   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4218   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
4219 
4220   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;S.X1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;S.FC+1&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4221     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
4222   <span class="s">}</span>
4223 
4224   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;S.FC+1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4225     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsThioSulfinateSulfur</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4226       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
4227     <span class="s">}</span>
4228   <span class="s">}</span>
4229   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
4230 <span class="s">}</span>
4231 
4232 <span class="c"># SO2M : SULFUR IN NEGATIVELY CHARGED SULFINATE GROUP</span>
4233 <span class="c">#</span>
<a name="_IsNegativelyChargedSulfinateSulfur-"></a>4234 <span class="k">sub </span><span class="m">_IsNegativelyChargedSulfinateSulfur</span> <span class="s">{</span>
4235   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4236 
4237   <span class="c"># Sulfinate ion: R&#39;-S(=O)-(O-)</span>
4238 
4239   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;S.T3.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;O.X1.FC-1&#39;</span><span class="cm">,</span> <span class="q">&#39;!O&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4240 <span class="s">}</span>
4241 
4242 <span class="c"># Sulfinate: R&#39;-S(=O)-OH; Sulfinate esters: R&#39;-S(=O)-O-R</span>
4243 <span class="c">#</span>
<a name="_IsSulfinateSulfur-"></a>4244 <span class="k">sub </span><span class="m">_IsSulfinateSulfur</span> <span class="s">{</span>
4245   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4246 
4247   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;S.T3.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;O.X1.FC0,O.X2&#39;</span><span class="cm">,</span> <span class="q">&#39;!O&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4248 <span class="s">}</span>
4249 
4250 <span class="c"># SSOM : TRICOORD SULFUR IN THIOSULFINATE GROUP</span>
4251 <span class="c">#</span>
<a name="_IsTriCoordinatedThioSulfinateSulfur-"></a>4252 <span class="k">sub </span><span class="m">_IsTriCoordinatedThioSulfinateSulfur</span> <span class="s">{</span>
4253   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4254   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
4255 
4256   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;S.X3&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;S&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4257     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
4258   <span class="s">}</span>
4259 
4260   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsThioSulfinateSulfur</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4261       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
4262   <span class="s">}</span>
4263 
4264   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
4265 <span class="s">}</span>
4266 
4267 <span class="c"># Is it a Thiosulfinate group?</span>
4268 <span class="c">#</span>
<a name="_IsThioSulfinateSulfur-"></a>4269 <span class="k">sub </span><span class="m">_IsThioSulfinateSulfur</span> <span class="s">{</span>
4270   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4271 
4272   <span class="c"># R&#39;-[S+1](-[O-1])-S-R&quot;</span>
4273 
4274   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;S.FC+1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O.FC-1&#39;</span><span class="cm">,</span> <span class="q">&#39;S&#39;</span><span class="cm">,</span> <span class="q">&#39;!O&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4275 <span class="s">}</span>
4276 
4277 <span class="c">#   =S=O:  SULFINYL SULFUR, EG. IN C=S=O</span>
4278 <span class="c">#</span>
<a name="_IsSulfinylSulfur-"></a>4279 <span class="k">sub </span><span class="m">_IsSulfinylSulfur</span> <span class="s">{</span>
4280   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4281 
4282   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;S.X2.DB2&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;C&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;=&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4283 <span class="s">}</span>
4284 
4285 <span class="c"># CLO4 : CHLORINE IN PERCHLORATE ANION, CLO4(-)</span>
4286 <span class="c">#</span>
<a name="_IsPerChlorateAnionChlorine-"></a>4287 <span class="k">sub </span><span class="m">_IsPerChlorateAnionChlorine</span> <span class="s">{</span>
4288   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4289 
4290   <span class="c"># R-O-Cl(=O)(=O)=O or (O-)-Cl(=O)(=O)=O</span>
4291   <span class="k">if</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;Cl.X4.DB3&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O.X1.FC-1,O.T2.FC0&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;=&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4292     <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
4293   <span class="s">}</span>
4294 
4295   <span class="c"># Match distributed formal charge of -0.25 on each Oxygen?</span>
4296   <span class="k">if</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;Cl.X4.DB3&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O.FC-0.25&#39;</span><span class="cm">,</span> <span class="q">&#39;O.FC-0.25&#39;</span><span class="cm">,</span> <span class="q">&#39;O.FC-0.25&#39;</span><span class="cm">,</span> <span class="q">&#39;O.FC-0.25&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;*&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4297     <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
4298   <span class="s">}</span>
4299 
4300   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
4301 <span class="s">}</span>
4302 
4303 <span class="c"># Get MMFF94 atom type for Hydrogen attached to Carbon...</span>
4304 <span class="c">#</span>
<a name="_GetAtomTypeForHydrogenAttachedToCarbon-"></a>4305 <span class="k">sub </span><span class="m">_GetAtomTypeForHydrogenAttachedToCarbon</span> <span class="s">{</span>
4306   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$CarbonAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4307   <span class="k">my</span><span class="s">(</span><span class="i">$AtomType</span><span class="s">)</span><span class="sc">;</span>
4308 
4309   <span class="c"># HC :  H  ATTACHED TO C</span>
4310   <span class="i">$AtomType</span> = <span class="q">&#39;HC&#39;</span><span class="sc">;</span>
4311 
4312   <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
4313 <span class="s">}</span>
4314 
4315 <span class="c"># Get MMFF94 atom type for Hydrogen attached to Nitrogen...</span>
4316 <span class="c">#</span>
4317 <span class="c"># 25 AtomTypeSymbols for element H:</span>
4318 <span class="c">#</span>
4319 <span class="c"># AtomTypeSymbol   AtomTypeNum   AtomTypeDefinition</span>
4320 <span class="c">#   HNR      23    H-N(SP3)</span>
4321 <span class="c">#   H3N      23    H-N(SP3), AMMONIA</span>
4322 <span class="c">#   HPYL     23    H-N IN PYRROLE</span>
4323 <span class="c">#   HNOX     23    H-N IN IN A N-OXIDE</span>
4324 <span class="c">#   HNM      23    H ON DICOORD, NEGATIVELY CHARGED NITROGEN</span>
4325 <span class="c">#   HN       23    GENERAL H ON NITROGEN</span>
4326 <span class="c">#   HN=N     27    AZO HYDROGEN</span>
4327 <span class="c">#   HN=C     27    IMINE HYDROGEN</span>
4328 <span class="c">#   HNCO     28    AMIDE HYDROGEN</span>
4329 <span class="c">#   HNCS     28    THIOAMIDE HYDROGEN</span>
4330 <span class="c">#   HNCC     28    H-N IN ENAMINES</span>
4331 <span class="c">#   HNCN     28    H-N IN H-N-C=N</span>
4332 <span class="c">#   HNNC     28    H-N IN H-N-N=C</span>
4333 <span class="c">#   HNNN     28    H-N IN H-N-N=N</span>
4334 <span class="c">#   HNSO     28    H-N IN SULFONAMIDE</span>
4335 <span class="c">#   HNPO     28    H-N IN PHOSPHONAMIDE</span>
4336 <span class="c">#   HNC%     28    HYDROGEN ON N ATTACHED TO TRIPLY BONDED CARBON</span>
4337 <span class="c">#   HSP2     28    GENERAL H ON SP2 NITROGEN</span>
4338 <span class="c">#   HNR+     36    H ON QUATERNARY NITROGEN</span>
4339 <span class="c">#   HIM+     36    H ON IMIDAZOLIUM-TYPE NITROGEN</span>
4340 <span class="c">#   HPD+     36    H ON PROTONATED PYRIDINE NITROGEN</span>
4341 <span class="c">#   HNN+     36    H ON AMIDINIUM-TYPE NITROGEN</span>
4342 <span class="c">#   HNC+     36    H ON PROTONATED IMINE NITROGEN</span>
4343 <span class="c">#   HGD+     36    H ON GUANIDINIUM-TYPE NITROGEN</span>
4344 <span class="c">#   HN5+     36    H ON N5+, N5A+ OR N5B+</span>
4345 <span class="c">#</span>
<a name="_GetAtomTypeForHydrogenAttachedToNitrogen-"></a>4346 <span class="k">sub </span><span class="m">_GetAtomTypeForHydrogenAttachedToNitrogen</span> <span class="s">{</span>
4347   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$NitrogenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4348   <span class="k">my</span><span class="s">(</span><span class="i">$AtomType</span><span class="cm">,</span> <span class="i">$NumOfSigmaBonds</span><span class="cm">,</span> <span class="i">$NumOfPiBonds</span><span class="s">)</span><span class="sc">;</span>
4349 
4350   <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
4351 
4352   <span class="s">(</span><span class="i">$NumOfSigmaBonds</span><span class="cm">,</span> <span class="i">$NumOfPiBonds</span><span class="s">)</span> = <span class="s">(</span><span class="q">&#39;0&#39;</span><span class="s">)</span> x <span class="n">2</span><span class="sc">;</span>
4353 
4354   <span class="s">(</span><span class="i">$NumOfSigmaBonds</span><span class="cm">,</span> <span class="i">$NumOfPiBonds</span><span class="s">)</span> = <span class="i">$NitrogenAtom</span><span class="i">-&gt;GetNumOfSigmaAndPiBondsToNonHydrogenAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4355   <span class="i">$NumOfSigmaBonds</span> += <span class="i">$NitrogenAtom</span><span class="i">-&gt;GetAtomicInvariantValue</span><span class="s">(</span><span class="q">&#39;H&#39;</span><span class="s">)</span><span class="sc">;</span>
4356 
4357   <span class="j">ATOMTYPE:</span> <span class="s">{</span>
4358 
4359     <span class="k">if</span> <span class="s">(</span><span class="i">$NumOfPiBonds</span> == <span class="n">0</span><span class="s">)</span> <span class="s">{</span>
4360       <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomTypeForHydrogenAttachedToNitrogenWithOnlySigmaBonds</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span><span class="sc">;</span>
4361       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4362     <span class="s">}</span>
4363 
4364     <span class="k">if</span> <span class="s">(</span><span class="i">$NumOfPiBonds</span> == <span class="n">1</span><span class="s">)</span> <span class="s">{</span>
4365       <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomTypeForHydrogenAttachedToNitrogenWithOnePiBond</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span><span class="sc">;</span>
4366       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4367     <span class="s">}</span>
4368 
4369     <span class="k">if</span> <span class="s">(</span><span class="i">$NumOfPiBonds</span> == <span class="n">2</span><span class="s">)</span> <span class="s">{</span>
4370       <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomTypeForHydrogenAttachedToNitrogenWithTwoPiBonds</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span><span class="sc">;</span>
4371       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4372     <span class="s">}</span>
4373 
4374     <span class="c"># HN : GENERAL H ON NITROGEN</span>
4375     <span class="i">$AtomType</span> = <span class="q">&#39;HN&#39;</span><span class="sc">;</span>
4376   <span class="s">}</span>
4377   <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
4378 <span class="s">}</span>
4379 
4380 <span class="c"># Get atom type for Hydrogen attached to a Nitrogen with only sigma bonds...</span>
4381 <span class="c">#</span>
<a name="_GetAtomTypeForHydrogenAttachedToNitrogenWithOnlySigmaBonds-"></a>4382 <span class="k">sub </span><span class="m">_GetAtomTypeForHydrogenAttachedToNitrogenWithOnlySigmaBonds</span> <span class="s">{</span>
4383   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$NitrogenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4384   <span class="k">my</span><span class="s">(</span><span class="i">$AtomType</span><span class="s">)</span><span class="sc">;</span>
4385 
4386   <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
4387 
4388   <span class="j">ATOMTYPE:</span> <span class="s">{</span>
4389 
4390     <span class="c"># HNC% : HYDROGEN ON N ATTACHED TO TRIPLY BONDED CARBON</span>
4391     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsHydrogenAttachedToTriplyBondedToCarbonNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4392       <span class="i">$AtomType</span> = <span class="q">&#39;HNC%&#39;</span><span class="sc">;</span>
4393       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4394     <span class="s">}</span>
4395 
4396     <span class="c"># HPYL : H-N IN PYRROLE</span>
4397     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsHydrogenAttachedToPyrroleNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4398       <span class="i">$AtomType</span> = <span class="q">&#39;HPYL&#39;</span><span class="sc">;</span>
4399       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4400     <span class="s">}</span>
4401 
4402     <span class="c"># HN5+ : H ON N5+, N5A+ OR N5B+</span>
4403     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsHydrogenAttachedToFiveMemberedHetreoCyclicPostivelyChargedNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4404       <span class="i">$AtomType</span> =  <span class="q">&#39;HN5+&#39;</span><span class="sc">;</span>
4405       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4406     <span class="s">}</span>
4407 
4408     <span class="c"># HGD+ : H ON GUANIDINIUM-TYPE NITROGEN</span>
4409     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsHydrogenAttachedToGuanidiniumNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4410       <span class="i">$AtomType</span> = <span class="q">&#39;HGD+&#39;</span><span class="sc">;</span>
4411       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4412     <span class="s">}</span>
4413 
4414     <span class="c"># HNCS : THIOAMIDE HYDROGEN</span>
4415     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsHydrogenAttachedToThioamideNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4416       <span class="i">$AtomType</span> = <span class="q">&#39;HNCS&#39;</span><span class="sc">;</span>
4417       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4418     <span class="s">}</span>
4419 
4420     <span class="c"># HNCO : AMIDE HYDROGEN</span>
4421     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsHydrogenAttachedToAmideNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4422       <span class="i">$AtomType</span> = <span class="q">&#39;HNCO&#39;</span><span class="sc">;</span>
4423       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4424     <span class="s">}</span>
4425 
4426     <span class="c"># HNSO : H-N IN SULFONAMIDE</span>
4427     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsHydrogenAttachedToSulfonamideNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4428       <span class="i">$AtomType</span> = <span class="q">&#39;HNSO&#39;</span><span class="sc">;</span>
4429       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4430     <span class="s">}</span>
4431 
4432     <span class="c"># HNPO : H-N IN PHOSPHONAMIDE</span>
4433     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsHydrogenAttachedToPhosphonamideNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4434       <span class="i">$AtomType</span> = <span class="q">&#39;HNPO&#39;</span><span class="sc">;</span>
4435       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4436     <span class="s">}</span>
4437 
4438     <span class="c"># HNOX : H-N IN IN A N-OXIDE</span>
4439     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsHydrogenAttachedToNOXideNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4440       <span class="i">$AtomType</span> = <span class="q">&#39;HNOX&#39;</span><span class="sc">;</span>
4441       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4442     <span class="s">}</span>
4443 
4444     <span class="c"># HNCC : H-N IN ENAMINES (H-N-C=C)</span>
4445     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsHydrogenAttachedToEnamineNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4446       <span class="i">$AtomType</span> = <span class="q">&#39;HNCC&#39;</span><span class="sc">;</span>
4447       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4448     <span class="s">}</span>
4449 
4450     <span class="c"># HNCN : H-N IN H-N-C=N</span>
4451     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsHydrogenAttachedToNCNNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4452       <span class="i">$AtomType</span> = <span class="q">&#39;HNCN&#39;</span><span class="sc">;</span>
4453       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4454     <span class="s">}</span>
4455 
4456     <span class="c">#  HNNC : H-N IN H-N-N=C</span>
4457     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsHydrogenAttachedToNNCNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4458       <span class="i">$AtomType</span> = <span class="q">&#39;HNNC&#39;</span><span class="sc">;</span>
4459       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4460     <span class="s">}</span>
4461 
4462     <span class="c"># HNNN : H-N IN H-N-N=N</span>
4463     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsHydrogenAttachedToNNNNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4464       <span class="i">$AtomType</span> = <span class="q">&#39;HNNN&#39;</span><span class="sc">;</span>
4465       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4466     <span class="s">}</span>
4467 
4468     <span class="c"># HNM : H ON DICOORD, NEGATIVELY CHARGED NITROGEN</span>
4469     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsHydrogenAttachedToNegativelyChargedDicoordinatedNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4470       <span class="i">$AtomType</span> = <span class="q">&#39;HNM&#39;</span><span class="sc">;</span>
4471       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4472     <span class="s">}</span>
4473 
4474     <span class="c"># H3N : H-N(SP3), AMMONIA</span>
4475     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsHydrogenAttachedToSP3AmmoniaNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4476       <span class="i">$AtomType</span> = <span class="q">&#39;H3N&#39;</span><span class="sc">;</span>
4477       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4478     <span class="s">}</span>
4479 
4480     <span class="c"># HNR : H-N(SP3)</span>
4481     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsHydrogenAttachedToSP3Nitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4482       <span class="i">$AtomType</span> = <span class="q">&#39;HNR&#39;</span><span class="sc">;</span>
4483       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4484     <span class="s">}</span>
4485 
4486     <span class="c"># HNR+ : H ON QUATERNARY NITROGEN</span>
4487     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsHydrogenAttachedToQuaternaryNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4488       <span class="i">$AtomType</span> = <span class="q">&#39;HNR+&#39;</span><span class="sc">;</span>
4489       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4490     <span class="s">}</span>
4491 
4492     <span class="c"># HN : GENERAL H ON NITROGEN</span>
4493     <span class="i">$AtomType</span> = <span class="q">&#39;HN&#39;</span><span class="sc">;</span>
4494   <span class="s">}</span>
4495   <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
4496 <span class="s">}</span>
4497 
4498 <span class="c"># Get atom type for Hydrogen attached to a Nitrogen with one pi bonds...</span>
4499 <span class="c">#</span>
<a name="_GetAtomTypeForHydrogenAttachedToNitrogenWithOnePiBond-"></a>4500 <span class="k">sub </span><span class="m">_GetAtomTypeForHydrogenAttachedToNitrogenWithOnePiBond</span> <span class="s">{</span>
4501   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$NitrogenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4502   <span class="k">my</span><span class="s">(</span><span class="i">$AtomType</span><span class="s">)</span><span class="sc">;</span>
4503 
4504   <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
4505 
4506   <span class="j">ATOMTYPE:</span> <span class="s">{</span>
4507 
4508     <span class="c"># HPYL : H-N IN PYRROLE</span>
4509     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsHydrogenAttachedToPyrroleNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4510       <span class="i">$AtomType</span> = <span class="q">&#39;HPYL&#39;</span><span class="sc">;</span>
4511       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4512     <span class="s">}</span>
4513 
4514     <span class="c"># HIM+ : H ON IMIDAZOLIUM-TYPE NITROGEN</span>
4515     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsHydrogenAttachedToImidazoliumNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4516       <span class="i">$AtomType</span> =  <span class="q">&#39;HIM+&#39;</span><span class="sc">;</span>
4517       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4518     <span class="s">}</span>
4519 
4520     <span class="c"># HN5+ : H ON N5+, N5A+ OR N5B+</span>
4521     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsHydrogenAttachedToFiveMemberedHetreoCyclicPostivelyChargedNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4522       <span class="i">$AtomType</span> =  <span class="q">&#39;HN5+&#39;</span><span class="sc">;</span>
4523       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4524     <span class="s">}</span>
4525 
4526     <span class="c"># HPD+ : H ON PROTONATED PYRIDINE NITROGEN</span>
4527     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsHydrogenAttachedToPositivelyChargedPyridineNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4528       <span class="i">$AtomType</span> = <span class="q">&#39;HPD+&#39;</span><span class="sc">;</span>
4529       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4530     <span class="s">}</span>
4531 
4532     <span class="c"># HNOX : H-N IN IN A N-OXIDE</span>
4533     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsHydrogenAttachedToNOXideNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4534       <span class="i">$AtomType</span> = <span class="q">&#39;HNOX&#39;</span><span class="sc">;</span>
4535       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4536     <span class="s">}</span>
4537 
4538     <span class="c"># HGD+ : H ON GUANIDINIUM-TYPE NITROGEN</span>
4539     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsHydrogenAttachedToGuanidiniumNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4540       <span class="i">$AtomType</span> = <span class="q">&#39;HGD+&#39;</span><span class="sc">;</span>
4541       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4542     <span class="s">}</span>
4543 
4544     <span class="c"># HNN+ : H ON AMIDINIUM-TYPE NITROGEN</span>
4545     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsHydrogenAttachedToAmidiniumNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4546       <span class="i">$AtomType</span> = <span class="q">&#39;HNN+&#39;</span><span class="sc">;</span>
4547       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4548     <span class="s">}</span>
4549 
4550     <span class="c"># HNC+ : H ON PROTONATED IMINE NITROGEN</span>
4551     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsHydrogenAttachedToPositivelyChargedImineNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4552       <span class="i">$AtomType</span> = <span class="q">&#39;HNC+&#39;</span><span class="sc">;</span>
4553       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4554     <span class="s">}</span>
4555 
4556     <span class="c"># HN=N : AZO HYDROGEN</span>
4557     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsHydrogenAttachedToAzoNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4558       <span class="i">$AtomType</span> = <span class="q">&#39;HN=N&#39;</span><span class="sc">;</span>
4559       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4560     <span class="s">}</span>
4561 
4562     <span class="c"># HN=C : IMINE HYDROGEN</span>
4563     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsHydrogenAttachedToImineNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4564       <span class="i">$AtomType</span> = <span class="q">&#39;HN=C&#39;</span><span class="sc">;</span>
4565       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4566     <span class="s">}</span>
4567 
4568     <span class="c"># HSP2: GENERAL H ON SP2 NITROGEN</span>
4569     <span class="i">$AtomType</span> = <span class="q">&#39;HSP2&#39;</span><span class="sc">;</span>
4570   <span class="s">}</span>
4571   <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
4572 <span class="s">}</span>
4573 
4574 <span class="c"># Get atom type for Hydrogen attached to a Nitrogen with two pi bonds...</span>
4575 <span class="c">#</span>
<a name="_GetAtomTypeForHydrogenAttachedToNitrogenWithTwoPiBonds-"></a>4576 <span class="k">sub </span><span class="m">_GetAtomTypeForHydrogenAttachedToNitrogenWithTwoPiBonds</span> <span class="s">{</span>
4577   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$NitrogenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4578   <span class="k">my</span><span class="s">(</span><span class="i">$AtomType</span><span class="s">)</span><span class="sc">;</span>
4579 
4580   <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
4581 
4582   <span class="j">ATOMTYPE:</span> <span class="s">{</span>
4583 
4584     <span class="c"># HN : GENERAL H ON NITROGEN</span>
4585     <span class="i">$AtomType</span> = <span class="q">&#39;HN&#39;</span><span class="sc">;</span>
4586   <span class="s">}</span>
4587   <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
4588 <span class="s">}</span>
4589 
4590 <span class="c"># HNR : H-N(SP3)</span>
4591 <span class="c">#</span>
<a name="_IsHydrogenAttachedToSP3Nitrogen-"></a>4592 <span class="k">sub </span><span class="m">_IsHydrogenAttachedToSP3Nitrogen</span> <span class="s">{</span>
4593   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$NitrogenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4594 
4595   <span class="k">return</span> <span class="i">$NitrogenAtom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.T3.FC0&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;*&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4596 <span class="s">}</span>
4597 
4598 <span class="c"># H3N : H-N(SP3), AMMONIA</span>
4599 <span class="c">#</span>
<a name="_IsHydrogenAttachedToSP3AmmoniaNitrogen-"></a>4600 <span class="k">sub </span><span class="m">_IsHydrogenAttachedToSP3AmmoniaNitrogen</span> <span class="s">{</span>
4601   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$NitrogenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4602 
4603   <span class="k">return</span> <span class="i">$NitrogenAtom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.T4.FC+1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;H&#39;</span><span class="cm">,</span> <span class="q">&#39;H&#39;</span><span class="cm">,</span> <span class="q">&#39;H&#39;</span><span class="cm">,</span> <span class="q">&#39;H&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4604 <span class="s">}</span>
4605 
4606 <span class="c"># HPYL : H-N IN PYRROLE</span>
4607 <span class="c">#</span>
<a name="_IsHydrogenAttachedToPyrroleNitrogen-"></a>4608 <span class="k">sub </span><span class="m">_IsHydrogenAttachedToPyrroleNitrogen</span> <span class="s">{</span>
4609   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$NitrogenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4610 
4611   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_IsPyrroleNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4612 <span class="s">}</span>
4613 
4614 <span class="c"># HNOX : H-N IN IN A N-OXIDE</span>
4615 <span class="c">#</span>
<a name="_IsHydrogenAttachedToNOXideNitrogen-"></a>4616 <span class="k">sub </span><span class="m">_IsHydrogenAttachedToNOXideNitrogen</span> <span class="s">{</span>
4617   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$NitrogenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4618 
4619   <span class="k">return</span> <span class="i">$NitrogenAtom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.FC+1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O.X1.FC-1&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4620 <span class="s">}</span>
4621 
4622 <span class="c"># HNM : H ON DICOORD, NEGATIVELY CHARGED NITROGEN</span>
4623 <span class="c">#</span>
<a name="_IsHydrogenAttachedToNegativelyChargedDicoordinatedNitrogen-"></a>4624 <span class="k">sub </span><span class="m">_IsHydrogenAttachedToNegativelyChargedDicoordinatedNitrogen</span> <span class="s">{</span>
4625   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$NitrogenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4626 
4627   <span class="k">return</span> <span class="i">$NitrogenAtom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.T2.FC-1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;*&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4628 <span class="s">}</span>
4629 
4630 <span class="c"># HN=N : AZO HYDROGEN</span>
4631 <span class="c">#</span>
<a name="_IsHydrogenAttachedToAzoNitrogen-"></a>4632 <span class="k">sub </span><span class="m">_IsHydrogenAttachedToAzoNitrogen</span> <span class="s">{</span>
4633   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$NitrogenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4634 
4635   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_IsAzoNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4636 <span class="s">}</span>
4637 
4638 <span class="c"># HN=C : IMINE HYDROGEN</span>
4639 <span class="c">#</span>
<a name="_IsHydrogenAttachedToImineNitrogen-"></a>4640 <span class="k">sub </span><span class="m">_IsHydrogenAttachedToImineNitrogen</span> <span class="s">{</span>
4641   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$NitrogenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4642 
4643   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_IsImineNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4644 <span class="s">}</span>
4645 
4646 <span class="c"># HNCO : AMIDE HYDROGEN</span>
4647 <span class="c">#</span>
<a name="_IsHydrogenAttachedToAmideNitrogen-"></a>4648 <span class="k">sub </span><span class="m">_IsHydrogenAttachedToAmideNitrogen</span> <span class="s">{</span>
4649   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$NitrogenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4650 
4651   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_IsAmideNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4652 <span class="s">}</span>
4653 
4654 <span class="c"># HNCS : THIOAMIDE HYDROGEN</span>
4655 <span class="c">#</span>
<a name="_IsHydrogenAttachedToThioamideNitrogen-"></a>4656 <span class="k">sub </span><span class="m">_IsHydrogenAttachedToThioamideNitrogen</span> <span class="s">{</span>
4657   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$NitrogenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4658 
4659   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_IsThioAmideNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4660 <span class="s">}</span>
4661 
4662 <span class="c"># HNCC : H-N IN ENAMINES (H-N-C=C)</span>
4663 <span class="c">#</span>
<a name="_IsHydrogenAttachedToEnamineNitrogen-"></a>4664 <span class="k">sub </span><span class="m">_IsHydrogenAttachedToEnamineNitrogen</span> <span class="s">{</span>
4665   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$NitrogenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4666 
4667   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_IsNCCNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4668 <span class="s">}</span>
4669 
4670 <span class="c"># HNCN : H-N IN H-N-C=N</span>
4671 <span class="c">#</span>
<a name="_IsHydrogenAttachedToNCNNitrogen-"></a>4672 <span class="k">sub </span><span class="m">_IsHydrogenAttachedToNCNNitrogen</span> <span class="s">{</span>
4673   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$NitrogenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4674 
4675   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_IsNCNNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4676 <span class="s">}</span>
4677 
4678 <span class="c">#  HNNC : H-N IN H-N-N=C</span>
4679 <span class="c">#</span>
<a name="_IsHydrogenAttachedToNNCNitrogen-"></a>4680 <span class="k">sub </span><span class="m">_IsHydrogenAttachedToNNCNitrogen</span> <span class="s">{</span>
4681   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$NitrogenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4682 
4683   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_IsNNCNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4684 <span class="s">}</span>
4685 
4686 <span class="c"># HNNN : H-N IN H-N-N=N</span>
4687 <span class="c">#</span>
<a name="_IsHydrogenAttachedToNNNNitrogen-"></a>4688 <span class="k">sub </span><span class="m">_IsHydrogenAttachedToNNNNitrogen</span> <span class="s">{</span>
4689   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$NitrogenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4690 
4691   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_IsNNNNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4692 <span class="s">}</span>
4693 
4694 <span class="c"># HNSO : H-N IN SULFONAMIDE</span>
4695 <span class="c">#</span>
<a name="_IsHydrogenAttachedToSulfonamideNitrogen-"></a>4696 <span class="k">sub </span><span class="m">_IsHydrogenAttachedToSulfonamideNitrogen</span> <span class="s">{</span>
4697   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$NitrogenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4698 
4699   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_IsNSO2SulfonamideNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4700 <span class="s">}</span>
4701 
4702 <span class="c"># HNPO : H-N IN PHOSPHONAMIDE</span>
4703 <span class="c">#</span>
<a name="_IsHydrogenAttachedToPhosphonamideNitrogen-"></a>4704 <span class="k">sub </span><span class="m">_IsHydrogenAttachedToPhosphonamideNitrogen</span> <span class="s">{</span>
4705   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$NitrogenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4706 
4707   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_IsNPO2PhosphonamideNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4708 <span class="s">}</span>
4709 
4710 <span class="c"># HNC% : HYDROGEN ON N ATTACHED TO TRIPLY BONDED CARBON</span>
4711 <span class="c">#</span>
<a name="_IsHydrogenAttachedToTriplyBondedToCarbonNitrogen-"></a>4712 <span class="k">sub </span><span class="m">_IsHydrogenAttachedToTriplyBondedToCarbonNitrogen</span> <span class="s">{</span>
4713   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$NitrogenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4714 
4715   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_IsAttchedToCCTripleBondNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4716 <span class="s">}</span>
4717 
4718 <span class="c"># HSP2 : GENERAL H ON SP2 NITROGEN</span>
4719 <span class="c">#</span>
<a name="_IsHydrogenAttachedToSP2Nitrogen-"></a>4720 <span class="k">sub </span><span class="m">_IsHydrogenAttachedToSP2Nitrogen</span> <span class="s">{</span>
4721   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$NitrogenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4722 
4723   <span class="k">return</span> <span class="i">$NitrogenAtom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.DB1&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4724 <span class="s">}</span>
4725 
4726 <span class="c"># HNR+ : H ON QUATERNARY NITROGEN</span>
4727 <span class="c">#</span>
<a name="_IsHydrogenAttachedToQuaternaryNitrogen-"></a>4728 <span class="k">sub </span><span class="m">_IsHydrogenAttachedToQuaternaryNitrogen</span> <span class="s">{</span>
4729   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$NitrogenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4730 
4731   <span class="k">return</span> <span class="i">$NitrogenAtom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.T4.FC+1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;*&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4732 <span class="s">}</span>
4733 
4734 <span class="c"># HIM+ : H ON IMIDAZOLIUM-TYPE NITROGEN</span>
4735 <span class="c">#</span>
<a name="_IsHydrogenAttachedToImidazoliumNitrogen-"></a>4736 <span class="k">sub </span><span class="m">_IsHydrogenAttachedToImidazoliumNitrogen</span> <span class="s">{</span>
4737   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$NitrogenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4738 
4739   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_IsImidazoliumNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4740 <span class="s">}</span>
4741 
4742 <span class="c"># HPD+ : H ON PROTONATED PYRIDINE NITROGEN</span>
4743 <span class="c">#</span>
<a name="_IsHydrogenAttachedToPositivelyChargedPyridineNitrogen-"></a>4744 <span class="k">sub </span><span class="m">_IsHydrogenAttachedToPositivelyChargedPyridineNitrogen</span> <span class="s">{</span>
4745   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$NitrogenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4746 
4747   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_IsPyridiniumNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4748 <span class="s">}</span>
4749 
4750 <span class="c"># HNN+ : H ON AMIDINIUM-TYPE NITROGEN</span>
4751 <span class="c">#</span>
<a name="_IsHydrogenAttachedToAmidiniumNitrogen-"></a>4752 <span class="k">sub </span><span class="m">_IsHydrogenAttachedToAmidiniumNitrogen</span> <span class="s">{</span>
4753   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$NitrogenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4754 
4755   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_IsPositivelyChargedAzoNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4756 <span class="s">}</span>
4757 
4758 <span class="c"># HNC+ : H ON PROTONATED IMINE NITROGEN</span>
4759 <span class="c">#</span>
<a name="_IsHydrogenAttachedToPositivelyChargedImineNitrogen-"></a>4760 <span class="k">sub </span><span class="m">_IsHydrogenAttachedToPositivelyChargedImineNitrogen</span> <span class="s">{</span>
4761   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$NitrogenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4762 
4763   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_IsPositivelyChargedIminiumNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4764 <span class="s">}</span>
4765 
4766 <span class="c"># HGD+ : H ON GUANIDINIUM-TYPE NITROGEN</span>
4767 <span class="c">#</span>
<a name="_IsHydrogenAttachedToGuanidiniumNitrogen-"></a>4768 <span class="k">sub </span><span class="m">_IsHydrogenAttachedToGuanidiniumNitrogen</span> <span class="s">{</span>
4769   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$NitrogenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4770 
4771   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_IsGuanidiniumNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4772 <span class="s">}</span>
4773 
4774 <span class="c"># HN5+ : H ON N5+, N5A+ OR N5B+</span>
4775 <span class="c">#</span>
<a name="_IsHydrogenAttachedToFiveMemberedHetreoCyclicPostivelyChargedNitrogen-"></a>4776 <span class="k">sub </span><span class="m">_IsHydrogenAttachedToFiveMemberedHetreoCyclicPostivelyChargedNitrogen</span> <span class="s">{</span>
4777   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$NitrogenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4778 
4779   <span class="k">if</span> <span class="s">(</span>!<span class="i">$NitrogenAtom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.RA5.FC+1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4780     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
4781   <span class="s">}</span>
4782 
4783   <span class="k">return</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsPositivelyChargedFiveMemberedHeteroAromaticRingAlphaNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span> ||
4784          <span class="i">$This</span><span class="i">-&gt;_IsPositivelyChargedFiveMemberedHeteroAromaticRingBetaNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span> ||
4785          <span class="i">$This</span><span class="i">-&gt;_IsPositivelyChargedFiveMemberedHeteroCyclicRingNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4786 <span class="s">}</span>
4787 
4788 <span class="c"># Get MMFF94 atom type for Hydrogen attached to Oxygen...</span>
4789 <span class="c">#</span>
4790 <span class="c"># 11 AtomTypeSymbols for element H:</span>
4791 <span class="c">#</span>
4792 <span class="c"># AtomTypeSymbol   AtomTypeNum   AtomTypeDefinition</span>
4793 <span class="c">#   HOR      21    HYDROGEN IN ALCOHOLS</span>
4794 <span class="c">#   HO       21    GENERAL H ON OXYGEN</span>
4795 <span class="c">#   HOM      21    HYDROGEN IN HYDROXIDE ANION</span>
4796 <span class="c">#   HOCO     24    H-O IN CARBOXYLIC ACIDS</span>
4797 <span class="c">#   HOP      24    HYDROGEN ON OXYGEN ATTACHED TO PHOSPHOROUS</span>
4798 <span class="c">#   HOCC     29    H-O IN ENOLS AND PHENOLS</span>
4799 <span class="c">#   HOCN     29    H-O IN HO-C=N</span>
4800 <span class="c">#   HOH      31    HYDROGEN IN H2O</span>
4801 <span class="c">#   HOS      33    H ON OXYGEN ATTACHED TO SULFUR</span>
4802 <span class="c">#   HO+      50    HYDROGEN ON O+ OXYGEN</span>
4803 <span class="c">#   HO=+     52    HYDROGEN ON OXENIUM OXYGEN</span>
4804 <span class="c">#</span>
<a name="_GetAtomTypeForHydrogenAttachedToOxygen-"></a>4805 <span class="k">sub </span><span class="m">_GetAtomTypeForHydrogenAttachedToOxygen</span> <span class="s">{</span>
4806   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$OxygenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4807   <span class="k">my</span><span class="s">(</span><span class="i">$AtomType</span><span class="s">)</span><span class="sc">;</span>
4808 
4809   <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
4810 
4811   <span class="j">ATOMTYPE:</span> <span class="s">{</span>
4812 
4813     <span class="c"># HOP : HYDROGEN ON OXYGEN ATTACHED TO PHOSPHOROUS</span>
4814     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsHydrogenAttachedToOPOxygen</span><span class="s">(</span><span class="i">$OxygenAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4815       <span class="i">$AtomType</span> = <span class="q">&#39;HOP&#39;</span><span class="sc">;</span>
4816       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4817     <span class="s">}</span>
4818 
4819     <span class="c"># HOS : H ON OXYGEN ATTACHED TO SULFUR</span>
4820     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsHydrogenAttachedToOSOxygen</span><span class="s">(</span><span class="i">$OxygenAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4821       <span class="i">$AtomType</span> = <span class="q">&#39;HOS&#39;</span><span class="sc">;</span>
4822       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4823     <span class="s">}</span>
4824 
4825     <span class="c"># HOCO : H-O IN CARBOXYLIC ACIDS</span>
4826     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsHydrogenAttachedToCarboxylicAcidOxygen</span><span class="s">(</span><span class="i">$OxygenAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4827       <span class="i">$AtomType</span> = <span class="q">&#39;HOCO&#39;</span><span class="sc">;</span>
4828       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4829     <span class="s">}</span>
4830 
4831     <span class="c"># HOCC : H-O IN ENOLS AND PHENOLS</span>
4832     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsHydrogenAttachedToEnolOrPhenolOxygen</span><span class="s">(</span><span class="i">$OxygenAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4833       <span class="i">$AtomType</span> = <span class="q">&#39;HOCC&#39;</span><span class="sc">;</span>
4834       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4835     <span class="s">}</span>
4836 
4837     <span class="c"># HOCN : H-O IN HO-C=N</span>
4838     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsHydrogenAttachedToOCNOxygen</span><span class="s">(</span><span class="i">$OxygenAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4839       <span class="i">$AtomType</span> = <span class="q">&#39;HOCN&#39;</span><span class="sc">;</span>
4840       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4841     <span class="s">}</span>
4842 
4843     <span class="c"># HOM : HYDROGEN IN HYDROXIDE ANION</span>
4844     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsHydrogenAttachedToHydroxideAnionOxygen</span><span class="s">(</span><span class="i">$OxygenAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4845       <span class="i">$AtomType</span> = <span class="q">&#39;HOM&#39;</span><span class="sc">;</span>
4846       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4847     <span class="s">}</span>
4848 
4849     <span class="c"># HO+ : HYDROGEN ON O+ OXYGEN</span>
4850     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsHydrogenAttachedToPositivelyChargedOxygen</span><span class="s">(</span><span class="i">$OxygenAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4851       <span class="i">$AtomType</span> = <span class="q">&#39;HO+&#39;</span><span class="sc">;</span>
4852       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4853     <span class="s">}</span>
4854 
4855     <span class="c"># HO=+ : HYDROGEN ON OXENIUM OXYGEN</span>
4856     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsHydrogenAttachedToOxeniumOxygen</span><span class="s">(</span><span class="i">$OxygenAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4857       <span class="i">$AtomType</span> = <span class="q">&#39;HO=+&#39;</span><span class="sc">;</span>
4858       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4859     <span class="s">}</span>
4860 
4861     <span class="c"># HOR : HYDROGEN IN ALCOHOLS</span>
4862     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsHydrogenAttachedToAlcoholOxygen</span><span class="s">(</span><span class="i">$OxygenAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4863       <span class="i">$AtomType</span> = <span class="q">&#39;HOR&#39;</span><span class="sc">;</span>
4864       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4865     <span class="s">}</span>
4866 
4867     <span class="c"># HOH : HYDROGEN IN H2O</span>
4868     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsHydrogenAttachedToWaterOxygen</span><span class="s">(</span><span class="i">$OxygenAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4869       <span class="i">$AtomType</span> = <span class="q">&#39;HOH&#39;</span><span class="sc">;</span>
4870       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4871     <span class="s">}</span>
4872 
4873     <span class="c"># HO: GENERAL H ON OXYGEN</span>
4874     <span class="i">$AtomType</span> = <span class="q">&#39;HO&#39;</span><span class="sc">;</span>
4875   <span class="s">}</span>
4876   <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
4877 <span class="s">}</span>
4878 
4879 <span class="c"># HOR : HYDROGEN IN ALCOHOLS</span>
4880 <span class="c">#</span>
<a name="_IsHydrogenAttachedToAlcoholOxygen-"></a>4881 <span class="k">sub </span><span class="m">_IsHydrogenAttachedToAlcoholOxygen</span> <span class="s">{</span>
4882   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$OxygenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4883 
4884   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_IsAlcoholOxygen</span><span class="s">(</span><span class="i">$OxygenAtom</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4885 <span class="s">}</span>
4886 
4887 <span class="c"># HO : GENERAL H ON OXYGEN</span>
4888 <span class="c">#</span>
<a name="_IsHydrogenAttachedToOxygen-"></a>4889 <span class="k">sub </span><span class="m">_IsHydrogenAttachedToOxygen</span> <span class="s">{</span>
4890   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$OxygenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4891 
4892   <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
4893 <span class="s">}</span>
4894 
4895 <span class="c"># HOM : HYDROGEN IN HYDROXIDE ANION</span>
4896 <span class="c">#</span>
<a name="_IsHydrogenAttachedToHydroxideAnionOxygen-"></a>4897 <span class="k">sub </span><span class="m">_IsHydrogenAttachedToHydroxideAnionOxygen</span> <span class="s">{</span>
4898   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$OxygenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4899 
4900   <span class="c"># H-(O-)</span>
4901   <span class="k">return</span> <span class="i">$OxygenAtom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.FC-1.T1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;H&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4902 <span class="s">}</span>
4903 
4904 <span class="c"># HOCO : H-O IN CARBOXYLIC ACIDS</span>
4905 <span class="c">#</span>
<a name="_IsHydrogenAttachedToCarboxylicAcidOxygen-"></a>4906 <span class="k">sub </span><span class="m">_IsHydrogenAttachedToCarboxylicAcidOxygen</span> <span class="s">{</span>
4907   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$OxygenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4908 
4909   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_IsEsterOrCarboxylicAcidOxygen</span><span class="s">(</span><span class="i">$OxygenAtom</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4910 <span class="s">}</span>
4911 
4912 <span class="c"># HOP : HYDROGEN ON OXYGEN ATTACHED TO PHOSPHOROUS</span>
4913 <span class="c">#</span>
<a name="_IsHydrogenAttachedToOPOxygen-"></a>4914 <span class="k">sub </span><span class="m">_IsHydrogenAttachedToOPOxygen</span> <span class="s">{</span>
4915   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$OxygenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4916 
4917   <span class="k">return</span> <span class="i">$OxygenAtom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;P&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;*&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4918 <span class="s">}</span>
4919 
4920 <span class="c"># HOCC : H-O IN ENOLS AND PHENOLS</span>
4921 <span class="c">#</span>
<a name="_IsHydrogenAttachedToEnolOrPhenolOxygen-"></a>4922 <span class="k">sub </span><span class="m">_IsHydrogenAttachedToEnolOrPhenolOxygen</span> <span class="s">{</span>
4923   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$OxygenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4924 
4925   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_IsEnolicOrPhenolicOxygen</span><span class="s">(</span><span class="i">$OxygenAtom</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4926 <span class="s">}</span>
4927 
4928 <span class="c"># HOCN : H-O IN HO-C=N</span>
4929 <span class="c">#</span>
<a name="_IsHydrogenAttachedToOCNOxygen-"></a>4930 <span class="k">sub </span><span class="m">_IsHydrogenAttachedToOCNOxygen</span> <span class="s">{</span>
4931   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$OxygenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4932 
4933   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_IsOCNDivalentOxygen</span><span class="s">(</span><span class="i">$OxygenAtom</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4934 <span class="s">}</span>
4935 
4936 <span class="c"># HOH : HYDROGEN IN H2O</span>
4937 <span class="c">#</span>
<a name="_IsHydrogenAttachedToWaterOxygen-"></a>4938 <span class="k">sub </span><span class="m">_IsHydrogenAttachedToWaterOxygen</span> <span class="s">{</span>
4939   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$OxygenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4940 
4941   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_IsWaterOxygen</span><span class="s">(</span><span class="i">$OxygenAtom</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4942 <span class="s">}</span>
4943 
4944 <span class="c"># HOS : H ON OXYGEN ATTACHED TO SULFUR</span>
4945 <span class="c">#</span>
<a name="_IsHydrogenAttachedToOSOxygen-"></a>4946 <span class="k">sub </span><span class="m">_IsHydrogenAttachedToOSOxygen</span> <span class="s">{</span>
4947   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$OxygenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4948 
4949   <span class="k">return</span> <span class="i">$OxygenAtom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;S&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;*&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4950 <span class="s">}</span>
4951 
4952 <span class="c"># HO+ : HYDROGEN ON O+ OXYGEN</span>
4953 <span class="c">#</span>
<a name="_IsHydrogenAttachedToPositivelyChargedOxygen-"></a>4954 <span class="k">sub </span><span class="m">_IsHydrogenAttachedToPositivelyChargedOxygen</span> <span class="s">{</span>
4955   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$OxygenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4956 
4957   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_IsPositivelyChargedOxoniumOxygen</span><span class="s">(</span><span class="i">$OxygenAtom</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4958 <span class="s">}</span>
4959 
4960 <span class="c"># HO=+ : HYDROGEN ON OXENIUM OXYGEN</span>
4961 <span class="c">#</span>
<a name="_IsHydrogenAttachedToOxeniumOxygen-"></a>4962 <span class="k">sub </span><span class="m">_IsHydrogenAttachedToOxeniumOxygen</span> <span class="s">{</span>
4963   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$OxygenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4964 
4965   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_IsPositivelyChargedOxeniumOxygen</span><span class="s">(</span><span class="i">$OxygenAtom</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4966 <span class="s">}</span>
4967 
4968 <span class="c"># Get MMFF94 atom type for Hydrogen attached to Phosphorus...</span>
4969 <span class="c">#</span>
<a name="_GetAtomTypeForHydrogenAttachedToPhosphorus-"></a>4970 <span class="k">sub </span><span class="m">_GetAtomTypeForHydrogenAttachedToPhosphorus</span> <span class="s">{</span>
4971   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$PhosphorusAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4972   <span class="k">my</span><span class="s">(</span><span class="i">$AtomType</span><span class="s">)</span><span class="sc">;</span>
4973 
4974   <span class="c"># HP : H ATTACHED TO TRI- OR TETRACOORDINATE PHOSPHORUS</span>
4975   <span class="i">$AtomType</span> = <span class="q">&#39;HP&#39;</span><span class="sc">;</span>
4976 
4977   <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
4978 <span class="s">}</span>
4979 
4980 <span class="c"># Get MMFF94 atom type for Hydrogen attached to Sulfur...</span>
4981 <span class="c">#</span>
<a name="_GetAtomTypeForHydrogenAttachedToSulfur-"></a>4982 <span class="k">sub </span><span class="m">_GetAtomTypeForHydrogenAttachedToSulfur</span> <span class="s">{</span>
4983   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$SulfurAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4984   <span class="k">my</span><span class="s">(</span><span class="i">$AtomType</span><span class="s">)</span><span class="sc">;</span>
4985 
4986   <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
4987 
4988   <span class="j">ATOMTYPE:</span> <span class="s">{</span>
4989 
4990    <span class="c"># HS=N : H ATTACHED TO TETRAVALENT, TRICOODR S DBL BONDED TO N</span>
4991     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsSNTricoordinatedSulfur</span><span class="s">(</span><span class="i">$SulfurAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4992       <span class="i">$AtomType</span> = <span class="q">&#39;HS=N&#39;</span><span class="sc">;</span>
4993       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4994     <span class="s">}</span>
4995 
4996     <span class="c"># HS : H ATTACHED TO DIVALENT, DICOORDINATE S</span>
4997     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsDivalentDiCoordinatedSulfur</span><span class="s">(</span><span class="i">$SulfurAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4998       <span class="i">$AtomType</span> = <span class="q">&#39;HS&#39;</span><span class="sc">;</span>
4999       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
5000     <span class="s">}</span>
5001 
5002     <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
5003     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;_GetAtomTypeForHydrogenAttachedToSulfur: MMFF94 atom type for Sulfur cann&#39;t be assigned...&quot;</span><span class="sc">;</span>
5004   <span class="s">}</span>
5005   <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
5006 <span class="s">}</span>
5007 
5008 <span class="c"># Get MMFF94 atom type for Hydrogen attached to Silicon...</span>
5009 <span class="c">#</span>
<a name="_GetAtomTypeForHydrogenAttachedToSilicon-"></a>5010 <span class="k">sub </span><span class="m">_GetAtomTypeForHydrogenAttachedToSilicon</span> <span class="s">{</span>
5011   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$SiliconAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
5012   <span class="k">my</span><span class="s">(</span><span class="i">$AtomType</span><span class="s">)</span><span class="sc">;</span>
5013 
5014   <span class="c"># HSI : H ATTACHED TO SI</span>
5015   <span class="i">$AtomType</span> = <span class="q">&#39;HSI&#39;</span><span class="sc">;</span>
5016 
5017   <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
5018 <span class="s">}</span>
5019 
5020 <span class="c"># Get information about number and types of hetero atoms present in ring...</span>
5021 <span class="c">#</span>
5022 <span class="c"># Note:</span>
5023 <span class="c">#   . Any atom other than Carbon and Hydrogen atom is considered a hetero atom.</span>
5024 <span class="c">#</span>
<a name="_GetHeteroAtomsInformationInRing-"></a>5025 <span class="k">sub </span><span class="m">_GetHeteroAtomsInformationInRing</span> <span class="s">{</span>
5026   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$RingAtomsRef</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
5027   <span class="k">my</span><span class="s">(</span><span class="i">$RingAtom</span><span class="cm">,</span> <span class="i">$RingAtomSymbol</span><span class="cm">,</span> <span class="i">$RingIsAromatic</span><span class="cm">,</span> <span class="i">$NumOfAromaticAtoms</span><span class="cm">,</span> <span class="i">$NumOfHeteroAtoms</span><span class="cm">,</span> <span class="i">%HeteroAtomSymbolsMap</span><span class="s">)</span><span class="sc">;</span>
5028 
5029   <span class="i">%HeteroAtomSymbolsMap</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
5030 
5031   <span class="i">$NumOfAromaticAtoms</span> = <span class="n">0</span><span class="sc">;</span>
5032   <span class="i">$NumOfHeteroAtoms</span> = <span class="n">0</span><span class="sc">;</span>
5033 
5034   <span class="j">RINGATOM:</span> <span class="k">for</span> <span class="i">$RingAtom</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$RingAtomsRef</span>}<span class="s">)</span> <span class="s">{</span>
5035     <span class="k">if</span> <span class="s">(</span><span class="i">$RingAtom</span><span class="i">-&gt;IsAromatic</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
5036       <span class="i">$NumOfAromaticAtoms</span>++<span class="sc">;</span>
5037     <span class="s">}</span>
5038 
5039     <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;_IsHeteroAtom</span><span class="s">(</span><span class="i">$RingAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
5040       <span class="k">next</span> <span class="j">RINGATOM</span><span class="sc">;</span>
5041     <span class="s">}</span>
5042     <span class="i">$NumOfHeteroAtoms</span>++<span class="sc">;</span>
5043 
5044     <span class="i">$RingAtomSymbol</span> = <span class="i">$RingAtom</span><span class="i">-&gt;GetAtomSymbol</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
5045     <span class="k">if</span> <span class="s">(</span><span class="k">exists</span> <span class="i">$HeteroAtomSymbolsMap</span>{<span class="i">$RingAtomSymbol</span>}<span class="s">)</span> <span class="s">{</span>
5046       <span class="i">$HeteroAtomSymbolsMap</span>{<span class="i">$RingAtomSymbol</span>} += <span class="n">1</span><span class="sc">;</span>
5047     <span class="s">}</span>
5048     <span class="k">else</span> <span class="s">{</span>
5049       <span class="i">$HeteroAtomSymbolsMap</span>{<span class="i">$RingAtomSymbol</span>} = <span class="n">1</span><span class="sc">;</span>
5050     <span class="s">}</span>
5051   <span class="s">}</span>
5052   <span class="i">$RingIsAromatic</span> = <span class="s">(</span><span class="i">$NumOfAromaticAtoms</span> == <span class="k">scalar</span> <span class="i">@</span>{<span class="i">$RingAtomsRef</span>}<span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
5053 
5054   <span class="k">return</span> <span class="s">(</span><span class="i">$RingIsAromatic</span><span class="cm">,</span> <span class="i">$NumOfHeteroAtoms</span><span class="cm">,</span> \<span class="i">%HeteroAtomSymbolsMap</span><span class="s">)</span><span class="sc">;</span>
5055 <span class="s">}</span>
5056 
5057 <span class="c"># Check whether specified atom has a hetero atom at alpha position in an aromatic ring...</span>
5058 <span class="c">#</span>
<a name="_IsAtomPositionAlphaInHeteroAromaticRing-"></a>5059 <span class="k">sub </span><span class="m">_IsAtomPositionAlphaInHeteroAromaticRing</span> <span class="s">{</span>
5060   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="cm">,</span> <span class="i">$RingAtomsRef</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
5061   <span class="k">my</span><span class="s">(</span><span class="i">$CheckRingAromaticity</span><span class="s">)</span><span class="sc">;</span>
5062 
5063   <span class="i">$CheckRingAromaticity</span> = <span class="n">1</span><span class="sc">;</span>
5064 
5065   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_IsAtomPositionAlphaInHeteroRing</span><span class="s">(</span><span class="i">$Atom</span><span class="cm">,</span> <span class="i">$RingAtomsRef</span><span class="cm">,</span> <span class="i">$CheckRingAromaticity</span><span class="s">)</span><span class="sc">;</span>
5066 <span class="s">}</span>
5067 
5068 <span class="c"># Check whether specified atom has a hetero atom at beta position in an aromatic ring...</span>
5069 <span class="c">#</span>
<a name="_IsAtomPositionBetaInHeteroAromaticRing-"></a>5070 <span class="k">sub </span><span class="m">_IsAtomPositionBetaInHeteroAromaticRing</span> <span class="s">{</span>
5071   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="cm">,</span> <span class="i">$RingAtomsRef</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
5072   <span class="k">my</span><span class="s">(</span><span class="i">$CheckRingAromaticity</span><span class="s">)</span><span class="sc">;</span>
5073 
5074   <span class="i">$CheckRingAromaticity</span> = <span class="n">1</span><span class="sc">;</span>
5075 
5076   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_IsAtomPositionBetaInHeteroRing</span><span class="s">(</span><span class="i">$Atom</span><span class="cm">,</span> <span class="i">$RingAtomsRef</span><span class="cm">,</span> <span class="i">$CheckRingAromaticity</span><span class="s">)</span><span class="sc">;</span>
5077 <span class="s">}</span>
5078 
5079 <span class="c"># Check whether specified atom has a hetero atom at alpha position in an aromatic or non-aromatic</span>
5080 <span class="c"># ring...</span>
5081 <span class="c">#</span>
<a name="_IsAtomPositionAlphaInHeteroRing-"></a>5082 <span class="k">sub </span><span class="m">_IsAtomPositionAlphaInHeteroRing</span> <span class="s">{</span>
5083   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="cm">,</span> <span class="i">$RingAtomsRef</span><span class="cm">,</span> <span class="i">$CheckRingAromaticity</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
5084   <span class="k">my</span><span class="s">(</span><span class="i">$RingIsAromatic</span><span class="cm">,</span> <span class="i">$NumOfHeteroAtoms</span><span class="cm">,</span> <span class="i">$NumOfAllowedHeteroAtoms</span><span class="cm">,</span> <span class="i">$HeteroAtomPositionsRef</span><span class="s">)</span><span class="sc">;</span>
5085 
5086   <span class="i">$CheckRingAromaticity</span> = <span class="k">defined</span><span class="s">(</span><span class="i">$CheckRingAromaticity</span><span class="s">)</span> &amp;&amp; <span class="i">$CheckRingAromaticity</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
5087 
5088   <span class="c"># Is it an aromatic ring containing appropriate number hertero atoms?</span>
5089   <span class="s">(</span><span class="i">$RingIsAromatic</span><span class="cm">,</span> <span class="i">$NumOfHeteroAtoms</span><span class="s">)</span> = <span class="i">$This</span><span class="i">-&gt;_GetHeteroAtomsInformationInRing</span><span class="s">(</span><span class="i">$RingAtomsRef</span><span class="s">)</span><span class="sc">;</span>
5090   <span class="i">$NumOfAllowedHeteroAtoms</span> = <span class="i">$Atom</span><span class="i">-&gt;IsCarbon</span><span class="s">(</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">2</span><span class="sc">;</span>
5091 
5092   <span class="k">if</span> <span class="s">(</span><span class="i">$CheckRingAromaticity</span> &amp;&amp; !<span class="i">$RingIsAromatic</span><span class="s">)</span> <span class="s">{</span>
5093     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
5094   <span class="s">}</span>
5095 
5096   <span class="k">if</span> <span class="s">(</span><span class="i">$NumOfHeteroAtoms</span> != <span class="i">$NumOfAllowedHeteroAtoms</span><span class="s">)</span> <span class="s">{</span>
5097     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
5098   <span class="s">}</span>
5099 
5100   <span class="c"># Does ring contain hetero atoms at alpha position?</span>
5101   <span class="i">$HeteroAtomPositionsRef</span> = <span class="i">$This</span><span class="i">-&gt;_GetHeteroAtomPositionsInRing</span><span class="s">(</span><span class="i">$Atom</span><span class="cm">,</span> <span class="i">$RingAtomsRef</span><span class="s">)</span><span class="sc">;</span>
5102   <span class="k">if</span> <span class="s">(</span><span class="k">exists</span><span class="s">(</span><span class="i">$HeteroAtomPositionsRef</span>-&gt;{<span class="w">Alpha</span>}<span class="s">)</span> &amp;&amp; !<span class="k">exists</span><span class="s">(</span><span class="i">$HeteroAtomPositionsRef</span>-&gt;{<span class="w">Beta</span>}<span class="s">)</span><span class="s">)</span> <span class="s">{</span>
5103     <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
5104   <span class="s">}</span>
5105 
5106   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
5107 <span class="s">}</span>
5108 
5109 <span class="c"># Check whether specified atom has a hetero atom at alpha position in an aromatic or non-aromatic</span>
5110 <span class="c"># ring...</span>
5111 <span class="c">#</span>
<a name="_IsAtomPositionBetaInHeteroRing-"></a>5112 <span class="k">sub </span><span class="m">_IsAtomPositionBetaInHeteroRing</span> <span class="s">{</span>
5113   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="cm">,</span> <span class="i">$RingAtomsRef</span><span class="cm">,</span> <span class="i">$CheckRingAromaticity</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
5114   <span class="k">my</span><span class="s">(</span><span class="i">$RingIsAromatic</span><span class="cm">,</span> <span class="i">$NumOfHeteroAtoms</span><span class="cm">,</span> <span class="i">$NumOfAllowedHeteroAtoms</span><span class="cm">,</span> <span class="i">$HeteroAtomPositionsRef</span><span class="s">)</span><span class="sc">;</span>
5115 
5116   <span class="i">$CheckRingAromaticity</span> = <span class="k">defined</span><span class="s">(</span><span class="i">$CheckRingAromaticity</span><span class="s">)</span> &amp;&amp; <span class="i">$CheckRingAromaticity</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
5117 
5118   <span class="c"># Is it an aromatic ring containing hertero atoms?</span>
5119   <span class="s">(</span><span class="i">$RingIsAromatic</span><span class="cm">,</span> <span class="i">$NumOfHeteroAtoms</span><span class="s">)</span> = <span class="i">$This</span><span class="i">-&gt;_GetHeteroAtomsInformationInRing</span><span class="s">(</span><span class="i">$RingAtomsRef</span><span class="s">)</span><span class="sc">;</span>
5120   <span class="i">$NumOfAllowedHeteroAtoms</span> = <span class="i">$Atom</span><span class="i">-&gt;IsCarbon</span><span class="s">(</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">2</span><span class="sc">;</span>
5121 
5122   <span class="k">if</span> <span class="s">(</span><span class="i">$CheckRingAromaticity</span> &amp;&amp; !<span class="i">$RingIsAromatic</span><span class="s">)</span> <span class="s">{</span>
5123     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
5124   <span class="s">}</span>
5125 
5126   <span class="k">if</span> <span class="s">(</span><span class="i">$NumOfHeteroAtoms</span> != <span class="i">$NumOfAllowedHeteroAtoms</span><span class="s">)</span> <span class="s">{</span>
5127     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
5128   <span class="s">}</span>
5129 
5130   <span class="c"># Does ring contain hetero atoms at alpha position?</span>
5131   <span class="i">$HeteroAtomPositionsRef</span> = <span class="i">$This</span><span class="i">-&gt;_GetHeteroAtomPositionsInRing</span><span class="s">(</span><span class="i">$Atom</span><span class="cm">,</span> <span class="i">$RingAtomsRef</span><span class="s">)</span><span class="sc">;</span>
5132   <span class="k">if</span> <span class="s">(</span><span class="k">exists</span><span class="s">(</span><span class="i">$HeteroAtomPositionsRef</span>-&gt;{<span class="w">Beta</span>}<span class="s">)</span> &amp;&amp; !<span class="k">exists</span><span class="s">(</span><span class="i">$HeteroAtomPositionsRef</span>-&gt;{<span class="w">Alpha</span>}<span class="s">)</span><span class="s">)</span> <span class="s">{</span>
5133     <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
5134   <span class="s">}</span>
5135 
5136   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
5137 <span class="s">}</span>
5138 
5139 <span class="c"># Get hetro atom positions relative to atom position...</span>
5140 <span class="c">#</span>
5141 <span class="c"># Notes:</span>
5142 <span class="c">#    . Any atom other than Carbon and Hydrogen atom is considered a hetero atom.</span>
5143 <span class="c">#</span>
<a name="_GetHeteroAtomPositionsInRing-"></a>5144 <span class="k">sub </span><span class="m">_GetHeteroAtomPositionsInRing</span> <span class="s">{</span>
5145   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="cm">,</span> <span class="i">$RingAtomsRef</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
5146   <span class="k">my</span><span class="s">(</span><span class="i">$RingAtom</span><span class="cm">,</span> <span class="i">$Index</span><span class="cm">,</span> <span class="i">$AtomIndex</span><span class="cm">,</span> <span class="i">$NumOfHeteroAtoms</span><span class="cm">,</span> <span class="i">%HeteroAtomPositionsMap</span><span class="s">)</span><span class="sc">;</span>
5147 
5148   <span class="i">%HeteroAtomPositionsMap</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
5149 
5150   <span class="i">$NumOfHeteroAtoms</span> = <span class="n">0</span><span class="sc">;</span>
5151   <span class="i">$AtomIndex</span> = <span class="n">0</span><span class="sc">;</span>
5152   <span class="i">$Index</span> = <span class="n">0</span><span class="sc">;</span>
5153 
5154   <span class="c"># Find position of specified atom in the ring and count hetero atoms...</span>
5155   <span class="k">for</span> <span class="i">$RingAtom</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$RingAtomsRef</span>}<span class="s">)</span> <span class="s">{</span>
5156     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsHeteroAtom</span><span class="s">(</span><span class="i">$RingAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
5157       <span class="i">$NumOfHeteroAtoms</span>++<span class="sc">;</span>
5158     <span class="s">}</span>
5159     <span class="k">if</span> <span class="s">(</span><span class="i">$RingAtom</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span> == <span class="i">$Atom</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
5160       <span class="i">$AtomIndex</span> = <span class="i">$Index</span><span class="sc">;</span>
5161     <span class="s">}</span>
5162     <span class="i">$Index</span>++<span class="sc">;</span>
5163   <span class="s">}</span>
5164 
5165   <span class="c"># Does ring contain any hetereo atoms?</span>
5166   <span class="k">if</span> <span class="s">(</span>!<span class="i">$NumOfHeteroAtoms</span><span class="s">)</span> <span class="s">{</span>
5167     <span class="k">return</span> \<span class="i">%HeteroAtomPositionsMap</span><span class="sc">;</span>
5168   <span class="s">}</span>
5169 
5170   <span class="c"># Check hetero atoms around specified atom to determine their position using their</span>
5171   <span class="c"># their distance from specified atom: 1 - Alpha, 2 - Beta, 3 - Gamma, 4 - Delta, 5 - Omega</span>
5172   <span class="c">#</span>
5173   <span class="k">my</span><span class="s">(</span><span class="i">$RingSize</span><span class="cm">,</span> <span class="i">$MaxPositionNum</span><span class="cm">,</span> <span class="i">$PositionNum</span><span class="cm">,</span> <span class="i">$PositionName</span><span class="cm">,</span> <span class="i">$MaxAtomIndex</span><span class="cm">,</span> <span class="i">$BeforeAtomIndex</span><span class="cm">,</span> <span class="i">$AfterAtomIndex</span><span class="cm">,</span> <span class="i">$BeforeAtom</span><span class="cm">,</span> <span class="i">$AfterAtom</span><span class="cm">,</span> <span class="i">%PositionNumToNameMap</span><span class="s">)</span><span class="sc">;</span>
5174 
5175   <span class="i">%PositionNumToNameMap</span> = <span class="s">(</span><span class="q">&#39;1&#39;</span> <span class="cm">=&gt;</span> <span class="q">&#39;Alpha&#39;</span><span class="cm">,</span> <span class="q">&#39;2&#39;</span> <span class="cm">=&gt;</span> <span class="q">&#39;Beta&#39;</span><span class="cm">,</span> <span class="q">&#39;3&#39;</span> <span class="cm">=&gt;</span> <span class="q">&#39;Gamma&#39;</span><span class="cm">,</span> <span class="q">&#39;4&#39;</span> <span class="cm">=&gt;</span> <span class="q">&#39;Delta&#39;</span><span class="cm">,</span> <span class="q">&#39;5&#39;</span> <span class="cm">=&gt;</span> <span class="q">&#39;Omega&#39;</span><span class="s">)</span><span class="sc">;</span>
5176 
5177   <span class="i">$RingSize</span> = <span class="k">scalar</span> <span class="i">@</span>{<span class="i">$RingAtomsRef</span>}<span class="sc">;</span>
5178   <span class="i">$MaxPositionNum</span> = <span class="k">int</span> <span class="i">$RingSize</span>/<span class="n">2</span><span class="sc">;</span>
5179   <span class="i">$MaxAtomIndex</span> = <span class="i">$RingSize</span> - <span class="n">1</span><span class="sc">;</span>
5180 
5181   <span class="j">POSITIONNUM:</span> <span class="k">for</span> <span class="i">$PositionNum</span> <span class="s">(</span><span class="n">1</span> .. <span class="i">$MaxPositionNum</span><span class="s">)</span> <span class="s">{</span>
5182     <span class="c"># Get atom before atom at a specific position...</span>
5183     <span class="i">$BeforeAtomIndex</span> = <span class="i">$AtomIndex</span> - <span class="i">$PositionNum</span><span class="sc">;</span>
5184     <span class="k">if</span> <span class="s">(</span><span class="i">$BeforeAtomIndex</span> &lt; <span class="n">0</span><span class="s">)</span> <span class="s">{</span>
5185       <span class="i">$BeforeAtomIndex</span> = <span class="i">$MaxAtomIndex</span> + <span class="i">$BeforeAtomIndex</span> + <span class="n">1</span><span class="sc">;</span>
5186     <span class="s">}</span>
5187     <span class="i">$BeforeAtom</span> = <span class="i">$RingAtomsRef</span>-&gt;[<span class="i">$BeforeAtomIndex</span>]<span class="sc">;</span>
5188 
5189     <span class="i">$PositionName</span> = <span class="k">exists</span> <span class="i">$PositionNumToNameMap</span>{<span class="i">$PositionNum</span>} ? <span class="i">$PositionNumToNameMap</span>{<span class="i">$PositionNum</span>} <span class="co">:</span> <span class="q">&#39;Unknown&#39;</span><span class="sc">;</span>
5190 
5191     <span class="c"># Is atom before atom at a specific position a hetero atom?</span>
5192     <span class="k">if</span> <span class="s">(</span>!<span class="i">$BeforeAtom</span><span class="i">-&gt;IsCarbon</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
5193       <span class="i">$This</span><span class="i">-&gt;_TrackHeteroAtomPositionInRing</span><span class="s">(</span><span class="i">$BeforeAtom</span><span class="cm">,</span> <span class="i">$PositionName</span><span class="cm">,</span> \<span class="i">%HeteroAtomPositionsMap</span><span class="s">)</span><span class="sc">;</span>
5194     <span class="s">}</span>
5195 
5196     <span class="c"># Get atom after atom at a specific position...</span>
5197     <span class="i">$AfterAtomIndex</span> = <span class="i">$AtomIndex</span> + <span class="i">$PositionNum</span><span class="sc">;</span>
5198     <span class="k">if</span> <span class="s">(</span><span class="i">$AfterAtomIndex</span> &gt; <span class="i">$MaxAtomIndex</span><span class="s">)</span> <span class="s">{</span>
5199       <span class="i">$AfterAtomIndex</span> = <span class="i">$AfterAtomIndex</span> - <span class="i">$MaxAtomIndex</span> - <span class="n">1</span><span class="sc">;</span>
5200     <span class="s">}</span>
5201 
5202     <span class="c"># Is it a different atom?</span>
5203     <span class="k">if</span> <span class="s">(</span><span class="i">$AfterAtomIndex</span> == <span class="i">$BeforeAtomIndex</span><span class="s">)</span> <span class="s">{</span>
5204       <span class="k">next</span> <span class="j">POSITIONNUM</span><span class="sc">;</span>
5205     <span class="s">}</span>
5206 
5207     <span class="c"># Is atom after atom at a specific position a hetero atom?</span>
5208     <span class="i">$AfterAtom</span> = <span class="i">$RingAtomsRef</span>-&gt;[<span class="i">$AfterAtomIndex</span>]<span class="sc">;</span>
5209 
5210     <span class="k">if</span> <span class="s">(</span>!<span class="i">$AfterAtom</span><span class="i">-&gt;IsCarbon</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
5211       <span class="i">$This</span><span class="i">-&gt;_TrackHeteroAtomPositionInRing</span><span class="s">(</span><span class="i">$AfterAtom</span><span class="cm">,</span> <span class="i">$PositionName</span><span class="cm">,</span> \<span class="i">%HeteroAtomPositionsMap</span><span class="s">)</span><span class="sc">;</span>
5212     <span class="s">}</span>
5213   <span class="s">}</span>
5214   <span class="k">return</span> \<span class="i">%HeteroAtomPositionsMap</span><span class="sc">;</span>
5215 <span class="s">}</span>
5216 
5217 <span class="c"># Is it a hetero atom?</span>
5218 <span class="c">#</span>
5219 <span class="c"># Notes:</span>
5220 <span class="c">#    . Any atom other than Carbon and Hydrogen atom is considered a hetero atom.</span>
5221 <span class="c">#</span>
<a name="_IsHeteroAtom-"></a>5222 <span class="k">sub </span><span class="m">_IsHeteroAtom</span> <span class="s">{</span>
5223   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
5224 
5225   <span class="k">return</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;IsCarbon</span><span class="s">(</span><span class="s">)</span> || <span class="i">$Atom</span><span class="i">-&gt;IsHydrogen</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> ? <span class="n">0</span> <span class="co">:</span> <span class="n">1</span><span class="sc">;</span>
5226 <span class="s">}</span>
5227 
5228 <span class="c"># Track hetero atom positions in ring by updating data in specified data hash reference...</span>
5229 <span class="c">#</span>
<a name="_TrackHeteroAtomPositionInRing-"></a>5230 <span class="k">sub </span><span class="m">_TrackHeteroAtomPositionInRing</span> <span class="s">{</span>
5231   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$HeteroAtom</span><span class="cm">,</span> <span class="i">$PositionName</span><span class="cm">,</span> <span class="i">$HeteroAtomPositionsMapRef</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
5232   <span class="k">my</span><span class="s">(</span><span class="i">$HeteroAtomSymbol</span><span class="s">)</span><span class="sc">;</span>
5233 
5234   <span class="c"># Is it a new hetero atom position?</span>
5235   <span class="k">if</span> <span class="s">(</span>!<span class="k">exists</span> <span class="i">$HeteroAtomPositionsMapRef</span>-&gt;{<span class="i">$PositionName</span>}<span class="s">)</span> <span class="s">{</span>
5236     <span class="i">%</span>{<span class="i">$HeteroAtomPositionsMapRef</span>-&gt;{<span class="i">$PositionName</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
5237   <span class="s">}</span>
5238 
5239   <span class="i">$HeteroAtomSymbol</span> = <span class="i">$HeteroAtom</span><span class="i">-&gt;GetAtomSymbol</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
5240   <span class="k">if</span> <span class="s">(</span><span class="k">exists</span> <span class="i">$HeteroAtomPositionsMapRef</span>-&gt;{<span class="i">$PositionName</span>}{<span class="i">$HeteroAtomSymbol</span>}<span class="s">)</span> <span class="s">{</span>
5241     <span class="i">$HeteroAtomPositionsMapRef</span>-&gt;{<span class="i">$PositionName</span>}{<span class="i">$HeteroAtomSymbol</span>} += <span class="n">1</span><span class="sc">;</span>
5242   <span class="s">}</span>
5243   <span class="k">else</span> <span class="s">{</span>
5244     <span class="i">$HeteroAtomPositionsMapRef</span>-&gt;{<span class="i">$PositionName</span>}{<span class="i">$HeteroAtomSymbol</span>} += <span class="n">1</span><span class="sc">;</span>
5245   <span class="s">}</span>
5246   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
5247 <span class="s">}</span>
5248 
5249 <span class="c"># Return a string containg data for MMFF94AtomTypes object...</span>
5250 <span class="c">#</span>
<a name="StringifyMMFF94AtomTypes-"></a>5251 <span class="k">sub </span><span class="m">StringifyMMFF94AtomTypes</span> <span class="s">{</span>
5252   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
5253   <span class="k">my</span><span class="s">(</span><span class="i">$AtomTypesString</span><span class="s">)</span><span class="sc">;</span>
5254 
5255   <span class="c"># Type of AtomTypes...</span>
5256   <span class="i">$AtomTypesString</span> = <span class="q">&quot;AtomTypes: $This-&gt;{Type}; IgnoreHydrogens: &quot;</span> . <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">IgnoreHydrogens</span>} ? <span class="q">&quot;Yes&quot;</span> <span class="co">:</span> <span class="q">&quot;No&quot;</span><span class="s">)</span><span class="sc">;</span>
5257 
5258   <span class="c"># Setup atom types information...</span>
5259   <span class="k">my</span><span class="s">(</span><span class="i">$AtomID</span><span class="cm">,</span> <span class="i">$AtomType</span><span class="cm">,</span> <span class="i">@AtomTypesInfo</span><span class="cm">,</span> <span class="i">%AssignedAtomTypes</span><span class="s">)</span><span class="sc">;</span>
5260 
5261   <span class="i">@AtomTypesInfo</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
5262   <span class="i">%AssignedAtomTypes</span> = <span class="i">$This</span><span class="i">-&gt;GetAtomTypes</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
5263 
5264   <span class="k">for</span> <span class="i">$AtomID</span> <span class="s">(</span><span class="k">sort</span> <span class="s">{</span> <span class="i">$a</span> &lt;=&gt; <span class="i">$b</span> <span class="s">}</span> <span class="k">keys</span> <span class="i">%AssignedAtomTypes</span><span class="s">)</span> <span class="s">{</span>
5265     <span class="i">$AtomType</span> = <span class="i">$AssignedAtomTypes</span>{<span class="i">$AtomID</span>} ? <span class="i">$AssignedAtomTypes</span>{<span class="i">$AtomID</span>} <span class="co">:</span> <span class="q">&#39;None&#39;</span><span class="sc">;</span>
5266     <span class="k">push</span> <span class="i">@AtomTypesInfo</span><span class="cm">,</span> <span class="q">&quot;$AtomID:$AtomType&quot;</span><span class="sc">;</span>
5267   <span class="s">}</span>
5268   <span class="i">$AtomTypesString</span> .= <span class="q">&quot;; AtomIDs:AtomTypes: &lt;&quot;</span> . <span class="i">TextUtil::JoinWords</span><span class="s">(</span>\<span class="i">@AtomTypesInfo</span><span class="cm">,</span> <span class="q">&quot;, &quot;</span><span class="cm">,</span> <span class="n">0</span><span class="s">)</span> . <span class="q">&quot;&gt;&quot;</span><span class="sc">;</span>
5269 
5270   <span class="k">return</span> <span class="i">$AtomTypesString</span><span class="sc">;</span>
5271 <span class="s">}</span>
5272 
5273 <span class="c"># Is it a MMFF94AtomTypes object?</span>
<a name="_IsMMFF94AtomTypes-"></a>5274 <span class="k">sub </span><span class="m">_IsMMFF94AtomTypes</span> <span class="s">{</span>
5275   <span class="k">my</span><span class="s">(</span><span class="i">$Object</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
5276 
5277   <span class="k">return</span> <span class="s">(</span><span class="i">Scalar::Util::blessed</span><span class="s">(</span><span class="i">$Object</span><span class="s">)</span> &amp;&amp; <span class="i">$Object</span><span class="i">-&gt;isa</span><span class="s">(</span><span class="i">$ClassName</span><span class="s">)</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
5278 <span class="s">}</span>
5279 
5280 <span class="c"># Check and load MMFF94 atom types data...</span>
5281 <span class="c">#</span>
<a name="_CheckAndLoadMMFF94AtomTypesData-"></a>5282 <span class="k">sub </span><span class="m">_CheckAndLoadMMFF94AtomTypesData</span> <span class="s">{</span>
5283 
5284   <span class="c"># Is it already loaded?</span>
5285   <span class="k">if</span> <span class="s">(</span><span class="k">exists</span> <span class="i">$MMFF94AtomTypesDataMap</span>{<span class="w">AtomTypes</span>}<span class="s">)</span> <span class="s">{</span>
5286     <span class="k">return</span><span class="sc">;</span>
5287   <span class="s">}</span>
5288 
5289   <span class="i">_LoadMMFF94AtomTypesData</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
5290 <span class="s">}</span>
5291 
5292 <span class="c"># Load MMFF94 atom types data from the file assuming first column to be atom type symbol..</span>
5293 <span class="c">#</span>
5294 <span class="c"># Format:</span>
5295 <span class="c">#</span>
5296 <span class="c"># &quot;AtomTypeSymbol&quot;,&quot;AtomTypeNum&quot;,&quot;ElementSymbol&quot;,&quot;AtomTypeDefinition&quot;</span>
5297 <span class="c"># &quot;CR&quot;,&quot;1&quot;,&quot;C&quot;,&quot;ALKYL CARBON, SP3&quot;</span>
5298 <span class="c"># &quot;C=C&quot;,&quot;2&quot;,&quot;C&quot;,&quot;VINYLIC CARBON, SP2&quot;</span>
5299 <span class="c">#</span>
<a name="_LoadMMFF94AtomTypesData-"></a>5300 <span class="k">sub </span><span class="m">_LoadMMFF94AtomTypesData</span> <span class="s">{</span>
5301   <span class="k">my</span><span class="s">(</span><span class="i">$AtomTypesDataFile</span><span class="cm">,</span> <span class="i">$MayaChemToolsLibDir</span><span class="s">)</span><span class="sc">;</span>
5302 
5303   <span class="i">$MayaChemToolsLibDir</span> = <span class="i">FileUtil::GetMayaChemToolsLibDirName</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
5304 
5305   <span class="i">$AtomTypesDataFile</span> =  <span class="q">&quot;$MayaChemToolsLibDir&quot;</span> . <span class="q">&quot;/data/MMFF94AtomTypes.csv&quot;</span><span class="sc">;</span>
5306   <span class="k">if</span> <span class="s">(</span>! <span class="k">-e</span> <span class="q">&quot;$AtomTypesDataFile&quot;</span><span class="s">)</span> <span class="s">{</span>
5307     <span class="w">croak</span> <span class="q">&quot;Error: MayaChemTools package file, $AtomTypesDataFile, is missing: Possible installation problems...&quot;</span><span class="sc">;</span>
5308   <span class="s">}</span>
5309 
5310   <span class="i">%MMFF94AtomTypesDataMap</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
5311   <span class="i">AtomTypes::AtomTypes::LoadAtomTypesData</span><span class="s">(</span><span class="i">$AtomTypesDataFile</span><span class="cm">,</span> \<span class="i">%MMFF94AtomTypesDataMap</span><span class="s">)</span><span class="sc">;</span>
5312 <span class="s">}</span>
5313 
<a name="EOF-"></a></pre>
<p>&nbsp;</p>
<br />
<center>
<img src="../../../images/h2o2.png">
</center>
</body>
</html>
