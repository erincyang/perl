<html>
<head>
<title>MayaChemTools:Code:AtomTypes::TPSAAtomTypes.pm</title>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<link rel="stylesheet" type="text/css" href="../../../css/MayaChemToolsCode.css">
</head>
<body leftmargin="20" rightmargin="20" topmargin="10" bottommargin="10">
<br/>
<center>
<a href="http://www.mayachemtools.org" title="MayaChemTools Home"><img src="../../../images/MayaChemToolsLogo.gif" border="0" alt="MayaChemTools"></a>
</center>
<br/>
<pre>
<a name="package-AtomTypes::TPSAAtomTypes-"></a>   1 <span class="k">package </span><span class="i">AtomTypes::TPSAAtomTypes</span><span class="sc">;</span>
   2 <span class="c">#</span>
   3 <span class="c"># $RCSfile: TPSAAtomTypes.pm,v $</span>
   4 <span class="c"># $Date: 2017/01/12 18:58:32 $</span>
   5 <span class="c"># $Revision: 1.17 $</span>
   6 <span class="c">#</span>
   7 <span class="c"># Author: Manish Sud &lt;msud@san.rr.com&gt;</span>
   8 <span class="c">#</span>
   9 <span class="c"># Copyright (C) 2017 Manish Sud. All rights reserved.</span>
  10 <span class="c">#</span>
  11 <span class="c"># This file is part of MayaChemTools.</span>
  12 <span class="c">#</span>
  13 <span class="c"># MayaChemTools is free software; you can redistribute it and/or modify it under</span>
  14 <span class="c"># the terms of the GNU Lesser General Public License as published by the Free</span>
  15 <span class="c"># Software Foundation; either version 3 of the License, or (at your option) any</span>
  16 <span class="c"># later version.</span>
  17 <span class="c">#</span>
  18 <span class="c"># MayaChemTools is distributed in the hope that it will be useful, but without</span>
  19 <span class="c"># any warranty; without even the implied warranty of merchantability of fitness</span>
  20 <span class="c"># for a particular purpose.  See the GNU Lesser General Public License for more</span>
  21 <span class="c"># details.</span>
  22 <span class="c">#</span>
  23 <span class="c"># You should have received a copy of the GNU Lesser General Public License</span>
  24 <span class="c"># along with MayaChemTools; if not, see &lt;http://www.gnu.org/licenses/&gt; or</span>
  25 <span class="c"># write to the Free Software Foundation Inc., 59 Temple Place, Suite 330,</span>
  26 <span class="c"># Boston, MA, 02111-1307, USA.</span>
  27 <span class="c">#</span>
  28 
  29 <span class="k">use</span> <span class="w">strict</span><span class="sc">;</span>
  30 <span class="k">use</span> <span class="w">Carp</span><span class="sc">;</span>
  31 <span class="k">use</span> <span class="w">Exporter</span><span class="sc">;</span>
  32 <span class="k">use</span> <span class="w">Scalar::Util</span> <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  33 <span class="k">use</span> <span class="w">Text::ParseWords</span><span class="sc">;</span>
  34 <span class="k">use</span> <span class="w">AtomTypes::AtomTypes</span><span class="sc">;</span>
  35 <span class="k">use</span> <span class="w">Molecule</span><span class="sc">;</span>
  36 
  37 <span class="k">use</span> <span class="w">vars</span> <span class="q">qw(@ISA @EXPORT @EXPORT_OK %EXPORT_TAGS)</span><span class="sc">;</span>
  38 
  39 <span class="i">@ISA</span> = <span class="q">qw(AtomTypes::AtomTypes Exporter)</span><span class="sc">;</span>
  40 <span class="i">@EXPORT</span> = <span class="q">qw(GetTPSAAtomTypesData GetAllPossibleTPSAAtomTypes)</span><span class="sc">;</span>
  41 <span class="i">@EXPORT_OK</span> = <span class="q">qw()</span><span class="sc">;</span>
  42 
  43 <span class="i">%EXPORT_TAGS</span> = <span class="s">(</span><span class="w">all</span>  <span class="cm">=&gt;</span> <span class="s">[</span><span class="i">@EXPORT</span><span class="cm">,</span> <span class="i">@EXPORT_OK</span><span class="s">]</span><span class="s">)</span><span class="sc">;</span>
  44 
  45 <span class="c"># Setup class variables...</span>
  46 <span class="k">my</span><span class="s">(</span><span class="i">$ClassName</span><span class="cm">,</span> <span class="i">%TPSAAtomTypesDataMap</span><span class="s">)</span><span class="sc">;</span>
  47 <span class="i">_InitializeClass</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  48 
  49 <span class="c"># Overload Perl functions...</span>
  50 <span class="k">use</span> <span class="w">overload</span> <span class="q">&#39;&quot;&quot;&#39;</span> <span class="cm">=&gt;</span> <span class="q">&#39;StringifyTPSAAtomTypes&#39;</span><span class="sc">;</span>
  51 
  52 <span class="c"># Class constructor...</span>
<a name="new-"></a>  53 <span class="k">sub </span><span class="m">new</span> <span class="s">{</span>
  54   <span class="k">my</span><span class="s">(</span><span class="i">$Class</span><span class="cm">,</span> <span class="i">%NamesAndValues</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
  55 
  56   <span class="c"># Initialize object...</span>
  57   <span class="k">my</span> <span class="i">$This</span> = <span class="i">$Class</span><span class="i">-&gt;SUPER::new</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  58   <span class="k">bless</span> <span class="i">$This</span><span class="cm">,</span> <span class="k">ref</span><span class="s">(</span><span class="i">$Class</span><span class="s">)</span> || <span class="i">$Class</span><span class="sc">;</span>
  59   <span class="i">$This</span><span class="i">-&gt;_InitializeTPSAAtomTypes</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  60 
  61   <span class="i">$This</span><span class="i">-&gt;_InitializeTPSAAtomTypesProperties</span><span class="s">(</span><span class="i">%NamesAndValues</span><span class="s">)</span><span class="sc">;</span>
  62 
  63   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
  64 <span class="s">}</span>
  65 
  66 <span class="c"># Initialize class ...</span>
<a name="_InitializeClass-"></a>  67 <span class="k">sub </span><span class="m">_InitializeClass</span> <span class="s">{</span>
  68   <span class="c">#Class name...</span>
  69   <span class="i">$ClassName</span> = <span class="w">__PACKAGE__</span><span class="sc">;</span>
  70 
  71   <span class="c"># Initialize the data hash. It&#39;ll be loaded on demand later...</span>
  72   <span class="i">%TPSAAtomTypesDataMap</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  73 <span class="s">}</span>
  74 
  75 <span class="c"># Initialize object data...</span>
  76 <span class="c">#</span>
<a name="_InitializeTPSAAtomTypes-"></a>  77 <span class="k">sub </span><span class="m">_InitializeTPSAAtomTypes</span> <span class="s">{</span>
  78   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
  79 
  80   <span class="c"># Type of AtomTypes...</span>
  81   <span class="i">$This</span>-&gt;{<span class="w">Type</span>} = <span class="q">&#39;TPSA&#39;</span><span class="sc">;</span>
  82 
  83   <span class="c"># Besides polar atoms - N, O, P, S - no TPSA atom types are assigned to any other</span>
  84   <span class="c"># atoms.</span>
  85   <span class="c">#</span>
  86   <span class="c"># By default, TPSA atom types are not assigned to Phosphorus and Sulfur atoms.</span>
  87   <span class="c">#</span>
  88   <span class="i">$This</span>-&gt;{<span class="w">IgnorePhosphorus</span>} = <span class="n">0</span><span class="sc">;</span>
  89   <span class="i">$This</span>-&gt;{<span class="w">IgnoreSulfur</span>} = <span class="n">0</span><span class="sc">;</span>
  90 
  91   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
  92 <span class="s">}</span>
  93 
  94 <span class="c"># Initialize object properties...</span>
  95 <span class="c">#</span>
<a name="_InitializeTPSAAtomTypesProperties-"></a>  96 <span class="k">sub </span><span class="m">_InitializeTPSAAtomTypesProperties</span> <span class="s">{</span>
  97   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">%NamesAndValues</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
  98 
  99   <span class="k">my</span><span class="s">(</span><span class="i">$Name</span><span class="cm">,</span> <span class="i">$Value</span><span class="cm">,</span> <span class="i">$MethodName</span><span class="s">)</span><span class="sc">;</span>
 100   <span class="k">while</span> <span class="s">(</span><span class="s">(</span><span class="i">$Name</span><span class="cm">,</span> <span class="i">$Value</span><span class="s">)</span> = <span class="k">each</span>  <span class="i">%NamesAndValues</span><span class="s">)</span> <span class="s">{</span>
 101     <span class="i">$MethodName</span> = <span class="q">&quot;Set${Name}&quot;</span><span class="sc">;</span>
 102     <span class="i">$This</span><span class="i">-&gt;$MethodName</span><span class="s">(</span><span class="i">$Value</span><span class="s">)</span><span class="sc">;</span>
 103   <span class="s">}</span>
 104 
 105   <span class="c"># Make sure molecule object was specified...</span>
 106   <span class="k">if</span> <span class="s">(</span>!<span class="k">exists</span> <span class="i">$NamesAndValues</span>{<span class="w">Molecule</span>}<span class="s">)</span> <span class="s">{</span>
 107     <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;New: Object can&#39;t be instantiated without specifying molecule...&quot;</span><span class="sc">;</span>
 108   <span class="s">}</span>
 109 
 110   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 111 <span class="s">}</span>
 112 
 113 <span class="c"># Get TPSA atom types and associated data loaded from TPSA data file as</span>
 114 <span class="c"># a reference to hash with the following hash data format:</span>
 115 <span class="c">#</span>
 116 <span class="c"># @{$TPSAAtomTypesDataMap{AtomTypes}} - Array of all possible atom types for all atoms</span>
 117 <span class="c"># @{$TPSAAtomTypesDataMap-&gt;{ColLabels}} - Array of column labels</span>
 118 <span class="c"># %{$TPSAAtomTypesDataMap-&gt;{DataCol&lt;Num&gt;}} - Hash keys pair: &lt;DataCol&lt;Num&gt;, AtomType&gt;</span>
 119 <span class="c">#</span>
 120 <span class="c"># This functionality can be either invoked as a class function or an</span>
 121 <span class="c"># object method.</span>
 122 <span class="c">#</span>
<a name="GetTPSAAtomTypesData-"></a> 123 <span class="k">sub </span><span class="m">GetTPSAAtomTypesData</span> <span class="s">{</span>
 124 
 125   <span class="c"># Make sure data is loaded...</span>
 126   <span class="i">_CheckAndLoadTPSAAtomTypesData</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 127 
 128   <span class="k">return</span> \<span class="i">%TPSAAtomTypesDataMap</span><span class="sc">;</span>
 129 <span class="s">}</span>
 130 
 131 <span class="c"># Get all possible TPSA atom types atoms as an array reference...</span>
 132 <span class="c">#</span>
 133 <span class="c"># This functionality can be either invoked as a class function or an</span>
 134 <span class="c"># object method.</span>
 135 <span class="c">#</span>
<a name="GetAllPossibleTPSAAtomTypes-"></a> 136 <span class="k">sub </span><span class="m">GetAllPossibleTPSAAtomTypes</span> <span class="s">{</span>
 137   <span class="k">return</span> <span class="i">_GetAllPossibleTPSAAtomTypes</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 138 <span class="s">}</span>
 139 
 140 <span class="c"># Are all atoms types successfully assigned?</span>
 141 <span class="c">#</span>
 142 <span class="c"># Notes:</span>
 143 <span class="c">#   . Dynamic checking of atom types assignment for atoms eliminates the need</span>
 144 <span class="c">#     to check and synchronize valid atom types during SetAtomType.</span>
 145 <span class="c">#   . Base class method is overrided to check atom assignment to nitrogen and</span>
 146 <span class="c">#     oxygen atom with optional check for phosphorus and sulfur atoms.</span>
 147 <span class="c">#</span>
<a name="IsAtomTypesAssignmentSuccessful-"></a> 148 <span class="k">sub </span><span class="m">IsAtomTypesAssignmentSuccessful</span> <span class="s">{</span>
 149   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 150   <span class="k">my</span><span class="s">(</span><span class="i">$Atom</span><span class="cm">,</span> <span class="i">$AtomType</span><span class="s">)</span><span class="sc">;</span>
 151 
 152   <span class="j">ATOM:</span> <span class="k">for</span> <span class="i">$Atom</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">Molecule</span>}<span class="i">-&gt;GetAtoms</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 153     <span class="k">if</span> <span class="s">(</span>!<span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;IsNitrogen</span><span class="s">(</span><span class="s">)</span> || <span class="i">$Atom</span><span class="i">-&gt;IsOxygen</span><span class="s">(</span><span class="s">)</span> ||
 154         <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;IsPhosphorus</span><span class="s">(</span><span class="s">)</span> &amp;&amp; !<span class="i">$This</span>-&gt;{<span class="w">IgnorePhosphorus</span>}<span class="s">)</span> ||
 155         <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;IsSulfur</span><span class="s">(</span><span class="s">)</span> &amp;&amp; !<span class="i">$This</span>-&gt;{<span class="w">IgnoreSulfur</span>}<span class="s">)</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 156       <span class="k">next</span> <span class="j">ATOM</span><span class="sc">;</span>
 157     <span class="s">}</span>
 158     <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;GetAtomType</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 159     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomType</span> =~ <span class="q">/^None$/i</span><span class="s">)</span> <span class="s">{</span>
 160       <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
 161     <span class="s">}</span>
 162   <span class="s">}</span>
 163 
 164   <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
 165 <span class="s">}</span>
 166 
 167 <span class="c"># Get all possible TPSA atom types as an array reference...</span>
 168 <span class="c">#</span>
<a name="_GetAllPossibleTPSAAtomTypes-"></a> 169 <span class="k">sub </span><span class="m">_GetAllPossibleTPSAAtomTypes</span> <span class="s">{</span>
 170   <span class="k">my</span><span class="s">(</span><span class="i">$TPSAAtomTypesDataRef</span><span class="s">)</span><span class="sc">;</span>
 171 
 172   <span class="i">$TPSAAtomTypesDataRef</span> = <span class="i">GetTPSAAtomTypesData</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 173 
 174   <span class="k">return</span> \<span class="i">@</span>{<span class="i">$TPSAAtomTypesDataRef</span>-&gt;{<span class="w">AtomTypes</span>}}<span class="sc">;</span>
 175 <span class="s">}</span>
 176 
 177 <span class="c"># Assign Topological Polar Surface Area (TPSA) atom types [ Ref 90-91 ] to Nitrogen and Oxygen</span>
 178 <span class="c"># atoms with optional assignment to Phosphorus and Sulfur atoms.</span>
 179 <span class="c">#</span>
 180 <span class="c"># Notes:</span>
 181 <span class="c">#     o Number of atom type symbols for:</span>
 182 <span class="c">#         o N: 27</span>
 183 <span class="c">#         o O: 7</span>
 184 <span class="c">#         o P: 5</span>
 185 <span class="c">#         o S: 8</span>
 186 <span class="c">#</span>
<a name="AssignAtomTypes-"></a> 187 <span class="k">sub </span><span class="m">AssignAtomTypes</span> <span class="s">{</span>
 188   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 189   <span class="k">my</span><span class="s">(</span><span class="i">$Atom</span><span class="cm">,</span> <span class="i">$AtomType</span><span class="s">)</span><span class="sc">;</span>
 190 
 191   <span class="j">ATOM:</span> <span class="k">for</span> <span class="i">$Atom</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;GetMolecule</span><span class="s">(</span><span class="s">)</span><span class="i">-&gt;GetAtoms</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 192     <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomType</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 193     <span class="i">$This</span><span class="i">-&gt;SetAtomType</span><span class="s">(</span><span class="i">$Atom</span><span class="cm">,</span> <span class="i">$AtomType</span><span class="s">)</span><span class="sc">;</span>
 194   <span class="s">}</span>
 195 
 196   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 197 <span class="s">}</span>
 198 
 199 <span class="c"># Get TPSA atom type for atom...</span>
 200 <span class="c">#</span>
<a name="_GetAtomType-"></a> 201 <span class="k">sub </span><span class="m">_GetAtomType</span> <span class="s">{</span>
 202   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 203   <span class="k">my</span><span class="s">(</span><span class="i">$AtomType</span><span class="s">)</span><span class="sc">;</span>
 204 
 205   <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
 206 
 207   <span class="j">ATOM:</span> <span class="s">{</span>
 208     <span class="k">if</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;IsNitrogen</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 209       <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomTypeForNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 210       <span class="k">last</span> <span class="j">ATOM</span><span class="sc">;</span>
 211     <span class="s">}</span>
 212 
 213     <span class="k">if</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;IsOxygen</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 214       <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomTypeForOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 215       <span class="k">last</span> <span class="j">ATOM</span><span class="sc">;</span>
 216     <span class="s">}</span>
 217 
 218     <span class="k">if</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;IsPhosphorus</span><span class="s">(</span><span class="s">)</span> &amp;&amp; !<span class="i">$This</span>-&gt;{<span class="w">IgnorePhosphorus</span>}<span class="s">)</span> <span class="s">{</span>
 219       <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomTypeForPhosphorus</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 220       <span class="k">last</span> <span class="j">ATOM</span><span class="sc">;</span>
 221     <span class="s">}</span>
 222 
 223     <span class="k">if</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;IsSulfur</span><span class="s">(</span><span class="s">)</span> &amp;&amp; !<span class="i">$This</span>-&gt;{<span class="w">IgnoreSulfur</span>}<span class="s">)</span> <span class="s">{</span>
 224       <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomTypeForSulfur</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 225       <span class="k">last</span> <span class="j">ATOM</span><span class="sc">;</span>
 226     <span class="s">}</span>
 227     <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
 228   <span class="s">}</span>
 229 
 230   <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
 231 <span class="s">}</span>
 232 
 233 
 234 <span class="c"># Get TPSA atom type for Nitrogen atom...</span>
 235 <span class="c">#</span>
 236 <span class="c"># 27 AtomTypeSymbols for element N:</span>
 237 <span class="c">#</span>
 238 <span class="c"># AtomTypeSymbol - SMARTS - Comments</span>
 239 <span class="c"># N1 - &#39;[N](-*)(-*)-*&#39;</span>
 240 <span class="c"># N2 - &#39;[N](-*)=*&#39;</span>
 241 <span class="c"># N3 - &#39;[N]#*&#39;</span>
 242 <span class="c"># N4 - &#39;[N](-*)(=*)=*&#39; - As in nitro group</span>
 243 <span class="c"># N5 - &#39;[N](=*)#*&#39; - Middle nitrogen in azide group</span>
 244 <span class="c"># N6 - &#39;[N]1(-*)-*-*-1&#39; - Atom in a 3 membered ring</span>
 245 <span class="c"># N7 - &#39;[NH](-*)-*&#39;</span>
 246 <span class="c"># N8 - &#39;[NH]1-*-*-1&#39; - Atom in a 3 membered ring</span>
 247 <span class="c"># N9 - &#39;[NH]=*&#39;</span>
 248 <span class="c"># N10 - &#39;[NH2]-*&#39;</span>
 249 <span class="c"># N11 - &#39;[N+](-*)(-*)(-*)-*&#39;</span>
 250 <span class="c"># N12 - &#39;[N+](-*)(-*)=*&#39;</span>
 251 <span class="c"># N13 - &#39;[N+](-*)#*&#39; - Nitrogen in isocyano group</span>
 252 <span class="c"># N14 - &#39;[NH+](-*)(-*)-*&#39;</span>
 253 <span class="c"># N15 - &#39;[NH+](-*)=*&#39;</span>
 254 <span class="c"># N16 - &#39;[NH2+](-*)-*&#39;</span>
 255 <span class="c"># N17 - &#39;[NH2+]=*&#39;</span>
 256 <span class="c"># N18 - &#39;[NH3+]-*&#39;</span>
 257 <span class="c"># N19 - &#39;[n](:*):*&#39;</span>
 258 <span class="c"># N20 - &#39;[n](:*)(:*):*&#39;</span>
 259 <span class="c"># N21 - &#39;[n](-*)(:*):*&#39;</span>
 260 <span class="c"># N22 - &#39;[n](=*)(:*):*&#39; - As in pyridine N-oxide</span>
 261 <span class="c"># N23 - &#39;[nH](:*):*&#39;</span>
 262 <span class="c"># N24 - &#39;[n+](:*)(:*):*&#39;</span>
 263 <span class="c"># N25 - &#39;[n+](-*)(:*):*&#39;</span>
 264 <span class="c"># N26 - &#39;[nH+](:*):*&#39;</span>
 265 <span class="c"># N - &#39;[#7]&#39; - Any other Nitrogen; Contribution: 30.5 - X*8.2 + H*1.5 or 0.0 for negative value</span>
 266 <span class="c">#</span>
<a name="_GetAtomTypeForNitrogen-"></a> 267 <span class="k">sub </span><span class="m">_GetAtomTypeForNitrogen</span> <span class="s">{</span>
 268   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 269   <span class="k">my</span><span class="s">(</span><span class="i">$AtomType</span><span class="cm">,</span> <span class="i">$NumOfSigmaBonds</span><span class="cm">,</span> <span class="i">$NumOfPiBonds</span><span class="s">)</span><span class="sc">;</span>
 270 
 271   <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
 272 
 273   <span class="s">(</span><span class="i">$NumOfSigmaBonds</span><span class="cm">,</span> <span class="i">$NumOfPiBonds</span><span class="s">)</span> = <span class="s">(</span><span class="q">&#39;0&#39;</span><span class="s">)</span> x <span class="n">2</span><span class="sc">;</span>
 274 
 275   <span class="s">(</span><span class="i">$NumOfSigmaBonds</span><span class="cm">,</span> <span class="i">$NumOfPiBonds</span><span class="s">)</span> = <span class="i">$Atom</span><span class="i">-&gt;GetNumOfSigmaAndPiBondsToNonHydrogenAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 276   <span class="i">$NumOfSigmaBonds</span> += <span class="i">$Atom</span><span class="i">-&gt;GetAtomicInvariantValue</span><span class="s">(</span><span class="q">&#39;H&#39;</span><span class="s">)</span><span class="sc">;</span>
 277 
 278   <span class="j">ATOMTYPE:</span> <span class="s">{</span>
 279 
 280     <span class="c"># Aromatic Nitrogens...</span>
 281     <span class="k">if</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;IsAromatic</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 282       <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomTypeForAromaticNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 283       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 284     <span class="s">}</span>
 285 
 286     <span class="c"># Only single bonds...</span>
 287     <span class="k">if</span> <span class="s">(</span><span class="i">$NumOfPiBonds</span> == <span class="n">0</span><span class="s">)</span> <span class="s">{</span>
 288       <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomTypeForNitrogenWithOnlySigmaBonds</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 289       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 290     <span class="s">}</span>
 291 
 292     <span class="c"># One double bond...</span>
 293     <span class="k">if</span> <span class="s">(</span><span class="i">$NumOfPiBonds</span> == <span class="n">1</span><span class="s">)</span> <span class="s">{</span>
 294       <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomTypeForNitrogenWithOnePiBond</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 295       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 296     <span class="s">}</span>
 297 
 298     <span class="c"># One triple bond or two double bonds...</span>
 299     <span class="k">if</span> <span class="s">(</span><span class="i">$NumOfPiBonds</span> == <span class="n">2</span><span class="s">)</span> <span class="s">{</span>
 300       <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomTypeForNitrogenWithTwoPiBonds</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 301       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 302     <span class="s">}</span>
 303 
 304     <span class="c"># One triple bond and a double bond...</span>
 305     <span class="k">if</span> <span class="s">(</span><span class="i">$NumOfPiBonds</span> == <span class="n">3</span><span class="s">)</span> <span class="s">{</span>
 306       <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomTypeForNitrogenWithThreePiBonds</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 307       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 308     <span class="s">}</span>
 309 
 310     <span class="i">$AtomType</span> = <span class="q">&#39;N&#39;</span><span class="sc">;</span>
 311   <span class="s">}</span>
 312   <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
 313 <span class="s">}</span>
 314 
 315 <span class="c"># Get TPSA atom type for Oxygen atom...</span>
 316 <span class="c">#</span>
 317 <span class="c"># AtomTypeSymbol - SMARTS - Comments</span>
 318 <span class="c"># O1 - &#39;[O](-*)-*&#39;</span>
 319 <span class="c"># O2 - &#39;[O]1-*-*-1&#39; - Atom in a 3 membered ring</span>
 320 <span class="c"># O3 - &#39;[O]=*&#39;</span>
 321 <span class="c"># O4 - &#39;[OH]-*&#39;</span>
 322 <span class="c"># O5 - &#39;[O-]-*&#39;</span>
 323 <span class="c"># O6 - &#39;[o](:*):*&#39;</span>
 324 <span class="c"># O - &#39;[#8]&#39; - Any other Oxygen; Contribution: 28.5 - X*8.6 + H*1.5 or 0.0 for negative value</span>
 325 <span class="c">#</span>
<a name="_GetAtomTypeForOxygen-"></a> 326 <span class="k">sub </span><span class="m">_GetAtomTypeForOxygen</span> <span class="s">{</span>
 327   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 328   <span class="k">my</span><span class="s">(</span><span class="i">$AtomType</span><span class="s">)</span><span class="sc">;</span>
 329 
 330   <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
 331 
 332   <span class="j">ATOMTYPE:</span> <span class="s">{</span>
 333 
 334     <span class="c"># O6 - &#39;[o](:*):*&#39;</span>
 335     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsO6Oxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 336       <span class="i">$AtomType</span> = <span class="q">&#39;O6&#39;</span><span class="sc">;</span>
 337       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 338     <span class="s">}</span>
 339 
 340     <span class="c"># O3 - &#39;[O]=*&#39;</span>
 341     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsO3Oxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 342       <span class="i">$AtomType</span> = <span class="q">&#39;O3&#39;</span><span class="sc">;</span>
 343       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 344     <span class="s">}</span>
 345 
 346     <span class="c"># O4 - &#39;[OH]-*&#39;</span>
 347     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsO4Oxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 348       <span class="i">$AtomType</span> = <span class="q">&#39;O4&#39;</span><span class="sc">;</span>
 349       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 350     <span class="s">}</span>
 351 
 352     <span class="c"># O5 - &#39;[O-]-*&#39;</span>
 353     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsO5Oxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 354       <span class="i">$AtomType</span> = <span class="q">&#39;O5&#39;</span><span class="sc">;</span>
 355       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 356     <span class="s">}</span>
 357 
 358     <span class="c"># O2 - &#39;[O]1-*-*-1&#39; - Atom in a 3 membered ring</span>
 359     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsO2Oxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 360       <span class="i">$AtomType</span> = <span class="q">&#39;O2&#39;</span><span class="sc">;</span>
 361       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 362     <span class="s">}</span>
 363 
 364     <span class="c"># O1 - &#39;[O](-*)-*&#39;</span>
 365     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsO1Oxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 366       <span class="i">$AtomType</span> = <span class="q">&#39;O1&#39;</span><span class="sc">;</span>
 367       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 368     <span class="s">}</span>
 369 
 370     <span class="c"># Any other Oxygen...</span>
 371     <span class="i">$AtomType</span> = <span class="q">&#39;O&#39;</span><span class="sc">;</span>
 372   <span class="s">}</span>
 373 
 374   <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
 375 <span class="s">}</span>
 376 
 377 <span class="c"># Get TPSA atom type for Phosphorus atom...</span>
 378 <span class="c">#</span>
 379 <span class="c"># 4 AtomTypeSymbols for element P:</span>
 380 <span class="c">#</span>
 381 <span class="c"># AtomTypeSymbol - SMARTS - Comments</span>
 382 <span class="c"># P1 - &#39;[P](-*)(-*)-*&#39;</span>
 383 <span class="c"># P2 - &#39;[P](-*)=*&#39;</span>
 384 <span class="c"># P3 - &#39;[P](-*)(-*)(-*)=*&#39;</span>
 385 <span class="c"># P4 - &#39;[PH](-*)(-*)=*&#39;</span>
 386 <span class="c"># P - &#39;[#15]&#39; - Any other Sulfur</span>
 387 <span class="c">#</span>
<a name="_GetAtomTypeForPhosphorus-"></a> 388 <span class="k">sub </span><span class="m">_GetAtomTypeForPhosphorus</span> <span class="s">{</span>
 389   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 390   <span class="k">my</span><span class="s">(</span><span class="i">$AtomType</span><span class="s">)</span><span class="sc">;</span>
 391 
 392   <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
 393 
 394   <span class="j">ATOMTYPE:</span> <span class="s">{</span>
 395 
 396     <span class="c"># P1 - &#39;[P](-*)(-*)-*&#39;</span>
 397     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsP1Phosphorus</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 398       <span class="i">$AtomType</span> = <span class="q">&#39;P1&#39;</span><span class="sc">;</span>
 399       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 400     <span class="s">}</span>
 401 
 402     <span class="c"># P2 - &#39;[P](-*)=*&#39;</span>
 403     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsP2Phosphorus</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 404       <span class="i">$AtomType</span> = <span class="q">&#39;P2&#39;</span><span class="sc">;</span>
 405       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 406     <span class="s">}</span>
 407 
 408     <span class="c"># P3 - &#39;[P](-*)(-*)(-*)=*&#39;</span>
 409     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsP3Phosphorus</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 410       <span class="i">$AtomType</span> = <span class="q">&#39;P3&#39;</span><span class="sc">;</span>
 411       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 412     <span class="s">}</span>
 413 
 414     <span class="c"># P4 - &#39;[PH](-*)(-*)=*&#39;</span>
 415     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsP4Phosphorus</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 416       <span class="i">$AtomType</span> = <span class="q">&#39;P4&#39;</span><span class="sc">;</span>
 417       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 418     <span class="s">}</span>
 419 
 420     <span class="c"># Any other Phosphorus...</span>
 421     <span class="i">$AtomType</span> = <span class="q">&#39;P&#39;</span><span class="sc">;</span>
 422   <span class="s">}</span>
 423 
 424   <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
 425 <span class="s">}</span>
 426 
 427 <span class="c"># Get TPSA atom type for Sulfur atom...</span>
 428 <span class="c">#</span>
 429 <span class="c"># 7 AtomTypeSymbols for element S:</span>
 430 <span class="c">#</span>
 431 <span class="c"># AtomTypeSymbol - SMARTS - Comments</span>
 432 <span class="c"># S1 - &#39;[S](-*)-*&#39;</span>
 433 <span class="c"># S2 - &#39;[S]=*&#39;</span>
 434 <span class="c"># S3 - &#39;[S](-*)(-*)=*&#39;</span>
 435 <span class="c"># S4 - &#39;[S](-*)(-*)(=*)=*&#39;</span>
 436 <span class="c"># S5 - &#39;[SH]-*&#39;</span>
 437 <span class="c"># S6 - &#39;[s](:*):*&#39;</span>
 438 <span class="c"># S - &#39;[#16]&#39; - Any other Phosphorus</span>
 439 <span class="c">#</span>
<a name="_GetAtomTypeForSulfur-"></a> 440 <span class="k">sub </span><span class="m">_GetAtomTypeForSulfur</span> <span class="s">{</span>
 441   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 442   <span class="k">my</span><span class="s">(</span><span class="i">$AtomType</span><span class="s">)</span><span class="sc">;</span>
 443 
 444   <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
 445 
 446   <span class="j">ATOMTYPE:</span> <span class="s">{</span>
 447 
 448     <span class="c"># S6 - &#39;[s](:*):*&#39;</span>
 449     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsS6Sulfur</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 450       <span class="i">$AtomType</span> = <span class="q">&#39;S6&#39;</span><span class="sc">;</span>
 451       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 452     <span class="s">}</span>
 453 
 454     <span class="c"># S4 - &#39;[S](-*)(-*)(=*)=*&#39;</span>
 455     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsS4Sulfur</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 456       <span class="i">$AtomType</span> = <span class="q">&#39;S4&#39;</span><span class="sc">;</span>
 457       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 458     <span class="s">}</span>
 459 
 460     <span class="c"># S1 - &#39;[S](-*)-*&#39;</span>
 461     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsS1Sulfur</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 462       <span class="i">$AtomType</span> = <span class="q">&#39;S1&#39;</span><span class="sc">;</span>
 463       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 464     <span class="s">}</span>
 465 
 466     <span class="c"># S2 - &#39;[S]=*&#39;</span>
 467     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsS2Sulfur</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 468       <span class="i">$AtomType</span> = <span class="q">&#39;S2&#39;</span><span class="sc">;</span>
 469       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 470     <span class="s">}</span>
 471 
 472     <span class="c"># S3 - &#39;[S](-*)(-*)=*&#39;</span>
 473     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsS3Sulfur</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 474       <span class="i">$AtomType</span> = <span class="q">&#39;S3&#39;</span><span class="sc">;</span>
 475       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 476     <span class="s">}</span>
 477 
 478     <span class="c"># S5 - &#39;[SH]-*&#39;</span>
 479     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsS5Sulfur</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 480       <span class="i">$AtomType</span> = <span class="q">&#39;S5&#39;</span><span class="sc">;</span>
 481       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 482     <span class="s">}</span>
 483 
 484     <span class="c"># Any other Sulfur...</span>
 485     <span class="i">$AtomType</span> = <span class="q">&#39;S&#39;</span><span class="sc">;</span>
 486   <span class="s">}</span>
 487 
 488   <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
 489 <span class="s">}</span>
 490 
 491 <span class="c"># Get TPSA atom type for aromatic Nitrogen...</span>
 492 <span class="c">#</span>
<a name="_GetAtomTypeForAromaticNitrogen-"></a> 493 <span class="k">sub </span><span class="m">_GetAtomTypeForAromaticNitrogen</span> <span class="s">{</span>
 494   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 495   <span class="k">my</span><span class="s">(</span><span class="i">$AtomType</span><span class="s">)</span><span class="sc">;</span>
 496 
 497   <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
 498 
 499   <span class="j">ATOMTYPE:</span> <span class="s">{</span>
 500 
 501     <span class="c"># N19 - &#39;[n](:*):*&#39;</span>
 502     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsN19Nitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 503       <span class="i">$AtomType</span> = <span class="q">&#39;N19&#39;</span><span class="sc">;</span>
 504       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 505     <span class="s">}</span>
 506 
 507     <span class="c"># N20 - &#39;[n](:*)(:*):*&#39;</span>
 508     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsN20Nitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 509       <span class="i">$AtomType</span> = <span class="q">&#39;N20&#39;</span><span class="sc">;</span>
 510       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 511     <span class="s">}</span>
 512 
 513     <span class="c"># N21 - &#39;[n](-*)(:*):*&#39;</span>
 514     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsN21Nitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 515       <span class="i">$AtomType</span> = <span class="q">&#39;N21&#39;</span><span class="sc">;</span>
 516       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 517     <span class="s">}</span>
 518 
 519     <span class="c"># N22 - &#39;[n](=*)(:*):*&#39; - As in pyridine N-oxide</span>
 520     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsN22Nitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 521       <span class="i">$AtomType</span> = <span class="q">&#39;N22&#39;</span><span class="sc">;</span>
 522       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 523     <span class="s">}</span>
 524 
 525     <span class="c"># N23 - &#39;[nH](:*):*&#39;</span>
 526     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsN23Nitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 527       <span class="i">$AtomType</span> = <span class="q">&#39;N23&#39;</span><span class="sc">;</span>
 528       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 529     <span class="s">}</span>
 530 
 531     <span class="c"># N24 - &#39;[n+](:*)(:*):*&#39;</span>
 532     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsN24Nitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 533       <span class="i">$AtomType</span> = <span class="q">&#39;N24&#39;</span><span class="sc">;</span>
 534       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 535     <span class="s">}</span>
 536 
 537     <span class="c"># N25 - &#39;[n+](-*)(:*):*&#39;</span>
 538     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsN25Nitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 539       <span class="i">$AtomType</span> = <span class="q">&#39;N25&#39;</span><span class="sc">;</span>
 540       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 541     <span class="s">}</span>
 542 
 543     <span class="c"># N26 - &#39;[nH+](:*):*&#39;</span>
 544     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsN26Nitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 545       <span class="i">$AtomType</span> = <span class="q">&#39;N26&#39;</span><span class="sc">;</span>
 546       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 547     <span class="s">}</span>
 548 
 549     <span class="i">$AtomType</span> = <span class="q">&#39;N&#39;</span><span class="sc">;</span>
 550   <span class="s">}</span>
 551 
 552   <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
 553 <span class="s">}</span>
 554 
 555 <span class="c"># Get TPSA atom type for Nitrogen with only sigma bonds...</span>
 556 <span class="c">#</span>
<a name="_GetAtomTypeForNitrogenWithOnlySigmaBonds-"></a> 557 <span class="k">sub </span><span class="m">_GetAtomTypeForNitrogenWithOnlySigmaBonds</span> <span class="s">{</span>
 558   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 559   <span class="k">my</span><span class="s">(</span><span class="i">$AtomType</span><span class="s">)</span><span class="sc">;</span>
 560 
 561   <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
 562 
 563   <span class="j">ATOMTYPE:</span> <span class="s">{</span>
 564 
 565    <span class="c"># N6 - &#39;[N]1(-*)-*-*-1&#39; - Atom in a 3 membered ring</span>
 566     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsN6Nitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 567       <span class="i">$AtomType</span> = <span class="q">&#39;N6&#39;</span><span class="sc">;</span>
 568       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 569     <span class="s">}</span>
 570 
 571     <span class="c"># N1 - &#39;[N](-*)(-*)-*&#39;</span>
 572     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsN1Nitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 573       <span class="i">$AtomType</span> = <span class="q">&#39;N1&#39;</span><span class="sc">;</span>
 574       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 575     <span class="s">}</span>
 576 
 577     <span class="c"># N8 - &#39;[NH]1-*-*-1&#39; - Atom in a 3 membered ring</span>
 578     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsN8Nitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 579       <span class="i">$AtomType</span> = <span class="q">&#39;N8&#39;</span><span class="sc">;</span>
 580       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 581     <span class="s">}</span>
 582 
 583     <span class="c"># N7 - &#39;[NH](-*)-*&#39;</span>
 584     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsN7Nitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 585       <span class="i">$AtomType</span> = <span class="q">&#39;N7&#39;</span><span class="sc">;</span>
 586       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 587     <span class="s">}</span>
 588 
 589     <span class="c"># N10 - &#39;[NH2]-*&#39;</span>
 590     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsN10Nitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 591       <span class="i">$AtomType</span> = <span class="q">&#39;N10&#39;</span><span class="sc">;</span>
 592       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 593     <span class="s">}</span>
 594 
 595     <span class="c"># N11 - &#39;[N+](-*)(-*)(-*)-*&#39;</span>
 596     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsN11Nitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 597       <span class="i">$AtomType</span> = <span class="q">&#39;N11&#39;</span><span class="sc">;</span>
 598       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 599     <span class="s">}</span>
 600 
 601     <span class="c"># N14 - &#39;[NH+](-*)(-*)-*&#39;</span>
 602     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsN14Nitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 603       <span class="i">$AtomType</span> = <span class="q">&#39;N14&#39;</span><span class="sc">;</span>
 604       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 605     <span class="s">}</span>
 606 
 607     <span class="c"># N16 - &#39;[NH2+](-*)-*&#39;</span>
 608     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsN16Nitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 609       <span class="i">$AtomType</span> = <span class="q">&#39;N16&#39;</span><span class="sc">;</span>
 610       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 611     <span class="s">}</span>
 612 
 613     <span class="c"># N18 - &#39;[NH3+]-*&#39;</span>
 614     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsN18Nitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 615       <span class="i">$AtomType</span> = <span class="q">&#39;N18&#39;</span><span class="sc">;</span>
 616       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 617     <span class="s">}</span>
 618 
 619     <span class="i">$AtomType</span> = <span class="q">&#39;N&#39;</span><span class="sc">;</span>
 620   <span class="s">}</span>
 621 
 622   <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
 623 <span class="s">}</span>
 624 
 625 <span class="c"># Get TPSA atom type for Nitrogen with one pi bonds...</span>
 626 <span class="c">#</span>
<a name="_GetAtomTypeForNitrogenWithOnePiBond-"></a> 627 <span class="k">sub </span><span class="m">_GetAtomTypeForNitrogenWithOnePiBond</span> <span class="s">{</span>
 628   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 629   <span class="k">my</span><span class="s">(</span><span class="i">$AtomType</span><span class="s">)</span><span class="sc">;</span>
 630 
 631   <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
 632 
 633   <span class="j">ATOMTYPE:</span> <span class="s">{</span>
 634 
 635     <span class="c"># N2 - &#39;[N](-*)=*&#39;</span>
 636     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsN2Nitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 637       <span class="i">$AtomType</span> = <span class="q">&#39;N2&#39;</span><span class="sc">;</span>
 638       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 639     <span class="s">}</span>
 640 
 641     <span class="c"># N9 - &#39;[NH]=*&#39;</span>
 642     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsN9Nitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 643       <span class="i">$AtomType</span> = <span class="q">&#39;N9&#39;</span><span class="sc">;</span>
 644       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 645     <span class="s">}</span>
 646 
 647     <span class="c"># N12 - &#39;[N+](-*)(-*)=*&#39;</span>
 648     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsN12Nitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 649       <span class="i">$AtomType</span> = <span class="q">&#39;N12&#39;</span><span class="sc">;</span>
 650       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 651     <span class="s">}</span>
 652 
 653     <span class="c"># N15 - &#39;[NH+](-*)=*&#39;</span>
 654     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsN15Nitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 655       <span class="i">$AtomType</span> = <span class="q">&#39;N15&#39;</span><span class="sc">;</span>
 656       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 657     <span class="s">}</span>
 658 
 659     <span class="c"># N17 - &#39;[NH2+]=*&#39;</span>
 660     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsN17Nitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 661       <span class="i">$AtomType</span> = <span class="q">&#39;N17&#39;</span><span class="sc">;</span>
 662       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 663     <span class="s">}</span>
 664 
 665     <span class="i">$AtomType</span> = <span class="q">&#39;N&#39;</span><span class="sc">;</span>
 666   <span class="s">}</span>
 667 
 668   <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
 669 <span class="s">}</span>
 670 
 671 <span class="c"># Get TPSA atom type for Nitrogen with two pi bonds...</span>
 672 <span class="c">#</span>
<a name="_GetAtomTypeForNitrogenWithTwoPiBonds-"></a> 673 <span class="k">sub </span><span class="m">_GetAtomTypeForNitrogenWithTwoPiBonds</span> <span class="s">{</span>
 674   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 675   <span class="k">my</span><span class="s">(</span><span class="i">$AtomType</span><span class="s">)</span><span class="sc">;</span>
 676 
 677   <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
 678 
 679   <span class="j">ATOMTYPE:</span> <span class="s">{</span>
 680 
 681     <span class="c"># N3 - &#39;[N]#*&#39;</span>
 682     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsN3Nitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 683       <span class="i">$AtomType</span> = <span class="q">&#39;N3&#39;</span><span class="sc">;</span>
 684       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 685     <span class="s">}</span>
 686 
 687     <span class="c"># N4 - &#39;[N](-*)(=*)=*&#39; - As in nitro group</span>
 688     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsN4Nitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 689       <span class="i">$AtomType</span> = <span class="q">&#39;N4&#39;</span><span class="sc">;</span>
 690       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 691     <span class="s">}</span>
 692 
 693     <span class="c"># N13 - &#39;[N+](-*)#*&#39;- Nitrogen in isocyano group</span>
 694     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsN13Nitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 695       <span class="i">$AtomType</span> = <span class="q">&#39;N13&#39;</span><span class="sc">;</span>
 696       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 697     <span class="s">}</span>
 698 
 699     <span class="i">$AtomType</span> = <span class="q">&#39;N&#39;</span><span class="sc">;</span>
 700   <span class="s">}</span>
 701 
 702   <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
 703 <span class="s">}</span>
 704 
 705 <span class="c"># Get TPSA atom type for Nitrogen with three pi bonds...</span>
 706 <span class="c">#</span>
<a name="_GetAtomTypeForNitrogenWithThreePiBonds-"></a> 707 <span class="k">sub </span><span class="m">_GetAtomTypeForNitrogenWithThreePiBonds</span> <span class="s">{</span>
 708   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 709   <span class="k">my</span><span class="s">(</span><span class="i">$AtomType</span><span class="s">)</span><span class="sc">;</span>
 710 
 711   <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
 712 
 713   <span class="j">ATOMTYPE:</span> <span class="s">{</span>
 714 
 715     <span class="c"># N5 - &#39;[N](=*)#*&#39; - Middle nitrogen in azide group</span>
 716     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsN5Nitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 717       <span class="i">$AtomType</span> = <span class="q">&#39;N5&#39;</span><span class="sc">;</span>
 718       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 719     <span class="s">}</span>
 720 
 721     <span class="i">$AtomType</span> = <span class="q">&#39;N&#39;</span><span class="sc">;</span>
 722   <span class="s">}</span>
 723 
 724   <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
 725 <span class="s">}</span>
 726 
 727 <span class="c"># N1 - &#39;[N](-*)(-*)-*&#39;</span>
 728 <span class="c">#</span>
<a name="_IsN1Nitrogen-"></a> 729 <span class="k">sub </span><span class="m">_IsN1Nitrogen</span> <span class="s">{</span>
 730   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 731 
 732   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.!RA3.X3.SB3.H0.FC0&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 733 <span class="s">}</span>
 734 
 735 <span class="c"># N2 - &#39;[N](-*)=*&#39;</span>
 736 <span class="c">#</span>
<a name="_IsN2Nitrogen-"></a> 737 <span class="k">sub </span><span class="m">_IsN2Nitrogen</span> <span class="s">{</span>
 738   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 739 
 740   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.X2.SB1.DB1.H0.FC0&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 741 <span class="s">}</span>
 742 
 743 <span class="c"># N3 - &#39;[N]#*&#39;</span>
 744 <span class="c">#</span>
<a name="_IsN3Nitrogen-"></a> 745 <span class="k">sub </span><span class="m">_IsN3Nitrogen</span> <span class="s">{</span>
 746   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 747 
 748   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.X1.TB1.H0.FC0&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 749 <span class="s">}</span>
 750 
 751 <span class="c"># N4 - &#39;[N](-*)(=*)=*&#39; - As in nitro group</span>
 752 <span class="c">#</span>
<a name="_IsN4Nitrogen-"></a> 753 <span class="k">sub </span><span class="m">_IsN4Nitrogen</span> <span class="s">{</span>
 754   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 755 
 756   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.X3.SB1.DB2.H0.FC0&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 757 <span class="s">}</span>
 758 
 759 <span class="c"># N5 - &#39;[N](=*)#*&#39; - Middle nitrogen in azide group</span>
 760 <span class="c">#</span>
<a name="_IsN5Nitrogen-"></a> 761 <span class="k">sub </span><span class="m">_IsN5Nitrogen</span> <span class="s">{</span>
 762   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 763 
 764   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.X2.DB1.TB1.H0.FC0&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 765 <span class="s">}</span>
 766 
 767 <span class="c"># N6 - &#39;[N]1(-*)-*-*-1&#39; - Atom in a 3 membered ring</span>
 768 <span class="c">#</span>
<a name="_IsN6Nitrogen-"></a> 769 <span class="k">sub </span><span class="m">_IsN6Nitrogen</span> <span class="s">{</span>
 770   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 771 
 772   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.RA3.X3.SB3.H0.FC0&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 773 <span class="s">}</span>
 774 
 775 <span class="c"># N7 - &#39;[NH](-*)-*&#39;</span>
 776 <span class="c">#</span>
<a name="_IsN7Nitrogen-"></a> 777 <span class="k">sub </span><span class="m">_IsN7Nitrogen</span> <span class="s">{</span>
 778   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 779 
 780   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.!RA3.X2.SB2.H1.FC0&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 781 <span class="s">}</span>
 782 
 783 <span class="c"># N8 - &#39;[NH]1-*-*-1&#39; - Atom in a 3 membered ring</span>
 784 <span class="c">#</span>
<a name="_IsN8Nitrogen-"></a> 785 <span class="k">sub </span><span class="m">_IsN8Nitrogen</span> <span class="s">{</span>
 786   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 787 
 788   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.RA3.X2.SB2.H1.FC0&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 789 <span class="s">}</span>
 790 
 791 <span class="c"># N9 - &#39;[NH]=*&#39;</span>
 792 <span class="c">#</span>
<a name="_IsN9Nitrogen-"></a> 793 <span class="k">sub </span><span class="m">_IsN9Nitrogen</span> <span class="s">{</span>
 794   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 795 
 796   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.X1.DB1.H1.FC0&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 797 <span class="s">}</span>
 798 
 799 <span class="c"># N10 - &#39;[NH2]-*&#39;</span>
 800 <span class="c">#</span>
<a name="_IsN10Nitrogen-"></a> 801 <span class="k">sub </span><span class="m">_IsN10Nitrogen</span> <span class="s">{</span>
 802   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 803 
 804   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.X1.SB1.H2.FC0&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 805 <span class="s">}</span>
 806 
 807 <span class="c"># N11 - &#39;[N+](-*)(-*)(-*)-*&#39;</span>
 808 <span class="c">#</span>
<a name="_IsN11Nitrogen-"></a> 809 <span class="k">sub </span><span class="m">_IsN11Nitrogen</span> <span class="s">{</span>
 810   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 811 
 812   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.X4.SB4.H0.FC+1&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 813 <span class="s">}</span>
 814 
 815 <span class="c"># N12 - &#39;[N+](-*)(-*)=*&#39;</span>
 816 <span class="c">#</span>
<a name="_IsN12Nitrogen-"></a> 817 <span class="k">sub </span><span class="m">_IsN12Nitrogen</span> <span class="s">{</span>
 818   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 819 
 820   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.X3.SB2.DB1.H0.FC+1&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 821 <span class="s">}</span>
 822 
 823 <span class="c"># N13 - &#39;[N+](-*)#*&#39;- Nitrogen in isocyano group</span>
 824 <span class="c">#</span>
<a name="_IsN13Nitrogen-"></a> 825 <span class="k">sub </span><span class="m">_IsN13Nitrogen</span> <span class="s">{</span>
 826   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 827 
 828   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.X2.SB1.TB1.H0.FC+1&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 829 <span class="s">}</span>
 830 
 831 <span class="c"># N14 - &#39;[NH+](-*)(-*)-*&#39;</span>
 832 <span class="c">#</span>
<a name="_IsN14Nitrogen-"></a> 833 <span class="k">sub </span><span class="m">_IsN14Nitrogen</span> <span class="s">{</span>
 834   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 835 
 836   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.X3.SB3.H1.FC+1&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 837 <span class="s">}</span>
 838 
 839 <span class="c"># N15 - &#39;[NH+](-*)=*&#39;</span>
 840 <span class="c">#</span>
<a name="_IsN15Nitrogen-"></a> 841 <span class="k">sub </span><span class="m">_IsN15Nitrogen</span> <span class="s">{</span>
 842   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 843 
 844   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.X2.SB1.DB1.H1.FC+1&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 845 <span class="s">}</span>
 846 
 847 <span class="c"># N16 - &#39;[NH2+](-*)-*&#39;</span>
 848 <span class="c">#</span>
<a name="_IsN16Nitrogen-"></a> 849 <span class="k">sub </span><span class="m">_IsN16Nitrogen</span> <span class="s">{</span>
 850   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 851 
 852   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.X2.SB2.H2.FC+1&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 853 <span class="s">}</span>
 854 
 855 <span class="c"># N17 - &#39;[NH2+]=*&#39;</span>
 856 <span class="c">#</span>
<a name="_IsN17Nitrogen-"></a> 857 <span class="k">sub </span><span class="m">_IsN17Nitrogen</span> <span class="s">{</span>
 858   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 859 
 860   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.X1.DB1.H2.FC+1&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 861 <span class="s">}</span>
 862 
 863 <span class="c"># N18 - &#39;[NH3+]-*&#39;</span>
 864 <span class="c">#</span>
<a name="_IsN18Nitrogen-"></a> 865 <span class="k">sub </span><span class="m">_IsN18Nitrogen</span> <span class="s">{</span>
 866   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 867 
 868   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.X1.SB1.H3.FC+1&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 869 <span class="s">}</span>
 870 
 871 <span class="c"># N19 - &#39;[n](:*):*&#39;</span>
 872 <span class="c">#</span>
<a name="_IsN19Nitrogen-"></a> 873 <span class="k">sub </span><span class="m">_IsN19Nitrogen</span> <span class="s">{</span>
 874   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 875 
 876   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.Ar.X2.AB2.H0.FC0&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 877 <span class="s">}</span>
 878 
 879 <span class="c"># N20 - &#39;[n](:*)(:*):*&#39;</span>
 880 <span class="c">#</span>
<a name="_IsN20Nitrogen-"></a> 881 <span class="k">sub </span><span class="m">_IsN20Nitrogen</span> <span class="s">{</span>
 882   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 883 
 884   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.Ar.X3.AB3.H0.FC0&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 885 <span class="s">}</span>
 886 
 887 <span class="c"># N21 - &#39;[n](-*)(:*):*&#39;</span>
 888 <span class="c">#</span>
<a name="_IsN21Nitrogen-"></a> 889 <span class="k">sub </span><span class="m">_IsN21Nitrogen</span> <span class="s">{</span>
 890   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 891 
 892   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.Ar.X3.AB2.H0.FC0&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;*&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;:&#39;</span><span class="cm">,</span> <span class="q">&#39;:&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 893 <span class="s">}</span>
 894 
 895 <span class="c"># N22 - &#39;[n](=*)(:*):*&#39; - As in pyridine N-oxide</span>
 896 <span class="c">#</span>
<a name="_IsN22Nitrogen-"></a> 897 <span class="k">sub </span><span class="m">_IsN22Nitrogen</span> <span class="s">{</span>
 898   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 899 
 900   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.Ar.X3.AB2.H0.FC0&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;*&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;:&#39;</span><span class="cm">,</span> <span class="q">&#39;:&#39;</span><span class="cm">,</span> <span class="q">&#39;=&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 901 <span class="s">}</span>
 902 
 903 <span class="c"># N23 - &#39;[nH](:*):*&#39;</span>
 904 <span class="c">#</span>
<a name="_IsN23Nitrogen-"></a> 905 <span class="k">sub </span><span class="m">_IsN23Nitrogen</span> <span class="s">{</span>
 906   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 907 
 908   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.Ar.X2.AB2.H1.FC0&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 909 <span class="s">}</span>
 910 
 911 <span class="c"># N24 - &#39;[n+](:*)(:*):*&#39;</span>
 912 <span class="c">#</span>
<a name="_IsN24Nitrogen-"></a> 913 <span class="k">sub </span><span class="m">_IsN24Nitrogen</span> <span class="s">{</span>
 914   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 915 
 916   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.Ar.X3.AB3.H0.FC+1&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 917 <span class="s">}</span>
 918 
 919 <span class="c"># N25 - &#39;[n+](-*)(:*):*&#39;</span>
 920 <span class="c">#</span>
<a name="_IsN25Nitrogen-"></a> 921 <span class="k">sub </span><span class="m">_IsN25Nitrogen</span> <span class="s">{</span>
 922   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 923 
 924   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.Ar.X3.AB2.H0.FC+1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;*&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;:&#39;</span><span class="cm">,</span> <span class="q">&#39;:&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 925 <span class="s">}</span>
 926 
 927 <span class="c"># N26 - &#39;[nH+](:*):*&#39;</span>
 928 <span class="c">#</span>
<a name="_IsN26Nitrogen-"></a> 929 <span class="k">sub </span><span class="m">_IsN26Nitrogen</span> <span class="s">{</span>
 930   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 931 
 932   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.Ar.X2.AB2.H1.FC+1&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 933 <span class="s">}</span>
 934 
 935 <span class="c"># O1 - &#39;[O](-*)-*&#39;</span>
 936 <span class="c">#</span>
<a name="_IsO1Oxygen-"></a> 937 <span class="k">sub </span><span class="m">_IsO1Oxygen</span> <span class="s">{</span>
 938   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 939 
 940   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.!RA.X2.SB2.H0.FC0&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 941 <span class="s">}</span>
 942 
 943 <span class="c"># O2 - &#39;[O]1-*-*-1&#39; - Atom in a 3 membered ring</span>
 944 <span class="c">#</span>
<a name="_IsO2Oxygen-"></a> 945 <span class="k">sub </span><span class="m">_IsO2Oxygen</span> <span class="s">{</span>
 946   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 947 
 948   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.RA3.X2.SB2.H0.FC0&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 949 <span class="s">}</span>
 950 
 951 <span class="c"># O3 - &#39;[O]=*&#39;</span>
 952 <span class="c">#</span>
<a name="_IsO3Oxygen-"></a> 953 <span class="k">sub </span><span class="m">_IsO3Oxygen</span> <span class="s">{</span>
 954   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 955 
 956   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.X1.DB1.H0.FC0&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 957 <span class="s">}</span>
 958 
 959 <span class="c"># O4 - &#39;[OH]-*&#39;</span>
 960 <span class="c">#</span>
<a name="_IsO4Oxygen-"></a> 961 <span class="k">sub </span><span class="m">_IsO4Oxygen</span> <span class="s">{</span>
 962   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 963 
 964   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.X1.SB1.H1.FC0&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 965 <span class="s">}</span>
 966 
 967 <span class="c"># O5 - &#39;[O-]-*&#39;</span>
 968 <span class="c">#</span>
<a name="_IsO5Oxygen-"></a> 969 <span class="k">sub </span><span class="m">_IsO5Oxygen</span> <span class="s">{</span>
 970   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 971 
 972   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.X1.SB1.H0.FC-1&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 973 <span class="s">}</span>
 974 
 975 <span class="c"># O6 - &#39;[o](:*):*&#39;</span>
 976 <span class="c">#</span>
<a name="_IsO6Oxygen-"></a> 977 <span class="k">sub </span><span class="m">_IsO6Oxygen</span> <span class="s">{</span>
 978   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 979 
 980   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.Ar.X2.AB2.H0.FC0&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 981 <span class="s">}</span>
 982 
 983 <span class="c"># P1 - &#39;[P](-*)(-*)-*&#39;</span>
 984 <span class="c">#</span>
<a name="_IsP1Phosphorus-"></a> 985 <span class="k">sub </span><span class="m">_IsP1Phosphorus</span> <span class="s">{</span>
 986   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 987 
 988   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;P.X3.SB3.H0.FC0&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 989 <span class="s">}</span>
 990 
 991 <span class="c"># P2 - &#39;[P](-*)=*&#39;</span>
 992 <span class="c">#</span>
<a name="_IsP2Phosphorus-"></a> 993 <span class="k">sub </span><span class="m">_IsP2Phosphorus</span> <span class="s">{</span>
 994   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 995 
 996   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;P.X2.SB1.DB1.H0.FC0&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 997 <span class="s">}</span>
 998 
 999 <span class="c"># P3 - &#39;[P](-*)(-*)(-*)=*&#39;</span>
1000 <span class="c">#</span>
<a name="_IsP3Phosphorus-"></a>1001 <span class="k">sub </span><span class="m">_IsP3Phosphorus</span> <span class="s">{</span>
1002   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1003 
1004   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;P.X4.SB3.DB1.H0.FC0&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1005 <span class="s">}</span>
1006 
1007 <span class="c"># P4 - &#39;[PH](-*)(-*)=*&#39;</span>
1008 <span class="c">#</span>
<a name="_IsP4Phosphorus-"></a>1009 <span class="k">sub </span><span class="m">_IsP4Phosphorus</span> <span class="s">{</span>
1010   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1011 
1012   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;P.X3.SB2.DB1.H1.FC0&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1013 <span class="s">}</span>
1014 
1015 <span class="c"># S1 - &#39;[S](-*)-*&#39;</span>
1016 <span class="c">#</span>
<a name="_IsS1Sulfur-"></a>1017 <span class="k">sub </span><span class="m">_IsS1Sulfur</span> <span class="s">{</span>
1018   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1019 
1020   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;S.X2.SB2.H0.FC0&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1021 <span class="s">}</span>
1022 
1023 <span class="c"># S2 - &#39;[S]=*&#39;</span>
1024 <span class="c">#</span>
<a name="_IsS2Sulfur-"></a>1025 <span class="k">sub </span><span class="m">_IsS2Sulfur</span> <span class="s">{</span>
1026   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1027 
1028   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;S.X1.DB1.H0.FC0&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1029 <span class="s">}</span>
1030 
1031 <span class="c"># S3 - &#39;[S](-*)(-*)=*&#39;</span>
1032 <span class="c">#</span>
<a name="_IsS3Sulfur-"></a>1033 <span class="k">sub </span><span class="m">_IsS3Sulfur</span> <span class="s">{</span>
1034   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1035 
1036   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;S.X3.SB2.DB1.H0.FC0&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1037 <span class="s">}</span>
1038 
1039 <span class="c"># S4 - &#39;[S](-*)(-*)(=*)=*&#39;</span>
1040 <span class="c">#</span>
<a name="_IsS4Sulfur-"></a>1041 <span class="k">sub </span><span class="m">_IsS4Sulfur</span> <span class="s">{</span>
1042   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1043 
1044   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;S.X4.SB2.DB2.H0.FC0&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1045 <span class="s">}</span>
1046 
1047 <span class="c"># S5 - &#39;[SH]-*&#39;</span>
1048 <span class="c">#</span>
<a name="_IsS5Sulfur-"></a>1049 <span class="k">sub </span><span class="m">_IsS5Sulfur</span> <span class="s">{</span>
1050   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1051 
1052   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;S.X1.SB1.H1.FC0&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1053 <span class="s">}</span>
1054 
1055 <span class="c"># S6 - &#39;[s](:*):*&#39;</span>
1056 <span class="c">#</span>
<a name="_IsS6Sulfur-"></a>1057 <span class="k">sub </span><span class="m">_IsS6Sulfur</span> <span class="s">{</span>
1058   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1059 
1060   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;S.Ar.X2.AB2.H0.FC0&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1061 <span class="s">}</span>
1062 
1063 <span class="c"># Return a string containg data for TPSAAtomTypes object...</span>
1064 <span class="c">#</span>
<a name="StringifyTPSAAtomTypes-"></a>1065 <span class="k">sub </span><span class="m">StringifyTPSAAtomTypes</span> <span class="s">{</span>
1066   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1067   <span class="k">my</span><span class="s">(</span><span class="i">$AtomTypesString</span><span class="s">)</span><span class="sc">;</span>
1068 
1069   <span class="c"># Type of AtomTypes...</span>
1070   <span class="i">$AtomTypesString</span> = <span class="q">&quot;AtomTypes: $This-&gt;{Type}; IgnorePhosphorus: &quot;</span> . <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">IgnorePhosphorus</span>} ? <span class="q">&quot;Yes&quot;</span> <span class="co">:</span> <span class="q">&quot;No&quot;</span><span class="s">)</span> . <span class="q">&quot;; IgnoreSulfur: &quot;</span> .  <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">IgnoreSulfur</span>} ? <span class="q">&quot;Yes&quot;</span> <span class="co">:</span> <span class="q">&quot;No&quot;</span><span class="s">)</span><span class="sc">;</span>
1071 
1072   <span class="c"># Setup atom types information...</span>
1073   <span class="k">my</span><span class="s">(</span><span class="i">$AtomID</span><span class="cm">,</span> <span class="i">$AtomType</span><span class="cm">,</span> <span class="i">@AtomTypesInfo</span><span class="cm">,</span> <span class="i">%AssignedAtomTypes</span><span class="s">)</span><span class="sc">;</span>
1074 
1075   <span class="i">@AtomTypesInfo</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1076   <span class="i">%AssignedAtomTypes</span> = <span class="i">$This</span><span class="i">-&gt;GetAtomTypes</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1077 
1078   <span class="k">for</span> <span class="i">$AtomID</span> <span class="s">(</span><span class="k">sort</span> <span class="s">{</span> <span class="i">$a</span> &lt;=&gt; <span class="i">$b</span> <span class="s">}</span> <span class="k">keys</span> <span class="i">%AssignedAtomTypes</span><span class="s">)</span> <span class="s">{</span>
1079     <span class="i">$AtomType</span> = <span class="i">$AssignedAtomTypes</span>{<span class="i">$AtomID</span>} ? <span class="i">$AssignedAtomTypes</span>{<span class="i">$AtomID</span>} <span class="co">:</span> <span class="q">&#39;None&#39;</span><span class="sc">;</span>
1080     <span class="k">push</span> <span class="i">@AtomTypesInfo</span><span class="cm">,</span> <span class="q">&quot;$AtomID:$AtomType&quot;</span><span class="sc">;</span>
1081   <span class="s">}</span>
1082   <span class="i">$AtomTypesString</span> .= <span class="q">&quot;; AtomIDs:AtomTypes: &lt;&quot;</span> . <span class="i">TextUtil::JoinWords</span><span class="s">(</span>\<span class="i">@AtomTypesInfo</span><span class="cm">,</span> <span class="q">&quot;, &quot;</span><span class="cm">,</span> <span class="n">0</span><span class="s">)</span> . <span class="q">&quot;&gt;&quot;</span><span class="sc">;</span>
1083 
1084   <span class="k">return</span> <span class="i">$AtomTypesString</span><span class="sc">;</span>
1085 <span class="s">}</span>
1086 
1087 <span class="c"># Is it a TPSAAtomTypes object?</span>
<a name="_IsTPSAAtomTypes-"></a>1088 <span class="k">sub </span><span class="m">_IsTPSAAtomTypes</span> <span class="s">{</span>
1089   <span class="k">my</span><span class="s">(</span><span class="i">$Object</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1090 
1091   <span class="k">return</span> <span class="s">(</span><span class="i">Scalar::Util::blessed</span><span class="s">(</span><span class="i">$Object</span><span class="s">)</span> &amp;&amp; <span class="i">$Object</span><span class="i">-&gt;isa</span><span class="s">(</span><span class="i">$ClassName</span><span class="s">)</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1092 <span class="s">}</span>
1093 
1094 <span class="c"># Check and load TPSA atom types data...</span>
1095 <span class="c">#</span>
<a name="_CheckAndLoadTPSAAtomTypesData-"></a>1096 <span class="k">sub </span><span class="m">_CheckAndLoadTPSAAtomTypesData</span> <span class="s">{</span>
1097 
1098   <span class="c"># Is it already loaded?</span>
1099   <span class="k">if</span> <span class="s">(</span><span class="k">exists</span> <span class="i">$TPSAAtomTypesDataMap</span>{<span class="w">AtomTypes</span>}<span class="s">)</span> <span class="s">{</span>
1100     <span class="k">return</span><span class="sc">;</span>
1101   <span class="s">}</span>
1102 
1103   <span class="i">_LoadTPSAAtomTypesData</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1104 <span class="s">}</span>
1105 
1106 <span class="c"># Load TPSA atom types data from the file assuming first column to be atom type symbol..</span>
1107 <span class="c">#</span>
1108 <span class="c"># Format:</span>
1109 <span class="c">#</span>
1110 <span class="c"># &quot;AtomType&quot;,&quot;SMARTS&quot;,&quot;TPSAContribution&quot;,&quot;Comments&quot;</span>
1111 <span class="c"># &quot;N1&quot;,&quot;[N](-*)(-*)-*&quot;,&quot;3.24&quot;,&quot;&quot;</span>
1112 <span class="c"># &quot;N2&quot;,&quot;[N](-*)=*&quot;,&quot;12.36&quot;,&quot;&quot;</span>
1113 <span class="c">#</span>
<a name="_LoadTPSAAtomTypesData-"></a>1114 <span class="k">sub </span><span class="m">_LoadTPSAAtomTypesData</span> <span class="s">{</span>
1115   <span class="k">my</span><span class="s">(</span><span class="i">$AtomTypesDataFile</span><span class="cm">,</span> <span class="i">$MayaChemToolsLibDir</span><span class="s">)</span><span class="sc">;</span>
1116 
1117   <span class="i">$MayaChemToolsLibDir</span> = <span class="i">FileUtil::GetMayaChemToolsLibDirName</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1118 
1119   <span class="i">$AtomTypesDataFile</span> =  <span class="q">&quot;$MayaChemToolsLibDir&quot;</span> . <span class="q">&quot;/data/TPSAAtomTypes.csv&quot;</span><span class="sc">;</span>
1120   <span class="k">if</span> <span class="s">(</span>! <span class="k">-e</span> <span class="q">&quot;$AtomTypesDataFile&quot;</span><span class="s">)</span> <span class="s">{</span>
1121     <span class="w">croak</span> <span class="q">&quot;Error: MayaChemTools package file, $AtomTypesDataFile, is missing: Possible installation problems...&quot;</span><span class="sc">;</span>
1122   <span class="s">}</span>
1123 
1124   <span class="i">%TPSAAtomTypesDataMap</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1125   <span class="i">AtomTypes::AtomTypes::LoadAtomTypesData</span><span class="s">(</span><span class="i">$AtomTypesDataFile</span><span class="cm">,</span> \<span class="i">%TPSAAtomTypesDataMap</span><span class="s">)</span><span class="sc">;</span>
1126 <span class="s">}</span>
1127 
<a name="EOF-"></a></pre>
<p>&nbsp;</p>
<br />
<center>
<img src="../../../images/h2o2.png">
</center>
</body>
</html>
