<html>
<head>
<title>MayaChemTools:Code:Fingerprints::TopologicalAtomTorsionsFingerprints.pm</title>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<link rel="stylesheet" type="text/css" href="../../../css/MayaChemToolsCode.css">
</head>
<body leftmargin="20" rightmargin="20" topmargin="10" bottommargin="10">
<br/>
<center>
<a href="http://www.mayachemtools.org" title="MayaChemTools Home"><img src="../../../images/MayaChemToolsLogo.gif" border="0" alt="MayaChemTools"></a>
</center>
<br/>
<pre>
<a name="package-Fingerprints::TopologicalAtomTorsionsFingerprints-"></a>   1 <span class="k">package </span><span class="i">Fingerprints::TopologicalAtomTorsionsFingerprints</span><span class="sc">;</span>
   2 <span class="c">#</span>
   3 <span class="c"># $RCSfile: TopologicalAtomTorsionsFingerprints.pm,v $</span>
   4 <span class="c"># $Date: 2017/01/12 18:59:25 $</span>
   5 <span class="c"># $Revision: 1.28 $</span>
   6 <span class="c">#</span>
   7 <span class="c"># Author: Manish Sud &lt;msud@san.rr.com&gt;</span>
   8 <span class="c">#</span>
   9 <span class="c"># Copyright (C) 2017 Manish Sud. All rights reserved.</span>
  10 <span class="c">#</span>
  11 <span class="c"># This file is part of MayaChemTools.</span>
  12 <span class="c">#</span>
  13 <span class="c"># MayaChemTools is free software; you can redistribute it and/or modify it under</span>
  14 <span class="c"># the terms of the GNU Lesser General Public License as published by the Free</span>
  15 <span class="c"># Software Foundation; either version 3 of the License, or (at your option) any</span>
  16 <span class="c"># later version.</span>
  17 <span class="c">#</span>
  18 <span class="c"># MayaChemTools is distributed in the hope that it will be useful, but without</span>
  19 <span class="c"># any warranty; without even the implied warranty of merchantability of fitness</span>
  20 <span class="c"># for a particular purpose.  See the GNU Lesser General Public License for more</span>
  21 <span class="c"># details.</span>
  22 <span class="c">#</span>
  23 <span class="c"># You should have received a copy of the GNU Lesser General Public License</span>
  24 <span class="c"># along with MayaChemTools; if not, see &lt;http://www.gnu.org/licenses/&gt; or</span>
  25 <span class="c"># write to the Free Software Foundation Inc., 59 Temple Place, Suite 330,</span>
  26 <span class="c"># Boston, MA, 02111-1307, USA.</span>
  27 <span class="c">#</span>
  28 
  29 <span class="k">use</span> <span class="w">strict</span><span class="sc">;</span>
  30 <span class="k">use</span> <span class="w">Carp</span><span class="sc">;</span>
  31 <span class="k">use</span> <span class="w">Exporter</span><span class="sc">;</span>
  32 <span class="k">use</span> <span class="w">Fingerprints::Fingerprints</span><span class="sc">;</span>
  33 <span class="k">use</span> <span class="w">TextUtil</span> <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  34 <span class="k">use</span> <span class="w">Molecule</span><span class="sc">;</span>
  35 <span class="k">use</span> <span class="w">AtomTypes::AtomicInvariantsAtomTypes</span><span class="sc">;</span>
  36 <span class="k">use</span> <span class="w">AtomTypes::DREIDINGAtomTypes</span><span class="sc">;</span>
  37 <span class="k">use</span> <span class="w">AtomTypes::EStateAtomTypes</span><span class="sc">;</span>
  38 <span class="k">use</span> <span class="w">AtomTypes::FunctionalClassAtomTypes</span><span class="sc">;</span>
  39 <span class="k">use</span> <span class="w">AtomTypes::MMFF94AtomTypes</span><span class="sc">;</span>
  40 <span class="k">use</span> <span class="w">AtomTypes::SLogPAtomTypes</span><span class="sc">;</span>
  41 <span class="k">use</span> <span class="w">AtomTypes::SYBYLAtomTypes</span><span class="sc">;</span>
  42 <span class="k">use</span> <span class="w">AtomTypes::TPSAAtomTypes</span><span class="sc">;</span>
  43 <span class="k">use</span> <span class="w">AtomTypes::UFFAtomTypes</span><span class="sc">;</span>
  44 
  45 <span class="k">use</span> <span class="w">vars</span> <span class="q">qw(@ISA @EXPORT @EXPORT_OK %EXPORT_TAGS)</span><span class="sc">;</span>
  46 
  47 <span class="i">@ISA</span> = <span class="q">qw(Fingerprints::Fingerprints Exporter)</span><span class="sc">;</span>
  48 <span class="i">@EXPORT</span> = <span class="q">qw()</span><span class="sc">;</span>
  49 <span class="i">@EXPORT_OK</span> = <span class="q">qw()</span><span class="sc">;</span>
  50 
  51 <span class="i">%EXPORT_TAGS</span> = <span class="s">(</span><span class="w">all</span>  <span class="cm">=&gt;</span> <span class="s">[</span><span class="i">@EXPORT</span><span class="cm">,</span> <span class="i">@EXPORT_OK</span><span class="s">]</span><span class="s">)</span><span class="sc">;</span>
  52 
  53 <span class="c"># Setup class variables...</span>
  54 <span class="k">my</span><span class="s">(</span><span class="i">$ClassName</span><span class="s">)</span><span class="sc">;</span>
  55 <span class="i">_InitializeClass</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  56 
  57 <span class="c"># Overload Perl functions...</span>
  58 <span class="k">use</span> <span class="w">overload</span> <span class="q">&#39;&quot;&quot;&#39;</span> <span class="cm">=&gt;</span> <span class="q">&#39;StringifyTopologicalAtomTorsionsFingerprints&#39;</span><span class="sc">;</span>
  59 
  60 <span class="c"># Class constructor...</span>
<a name="new-"></a>  61 <span class="k">sub </span><span class="m">new</span> <span class="s">{</span>
  62   <span class="k">my</span><span class="s">(</span><span class="i">$Class</span><span class="cm">,</span> <span class="i">%NamesAndValues</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
  63 
  64   <span class="c"># Initialize object...</span>
  65   <span class="k">my</span> <span class="i">$This</span> = <span class="i">$Class</span><span class="i">-&gt;SUPER::new</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  66   <span class="k">bless</span> <span class="i">$This</span><span class="cm">,</span> <span class="k">ref</span><span class="s">(</span><span class="i">$Class</span><span class="s">)</span> || <span class="i">$Class</span><span class="sc">;</span>
  67   <span class="i">$This</span><span class="i">-&gt;_InitializeTopologicalAtomTorsionsFingerprints</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  68 
  69   <span class="i">$This</span><span class="i">-&gt;_InitializeTopologicalAtomTorsionsFingerprintsProperties</span><span class="s">(</span><span class="i">%NamesAndValues</span><span class="s">)</span><span class="sc">;</span>
  70 
  71   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
  72 <span class="s">}</span>
  73 
  74 <span class="c"># Initialize object data...</span>
  75 <span class="c">#</span>
<a name="_InitializeTopologicalAtomTorsionsFingerprints-"></a>  76 <span class="k">sub </span><span class="m">_InitializeTopologicalAtomTorsionsFingerprints</span> <span class="s">{</span>
  77   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
  78 
  79   <span class="c"># Type of fingerprint...</span>
  80   <span class="i">$This</span>-&gt;{<span class="w">Type</span>} = <span class="q">&#39;TopologicalAtomTorsions&#39;</span><span class="sc">;</span>
  81 
  82   <span class="c"># Type of vector...</span>
  83   <span class="i">$This</span>-&gt;{<span class="w">VectorType</span>} = <span class="q">&#39;FingerprintsVector&#39;</span><span class="sc">;</span>
  84 
  85   <span class="c"># Type of FingerprintsVector...</span>
  86   <span class="i">$This</span>-&gt;{<span class="w">FingerprintsVectorType</span>} = <span class="q">&#39;NumericalValues&#39;</span><span class="sc">;</span>
  87 
  88   <span class="c"># Atom identifier type to use for atom IDs in atom torsions...</span>
  89   <span class="c">#</span>
  90   <span class="c"># Currently supported values are: AtomicInvariantsAtomTypes, DREIDINGAtomTypes,</span>
  91   <span class="c"># EStateAtomTypes, FunctionalClassAtomTypes, MMFF94AtomTypes, SLogPAtomTypes,</span>
  92   <span class="c"># SYBYLAtomTypes, TPSAAtomTypes, UFFAtomTypes</span>
  93   <span class="c">#</span>
  94   <span class="i">$This</span>-&gt;{<span class="w">AtomIdentifierType</span>} = <span class="q">&#39;&#39;</span><span class="sc">;</span>
  95 
  96   <span class="c"># Atom types assigned to each heavy atom...</span>
  97   <span class="c">#</span>
  98   <span class="i">%</span>{<span class="i">$This</span>-&gt;{<span class="w">AssignedAtomTypes</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  99 
 100   <span class="c"># Final unique atom torsions...</span>
 101   <span class="c">#</span>
 102   <span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">AtomTorsionsIDs</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 103   <span class="i">%</span>{<span class="i">$This</span>-&gt;{<span class="w">AtomTorsionsCount</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 104 <span class="s">}</span>
 105 
 106 <span class="c"># Initialize class ...</span>
<a name="_InitializeClass-"></a> 107 <span class="k">sub </span><span class="m">_InitializeClass</span> <span class="s">{</span>
 108   <span class="c">#Class name...</span>
 109   <span class="i">$ClassName</span> = <span class="w">__PACKAGE__</span><span class="sc">;</span>
 110 <span class="s">}</span>
 111 
 112 <span class="c"># Initialize object properties....</span>
<a name="_InitializeTopologicalAtomTorsionsFingerprintsProperties-"></a> 113 <span class="k">sub </span><span class="m">_InitializeTopologicalAtomTorsionsFingerprintsProperties</span> <span class="s">{</span>
 114   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">%NamesAndValues</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 115 
 116   <span class="k">my</span><span class="s">(</span><span class="i">$Name</span><span class="cm">,</span> <span class="i">$Value</span><span class="cm">,</span> <span class="i">$MethodName</span><span class="s">)</span><span class="sc">;</span>
 117   <span class="k">while</span> <span class="s">(</span><span class="s">(</span><span class="i">$Name</span><span class="cm">,</span> <span class="i">$Value</span><span class="s">)</span> = <span class="k">each</span>  <span class="i">%NamesAndValues</span><span class="s">)</span> <span class="s">{</span>
 118     <span class="i">$MethodName</span> = <span class="q">&quot;Set${Name}&quot;</span><span class="sc">;</span>
 119     <span class="i">$This</span><span class="i">-&gt;$MethodName</span><span class="s">(</span><span class="i">$Value</span><span class="s">)</span><span class="sc">;</span>
 120   <span class="s">}</span>
 121 
 122   <span class="c"># Make sure molecule object was specified...</span>
 123   <span class="k">if</span> <span class="s">(</span>!<span class="k">exists</span> <span class="i">$NamesAndValues</span>{<span class="w">Molecule</span>}<span class="s">)</span> <span class="s">{</span>
 124     <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;New: Object can&#39;t be instantiated without specifying molecule...&quot;</span><span class="sc">;</span>
 125   <span class="s">}</span>
 126   <span class="k">if</span> <span class="s">(</span>!<span class="k">exists</span> <span class="i">$NamesAndValues</span>{<span class="w">AtomIdentifierType</span>}<span class="s">)</span> <span class="s">{</span>
 127     <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;New: Object can&#39;t be instantiated without specifying AtomIdentifierType...&quot;</span><span class="sc">;</span>
 128   <span class="s">}</span>
 129 
 130   <span class="i">$This</span><span class="i">-&gt;_InitializeFingerprintsVector</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 131 
 132   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 133 <span class="s">}</span>
 134 
 135 <span class="c"># Set atom identifier type..</span>
 136 <span class="c">#</span>
<a name="SetAtomIdentifierType-"></a> 137 <span class="k">sub </span><span class="m">SetAtomIdentifierType</span> <span class="s">{</span>
 138   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$IdentifierType</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 139 
 140   <span class="k">if</span> <span class="s">(</span><span class="i">$IdentifierType</span> !~ <span class="q">/^(AtomicInvariantsAtomTypes|DREIDINGAtomTypes|EStateAtomTypes|FunctionalClassAtomTypes|MMFF94AtomTypes|SLogPAtomTypes|SYBYLAtomTypes|TPSAAtomTypes|UFFAtomTypes)$/i</span><span class="s">)</span> <span class="s">{</span>
 141     <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;SetAtomIdentifierType: Specified value, $IdentifierType, for AtomIdentifierType is not vaild. Supported types in current release of MayaChemTools: AtomicInvariantsAtomTypes, DREIDINGAtomTypes, EStateAtomTypes, FunctionalClassAtomTypes, MMFF94AtomTypes, SLogPAtomTypes, SYBYLAtomTypes, TPSAAtomTypes, and UFFAtomTypes.&quot;</span><span class="sc">;</span>
 142   <span class="s">}</span>
 143 
 144   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomIdentifierType</span>}<span class="s">)</span> <span class="s">{</span>
 145     <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;SeAtomIdentifierType: Can&#39;t change intial atom identifier type:  It&#39;s already set...&quot;</span><span class="sc">;</span>
 146   <span class="s">}</span>
 147 
 148   <span class="i">$This</span>-&gt;{<span class="w">AtomIdentifierType</span>} = <span class="i">$IdentifierType</span><span class="sc">;</span>
 149 
 150   <span class="c"># Initialize atom identifier type information...</span>
 151   <span class="i">$This</span><span class="i">-&gt;_InitializeAtomIdentifierTypeInformation</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 152 
 153   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 154 <span class="s">}</span>
 155 
 156 <span class="c"># Generate fingerprints description...</span>
 157 <span class="c">#</span>
<a name="GetDescription-"></a> 158 <span class="k">sub </span><span class="m">GetDescription</span> <span class="s">{</span>
 159   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 160 
 161   <span class="c"># Is description explicity set?</span>
 162   <span class="k">if</span> <span class="s">(</span><span class="k">exists</span> <span class="i">$This</span>-&gt;{<span class="w">Description</span>}<span class="s">)</span> <span class="s">{</span>
 163     <span class="k">return</span> <span class="i">$This</span>-&gt;{<span class="w">Description</span>}<span class="sc">;</span>
 164   <span class="s">}</span>
 165 
 166   <span class="c"># Generate fingerprints description...</span>
 167 
 168   <span class="k">return</span> <span class="q">&quot;$This-&gt;{Type}:$This-&gt;{AtomIdentifierType}&quot;</span><span class="sc">;</span>
 169 <span class="s">}</span>
 170 
 171 <span class="c"># Generate topological atom torsions [ Ref 58, Ref 72 ] fingerprints...</span>
 172 <span class="c">#</span>
 173 <span class="c"># Methodology:</span>
 174 <span class="c">#   . Assign atom types to all the atoms.</span>
 175 <span class="c">#   . Generate and count atom torsions.</span>
 176 <span class="c">#</span>
 177 <span class="c"># Notes:</span>
 178 <span class="c">#   . Hydrogen atoms are ignored during the fingerprint generation.</span>
 179 <span class="c">#</span>
<a name="GenerateFingerprints-"></a> 180 <span class="k">sub </span><span class="m">GenerateFingerprints</span> <span class="s">{</span>
 181   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 182 
 183   <span class="c"># Cache appropriate molecule data...</span>
 184   <span class="i">$This</span><span class="i">-&gt;_SetupMoleculeDataCache</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 185 
 186   <span class="c"># Assign atom types to all heavy atoms...</span>
 187   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;_AssignAtomTypes</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 188     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;GenerateFingerprints: $This-&gt;{AtomIdentifierType} fingerprints generation didn&#39;t succeed: Couldn&#39;t assign valid $This-&gt;{AtomIdentifierType} to all atoms...&quot;</span><span class="sc">;</span>
 189     <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 190   <span class="s">}</span>
 191 
 192   <span class="c"># Count atom torsions...</span>
 193   <span class="i">$This</span><span class="i">-&gt;_GenerateAndCountAtomTorsions</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 194 
 195   <span class="c"># Set final fingerprints...</span>
 196   <span class="i">$This</span><span class="i">-&gt;_SetFinalFingerprints</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 197 
 198   <span class="c"># Clear cached molecule data...</span>
 199   <span class="i">$This</span><span class="i">-&gt;_ClearMoleculeDataCache</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 200 
 201   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 202 <span class="s">}</span>
 203 
 204 <span class="c"># Assign appropriate atom types to all heavy atoms...</span>
 205 <span class="c">#</span>
<a name="_AssignAtomTypes-"></a> 206 <span class="k">sub </span><span class="m">_AssignAtomTypes</span> <span class="s">{</span>
 207   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 208   <span class="k">my</span><span class="s">(</span><span class="i">$SpecifiedAtomTypes</span><span class="cm">,</span> <span class="i">$Atom</span><span class="cm">,</span> <span class="i">$AtomID</span><span class="cm">,</span> <span class="i">$IgnoreHydrogens</span><span class="s">)</span><span class="sc">;</span>
 209 
 210   <span class="i">%</span>{<span class="i">$This</span>-&gt;{<span class="w">AssignedAtomTypes</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 211   <span class="i">$IgnoreHydrogens</span> = <span class="n">1</span><span class="sc">;</span>
 212 
 213   <span class="i">$SpecifiedAtomTypes</span> = <span class="k">undef</span><span class="sc">;</span>
 214 
 215   <span class="j">IDENTIFIERTYPE:</span> <span class="s">{</span>
 216     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomIdentifierType</span>} =~ <span class="q">/^AtomicInvariantsAtomTypes$/i</span><span class="s">)</span> <span class="s">{</span>
 217       <span class="i">$SpecifiedAtomTypes</span> = <span class="i">new</span> <span class="i">AtomTypes::AtomicInvariantsAtomTypes</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span> <span class="cm">=&gt;</span> <span class="i">$This</span>-&gt;{<span class="w">Molecule</span>}<span class="cm">,</span> <span class="q">&#39;IgnoreHydrogens&#39;</span> <span class="cm">=&gt;</span> <span class="i">$IgnoreHydrogens</span><span class="cm">,</span> <span class="q">&#39;AtomicInvariantsToUse&#39;</span> <span class="cm">=&gt;</span> <span class="i">$This</span>-&gt;{<span class="w">AtomicInvariantsToUse</span>}<span class="s">)</span><span class="sc">;</span>
 218       <span class="k">last</span> <span class="j">IDENTIFIERTYPE</span><span class="sc">;</span>
 219     <span class="s">}</span>
 220 
 221     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomIdentifierType</span>} =~ <span class="q">/^DREIDINGAtomTypes$/i</span><span class="s">)</span> <span class="s">{</span>
 222       <span class="i">$SpecifiedAtomTypes</span> = <span class="i">new</span> <span class="i">AtomTypes::DREIDINGAtomTypes</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span> <span class="cm">=&gt;</span> <span class="i">$This</span>-&gt;{<span class="w">Molecule</span>}<span class="cm">,</span> <span class="q">&#39;IgnoreHydrogens&#39;</span> <span class="cm">=&gt;</span> <span class="i">$IgnoreHydrogens</span><span class="s">)</span><span class="sc">;</span>
 223       <span class="k">last</span> <span class="j">IDENTIFIERTYPE</span><span class="sc">;</span>
 224     <span class="s">}</span>
 225 
 226     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomIdentifierType</span>} =~ <span class="q">/^EStateAtomTypes$/i</span><span class="s">)</span> <span class="s">{</span>
 227       <span class="i">$SpecifiedAtomTypes</span> = <span class="i">new</span> <span class="i">AtomTypes::EStateAtomTypes</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span> <span class="cm">=&gt;</span> <span class="i">$This</span>-&gt;{<span class="w">Molecule</span>}<span class="cm">,</span> <span class="q">&#39;IgnoreHydrogens&#39;</span> <span class="cm">=&gt;</span> <span class="i">$IgnoreHydrogens</span><span class="s">)</span><span class="sc">;</span>
 228       <span class="k">last</span> <span class="j">IDENTIFIERTYPE</span><span class="sc">;</span>
 229     <span class="s">}</span>
 230 
 231     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomIdentifierType</span>} =~ <span class="q">/^FunctionalClassAtomTypes$/i</span><span class="s">)</span> <span class="s">{</span>
 232       <span class="i">$SpecifiedAtomTypes</span> = <span class="i">new</span> <span class="i">AtomTypes::FunctionalClassAtomTypes</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span> <span class="cm">=&gt;</span> <span class="i">$This</span>-&gt;{<span class="w">Molecule</span>}<span class="cm">,</span> <span class="q">&#39;IgnoreHydrogens&#39;</span> <span class="cm">=&gt;</span> <span class="i">$IgnoreHydrogens</span><span class="cm">,</span> <span class="q">&#39;FunctionalClassesToUse&#39;</span> <span class="cm">=&gt;</span> <span class="i">$This</span>-&gt;{<span class="w">FunctionalClassesToUse</span>}<span class="s">)</span><span class="sc">;</span>
 233       <span class="k">last</span> <span class="j">IDENTIFIERTYPE</span><span class="sc">;</span>
 234     <span class="s">}</span>
 235 
 236     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomIdentifierType</span>} =~ <span class="q">/^MMFF94AtomTypes$/i</span><span class="s">)</span> <span class="s">{</span>
 237       <span class="i">$SpecifiedAtomTypes</span> = <span class="i">new</span> <span class="i">AtomTypes::MMFF94AtomTypes</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span> <span class="cm">=&gt;</span> <span class="i">$This</span>-&gt;{<span class="w">Molecule</span>}<span class="cm">,</span> <span class="q">&#39;IgnoreHydrogens&#39;</span> <span class="cm">=&gt;</span> <span class="i">$IgnoreHydrogens</span><span class="s">)</span><span class="sc">;</span>
 238       <span class="k">last</span> <span class="j">IDENTIFIERTYPE</span><span class="sc">;</span>
 239     <span class="s">}</span>
 240 
 241     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomIdentifierType</span>} =~ <span class="q">/^SLogPAtomTypes$/i</span><span class="s">)</span> <span class="s">{</span>
 242       <span class="i">$SpecifiedAtomTypes</span> = <span class="i">new</span> <span class="i">AtomTypes::SLogPAtomTypes</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span> <span class="cm">=&gt;</span> <span class="i">$This</span>-&gt;{<span class="w">Molecule</span>}<span class="cm">,</span> <span class="q">&#39;IgnoreHydrogens&#39;</span> <span class="cm">=&gt;</span> <span class="i">$IgnoreHydrogens</span><span class="s">)</span><span class="sc">;</span>
 243       <span class="k">last</span> <span class="j">IDENTIFIERTYPE</span><span class="sc">;</span>
 244     <span class="s">}</span>
 245     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomIdentifierType</span>} =~ <span class="q">/^SYBYLAtomTypes$/i</span><span class="s">)</span> <span class="s">{</span>
 246       <span class="i">$SpecifiedAtomTypes</span> = <span class="i">new</span> <span class="i">AtomTypes::SYBYLAtomTypes</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span> <span class="cm">=&gt;</span> <span class="i">$This</span>-&gt;{<span class="w">Molecule</span>}<span class="cm">,</span> <span class="q">&#39;IgnoreHydrogens&#39;</span> <span class="cm">=&gt;</span> <span class="i">$IgnoreHydrogens</span><span class="s">)</span><span class="sc">;</span>
 247       <span class="k">last</span> <span class="j">IDENTIFIERTYPE</span><span class="sc">;</span>
 248     <span class="s">}</span>
 249 
 250     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomIdentifierType</span>} =~ <span class="q">/^TPSAAtomTypes$/i</span><span class="s">)</span> <span class="s">{</span>
 251       <span class="i">$SpecifiedAtomTypes</span> = <span class="i">new</span> <span class="i">AtomTypes::TPSAAtomTypes</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span> <span class="cm">=&gt;</span> <span class="i">$This</span>-&gt;{<span class="w">Molecule</span>}<span class="cm">,</span> <span class="q">&#39;IgnorePhosphorus&#39;</span> <span class="cm">=&gt;</span> <span class="n">0</span><span class="cm">,</span> <span class="q">&#39;IgnoreSulfur&#39;</span> <span class="cm">=&gt;</span> <span class="n">0</span><span class="s">)</span><span class="sc">;</span>
 252       <span class="k">last</span> <span class="j">IDENTIFIERTYPE</span><span class="sc">;</span>
 253     <span class="s">}</span>
 254 
 255     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomIdentifierType</span>} =~ <span class="q">/^UFFAtomTypes$/i</span><span class="s">)</span> <span class="s">{</span>
 256       <span class="i">$SpecifiedAtomTypes</span> = <span class="i">new</span> <span class="i">AtomTypes::UFFAtomTypes</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span> <span class="cm">=&gt;</span> <span class="i">$This</span>-&gt;{<span class="w">Molecule</span>}<span class="cm">,</span> <span class="q">&#39;IgnoreHydrogens&#39;</span> <span class="cm">=&gt;</span> <span class="i">$IgnoreHydrogens</span><span class="s">)</span><span class="sc">;</span>
 257       <span class="k">last</span> <span class="j">IDENTIFIERTYPE</span><span class="sc">;</span>
 258     <span class="s">}</span>
 259 
 260     <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;_AssignAtomTypes: Unknown atom indentifier type $This-&gt;{AtomIdentifierType}...&quot;</span><span class="sc">;</span>
 261   <span class="s">}</span>
 262 
 263   <span class="c"># Assign atom types...</span>
 264   <span class="i">$SpecifiedAtomTypes</span><span class="i">-&gt;AssignAtomTypes</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 265 
 266   <span class="c"># Make sure atom types assignment is successful...</span>
 267   <span class="k">if</span> <span class="s">(</span>!<span class="i">$SpecifiedAtomTypes</span><span class="i">-&gt;IsAtomTypesAssignmentSuccessful</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 268     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
 269   <span class="s">}</span>
 270 
 271   <span class="c"># Collect assigned atom types...</span>
 272   <span class="j">ATOM:</span> <span class="k">for</span> <span class="i">$Atom</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">Atoms</span>}}<span class="s">)</span> <span class="s">{</span>
 273     <span class="k">if</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;IsHydrogen</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 274       <span class="k">next</span> <span class="j">ATOM</span><span class="sc">;</span>
 275     <span class="s">}</span>
 276     <span class="i">$AtomID</span> = <span class="i">$Atom</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 277     <span class="i">$This</span>-&gt;{<span class="w">AssignedAtomTypes</span>}{<span class="i">$AtomID</span>} = <span class="i">$SpecifiedAtomTypes</span><span class="i">-&gt;GetAtomType</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 278   <span class="s">}</span>
 279 
 280   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 281 <span class="s">}</span>
 282 
 283 <span class="c"># Count atom torsions involving non-hydrogen atoms by going over the structurally</span>
 284 <span class="c"># unique atom torsions...</span>
 285 <span class="c">#</span>
<a name="_GenerateAndCountAtomTorsions-"></a> 286 <span class="k">sub </span><span class="m">_GenerateAndCountAtomTorsions</span> <span class="s">{</span>
 287   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 288   <span class="k">my</span><span class="s">(</span><span class="i">$Atom1</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="cm">,</span> <span class="i">$Atom3</span><span class="cm">,</span> <span class="i">$Atom4</span><span class="cm">,</span> <span class="i">$AtomID1</span><span class="cm">,</span> <span class="i">$AtomID2</span><span class="cm">,</span> <span class="i">$AtomID3</span><span class="cm">,</span> <span class="i">$AtomID4</span><span class="cm">,</span> <span class="i">$AtomTorsionID</span><span class="cm">,</span> <span class="i">@Atom1Neighbors</span><span class="cm">,</span> <span class="i">@Atom2Neighbors</span><span class="cm">,</span> <span class="i">@Atom3Neighbors</span><span class="s">)</span><span class="sc">;</span>
 289 
 290   <span class="c"># Setup a hash to track structurally unique atom torsions by atom IDs...</span>
 291   <span class="i">%</span>{<span class="i">$This</span>-&gt;{<span class="w">StructurallyUniqueAtomTorsions</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 292 
 293   <span class="j">ATOM1:</span> <span class="k">for</span> <span class="i">$Atom1</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">Atoms</span>}}<span class="s">)</span> <span class="s">{</span>
 294     <span class="k">if</span> <span class="s">(</span><span class="i">$Atom1</span><span class="i">-&gt;IsHydrogen</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 295       <span class="k">next</span> <span class="j">ATOM1</span><span class="sc">;</span>
 296     <span class="s">}</span>
 297     <span class="i">$AtomID1</span> = <span class="i">$Atom1</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 298     <span class="c"># Go over Atom1 neighbors other than Atom1...</span>
 299     <span class="i">@Atom1Neighbors</span> = <span class="i">$Atom1</span><span class="i">-&gt;GetNeighbors</span><span class="s">(</span><span class="i">$Atom1</span><span class="s">)</span><span class="sc">;</span>
 300     <span class="j">ATOM2:</span> <span class="k">for</span> <span class="i">$Atom2</span> <span class="s">(</span><span class="i">@Atom1Neighbors</span><span class="s">)</span> <span class="s">{</span>
 301       <span class="k">if</span> <span class="s">(</span><span class="i">$Atom2</span><span class="i">-&gt;IsHydrogen</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 302         <span class="k">next</span> <span class="j">ATOM2</span><span class="sc">;</span>
 303       <span class="s">}</span>
 304       <span class="i">$AtomID2</span> = <span class="i">$Atom2</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 305       <span class="c"># Go over Atom2 neighbors other than Atom1 and Atom2...</span>
 306       <span class="i">@Atom2Neighbors</span> = <span class="i">$Atom2</span><span class="i">-&gt;GetNeighbors</span><span class="s">(</span><span class="i">$Atom1</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="s">)</span><span class="sc">;</span>
 307       <span class="j">ATOM3:</span> <span class="k">for</span> <span class="i">$Atom3</span> <span class="s">(</span><span class="i">@Atom2Neighbors</span><span class="s">)</span> <span class="s">{</span>
 308         <span class="k">if</span> <span class="s">(</span><span class="i">$Atom3</span><span class="i">-&gt;IsHydrogen</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 309           <span class="k">next</span> <span class="j">ATOM3</span><span class="sc">;</span>
 310         <span class="s">}</span>
 311         <span class="i">$AtomID3</span> = <span class="i">$Atom3</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 312         <span class="i">@Atom3Neighbors</span> = <span class="i">$Atom3</span><span class="i">-&gt;GetNeighbors</span><span class="s">(</span><span class="i">$Atom1</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="cm">,</span> <span class="i">$Atom3</span><span class="s">)</span><span class="sc">;</span>
 313         <span class="c"># Go over Atom3 neighbors other than Atom1, Atom2 and Atom3...</span>
 314         <span class="j">ATOM4:</span> <span class="k">for</span> <span class="i">$Atom4</span> <span class="s">(</span><span class="i">@Atom3Neighbors</span><span class="s">)</span> <span class="s">{</span>
 315           <span class="k">if</span> <span class="s">(</span><span class="i">$Atom4</span><span class="i">-&gt;IsHydrogen</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 316             <span class="k">next</span> <span class="j">ATOM4</span><span class="sc">;</span>
 317           <span class="s">}</span>
 318           <span class="i">$AtomID4</span> = <span class="i">$Atom4</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 319 
 320           <span class="c"># Is it a structurally unique torsion?</span>
 321           <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;_IsStructurallyUniqueTorsion</span><span class="s">(</span><span class="i">$AtomID1</span><span class="cm">,</span> <span class="i">$AtomID2</span><span class="cm">,</span> <span class="i">$AtomID3</span><span class="cm">,</span> <span class="i">$AtomID4</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 322             <span class="k">next</span> <span class="j">ATOM4</span><span class="sc">;</span>
 323           <span class="s">}</span>
 324 
 325           <span class="c"># Track structurally unique torsions...</span>
 326           <span class="i">$AtomTorsionID</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomTorsionID</span><span class="s">(</span><span class="i">$AtomID1</span><span class="cm">,</span> <span class="i">$AtomID2</span><span class="cm">,</span> <span class="i">$AtomID3</span><span class="cm">,</span> <span class="i">$AtomID4</span><span class="s">)</span><span class="sc">;</span>
 327           <span class="k">if</span> <span class="s">(</span><span class="k">exists</span> <span class="i">$This</span>-&gt;{<span class="w">AtomTorsionsCount</span>}{<span class="i">$AtomTorsionID</span>}<span class="s">)</span> <span class="s">{</span>
 328             <span class="i">$This</span>-&gt;{<span class="w">AtomTorsionsCount</span>}{<span class="i">$AtomTorsionID</span>} += <span class="n">1</span><span class="sc">;</span>
 329           <span class="s">}</span>
 330           <span class="k">else</span> <span class="s">{</span>
 331             <span class="i">$This</span>-&gt;{<span class="w">AtomTorsionsCount</span>}{<span class="i">$AtomTorsionID</span>} = <span class="n">1</span><span class="sc">;</span>
 332           <span class="s">}</span>
 333         <span class="s">}</span>
 334       <span class="s">}</span>
 335     <span class="s">}</span>
 336   <span class="s">}</span>
 337 
 338   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 339 <span class="s">}</span>
 340 
 341 <span class="c"># Is it a structurally unique torsions?</span>
 342 <span class="c">#</span>
 343 <span class="c"># Notes:</span>
 344 <span class="c">#  . For a torsion to be structurally unique which hasn&#39;t already been encountered,</span>
 345 <span class="c">#    all the four atoms involved in the torsion must be new atoms. And this can be</span>
 346 <span class="c">#    simply implemented by tracking the torsions using atom IDs and maintaining a</span>
 347 <span class="c">#    hash of already encountered torsions using lexicographically smaller torsion ID</span>
 348 <span class="c">#    consisting of four atom IDs.</span>
 349 <span class="c">#</span>
<a name="_IsStructurallyUniqueTorsion-"></a> 350 <span class="k">sub </span><span class="m">_IsStructurallyUniqueTorsion</span> <span class="s">{</span>
 351   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">@AtomIDs</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 352   <span class="k">my</span><span class="s">(</span><span class="i">$TorsionID</span><span class="cm">,</span> <span class="i">$ReverseTorsionID</span><span class="s">)</span><span class="sc">;</span>
 353 
 354   <span class="i">$TorsionID</span> = <span class="k">join</span> <span class="q">&quot;-&quot;</span><span class="cm">,</span> <span class="i">@AtomIDs</span><span class="sc">;</span>
 355   <span class="i">$ReverseTorsionID</span> = <span class="k">join</span> <span class="q">&quot;-&quot;</span><span class="cm">,</span> <span class="k">reverse</span> <span class="i">@AtomIDs</span><span class="sc">;</span>
 356 
 357   <span class="c"># Use lexicographically smaller string...</span>
 358   <span class="k">if</span> <span class="s">(</span><span class="i">$ReverseTorsionID</span> <span class="k">lt</span> <span class="i">$TorsionID</span><span class="s">)</span> <span class="s">{</span>
 359     <span class="i">$TorsionID</span> = <span class="i">$ReverseTorsionID</span><span class="sc">;</span>
 360   <span class="s">}</span>
 361 
 362   <span class="k">if</span> <span class="s">(</span><span class="k">exists</span> <span class="i">$This</span>-&gt;{<span class="w">StructurallyUniqueAtomTorsions</span>}{<span class="i">$TorsionID</span>}<span class="s">)</span> <span class="s">{</span>
 363     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
 364   <span class="s">}</span>
 365 
 366   <span class="c"># Keep track...</span>
 367   <span class="i">$This</span>-&gt;{<span class="w">StructurallyUniqueAtomTorsions</span>}{<span class="i">$TorsionID</span>} = <span class="n">1</span><span class="sc">;</span>
 368 
 369   <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
 370 <span class="s">}</span>
 371 
 372 <span class="c"># Get atom torsion ID corresponding to atom types involved in torsion...</span>
 373 <span class="c">#</span>
 374 <span class="c"># Notes:</span>
 375 <span class="c">#  . TorsionID corresponds to assigned atom types of all the four torsion atoms</span>
 376 <span class="c">#    concatenated by hyphen.</span>
 377 <span class="c">#  . TorsionIDs are generated for both forward and backward sequence of atoms</span>
 378 <span class="c">#    in the torsion and keeping the lexicographically smaller TorsionID to keep TorsionID</span>
 379 <span class="c">#    independent of atom ordering.</span>
 380 <span class="c">#</span>
<a name="_GetAtomTorsionID-"></a> 381 <span class="k">sub </span><span class="m">_GetAtomTorsionID</span> <span class="s">{</span>
 382   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">@AtomIDs</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 383   <span class="k">my</span><span class="s">(</span><span class="i">$AtomTorsionID</span><span class="cm">,</span> <span class="i">$ReverseAtomTorsionID</span><span class="cm">,</span> <span class="i">@AtomTypes</span><span class="s">)</span><span class="sc">;</span>
 384 
 385   <span class="i">@AtomTypes</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 386   <span class="i">@AtomTypes</span> = <span class="k">map</span> <span class="s">{</span> <span class="i">$This</span>-&gt;{<span class="w">AssignedAtomTypes</span>}{<span class="i">$_</span>} <span class="s">}</span> <span class="i">@AtomIDs</span><span class="sc">;</span>
 387 
 388   <span class="i">$AtomTorsionID</span> = <span class="k">join</span> <span class="q">&quot;-&quot;</span><span class="cm">,</span> <span class="i">@AtomTypes</span><span class="sc">;</span>
 389   <span class="i">$ReverseAtomTorsionID</span> = <span class="k">join</span> <span class="q">&quot;-&quot;</span><span class="cm">,</span> <span class="k">reverse</span> <span class="i">@AtomTypes</span><span class="sc">;</span>
 390 
 391   <span class="c"># Use lexicographically smaller string as ID...</span>
 392   <span class="k">return</span> <span class="s">(</span><span class="i">$ReverseAtomTorsionID</span> <span class="k">lt</span> <span class="i">$AtomTorsionID</span><span class="s">)</span> ? <span class="i">$ReverseAtomTorsionID</span> <span class="co">:</span> <span class="i">$AtomTorsionID</span><span class="sc">;</span>
 393 <span class="s">}</span>
 394 
 395 <span class="c"># Set final fingerpritns vector...</span>
 396 <span class="c">#</span>
<a name="_SetFinalFingerprints-"></a> 397 <span class="k">sub </span><span class="m">_SetFinalFingerprints</span> <span class="s">{</span>
 398   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 399   <span class="k">my</span><span class="s">(</span><span class="i">$AtomTorsionID</span><span class="cm">,</span> <span class="i">$Value</span><span class="cm">,</span> <span class="i">@Values</span><span class="s">)</span><span class="sc">;</span>
 400 
 401   <span class="c"># Mark successful generation of fingerprints...</span>
 402   <span class="i">$This</span>-&gt;{<span class="w">FingerprintsGenerated</span>} = <span class="n">1</span><span class="sc">;</span>
 403 
 404   <span class="i">@Values</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 405   <span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">AtomTorsionsIDs</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 406 
 407   <span class="k">for</span> <span class="i">$AtomTorsionID</span> <span class="s">(</span><span class="k">sort</span> <span class="k">keys</span> <span class="i">%</span>{<span class="i">$This</span>-&gt;{<span class="w">AtomTorsionsCount</span>}}<span class="s">)</span> <span class="s">{</span>
 408     <span class="i">$Value</span> = <span class="i">$This</span>-&gt;{<span class="w">AtomTorsionsCount</span>}{<span class="i">$AtomTorsionID</span>}<span class="sc">;</span>
 409     <span class="k">push</span> <span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">AtomTorsionsIDs</span>}}<span class="cm">,</span> <span class="i">$AtomTorsionID</span><span class="sc">;</span>
 410     <span class="k">push</span> <span class="i">@Values</span><span class="cm">,</span> <span class="i">$Value</span><span class="sc">;</span>
 411   <span class="s">}</span>
 412 
 413   <span class="c"># Add AtomPairsIDs and values to fingerprint vector...</span>
 414   <span class="i">$This</span>-&gt;{<span class="w">FingerprintsVector</span>}<span class="i">-&gt;AddValueIDs</span><span class="s">(</span>\<span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">AtomTorsionsIDs</span>}}<span class="s">)</span><span class="sc">;</span>
 415   <span class="i">$This</span>-&gt;{<span class="w">FingerprintsVector</span>}<span class="i">-&gt;AddValues</span><span class="s">(</span>\<span class="i">@Values</span><span class="s">)</span><span class="sc">;</span>
 416 
 417   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 418 <span class="s">}</span>
 419 
 420 <span class="c"># Get atom torsions IDs corresponding to atom torsions count values in fingerprint</span>
 421 <span class="c"># vector as an array or reference to an array...</span>
 422 <span class="c">#</span>
 423 <span class="c"># AtomTorsionsIDs list differes in molecules and is generated during finalization</span>
 424 <span class="c"># of fingerprints to make sure the fingerprint vector containing count values</span>
 425 <span class="c"># matches the atom torsions array.</span>
 426 <span class="c">#</span>
<a name="GetAtomTorsionsIDs-"></a> 427 <span class="k">sub </span><span class="m">GetAtomTorsionsIDs</span> <span class="s">{</span>
 428   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 429 
 430   <span class="k">return</span> <span class="k">wantarray</span> ? <span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">AtomTorsionsIDs</span>}} <span class="co">:</span> \<span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">AtomTorsionsIDs</span>}}<span class="sc">;</span>
 431 <span class="s">}</span>
 432 
 433 <span class="c"># Cache  appropriate molecule data...</span>
 434 <span class="c">#</span>
<a name="_SetupMoleculeDataCache-"></a> 435 <span class="k">sub </span><span class="m">_SetupMoleculeDataCache</span> <span class="s">{</span>
 436   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 437 
 438   <span class="c"># Get all atoms including hydrogens. The hydrogen atoms are ignored during processing...</span>
 439   <span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">Atoms</span>}} = <span class="i">$This</span><span class="i">-&gt;GetMolecule</span><span class="s">(</span><span class="s">)</span><span class="i">-&gt;GetAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 440 
 441   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 442 <span class="s">}</span>
 443 
 444 <span class="c"># Clear cached molecule data...</span>
 445 <span class="c">#</span>
<a name="_ClearMoleculeDataCache-"></a> 446 <span class="k">sub </span><span class="m">_ClearMoleculeDataCache</span> <span class="s">{</span>
 447   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 448 
 449   <span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">Atoms</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 450 
 451   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 452 <span class="s">}</span>
 453 
 454 <span class="c"># Set atomic invariants to use for atom identifiers...</span>
 455 <span class="c">#</span>
<a name="SetAtomicInvariantsToUse-"></a> 456 <span class="k">sub </span><span class="m">SetAtomicInvariantsToUse</span> <span class="s">{</span>
 457   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">@Values</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 458   <span class="k">my</span><span class="s">(</span><span class="i">$FirstValue</span><span class="cm">,</span> <span class="i">$TypeOfFirstValue</span><span class="cm">,</span> <span class="i">$AtomicInvariant</span><span class="cm">,</span> <span class="i">$SpecifiedAtomicInvariant</span><span class="cm">,</span> <span class="i">$AtomicInvariantValue</span><span class="cm">,</span> <span class="i">@SpecifiedAtomicInvariants</span><span class="cm">,</span> <span class="i">@AtomicInvariantsToUse</span><span class="s">)</span><span class="sc">;</span>
 459 
 460   <span class="k">if</span> <span class="s">(</span>!<span class="i">@Values</span><span class="s">)</span> <span class="s">{</span>
 461     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;SetAtomicInvariantsToUse: No values specified...&quot;</span><span class="sc">;</span>
 462     <span class="k">return</span><span class="sc">;</span>
 463   <span class="s">}</span>
 464 
 465   <span class="i">$FirstValue</span> = <span class="i">$Values</span>[<span class="n">0</span>]<span class="sc">;</span>
 466   <span class="i">$TypeOfFirstValue</span> = <span class="k">ref</span> <span class="i">$FirstValue</span><span class="sc">;</span>
 467 
 468   <span class="i">@SpecifiedAtomicInvariants</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 469   <span class="i">@AtomicInvariantsToUse</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 470 
 471   <span class="k">if</span> <span class="s">(</span><span class="i">$TypeOfFirstValue</span> =~ <span class="q">/^ARRAY/</span><span class="s">)</span> <span class="s">{</span>
 472     <span class="k">push</span> <span class="i">@SpecifiedAtomicInvariants</span><span class="cm">,</span> <span class="i">@</span>{<span class="i">$FirstValue</span>}<span class="sc">;</span>
 473   <span class="s">}</span>
 474   <span class="k">else</span> <span class="s">{</span>
 475     <span class="k">push</span> <span class="i">@SpecifiedAtomicInvariants</span><span class="cm">,</span> <span class="i">@Values</span><span class="sc">;</span>
 476   <span class="s">}</span>
 477 
 478   <span class="c"># Make sure specified AtomicInvariants are valid...</span>
 479   <span class="k">for</span> <span class="i">$SpecifiedAtomicInvariant</span> <span class="s">(</span><span class="i">@SpecifiedAtomicInvariants</span><span class="s">)</span> <span class="s">{</span>
 480     <span class="k">if</span> <span class="s">(</span>!<span class="i">AtomTypes::AtomicInvariantsAtomTypes::IsAtomicInvariantAvailable</span><span class="s">(</span><span class="i">$SpecifiedAtomicInvariant</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 481       <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;SetAtomicInvariantsToUse: Specified atomic invariant, $SpecifiedAtomicInvariant, is not supported...\n &quot;</span><span class="sc">;</span>
 482     <span class="s">}</span>
 483     <span class="i">$AtomicInvariant</span> = <span class="i">$SpecifiedAtomicInvariant</span><span class="sc">;</span>
 484     <span class="k">push</span> <span class="i">@AtomicInvariantsToUse</span><span class="cm">,</span> <span class="i">$AtomicInvariant</span><span class="sc">;</span>
 485   <span class="s">}</span>
 486 
 487   <span class="c"># Set atomic invariants to use...</span>
 488   <span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">AtomicInvariantsToUse</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 489   <span class="k">push</span> <span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">AtomicInvariantsToUse</span>}}<span class="cm">,</span> <span class="i">@AtomicInvariantsToUse</span><span class="sc">;</span>
 490 
 491   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 492 <span class="s">}</span>
 493 
 494 <span class="c"># Set functional classes to use for atom identifiers...</span>
 495 <span class="c">#</span>
<a name="SetFunctionalClassesToUse-"></a> 496 <span class="k">sub </span><span class="m">SetFunctionalClassesToUse</span> <span class="s">{</span>
 497   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">@Values</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 498   <span class="k">my</span><span class="s">(</span><span class="i">$FirstValue</span><span class="cm">,</span> <span class="i">$TypeOfFirstValue</span><span class="cm">,</span> <span class="i">$FunctionalClass</span><span class="cm">,</span> <span class="i">$SpecifiedFunctionalClass</span><span class="cm">,</span> <span class="i">@SpecifiedFunctionalClasses</span><span class="cm">,</span> <span class="i">@FunctionalClassesToUse</span><span class="s">)</span><span class="sc">;</span>
 499 
 500   <span class="k">if</span> <span class="s">(</span>!<span class="i">@Values</span><span class="s">)</span> <span class="s">{</span>
 501     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;SetFunctionalClassesToUse: No values specified...&quot;</span><span class="sc">;</span>
 502     <span class="k">return</span><span class="sc">;</span>
 503   <span class="s">}</span>
 504 
 505   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomIdentifierType</span>} !~ <span class="q">/^FunctionalClassAtomTypes$/i</span><span class="s">)</span> <span class="s">{</span>
 506     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;SetFunctionalClassesToUse: FunctionalClassesToUse can&#39;t be set for InitialAtomIdentifierType of $This-&gt;{AtomIdentifierType}...&quot;</span><span class="sc">;</span>
 507     <span class="k">return</span><span class="sc">;</span>
 508   <span class="s">}</span>
 509 
 510   <span class="i">$FirstValue</span> = <span class="i">$Values</span>[<span class="n">0</span>]<span class="sc">;</span>
 511   <span class="i">$TypeOfFirstValue</span> = <span class="k">ref</span> <span class="i">$FirstValue</span><span class="sc">;</span>
 512 
 513   <span class="i">@SpecifiedFunctionalClasses</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 514   <span class="i">@FunctionalClassesToUse</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 515 
 516   <span class="k">if</span> <span class="s">(</span><span class="i">$TypeOfFirstValue</span> =~ <span class="q">/^ARRAY/</span><span class="s">)</span> <span class="s">{</span>
 517     <span class="k">push</span> <span class="i">@SpecifiedFunctionalClasses</span><span class="cm">,</span> <span class="i">@</span>{<span class="i">$FirstValue</span>}<span class="sc">;</span>
 518   <span class="s">}</span>
 519   <span class="k">else</span> <span class="s">{</span>
 520     <span class="k">push</span> <span class="i">@SpecifiedFunctionalClasses</span><span class="cm">,</span> <span class="i">@Values</span><span class="sc">;</span>
 521   <span class="s">}</span>
 522 
 523   <span class="c"># Make sure specified FunctionalClasses are valid...</span>
 524   <span class="k">for</span> <span class="i">$SpecifiedFunctionalClass</span> <span class="s">(</span><span class="i">@SpecifiedFunctionalClasses</span><span class="s">)</span> <span class="s">{</span>
 525     <span class="k">if</span> <span class="s">(</span>!<span class="i">AtomTypes::FunctionalClassAtomTypes::IsFunctionalClassAvailable</span><span class="s">(</span><span class="i">$SpecifiedFunctionalClass</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 526       <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;SetFunctionalClassesToUse: Specified functional class, $SpecifiedFunctionalClass, is not supported...\n &quot;</span><span class="sc">;</span>
 527     <span class="s">}</span>
 528     <span class="k">push</span> <span class="i">@FunctionalClassesToUse</span><span class="cm">,</span> <span class="i">$SpecifiedFunctionalClass</span><span class="sc">;</span>
 529   <span class="s">}</span>
 530 
 531   <span class="c"># Set functional classes to use...</span>
 532   <span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">FunctionalClassesToUse</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 533   <span class="k">push</span> <span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">FunctionalClassesToUse</span>}}<span class="cm">,</span> <span class="i">@FunctionalClassesToUse</span><span class="sc">;</span>
 534 
 535   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 536 <span class="s">}</span>
 537 
 538 <span class="c"># Initialize atom indentifier type information...</span>
 539 <span class="c">#</span>
 540 <span class="c"># Current supported values:</span>
 541 <span class="c">#</span>
 542 <span class="c"># AtomicInvariantsAtomTypes, DREIDINGAtomTypes, EStateAtomTypes, FunctionalClassAtomTypes,</span>
 543 <span class="c"># MMFF94AtomTypes, SLogPAtomTypes, SYBYLAtomTypes, TPSAAtomTypes, UFFAtomTypes</span>
 544 <span class="c">#</span>
<a name="_InitializeAtomIdentifierTypeInformation-"></a> 545 <span class="k">sub </span><span class="m">_InitializeAtomIdentifierTypeInformation</span> <span class="s">{</span>
 546   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 547 
 548   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomIdentifierType</span>} =~ <span class="q">/^AtomicInvariantsAtomTypes$/i</span><span class="s">)</span> <span class="s">{</span>
 549     <span class="i">$This</span><span class="i">-&gt;_InitializeAtomicInvariantsAtomTypesInformation</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 550   <span class="s">}</span>
 551   <span class="k">elsif</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomIdentifierType</span>} =~ <span class="q">/^FunctionalClassAtomTypes$/i</span><span class="s">)</span> <span class="s">{</span>
 552     <span class="i">$This</span><span class="i">-&gt;_InitializeFunctionalClassAtomTypesInformation</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 553   <span class="s">}</span>
 554   <span class="k">elsif</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomIdentifierType</span>} =~ <span class="q">/^(DREIDINGAtomTypes|EStateAtomTypes|MMFF94AtomTypes|SLogPAtomTypes|SYBYLAtomTypes|TPSAAtomTypes|UFFAtomTypes)$/i</span><span class="s">)</span> <span class="s">{</span>
 555     <span class="c"># Nothing to do for now...</span>
 556   <span class="s">}</span>
 557   <span class="k">else</span> <span class="s">{</span>
 558     <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;_InitializeAtomIdentifierTypeInformation: Unknown atom indentifier type $This-&gt;{AtomIdentifierType}...&quot;</span><span class="sc">;</span>
 559   <span class="s">}</span>
 560 
 561   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 562 <span class="s">}</span>
 563 
 564 <span class="c"># Initialize atomic invariants to use for generating atom IDs in atom torsions...</span>
 565 <span class="c">#</span>
 566 <span class="c"># Let:</span>
 567 <span class="c">#   AS = Atom symbol corresponding to element symbol</span>
 568 <span class="c">#</span>
 569 <span class="c">#   X&lt;n&gt;   = Number of non-hydrogen atom neighbors or heavy atoms attached to atom</span>
 570 <span class="c">#   BO&lt;n&gt; = Sum of bond orders to non-hydrogen atom neighbors or heavy atoms attached to atom</span>
 571 <span class="c">#   LBO&lt;n&gt; = Largest bond order of non-hydrogen atom neighbors or heavy atoms attached to atom</span>
 572 <span class="c">#   SB&lt;n&gt; = Number of single bonds to non-hydrogen atom neighbors or heavy atoms attached to atom</span>
 573 <span class="c">#   DB&lt;n&gt; = Number of double bonds to non-hydrogen atom neighbors or heavy atoms attached to atom</span>
 574 <span class="c">#   TB&lt;n&gt; = Number of triple bonds to non-hydrogen atom neighbors or heavy atoms attached to atom</span>
 575 <span class="c">#   H&lt;n&gt;   = Number of implicit and explicit hydrogens for atom</span>
 576 <span class="c">#   Ar     = Aromatic annotation indicating whether atom is aromatic</span>
 577 <span class="c">#   RA     = Ring atom annotation indicating whether atom is a ring</span>
 578 <span class="c">#   FC&lt;+n/-n&gt; = Formal charge assigned to atom</span>
 579 <span class="c">#   MN&lt;n&gt; = Mass number indicating isotope other than most abundant isotope</span>
 580 <span class="c">#   SM&lt;n&gt; = Spin multiplicity of atom. Possible values: 1 (singlet), 2 (doublet) or 3 (triplet)</span>
 581 <span class="c">#</span>
 582 <span class="c">#   AtomTypeIDx = Atomic invariants atom type for atom x</span>
 583 <span class="c">#   AtomTypeIDy = Atomic invariants atom type for atom y</span>
 584 <span class="c">#   AtomTypeIDz = Atomic invariants atom type for atom z</span>
 585 <span class="c">#   AtomTypeIDw = Atomic invariants atom type for atom w</span>
 586 <span class="c">#</span>
 587 <span class="c"># Then:</span>
 588 <span class="c">#</span>
 589 <span class="c">#   Atom torsion AtomID generated by AtomTypes::AtomicInvariantsAtomTypes class corresponds to:</span>
 590 <span class="c">#</span>
 591 <span class="c">#     AS.X&lt;n&gt;.BO&lt;n&gt;.LBO&lt;n&gt;.&lt;SB&gt;&lt;n&gt;.&lt;DB&gt;&lt;n&gt;.&lt;TB&gt;&lt;n&gt;.H&lt;n&gt;.Ar.RA.FC&lt;+n/-n&gt;.MN&lt;n&gt;.SM&lt;n&gt;</span>
 592 <span class="c">#</span>
 593 <span class="c">#  AtomTorsion ID corresponds to:</span>
 594 <span class="c">#</span>
 595 <span class="c">#    AtomTypeIDx-AtomTypeIDy-AtomTypeIDz-AtomTypeIDw</span>
 596 <span class="c">#</span>
 597 <span class="c"># Except for AS which is a required atomic invariant in atom torsions AtomIDs, all other atomic invariants are</span>
 598 <span class="c"># optional. Default atomic invariants used for AtomID are: AS, X&lt;n&gt;, BO&lt;n&gt;, H&lt;n&gt;, FC&lt;+n/-n&gt;.</span>
 599 <span class="c"># AtomID specification doesn&#39;t include atomic invariants with zero or undefined values.</span>
 600 <span class="c">#</span>
 601 <span class="c"># Examples of atom torsion AtomIDs in Aspirin using default atomic invariants:</span>
 602 <span class="c">#</span>
 603 <span class="c">#  C.X1.BO1.H3-C.X3.BO4-O.X2.BO2-C.X3.BO4</span>
 604 <span class="c">#  C.X2.BO3.H1-C.X2.BO3.H1-C.X2.BO3.H1-C.X2.BO3.H1</span>
 605 <span class="c">#  C.X3.BO4-C.X3.BO4-O.X2.BO2-C.X3.BO4</span>
 606 <span class="c">#  C.X3.BO4-O.X2.BO2-C.X3.BO4-O.X1.BO2</span>
 607 <span class="c">#</span>
 608 <span class="c"># Examples of atom torsion AtomIDs in Aspirin using AS, X and BO atomic invariants:</span>
 609 <span class="c">#</span>
 610 <span class="c">#  C.X1.BO1-C.X3.BO4-O.X2.BO2-C.X3.BO4</span>
 611 <span class="c">#  C.X2.BO3-C.X2.BO3-C.X2.BO3-C.X2.BO3</span>
 612 <span class="c">#  C.X3.BO4-C.X3.BO4-O.X2.BO2-C.X3.BO4</span>
 613 <span class="c">#  C.X3.BO4-O.X2.BO2-C.X3.BO4-O.X1.BO2</span>
 614 <span class="c">#</span>
<a name="_InitializeAtomicInvariantsAtomTypesInformation-"></a> 615 <span class="k">sub </span><span class="m">_InitializeAtomicInvariantsAtomTypesInformation</span> <span class="s">{</span>
 616   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 617 
 618   <span class="c"># Default atomic invariants to use for generating atom torsions atom IDs: AS, X, BO, H, FC</span>
 619   <span class="c">#</span>
 620   <span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">AtomicInvariantsToUse</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 621   <span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">AtomicInvariantsToUse</span>}} = <span class="s">(</span><span class="q">&#39;AS&#39;</span><span class="cm">,</span> <span class="q">&#39;X&#39;</span><span class="cm">,</span> <span class="q">&#39;BO&#39;</span><span class="cm">,</span> <span class="q">&#39;H&#39;</span><span class="cm">,</span> <span class="q">&#39;FC&#39;</span><span class="s">)</span><span class="sc">;</span>
 622 
 623   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 624 <span class="s">}</span>
 625 
 626 <span class="c"># Initialize functional class atom types, generated by AtomTypes::FunctionalClassAtomTypes</span>
 627 <span class="c"># class, to use for generating atom identifiers...</span>
 628 <span class="c">#</span>
 629 <span class="c"># Let:</span>
 630 <span class="c">#   HBD: HydrogenBondDonor</span>
 631 <span class="c">#   HBA: HydrogenBondAcceptor</span>
 632 <span class="c">#   PI :  PositivelyIonizable</span>
 633 <span class="c">#   NI : NegativelyIonizable</span>
 634 <span class="c">#   Ar : Aromatic</span>
 635 <span class="c">#   Hal : Halogen</span>
 636 <span class="c">#   H : Hydrophobic</span>
 637 <span class="c">#   RA : RingAtom</span>
 638 <span class="c">#   CA : ChainAtom</span>
 639 <span class="c">#</span>
 640 <span class="c"># Then:</span>
 641 <span class="c">#</span>
 642 <span class="c">#   Functiononal class atom type specification for an atom corresponds to:</span>
 643 <span class="c">#</span>
 644 <span class="c">#     Ar.CA.H.HBA.HBD.Hal.NI.PI.RA</span>
 645 <span class="c">#</span>
 646 <span class="c">#   Default functional classes used are: HBD, HBA, PI, NI, Ar, Hal</span>
 647 <span class="c">#</span>
 648 <span class="c">#   FunctionalAtomTypes are assigned using the following definitions [ Ref 60-61, Ref 65-66 ]:</span>
 649 <span class="c">#</span>
 650 <span class="c">#     HydrogenBondDonor: NH, NH2, OH</span>
 651 <span class="c">#     HydrogenBondAcceptor: N[!H], O</span>
 652 <span class="c">#     PositivelyIonizable: +, NH2</span>
 653 <span class="c">#     NegativelyIonizable: -, C(=O)OH, S(=O)OH, P(=O)OH</span>
 654 <span class="c">#</span>
<a name="_InitializeFunctionalClassAtomTypesInformation-"></a> 655 <span class="k">sub </span><span class="m">_InitializeFunctionalClassAtomTypesInformation</span> <span class="s">{</span>
 656   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 657 
 658   <span class="c"># Default functional class atom typess to use for generating atom identifiers</span>
 659   <span class="c"># are: HBD, HBA, PI, NI, Ar, Hal</span>
 660   <span class="c">#</span>
 661   <span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">FunctionalClassesToUse</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 662   <span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">FunctionalClassesToUse</span>}} = <span class="s">(</span><span class="q">&#39;HBD&#39;</span><span class="cm">,</span> <span class="q">&#39;HBA&#39;</span><span class="cm">,</span> <span class="q">&#39;PI&#39;</span><span class="cm">,</span> <span class="q">&#39;NI&#39;</span><span class="cm">,</span> <span class="q">&#39;Ar&#39;</span><span class="cm">,</span> <span class="q">&#39;Hal&#39;</span><span class="s">)</span><span class="sc">;</span>
 663 
 664   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 665 <span class="s">}</span>
 666 
 667 <span class="c"># Return a string containg data for TopologicalAtomTorsionsFingerprints object...</span>
 668 <span class="c">#</span>
<a name="StringifyTopologicalAtomTorsionsFingerprints-"></a> 669 <span class="k">sub </span><span class="m">StringifyTopologicalAtomTorsionsFingerprints</span> <span class="s">{</span>
 670   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 671   <span class="k">my</span><span class="s">(</span><span class="i">$FingerprintsString</span><span class="s">)</span><span class="sc">;</span>
 672 
 673   <span class="c"># Type of fingerprint...</span>
 674   <span class="i">$FingerprintsString</span> = <span class="q">&quot;Fingerprint type: $This-&gt;{Type}; AtomIdentifierType: $This-&gt;{AtomIdentifierType}&quot;</span><span class="sc">;</span>
 675 
 676   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomIdentifierType</span>} =~ <span class="q">/^AtomicInvariantsAtomTypes$/i</span><span class="s">)</span> <span class="s">{</span>
 677     <span class="k">my</span><span class="s">(</span><span class="i">$AtomicInvariant</span><span class="cm">,</span> <span class="i">@AtomicInvariants</span><span class="cm">,</span> <span class="i">@AtomicInvariantsOrder</span><span class="cm">,</span> <span class="i">%AvailableAtomicInvariants</span><span class="s">)</span><span class="sc">;</span>
 678 
 679     <span class="i">@AtomicInvariantsOrder</span> = <span class="i">AtomTypes::AtomicInvariantsAtomTypes::GetAtomicInvariantsOrder</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 680     <span class="i">%AvailableAtomicInvariants</span> = <span class="i">AtomTypes::AtomicInvariantsAtomTypes::GetAvailableAtomicInvariants</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 681 
 682     <span class="k">for</span> <span class="i">$AtomicInvariant</span> <span class="s">(</span><span class="i">@AtomicInvariantsOrder</span><span class="s">)</span> <span class="s">{</span>
 683       <span class="k">push</span> <span class="i">@AtomicInvariants</span><span class="cm">,</span> <span class="q">&quot;$AtomicInvariant: $AvailableAtomicInvariants{$AtomicInvariant}&quot;</span><span class="sc">;</span>
 684     <span class="s">}</span>
 685 
 686     <span class="i">$FingerprintsString</span> .= <span class="q">&quot;; AtomicInvariantsToUse: &lt;&quot;</span> . <span class="i">TextUtil::JoinWords</span><span class="s">(</span>\<span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">AtomicInvariantsToUse</span>}}<span class="cm">,</span> <span class="q">&quot;, &quot;</span><span class="cm">,</span> <span class="n">0</span><span class="s">)</span> . <span class="q">&quot;&gt;&quot;</span><span class="sc">;</span>
 687     <span class="i">$FingerprintsString</span> .= <span class="q">&quot;; AtomicInvariantsOrder: &lt;&quot;</span> . <span class="i">TextUtil::JoinWords</span><span class="s">(</span>\<span class="i">@AtomicInvariantsOrder</span><span class="cm">,</span> <span class="q">&quot;, &quot;</span><span class="cm">,</span> <span class="n">0</span><span class="s">)</span> . <span class="q">&quot;&gt;&quot;</span><span class="sc">;</span>
 688     <span class="i">$FingerprintsString</span> .= <span class="q">&quot;; AvailableAtomicInvariants: &lt;&quot;</span> . <span class="i">TextUtil::JoinWords</span><span class="s">(</span>\<span class="i">@AtomicInvariants</span><span class="cm">,</span> <span class="q">&quot;, &quot;</span><span class="cm">,</span> <span class="n">0</span><span class="s">)</span> . <span class="q">&quot;&gt;&quot;</span><span class="sc">;</span>
 689   <span class="s">}</span>
 690   <span class="k">elsif</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomIdentifierType</span>} =~ <span class="q">/^FunctionalClassAtomTypes$/i</span><span class="s">)</span> <span class="s">{</span>
 691     <span class="k">my</span><span class="s">(</span><span class="i">$FunctionalClass</span><span class="cm">,</span> <span class="i">@FunctionalClasses</span><span class="cm">,</span> <span class="i">@FunctionalClassesOrder</span><span class="cm">,</span> <span class="i">%AvailableFunctionalClasses</span><span class="s">)</span><span class="sc">;</span>
 692 
 693     <span class="i">@FunctionalClassesOrder</span> = <span class="i">AtomTypes::FunctionalClassAtomTypes::GetFunctionalClassesOrder</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 694     <span class="i">%AvailableFunctionalClasses</span> = <span class="i">AtomTypes::FunctionalClassAtomTypes::GetAvailableFunctionalClasses</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 695 
 696     <span class="k">for</span> <span class="i">$FunctionalClass</span> <span class="s">(</span><span class="i">@FunctionalClassesOrder</span><span class="s">)</span> <span class="s">{</span>
 697       <span class="k">push</span> <span class="i">@FunctionalClasses</span><span class="cm">,</span> <span class="q">&quot;$FunctionalClass: $AvailableFunctionalClasses{$FunctionalClass}&quot;</span><span class="sc">;</span>
 698     <span class="s">}</span>
 699 
 700     <span class="i">$FingerprintsString</span> .= <span class="q">&quot;; FunctionalClassesToUse: &lt;&quot;</span> . <span class="i">TextUtil::JoinWords</span><span class="s">(</span>\<span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">FunctionalClassesToUse</span>}}<span class="cm">,</span> <span class="q">&quot;, &quot;</span><span class="cm">,</span> <span class="n">0</span><span class="s">)</span> . <span class="q">&quot;&gt;&quot;</span><span class="sc">;</span>
 701     <span class="i">$FingerprintsString</span> .= <span class="q">&quot;; FunctionalClassesOrder: &lt;&quot;</span> . <span class="i">TextUtil::JoinWords</span><span class="s">(</span>\<span class="i">@FunctionalClassesOrder</span><span class="cm">,</span> <span class="q">&quot;, &quot;</span><span class="cm">,</span> <span class="n">0</span><span class="s">)</span> . <span class="q">&quot;&gt;&quot;</span><span class="sc">;</span>
 702     <span class="i">$FingerprintsString</span> .= <span class="q">&quot;; AvailableFunctionalClasses: &lt;&quot;</span> . <span class="i">TextUtil::JoinWords</span><span class="s">(</span>\<span class="i">@FunctionalClasses</span><span class="cm">,</span> <span class="q">&quot;, &quot;</span><span class="cm">,</span> <span class="n">0</span><span class="s">)</span> . <span class="q">&quot;&gt;&quot;</span><span class="sc">;</span>
 703   <span class="s">}</span>
 704 
 705   <span class="c"># Total number of atom torsions...</span>
 706   <span class="i">$FingerprintsString</span> .= <span class="q">&quot;; NumOfAtomTorsions: &quot;</span> . <span class="i">$This</span>-&gt;{<span class="w">FingerprintsVector</span>}<span class="i">-&gt;GetNumOfValues</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 707 
 708   <span class="c"># FingerprintsVector...</span>
 709   <span class="i">$FingerprintsString</span> .= <span class="q">&quot;; FingerprintsVector: &lt; $This-&gt;{FingerprintsVector} &gt;&quot;</span><span class="sc">;</span>
 710 
 711   <span class="k">return</span> <span class="i">$FingerprintsString</span><span class="sc">;</span>
 712 <span class="s">}</span>
 713 
<a name="EOF-"></a></pre>
<p>&nbsp;</p>
<br />
<center>
<img src="../../../images/h2o2.png">
</center>
</body>
</html>
