<html>
<head>
<title>MayaChemTools:Code:ExtractFromSDFiles.pl</title>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<link rel="stylesheet" type="text/css" href="../../../css/MayaChemToolsCode.css">
</head>
<body leftmargin="20" rightmargin="20" topmargin="10" bottommargin="10">
<br/>
<center>
<a href="http://www.mayachemtools.org" title="MayaChemTools Home"><img src="../../../images/MayaChemToolsLogo.gif" border="0" alt="MayaChemTools"></a>
</center>
<br/>
<pre>
   1 #!/usr/bin/perl -w
   2 <span class="c">#</span>
   3 <span class="c"># $RCSfile: ExtractFromSDFiles.pl,v $</span>
   4 <span class="c"># $Date: 2017/01/12 18:57:06 $</span>
   5 <span class="c"># $Revision: 1.50 $</span>
   6 <span class="c">#</span>
   7 <span class="c"># Author: Manish Sud &lt;msud@san.rr.com&gt;</span>
   8 <span class="c">#</span>
   9 <span class="c"># Copyright (C) 2017 Manish Sud. All rights reserved.</span>
  10 <span class="c">#</span>
  11 <span class="c"># This file is part of MayaChemTools.</span>
  12 <span class="c">#</span>
  13 <span class="c"># MayaChemTools is free software; you can redistribute it and/or modify it under</span>
  14 <span class="c"># the terms of the GNU Lesser General Public License as published by the Free</span>
  15 <span class="c"># Software Foundation; either version 3 of the License, or (at your option) any</span>
  16 <span class="c"># later version.</span>
  17 <span class="c">#</span>
  18 <span class="c"># MayaChemTools is distributed in the hope that it will be useful, but without</span>
  19 <span class="c"># any warranty; without even the implied warranty of merchantability of fitness</span>
  20 <span class="c"># for a particular purpose.  See the GNU Lesser General Public License for more</span>
  21 <span class="c"># details.</span>
  22 <span class="c">#</span>
  23 <span class="c"># You should have received a copy of the GNU Lesser General Public License</span>
  24 <span class="c"># along with MayaChemTools; if not, see &lt;http://www.gnu.org/licenses/&gt; or</span>
  25 <span class="c"># write to the Free Software Foundation Inc., 59 Temple Place, Suite 330,</span>
  26 <span class="c"># Boston, MA, 02111-1307, USA.</span>
  27 <span class="c">#</span>
  28 
  29 <span class="k">use</span> <span class="w">strict</span><span class="sc">;</span>
  30 <span class="k">use</span> <span class="w">FindBin</span><span class="sc">;</span> <span class="k">use</span> <span class="w">lib</span> <span class="q">&quot;$FindBin::Bin/../lib&quot;</span><span class="sc">;</span>
  31 <span class="k">use</span> <span class="w">Getopt::Long</span><span class="sc">;</span>
  32 <span class="k">use</span> <span class="w">File::Basename</span><span class="sc">;</span>
  33 <span class="k">use</span> <span class="w">Text::ParseWords</span><span class="sc">;</span>
  34 <span class="k">use</span> <span class="w">Benchmark</span><span class="sc">;</span>
  35 <span class="k">use</span> <span class="w">SDFileUtil</span><span class="sc">;</span>
  36 <span class="k">use</span> <span class="w">FileUtil</span><span class="sc">;</span>
  37 <span class="k">use</span> <span class="w">TextUtil</span><span class="sc">;</span>
  38 
  39 <span class="k">my</span><span class="s">(</span><span class="i">$ScriptName</span><span class="cm">,</span> <span class="i">%Options</span><span class="cm">,</span> <span class="i">$StartTime</span><span class="cm">,</span> <span class="i">$EndTime</span><span class="cm">,</span> <span class="i">$TotalTime</span><span class="s">)</span><span class="sc">;</span>
  40 
  41 <span class="c"># Autoflush STDOUT</span>
  42 <span class="i">$|</span> = <span class="n">1</span><span class="sc">;</span>
  43 
  44 <span class="c"># Starting message...</span>
  45 <span class="i">$ScriptName</span> = <span class="i">basename</span><span class="s">(</span><span class="i">$0</span><span class="s">)</span><span class="sc">;</span>
  46 <span class="k">print</span> <span class="q">&quot;\n$ScriptName:Starting...\n\n&quot;</span><span class="sc">;</span>
  47 <span class="i">$StartTime</span> = <span class="w">new</span> <span class="w">Benchmark</span><span class="sc">;</span>
  48 
  49 <span class="c"># Get the options and setup script...</span>
  50 <span class="i">SetupScriptUsage</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  51 <span class="k">if</span> <span class="s">(</span><span class="i">$Options</span>{<span class="w">help</span>} || <span class="i">@ARGV</span> &lt; <span class="n">1</span><span class="s">)</span> <span class="s">{</span>
  52   <span class="k">die</span> <span class="i">GetUsageFromPod</span><span class="s">(</span><span class="q">&quot;$FindBin::Bin/$ScriptName&quot;</span><span class="s">)</span><span class="sc">;</span>
  53 <span class="s">}</span>
  54 
  55 <span class="k">my</span><span class="s">(</span><span class="i">@SDFilesList</span><span class="s">)</span><span class="sc">;</span>
  56 <span class="i">@SDFilesList</span> = <span class="i">ExpandFileNames</span><span class="s">(</span>\<span class="i">@ARGV</span><span class="cm">,</span> <span class="q">&quot;sdf sd&quot;</span><span class="s">)</span><span class="sc">;</span>
  57 
  58 <span class="c"># Process options...</span>
  59 <span class="k">print</span> <span class="q">&quot;Processing options...\n&quot;</span><span class="sc">;</span>
  60 <span class="k">my</span><span class="s">(</span><span class="i">%OptionsInfo</span><span class="s">)</span><span class="sc">;</span>
  61 <span class="i">ProcessOptions</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  62 
  63 <span class="c"># Collect information about SD files...</span>
  64 <span class="k">print</span> <span class="q">&quot;Checking input SD file(s)...\n&quot;</span><span class="sc">;</span>
  65 <span class="k">my</span><span class="s">(</span><span class="i">%SDFilesInfo</span><span class="s">)</span><span class="sc">;</span>
  66 <span class="i">RetrieveSDFilesInfo</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  67 
  68 <span class="c"># Generate output files...</span>
  69 <span class="k">my</span><span class="s">(</span><span class="i">$FileIndex</span><span class="s">)</span><span class="sc">;</span>
  70 <span class="k">if</span> <span class="s">(</span><span class="i">@SDFilesList</span> &gt; <span class="n">1</span><span class="s">)</span> <span class="s">{</span>
  71   <span class="k">print</span> <span class="q">&quot;\nProcessing SD files...\n&quot;</span><span class="sc">;</span>
  72 <span class="s">}</span>
  73 <span class="k">for</span> <span class="i">$FileIndex</span> <span class="s">(</span><span class="n">0</span> .. <span class="i">$#SDFilesList</span><span class="s">)</span> <span class="s">{</span>
  74   <span class="k">if</span> <span class="s">(</span><span class="i">$SDFilesInfo</span>{<span class="w">FileOkay</span>}[<span class="i">$FileIndex</span>]<span class="s">)</span> <span class="s">{</span>
  75     <span class="k">print</span> <span class="q">&quot;\nProcessing file $SDFilesList[$FileIndex]...\n&quot;</span><span class="sc">;</span>
  76     <span class="i">ExtractFromSDFile</span><span class="s">(</span><span class="i">$FileIndex</span><span class="s">)</span><span class="sc">;</span>
  77   <span class="s">}</span>
  78 <span class="s">}</span>
  79 <span class="k">print</span> <span class="q">&quot;\n$ScriptName:Done...\n\n&quot;</span><span class="sc">;</span>
  80 
  81 <span class="i">$EndTime</span> = <span class="w">new</span> <span class="w">Benchmark</span><span class="sc">;</span>
  82 <span class="i">$TotalTime</span> = <span class="w">timediff</span> <span class="s">(</span><span class="i">$EndTime</span><span class="cm">,</span> <span class="i">$StartTime</span><span class="s">)</span><span class="sc">;</span>
  83 <span class="k">print</span> <span class="q">&quot;Total time: &quot;</span><span class="cm">,</span> <span class="i">timestr</span><span class="s">(</span><span class="i">$TotalTime</span><span class="s">)</span><span class="cm">,</span> <span class="q">&quot;\n&quot;</span><span class="sc">;</span>
  84 
  85 <span class="c">###############################################################################</span>
  86 
  87 <span class="c"># Extract data from a SD file...</span>
<a name="ExtractFromSDFile-"></a>  88 <span class="k">sub </span><span class="m">ExtractFromSDFile</span> <span class="s">{</span>
  89   <span class="k">my</span><span class="s">(</span><span class="i">$FileIndex</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
  90 
  91   <span class="i">OpenInputAndOutputFiles</span><span class="s">(</span><span class="i">$FileIndex</span><span class="s">)</span><span class="sc">;</span>
  92 
  93   <span class="j">MODE:</span> <span class="s">{</span>
  94     <span class="k">if</span> <span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">Mode</span>} =~ <span class="q">/^AllDataFields$/i</span><span class="s">)</span> <span class="s">{</span>
  95       <span class="i">ExtractAllDataFields</span><span class="s">(</span><span class="i">$FileIndex</span><span class="s">)</span><span class="sc">;</span>
  96       <span class="k">last</span> <span class="j">MODE</span><span class="sc">;</span>
  97     <span class="s">}</span>
  98     <span class="k">if</span> <span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">Mode</span>} =~ <span class="q">/^CommonDataFields$/i</span><span class="s">)</span> <span class="s">{</span>
  99       <span class="i">ExtractCommonDataFields</span><span class="s">(</span><span class="i">$FileIndex</span><span class="s">)</span><span class="sc">;</span>
 100       <span class="k">last</span> <span class="j">MODE</span><span class="sc">;</span>
 101     <span class="s">}</span>
 102     <span class="k">if</span> <span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">Mode</span>} =~ <span class="q">/^DataFields$/i</span><span class="s">)</span> <span class="s">{</span>
 103       <span class="i">ExtractDataFields</span><span class="s">(</span><span class="i">$FileIndex</span><span class="s">)</span><span class="sc">;</span>
 104       <span class="k">last</span> <span class="j">MODE</span><span class="sc">;</span>
 105     <span class="s">}</span>
 106     <span class="k">if</span> <span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">Mode</span>} =~ <span class="q">/^(DataFieldByList|DatafieldUniqueByList)$/i</span><span class="s">)</span> <span class="s">{</span>
 107       <span class="i">ExtractDataFieldByList</span><span class="s">(</span><span class="i">$FileIndex</span><span class="s">)</span><span class="sc">;</span>
 108       <span class="k">last</span> <span class="j">MODE</span><span class="sc">;</span>
 109     <span class="s">}</span>
 110     <span class="k">if</span> <span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">Mode</span>} =~ <span class="q">/^DataFieldNotByList$/i</span><span class="s">)</span> <span class="s">{</span>
 111       <span class="i">ExtractDataFieldNotByList</span><span class="s">(</span><span class="i">$FileIndex</span><span class="s">)</span><span class="sc">;</span>
 112       <span class="k">last</span> <span class="j">MODE</span><span class="sc">;</span>
 113     <span class="s">}</span>
 114     <span class="k">if</span> <span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">Mode</span>} =~ <span class="q">/^DataFieldsByValue$/i</span><span class="s">)</span> <span class="s">{</span>
 115       <span class="i">ExtractDataFieldsByValue</span><span class="s">(</span><span class="i">$FileIndex</span><span class="s">)</span><span class="sc">;</span>
 116       <span class="k">last</span> <span class="j">MODE</span><span class="sc">;</span>
 117     <span class="s">}</span>
 118     <span class="k">if</span> <span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">Mode</span>} =~ <span class="q">/^DataFieldsByRegex$/i</span><span class="s">)</span> <span class="s">{</span>
 119       <span class="i">ExtractDataFieldsByRegex</span><span class="s">(</span><span class="i">$FileIndex</span><span class="s">)</span><span class="sc">;</span>
 120       <span class="k">last</span> <span class="j">MODE</span><span class="sc">;</span>
 121     <span class="s">}</span>
 122     <span class="k">if</span> <span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">Mode</span>} =~ <span class="q">/^RandomCmpds$/i</span><span class="s">)</span> <span class="s">{</span>
 123       <span class="i">ExtractRandomCompounds</span><span class="s">(</span><span class="i">$FileIndex</span><span class="s">)</span><span class="sc">;</span>
 124       <span class="k">last</span> <span class="j">MODE</span><span class="sc">;</span>
 125     <span class="s">}</span>
 126     <span class="k">if</span> <span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">Mode</span>} =~ <span class="q">/^MolNames$/i</span><span class="s">)</span> <span class="s">{</span>
 127       <span class="i">ExtractMolNames</span><span class="s">(</span><span class="i">$FileIndex</span><span class="s">)</span><span class="sc">;</span>
 128       <span class="k">last</span> <span class="j">MODE</span><span class="sc">;</span>
 129     <span class="s">}</span>
 130     <span class="k">if</span> <span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">Mode</span>} =~ <span class="q">/^RecordNum$/i</span><span class="s">)</span> <span class="s">{</span>
 131       <span class="i">ExtractRecordNum</span><span class="s">(</span><span class="i">$FileIndex</span><span class="s">)</span><span class="sc">;</span>
 132       <span class="k">last</span> <span class="j">MODE</span><span class="sc">;</span>
 133     <span class="s">}</span>
 134     <span class="k">if</span> <span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">Mode</span>} =~ <span class="q">/^RecordNums$/i</span><span class="s">)</span> <span class="s">{</span>
 135       <span class="i">ExtractRecordNums</span><span class="s">(</span><span class="i">$FileIndex</span><span class="s">)</span><span class="sc">;</span>
 136       <span class="k">last</span> <span class="j">MODE</span><span class="sc">;</span>
 137     <span class="s">}</span>
 138     <span class="k">if</span> <span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">Mode</span>} =~ <span class="q">/^RecordRange$/i</span><span class="s">)</span> <span class="s">{</span>
 139       <span class="i">ExtractRecordRange</span><span class="s">(</span><span class="i">$FileIndex</span><span class="s">)</span><span class="sc">;</span>
 140       <span class="k">last</span> <span class="j">MODE</span><span class="sc">;</span>
 141     <span class="s">}</span>
 142     <span class="k">if</span> <span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">Mode</span>} =~ <span class="q">/^2DCmpdRecords$/i</span><span class="s">)</span> <span class="s">{</span>
 143       <span class="i">Extract2DCmpdRecords</span><span class="s">(</span><span class="i">$FileIndex</span><span class="s">)</span><span class="sc">;</span>
 144       <span class="k">last</span> <span class="j">MODE</span><span class="sc">;</span>
 145     <span class="s">}</span>
 146     <span class="k">if</span> <span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">Mode</span>} =~ <span class="q">/^3DCmpdRecords$/i</span><span class="s">)</span> <span class="s">{</span>
 147       <span class="i">Extract3DCmpdRecords</span><span class="s">(</span><span class="i">$FileIndex</span><span class="s">)</span><span class="sc">;</span>
 148       <span class="k">last</span> <span class="j">MODE</span><span class="sc">;</span>
 149     <span class="s">}</span>
 150     <span class="k">die</span> <span class="q">&quot;Error: The value specified, $Options{mode}, for option \&quot;-m --mode\&quot; is not valid. Allowed values: alldatafields, commondatafields, datafields, datafieldsbyvalue, datafieldbylist, datafielduniquebylist, datafieldnotbylist, molnames, randomcmpds, recordnum, recordnums, recordrange, 2dcmpdrecords, 3dcmpdrecords\n&quot;</span><span class="sc">;</span>
 151   <span class="s">}</span>
 152 
 153   <span class="i">CloseInputAndOutputFiles</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 154 <span class="s">}</span>
 155 
 156 <span class="c"># Extract all data fields...</span>
<a name="ExtractAllDataFields-"></a> 157 <span class="k">sub </span><span class="m">ExtractAllDataFields</span> <span class="s">{</span>
 158   <span class="k">my</span><span class="s">(</span><span class="i">$FileIndex</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 159   <span class="k">my</span><span class="s">(</span><span class="i">@CmpdLines</span><span class="s">)</span><span class="sc">;</span>
 160 
 161   <span class="i">@</span>{<span class="i">$SDFilesInfo</span>{<span class="w">DataLabels</span>}} = <span class="i">@</span>{<span class="i">$SDFilesInfo</span>{<span class="w">AllDataFieldLabels</span>}[<span class="i">$FileIndex</span>]}<span class="sc">;</span>
 162   <span class="i">WriteTextFileColLabels</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 163 
 164   <span class="k">while</span> <span class="s">(</span><span class="i">$SDFilesInfo</span>{<span class="w">CmpdString</span>} = <span class="i">ReadCmpdString</span><span class="s">(</span><span class="i">$SDFilesInfo</span>{<span class="w">InputSDFileRef</span>}<span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 165     <span class="i">@CmpdLines</span> = <span class="k">split</span> <span class="q">&quot;\n&quot;</span><span class="cm">,</span> <span class="i">$SDFilesInfo</span>{<span class="w">CmpdString</span>}<span class="sc">;</span>
 166     <span class="i">%</span>{<span class="i">$SDFilesInfo</span>{<span class="w">DataFieldValues</span>}} = <span class="i">GetCmpdDataHeaderLabelsAndValues</span><span class="s">(</span>\<span class="i">@CmpdLines</span><span class="s">)</span><span class="sc">;</span>
 167 
 168     <span class="i">SetupDataValues</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 169     <span class="i">WriteTextFileCmpdData</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 170     <span class="i">WriteSDFileCmpdData</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 171   <span class="s">}</span>
 172 <span class="s">}</span>
 173 
 174 <span class="c"># Extract common data fields...</span>
<a name="ExtractCommonDataFields-"></a> 175 <span class="k">sub </span><span class="m">ExtractCommonDataFields</span> <span class="s">{</span>
 176   <span class="k">my</span><span class="s">(</span><span class="i">$FileIndex</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 177   <span class="k">my</span><span class="s">(</span><span class="i">@CmpdLines</span><span class="s">)</span><span class="sc">;</span>
 178 
 179   <span class="i">@</span>{<span class="i">$SDFilesInfo</span>{<span class="w">DataLabels</span>}} = <span class="i">@</span>{<span class="i">$SDFilesInfo</span>{<span class="w">CommonDataFieldLabels</span>}[<span class="i">$FileIndex</span>]}<span class="sc">;</span>
 180   <span class="i">WriteTextFileColLabels</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 181 
 182   <span class="k">while</span> <span class="s">(</span><span class="i">$SDFilesInfo</span>{<span class="w">CmpdString</span>} = <span class="i">ReadCmpdString</span><span class="s">(</span><span class="i">$SDFilesInfo</span>{<span class="w">InputSDFileRef</span>}<span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 183     <span class="i">@CmpdLines</span> = <span class="k">split</span> <span class="q">&quot;\n&quot;</span><span class="cm">,</span> <span class="i">$SDFilesInfo</span>{<span class="w">CmpdString</span>}<span class="sc">;</span>
 184     <span class="i">%</span>{<span class="i">$SDFilesInfo</span>{<span class="w">DataFieldValues</span>}} = <span class="i">GetCmpdDataHeaderLabelsAndValues</span><span class="s">(</span>\<span class="i">@CmpdLines</span><span class="s">)</span><span class="sc">;</span>
 185 
 186     <span class="i">SetupDataValues</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 187     <span class="i">WriteTextFileCmpdData</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 188     <span class="i">WriteSDFileCmpdData</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 189   <span class="s">}</span>
 190 <span class="s">}</span>
 191 
 192 <span class="c"># Extract specified data fields...</span>
<a name="ExtractDataFields-"></a> 193 <span class="k">sub </span><span class="m">ExtractDataFields</span> <span class="s">{</span>
 194   <span class="k">my</span><span class="s">(</span><span class="i">$FileIndex</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 195   <span class="k">my</span><span class="s">(</span><span class="i">@CmpdLines</span><span class="s">)</span><span class="sc">;</span>
 196 
 197   <span class="i">@</span>{<span class="i">$SDFilesInfo</span>{<span class="w">DataLabels</span>}} = <span class="i">@</span>{<span class="i">$OptionsInfo</span>{<span class="w">SpecifiedDataFieldLabels</span>}}<span class="sc">;</span>
 198   <span class="i">WriteTextFileColLabels</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 199 
 200   <span class="k">while</span> <span class="s">(</span><span class="i">$SDFilesInfo</span>{<span class="w">CmpdString</span>} = <span class="i">ReadCmpdString</span><span class="s">(</span><span class="i">$SDFilesInfo</span>{<span class="w">InputSDFileRef</span>}<span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 201     <span class="i">@CmpdLines</span> = <span class="k">split</span> <span class="q">&quot;\n&quot;</span><span class="cm">,</span> <span class="i">$SDFilesInfo</span>{<span class="w">CmpdString</span>}<span class="sc">;</span>
 202     <span class="i">%</span>{<span class="i">$SDFilesInfo</span>{<span class="w">DataFieldValues</span>}} = <span class="i">GetCmpdDataHeaderLabelsAndValues</span><span class="s">(</span>\<span class="i">@CmpdLines</span><span class="s">)</span><span class="sc">;</span>
 203 
 204     <span class="i">SetupDataValues</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 205     <span class="i">WriteTextFileCmpdData</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 206     <span class="i">WriteSDFileCmpdData</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 207   <span class="s">}</span>
 208 <span class="s">}</span>
 209 
 210 <span class="c"># Extract data fields using a list...</span>
<a name="ExtractDataFieldByList-"></a> 211 <span class="k">sub </span><span class="m">ExtractDataFieldByList</span> <span class="s">{</span>
 212   <span class="k">my</span><span class="s">(</span><span class="i">$FileIndex</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 213   <span class="k">my</span><span class="s">(</span><span class="i">$CmpdNum</span><span class="cm">,</span> <span class="i">$Value</span><span class="cm">,</span> <span class="i">$SpecifiedDataFieldValuesFoundCount</span><span class="cm">,</span> <span class="i">$CurrentValue</span><span class="cm">,</span> <span class="i">$SpecifiedDataFieldLabel</span><span class="cm">,</span> <span class="i">@CmpdLines</span><span class="s">)</span><span class="sc">;</span>
 214 
 215   <span class="i">@</span>{<span class="i">$SDFilesInfo</span>{<span class="w">DataLabels</span>}} = <span class="i">@</span>{<span class="i">$SDFilesInfo</span>{<span class="w">AllDataFieldLabels</span>}[<span class="i">$FileIndex</span>]}<span class="sc">;</span>
 216   <span class="i">WriteTextFileColLabels</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 217 
 218   <span class="k">for</span> <span class="i">$Value</span> <span class="s">(</span><span class="k">keys</span> <span class="i">%</span>{<span class="i">$OptionsInfo</span>{<span class="w">SpecifiedDataFieldValues</span>}}<span class="s">)</span> <span class="s">{</span>
 219     <span class="i">$OptionsInfo</span>{<span class="w">SpecifiedDataFieldValues</span>}{<span class="i">$Value</span>} = <span class="q">&quot;NotFound&quot;</span><span class="sc">;</span>
 220   <span class="s">}</span>
 221   <span class="i">$SpecifiedDataFieldValuesFoundCount</span> = <span class="n">0</span><span class="sc">;</span>
 222   <span class="i">$SpecifiedDataFieldLabel</span> = <span class="i">$OptionsInfo</span>{<span class="w">SpecifiedDataFieldLabel</span>}<span class="sc">;</span>
 223 
 224   <span class="j">CMPDSTRING:</span> <span class="k">while</span> <span class="s">(</span><span class="i">$SDFilesInfo</span>{<span class="w">CmpdString</span>} = <span class="i">ReadCmpdString</span><span class="s">(</span><span class="i">$SDFilesInfo</span>{<span class="w">InputSDFileRef</span>}<span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 225     <span class="i">$CmpdNum</span>++<span class="sc">;</span>
 226 
 227     <span class="i">@CmpdLines</span> = <span class="k">split</span> <span class="q">&quot;\n&quot;</span><span class="cm">,</span> <span class="i">$SDFilesInfo</span>{<span class="w">CmpdString</span>}<span class="sc">;</span>
 228     <span class="i">%</span>{<span class="i">$SDFilesInfo</span>{<span class="w">DataFieldValues</span>}} = <span class="i">GetCmpdDataHeaderLabelsAndValues</span><span class="s">(</span>\<span class="i">@CmpdLines</span><span class="s">)</span><span class="sc">;</span>
 229 
 230     <span class="k">if</span> <span class="s">(</span>!<span class="k">exists</span> <span class="i">$SDFilesInfo</span>{<span class="w">DataFieldValues</span>}{<span class="i">$SpecifiedDataFieldLabel</span>}<span class="s">)</span> <span class="s">{</span>
 231       <span class="k">next</span> <span class="j">CMPDSTRING</span><span class="sc">;</span>
 232     <span class="s">}</span>
 233 
 234     <span class="i">SetupDataValues</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 235 
 236     <span class="i">$SpecifiedDataFieldLabel</span> = <span class="i">$OptionsInfo</span>{<span class="w">SpecifiedDataFieldLabel</span>}<span class="sc">;</span>
 237     <span class="i">$CurrentValue</span> = <span class="i">$SDFilesInfo</span>{<span class="w">DataFieldValues</span>}{<span class="i">$SpecifiedDataFieldLabel</span>}<span class="sc">;</span>
 238 
 239     <span class="k">if</span> <span class="s">(</span><span class="k">exists</span> <span class="i">$OptionsInfo</span>{<span class="w">SpecifiedDataFieldValues</span>}{<span class="i">$CurrentValue</span>}<span class="s">)</span> <span class="s">{</span>
 240       <span class="k">if</span> <span class="s">(</span><span class="i">$SpecifiedDataFieldValuesFoundCount</span> &lt; <span class="i">$OptionsInfo</span>{<span class="w">SpecifiedDataFieldValuesCount</span>}<span class="s">)</span> <span class="s">{</span>
 241         <span class="k">if</span> <span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">SpecifiedDataFieldValues</span>}{<span class="i">$CurrentValue</span>} <span class="k">eq</span> <span class="q">&quot;NotFound&quot;</span><span class="s">)</span> <span class="s">{</span>
 242           <span class="i">$SpecifiedDataFieldValuesFoundCount</span>++<span class="sc">;</span>
 243           <span class="i">$OptionsInfo</span>{<span class="w">SpecifiedDataFieldValues</span>}{<span class="i">$CurrentValue</span>} = <span class="q">&quot;Found&quot;</span><span class="sc">;</span>
 244           <span class="k">if</span> <span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">Mode</span>} =~ <span class="q">/^DataFieldUniqueByList$/i</span><span class="s">)</span> <span class="s">{</span>
 245             <span class="i">WriteSDFileCmpdString</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 246             <span class="i">WriteTextFileCmpdData</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 247           <span class="s">}</span>
 248         <span class="s">}</span>
 249         <span class="k">if</span> <span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">Mode</span>} =~ <span class="q">/^DataFieldByList$/i</span><span class="s">)</span> <span class="s">{</span>
 250           <span class="i">WriteSDFileCmpdString</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 251           <span class="i">WriteTextFileCmpdData</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 252         <span class="s">}</span>
 253       <span class="s">}</span>
 254       <span class="k">if</span> <span class="s">(</span><span class="i">$SpecifiedDataFieldValuesFoundCount</span> &gt;= <span class="i">$OptionsInfo</span>{<span class="w">SpecifiedDataFieldValuesCount</span>}<span class="s">)</span> <span class="s">{</span>
 255         <span class="k">last</span> <span class="j">CMPDSTRING</span><span class="sc">;</span>
 256       <span class="s">}</span>
 257     <span class="s">}</span>
 258   <span class="s">}</span>
 259 <span class="s">}</span>
 260 
 261 <span class="c"># Extract data field whose values are not on the specified list...</span>
<a name="ExtractDataFieldNotByList-"></a> 262 <span class="k">sub </span><span class="m">ExtractDataFieldNotByList</span> <span class="s">{</span>
 263   <span class="k">my</span><span class="s">(</span><span class="i">$FileIndex</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 264   <span class="k">my</span><span class="s">(</span><span class="i">$CurrentValue</span><span class="cm">,</span> <span class="i">$SpecifiedDataFieldLabel</span><span class="cm">,</span> <span class="i">@CmpdLines</span><span class="s">)</span><span class="sc">;</span>
 265 
 266   <span class="i">@</span>{<span class="i">$SDFilesInfo</span>{<span class="w">DataLabels</span>}} = <span class="i">@</span>{<span class="i">$SDFilesInfo</span>{<span class="w">AllDataFieldLabels</span>}[<span class="i">$FileIndex</span>]}<span class="sc">;</span>
 267   <span class="i">WriteTextFileColLabels</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 268 
 269   <span class="i">$SpecifiedDataFieldLabel</span> = <span class="i">$OptionsInfo</span>{<span class="w">SpecifiedDataFieldLabel</span>}<span class="sc">;</span>
 270 
 271   <span class="j">CMPDSTRING:</span> <span class="k">while</span> <span class="s">(</span><span class="i">$SDFilesInfo</span>{<span class="w">CmpdString</span>} = <span class="i">ReadCmpdString</span><span class="s">(</span><span class="i">$SDFilesInfo</span>{<span class="w">InputSDFileRef</span>}<span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 272     <span class="i">@CmpdLines</span> = <span class="k">split</span> <span class="q">&quot;\n&quot;</span><span class="cm">,</span> <span class="i">$SDFilesInfo</span>{<span class="w">CmpdString</span>}<span class="sc">;</span>
 273     <span class="i">%</span>{<span class="i">$SDFilesInfo</span>{<span class="w">DataFieldValues</span>}} = <span class="i">GetCmpdDataHeaderLabelsAndValues</span><span class="s">(</span>\<span class="i">@CmpdLines</span><span class="s">)</span><span class="sc">;</span>
 274 
 275     <span class="k">if</span> <span class="s">(</span>!<span class="k">exists</span> <span class="i">$SDFilesInfo</span>{<span class="w">DataFieldValues</span>}{<span class="i">$SpecifiedDataFieldLabel</span>}<span class="s">)</span> <span class="s">{</span>
 276       <span class="k">next</span> <span class="j">CMPDSTRING</span><span class="sc">;</span>
 277     <span class="s">}</span>
 278 
 279     <span class="i">SetupDataValues</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 280 
 281     <span class="i">$CurrentValue</span> = <span class="i">$SDFilesInfo</span>{<span class="w">DataFieldValues</span>}{<span class="i">$SpecifiedDataFieldLabel</span>}<span class="sc">;</span>
 282 
 283     <span class="c"># Make sure the current value is not empty and is not only specified list of values...</span>
 284     <span class="k">if</span> <span class="s">(</span><span class="i">IsEmpty</span><span class="s">(</span><span class="i">$CurrentValue</span><span class="s">)</span> || <span class="k">exists</span> <span class="i">$OptionsInfo</span>{<span class="w">SpecifiedDataFieldValues</span>}{<span class="i">$CurrentValue</span>}<span class="s">)</span> <span class="s">{</span>
 285       <span class="k">next</span> <span class="j">CMPDSTRING</span><span class="sc">;</span>
 286     <span class="s">}</span>
 287 
 288     <span class="i">WriteSDFileCmpdString</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 289     <span class="i">WriteTextFileCmpdData</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 290   <span class="s">}</span>
 291 <span class="s">}</span>
 292 
 293 <span class="c"># Extract data fields by value...</span>
<a name="ExtractDataFieldsByValue-"></a> 294 <span class="k">sub </span><span class="m">ExtractDataFieldsByValue</span> <span class="s">{</span>
 295   <span class="k">my</span><span class="s">(</span><span class="i">$FileIndex</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 296   <span class="k">my</span><span class="s">(</span><span class="i">$Label</span><span class="cm">,</span> <span class="i">$CurrentValue</span><span class="cm">,</span> <span class="i">$SpecifiedCriterion</span><span class="cm">,</span> <span class="i">$SpecifiedValue</span><span class="cm">,</span> <span class="i">$ViolationCount</span><span class="cm">,</span> <span class="i">$Nothing</span><span class="cm">,</span> <span class="i">@CmpdLines</span><span class="s">)</span><span class="sc">;</span>
 297 
 298   <span class="i">@</span>{<span class="i">$SDFilesInfo</span>{<span class="w">DataLabels</span>}} = <span class="i">@</span>{<span class="i">$SDFilesInfo</span>{<span class="w">AllDataFieldLabels</span>}[<span class="i">$FileIndex</span>]}<span class="sc">;</span>
 299   <span class="i">WriteTextFileColLabels</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 300 
 301   <span class="j">CMPDSTRING:</span> <span class="k">while</span> <span class="s">(</span><span class="i">$SDFilesInfo</span>{<span class="w">CmpdString</span>} = <span class="i">ReadCmpdString</span><span class="s">(</span><span class="i">$SDFilesInfo</span>{<span class="w">InputSDFileRef</span>}<span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 302     <span class="i">@CmpdLines</span> = <span class="k">split</span> <span class="q">&quot;\n&quot;</span><span class="cm">,</span> <span class="i">$SDFilesInfo</span>{<span class="w">CmpdString</span>}<span class="sc">;</span>
 303     <span class="i">%</span>{<span class="i">$SDFilesInfo</span>{<span class="w">DataFieldValues</span>}} = <span class="i">GetCmpdDataHeaderLabelsAndValues</span><span class="s">(</span>\<span class="i">@CmpdLines</span><span class="s">)</span><span class="sc">;</span>
 304 
 305     <span class="i">SetupDataValues</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 306     <span class="i">$ViolationCount</span> = <span class="n">0</span><span class="sc">;</span>
 307 
 308     <span class="k">for</span> <span class="i">$Label</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$OptionsInfo</span>{<span class="w">SpecifiedDataFieldLabels</span>}}<span class="s">)</span> <span class="s">{</span>
 309       <span class="k">if</span> <span class="s">(</span><span class="k">exists</span> <span class="i">$SDFilesInfo</span>{<span class="w">DataFieldValues</span>}{<span class="i">$Label</span>}<span class="s">)</span> <span class="s">{</span>
 310         <span class="i">$CurrentValue</span> = <span class="i">$SDFilesInfo</span>{<span class="w">DataFieldValues</span>}{<span class="i">$Label</span>}<span class="sc">;</span>
 311         <span class="i">$SpecifiedCriterion</span> = <span class="i">$OptionsInfo</span>{<span class="w">SpecifiedDataFieldCriteriaMap</span>}{<span class="i">$Label</span>}<span class="sc">;</span>
 312         <span class="i">$SpecifiedValue</span> = <span class="i">$OptionsInfo</span>{<span class="w">SpecifiedDataFieldValuesMap</span>}{<span class="i">$Label</span>}<span class="sc">;</span>
 313 
 314         <span class="k">if</span> <span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">NumericalComparison</span>}<span class="s">)</span> <span class="s">{</span>
 315           <span class="j">CRITERION:</span> <span class="s">{</span>
 316               <span class="k">if</span> <span class="s">(</span><span class="i">$SpecifiedCriterion</span> =~ <span class="q">/^eq$/i</span><span class="s">)</span> <span class="s">{</span> <span class="k">if</span> <span class="s">(</span><span class="i">$CurrentValue</span> != <span class="i">$SpecifiedValue</span><span class="s">)</span> <span class="s">{</span> <span class="i">$ViolationCount</span>++<span class="sc">;</span> <span class="k">last</span> <span class="j">CRITERION</span><span class="sc">;</span> <span class="s">}</span> <span class="s">}</span>
 317               <span class="k">if</span> <span class="s">(</span><span class="i">$SpecifiedCriterion</span> =~ <span class="q">/^le$/i</span><span class="s">)</span> <span class="s">{</span> <span class="k">if</span> <span class="s">(</span><span class="i">$CurrentValue</span> &gt; <span class="i">$SpecifiedValue</span><span class="s">)</span> <span class="s">{</span> <span class="i">$ViolationCount</span>++<span class="sc">;</span> <span class="k">last</span> <span class="j">CRITERION</span><span class="sc">;</span> <span class="s">}</span> <span class="s">}</span>
 318               <span class="k">if</span> <span class="s">(</span><span class="i">$SpecifiedCriterion</span> =~ <span class="q">/^ge$/i</span><span class="s">)</span> <span class="s">{</span> <span class="k">if</span> <span class="s">(</span><span class="i">$CurrentValue</span> &lt; <span class="i">$SpecifiedValue</span><span class="s">)</span> <span class="s">{</span> <span class="i">$ViolationCount</span>++<span class="sc">;</span> <span class="k">last</span> <span class="j">CRITERION</span><span class="sc">;</span> <span class="s">}</span> <span class="s">}</span>
 319               <span class="i">$Nothing</span> = <span class="n">1</span><span class="sc">;</span>
 320             <span class="s">}</span>
 321         <span class="s">}</span>
 322         <span class="k">else</span> <span class="s">{</span>
 323           <span class="j">CRITERION:</span> <span class="s">{</span>
 324               <span class="k">if</span> <span class="s">(</span><span class="i">$SpecifiedCriterion</span> =~ <span class="q">/^eq$/i</span><span class="s">)</span> <span class="s">{</span> <span class="k">if</span> <span class="s">(</span><span class="i">$CurrentValue</span> <span class="k">ne</span> <span class="i">$SpecifiedValue</span><span class="s">)</span> <span class="s">{</span> <span class="i">$ViolationCount</span>++<span class="sc">;</span> <span class="k">last</span> <span class="j">CRITERION</span><span class="sc">;</span> <span class="s">}</span> <span class="s">}</span>
 325               <span class="k">if</span> <span class="s">(</span><span class="i">$SpecifiedCriterion</span> =~ <span class="q">/^le$/i</span><span class="s">)</span> <span class="s">{</span> <span class="k">if</span> <span class="s">(</span><span class="i">$CurrentValue</span> <span class="k">gt</span> <span class="i">$SpecifiedValue</span><span class="s">)</span> <span class="s">{</span> <span class="i">$ViolationCount</span>++<span class="sc">;</span> <span class="k">last</span> <span class="j">CRITERION</span><span class="sc">;</span> <span class="s">}</span> <span class="s">}</span>
 326               <span class="k">if</span> <span class="s">(</span><span class="i">$SpecifiedCriterion</span> =~ <span class="q">/^ge$/i</span><span class="s">)</span> <span class="s">{</span> <span class="k">if</span> <span class="s">(</span><span class="i">$CurrentValue</span> <span class="k">lt</span> <span class="i">$SpecifiedValue</span><span class="s">)</span> <span class="s">{</span> <span class="i">$ViolationCount</span>++<span class="sc">;</span> <span class="k">last</span> <span class="j">CRITERION</span><span class="sc">;</span> <span class="s">}</span> <span class="s">}</span>
 327               <span class="i">$Nothing</span> = <span class="n">1</span><span class="sc">;</span>
 328             <span class="s">}</span>
 329         <span class="s">}</span>
 330       <span class="s">}</span>
 331     <span class="s">}</span>
 332     <span class="k">if</span> <span class="s">(</span><span class="i">$ViolationCount</span> &lt;= <span class="i">$OptionsInfo</span>{<span class="w">Violations</span>}<span class="s">)</span> <span class="s">{</span>
 333       <span class="i">WriteSDFileCmpdString</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 334       <span class="i">WriteTextFileCmpdData</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 335     <span class="s">}</span>
 336   <span class="s">}</span>
 337 <span class="s">}</span>
 338 
 339 <span class="c"># Extract data fields by value using regular expression match...</span>
<a name="ExtractDataFieldsByRegex-"></a> 340 <span class="k">sub </span><span class="m">ExtractDataFieldsByRegex</span> <span class="s">{</span>
 341   <span class="k">my</span><span class="s">(</span><span class="i">$FileIndex</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 342   <span class="k">my</span><span class="s">(</span><span class="i">$Label</span><span class="cm">,</span> <span class="i">$CurrentValue</span><span class="cm">,</span> <span class="i">$SpecifiedRegexCriterion</span><span class="cm">,</span> <span class="i">$SpecifiedRegex</span><span class="cm">,</span> <span class="i">$ViolationCount</span><span class="cm">,</span> <span class="i">$Nothing</span><span class="cm">,</span> <span class="i">@CmpdLines</span><span class="s">)</span><span class="sc">;</span>
 343 
 344   <span class="i">@</span>{<span class="i">$SDFilesInfo</span>{<span class="w">DataLabels</span>}} = <span class="i">@</span>{<span class="i">$SDFilesInfo</span>{<span class="w">AllDataFieldLabels</span>}[<span class="i">$FileIndex</span>]}<span class="sc">;</span>
 345   <span class="i">WriteTextFileColLabels</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 346 
 347   <span class="j">CMPDSTRING:</span> <span class="k">while</span> <span class="s">(</span><span class="i">$SDFilesInfo</span>{<span class="w">CmpdString</span>} = <span class="i">ReadCmpdString</span><span class="s">(</span><span class="i">$SDFilesInfo</span>{<span class="w">InputSDFileRef</span>}<span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 348     <span class="i">@CmpdLines</span> = <span class="k">split</span> <span class="q">&quot;\n&quot;</span><span class="cm">,</span> <span class="i">$SDFilesInfo</span>{<span class="w">CmpdString</span>}<span class="sc">;</span>
 349     <span class="i">%</span>{<span class="i">$SDFilesInfo</span>{<span class="w">DataFieldValues</span>}} = <span class="i">GetCmpdDataHeaderLabelsAndValues</span><span class="s">(</span>\<span class="i">@CmpdLines</span><span class="s">)</span><span class="sc">;</span>
 350 
 351     <span class="i">SetupDataValues</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 352     <span class="i">$ViolationCount</span> = <span class="n">0</span><span class="sc">;</span>
 353 
 354     <span class="k">for</span> <span class="i">$Label</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$OptionsInfo</span>{<span class="w">SpecifiedDataFieldLabels</span>}}<span class="s">)</span> <span class="s">{</span>
 355       <span class="k">if</span> <span class="s">(</span><span class="k">exists</span> <span class="i">$SDFilesInfo</span>{<span class="w">DataFieldValues</span>}{<span class="i">$Label</span>}<span class="s">)</span> <span class="s">{</span>
 356         <span class="i">$CurrentValue</span> = <span class="i">$SDFilesInfo</span>{<span class="w">DataFieldValues</span>}{<span class="i">$Label</span>}<span class="sc">;</span>
 357            <span class="i">$SpecifiedRegexCriterion</span> = <span class="i">$OptionsInfo</span>{<span class="w">SpecifiedDataFieldRegexCriteriaMap</span>}{<span class="i">$Label</span>}<span class="sc">;</span>
 358            <span class="i">$SpecifiedRegex</span> = <span class="i">$OptionsInfo</span>{<span class="w">SpecifiedDataFieldRegexMap</span>}{<span class="i">$Label</span>}<span class="sc">;</span>
 359 
 360         <span class="k">if</span> <span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">RegexIgnoreCase</span>}<span class="s">)</span> <span class="s">{</span>
 361           <span class="j">CRITERION:</span> <span class="s">{</span>
 362                  <span class="k">if</span> <span class="s">(</span><span class="i">$SpecifiedRegexCriterion</span> =~ <span class="q">/^eq$/i</span><span class="s">)</span> <span class="s">{</span> <span class="k">if</span> <span class="s">(</span><span class="i">$CurrentValue</span> !~ <span class="q">/$SpecifiedRegex/i</span><span class="s">)</span> <span class="s">{</span> <span class="i">$ViolationCount</span>++<span class="sc">;</span> <span class="k">last</span> <span class="j">CRITERION</span><span class="sc">;</span> <span class="s">}</span> <span class="s">}</span>
 363                  <span class="k">if</span> <span class="s">(</span><span class="i">$SpecifiedRegexCriterion</span> =~ <span class="q">/^ne$/i</span><span class="s">)</span> <span class="s">{</span> <span class="k">if</span> <span class="s">(</span><span class="i">$CurrentValue</span> =~ <span class="q">/$SpecifiedRegex/i</span><span class="s">)</span> <span class="s">{</span>  <span class="i">$ViolationCount</span>++<span class="sc">;</span> <span class="k">last</span> <span class="j">CRITERION</span><span class="sc">;</span> <span class="s">}</span> <span class="s">}</span>
 364               <span class="i">$Nothing</span> = <span class="n">1</span><span class="sc">;</span>
 365             <span class="s">}</span>
 366         <span class="s">}</span>
 367         <span class="k">else</span> <span class="s">{</span>
 368           <span class="j">CRITERION:</span> <span class="s">{</span>
 369                  <span class="k">if</span> <span class="s">(</span><span class="i">$SpecifiedRegexCriterion</span> =~ <span class="q">/^eq$/i</span><span class="s">)</span> <span class="s">{</span> <span class="k">if</span> <span class="s">(</span><span class="i">$CurrentValue</span> !~ <span class="q">/$SpecifiedRegex/</span><span class="s">)</span> <span class="s">{</span> <span class="i">$ViolationCount</span>++<span class="sc">;</span> <span class="k">last</span> <span class="j">CRITERION</span><span class="sc">;</span> <span class="s">}</span> <span class="s">}</span>
 370                  <span class="k">if</span> <span class="s">(</span><span class="i">$SpecifiedRegexCriterion</span> =~ <span class="q">/^ne$/i</span><span class="s">)</span> <span class="s">{</span> <span class="k">if</span> <span class="s">(</span><span class="i">$CurrentValue</span> =~ <span class="q">/$SpecifiedRegex/</span><span class="s">)</span> <span class="s">{</span>  <span class="i">$ViolationCount</span>++<span class="sc">;</span> <span class="k">last</span> <span class="j">CRITERION</span><span class="sc">;</span> <span class="s">}</span> <span class="s">}</span>
 371               <span class="i">$Nothing</span> = <span class="n">1</span><span class="sc">;</span>
 372             <span class="s">}</span>
 373         <span class="s">}</span>
 374       <span class="s">}</span>
 375     <span class="s">}</span>
 376     <span class="k">if</span> <span class="s">(</span><span class="i">$ViolationCount</span> &lt;= <span class="i">$OptionsInfo</span>{<span class="w">Violations</span>}<span class="s">)</span> <span class="s">{</span>
 377       <span class="i">WriteSDFileCmpdString</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 378       <span class="i">WriteTextFileCmpdData</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 379     <span class="s">}</span>
 380   <span class="s">}</span>
 381 <span class="s">}</span>
 382 
 383 <span class="c"># Extract random compounds...</span>
<a name="ExtractRandomCompounds-"></a> 384 <span class="k">sub </span><span class="m">ExtractRandomCompounds</span> <span class="s">{</span>
 385   <span class="k">my</span><span class="s">(</span><span class="i">$FileIndex</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 386   <span class="k">my</span><span class="s">(</span><span class="i">$CmpdNum</span><span class="cm">,</span> <span class="i">$CmpdCount</span><span class="cm">,</span> <span class="i">$RandomCycleCount</span><span class="cm">,</span> <span class="i">$RandomIndex</span><span class="cm">,</span> <span class="i">@CmpdLines</span><span class="cm">,</span> <span class="i">%RandomCmpdIndexMap</span><span class="s">)</span><span class="sc">;</span>
 387 
 388   <span class="i">@</span>{<span class="i">$SDFilesInfo</span>{<span class="w">DataLabels</span>}} = <span class="i">@</span>{<span class="i">$SDFilesInfo</span>{<span class="w">AllDataFieldLabels</span>}[<span class="i">$FileIndex</span>]}<span class="sc">;</span>
 389   <span class="i">WriteTextFileColLabels</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 390 
 391   <span class="i">$CmpdCount</span> = <span class="i">$SDFilesInfo</span>{<span class="w">CmpdCount</span>}[<span class="i">$FileIndex</span>]<span class="sc">;</span>
 392   <span class="k">srand</span><span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">Seed</span>}<span class="s">)</span><span class="sc">;</span>
 393   <span class="i">$RandomCycleCount</span> = <span class="n">0</span><span class="sc">;</span>
 394 
 395   <span class="i">%RandomCmpdIndexMap</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 396   <span class="k">while</span> <span class="s">(</span><span class="i">$RandomCycleCount</span> &lt;= <span class="i">$CmpdCount</span> &amp;&amp; <span class="i">$RandomCycleCount</span> &lt;= <span class="i">$OptionsInfo</span>{<span class="w">NumOfCmpds</span>}<span class="s">)</span> <span class="s">{</span>
 397     <span class="i">$RandomCycleCount</span>++<span class="sc">;</span>
 398     <span class="i">$RandomIndex</span> = <span class="k">int</span> <span class="s">(</span><span class="k">rand</span> <span class="i">$CmpdCount</span><span class="s">)</span> + <span class="n">1</span><span class="sc">;</span>
 399     <span class="i">$RandomCmpdIndexMap</span>{<span class="i">$RandomIndex</span>} = <span class="i">$RandomIndex</span><span class="sc">;</span>
 400   <span class="s">}</span>
 401 
 402   <span class="i">$CmpdNum</span> = <span class="n">0</span><span class="sc">;</span>
 403   <span class="j">CMPDSTRING:</span> <span class="k">while</span> <span class="s">(</span><span class="i">$SDFilesInfo</span>{<span class="w">CmpdString</span>} = <span class="i">ReadCmpdString</span><span class="s">(</span><span class="i">$SDFilesInfo</span>{<span class="w">InputSDFileRef</span>}<span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 404     <span class="i">$CmpdNum</span>++<span class="sc">;</span>
 405     <span class="k">if</span> <span class="s">(</span>!<span class="k">exists</span> <span class="i">$RandomCmpdIndexMap</span>{<span class="i">$CmpdNum</span>}<span class="s">)</span> <span class="s">{</span>
 406       <span class="k">next</span> <span class="j">CMPDSTRING</span><span class="sc">;</span>
 407     <span class="s">}</span>
 408 
 409     <span class="i">@CmpdLines</span> = <span class="k">split</span> <span class="q">&quot;\n&quot;</span><span class="cm">,</span> <span class="i">$SDFilesInfo</span>{<span class="w">CmpdString</span>}<span class="sc">;</span>
 410 
 411     <span class="i">WriteSDFileCmpdString</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 412 
 413     <span class="k">if</span> <span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">OutputTextFile</span>}<span class="s">)</span> <span class="s">{</span>
 414       <span class="i">%</span>{<span class="i">$SDFilesInfo</span>{<span class="w">DataFieldValues</span>}} = <span class="i">GetCmpdDataHeaderLabelsAndValues</span><span class="s">(</span>\<span class="i">@CmpdLines</span><span class="s">)</span><span class="sc">;</span>
 415       <span class="i">SetupDataValues</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 416       <span class="i">WriteTextFileCmpdData</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 417     <span class="s">}</span>
 418   <span class="s">}</span>
 419 <span class="s">}</span>
 420 
 421 <span class="c"># Extract mol names...</span>
<a name="ExtractMolNames-"></a> 422 <span class="k">sub </span><span class="m">ExtractMolNames</span> <span class="s">{</span>
 423   <span class="k">my</span><span class="s">(</span><span class="i">$FileIndex</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 424   <span class="k">my</span><span class="s">(</span><span class="i">$MolName</span><span class="cm">,</span> <span class="i">$NewTextFileRef</span><span class="cm">,</span> <span class="i">@CmpdLines</span><span class="s">)</span><span class="sc">;</span>
 425 
 426   <span class="k">push</span> <span class="i">@</span>{<span class="i">$SDFilesInfo</span>{<span class="w">DataLabels</span>}}<span class="cm">,</span> <span class="q">&quot;MolName&quot;</span><span class="sc">;</span>
 427   <span class="i">WriteTextFileColLabels</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 428 
 429   <span class="i">$NewTextFileRef</span> = <span class="i">$SDFilesInfo</span>{<span class="w">NewTextFileRef</span>}<span class="sc">;</span>
 430   <span class="k">while</span> <span class="s">(</span><span class="i">$SDFilesInfo</span>{<span class="w">CmpdString</span>} = <span class="i">ReadCmpdString</span><span class="s">(</span><span class="i">$SDFilesInfo</span>{<span class="w">InputSDFileRef</span>}<span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 431     <span class="i">@CmpdLines</span> = <span class="k">split</span> <span class="q">&quot;\n&quot;</span><span class="cm">,</span> <span class="i">$SDFilesInfo</span>{<span class="w">CmpdString</span>}<span class="sc">;</span>
 432     <span class="i">$MolName</span> = <span class="i">QuoteAWord</span><span class="s">(</span><span class="i">ParseCmpdMolNameLine</span><span class="s">(</span><span class="i">$CmpdLines</span>[<span class="n">0</span>]<span class="s">)</span><span class="cm">,</span> <span class="i">$OptionsInfo</span>{<span class="w">OutQuote</span>}<span class="s">)</span><span class="sc">;</span>
 433     <span class="k">print</span> <span class="i">$NewTextFileRef</span> <span class="q">&quot;$MolName\n&quot;</span><span class="sc">;</span>
 434   <span class="s">}</span>
 435 <span class="s">}</span>
 436 
 437 <span class="c"># Extract a specific compound record...</span>
<a name="ExtractRecordNum-"></a> 438 <span class="k">sub </span><span class="m">ExtractRecordNum</span> <span class="s">{</span>
 439   <span class="k">my</span><span class="s">(</span><span class="i">$FileIndex</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 440   <span class="k">my</span><span class="s">(</span><span class="i">$CmpdNum</span><span class="cm">,</span> <span class="i">@CmpdLines</span><span class="s">)</span><span class="sc">;</span>
 441 
 442   <span class="i">@</span>{<span class="i">$SDFilesInfo</span>{<span class="w">DataLabels</span>}} = <span class="i">@</span>{<span class="i">$SDFilesInfo</span>{<span class="w">AllDataFieldLabels</span>}[<span class="i">$FileIndex</span>]}<span class="sc">;</span>
 443   <span class="i">WriteTextFileColLabels</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 444 
 445   <span class="i">$CmpdNum</span> = <span class="n">0</span><span class="sc">;</span>
 446 
 447   <span class="j">CMPDSTRING:</span> <span class="k">while</span> <span class="s">(</span><span class="i">$SDFilesInfo</span>{<span class="w">CmpdString</span>} = <span class="i">ReadCmpdString</span><span class="s">(</span><span class="i">$SDFilesInfo</span>{<span class="w">InputSDFileRef</span>}<span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 448     <span class="i">$CmpdNum</span>++<span class="sc">;</span>
 449     <span class="k">if</span> <span class="s">(</span><span class="i">$CmpdNum</span> != <span class="i">$OptionsInfo</span>{<span class="w">RecordNum</span>}<span class="s">)</span> <span class="s">{</span>
 450       <span class="k">next</span> <span class="j">CMPDSTRING</span><span class="sc">;</span>
 451     <span class="s">}</span>
 452 
 453     <span class="i">@CmpdLines</span> = <span class="k">split</span> <span class="q">&quot;\n&quot;</span><span class="cm">,</span> <span class="i">$SDFilesInfo</span>{<span class="w">CmpdString</span>}<span class="sc">;</span>
 454     <span class="i">WriteSDFileCmpdString</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 455 
 456     <span class="k">if</span> <span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">OutputTextFile</span>}<span class="s">)</span> <span class="s">{</span>
 457       <span class="i">%</span>{<span class="i">$SDFilesInfo</span>{<span class="w">DataFieldValues</span>}} = <span class="i">GetCmpdDataHeaderLabelsAndValues</span><span class="s">(</span>\<span class="i">@CmpdLines</span><span class="s">)</span><span class="sc">;</span>
 458       <span class="i">SetupDataValues</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 459       <span class="i">WriteTextFileCmpdData</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 460     <span class="s">}</span>
 461     <span class="k">last</span> <span class="j">CMPDSTRING</span><span class="sc">;</span>
 462   <span class="s">}</span>
 463 <span class="s">}</span>
 464 
 465 <span class="c"># Extract a specific compound records...</span>
<a name="ExtractRecordNums-"></a> 466 <span class="k">sub </span><span class="m">ExtractRecordNums</span> <span class="s">{</span>
 467   <span class="k">my</span><span class="s">(</span><span class="i">$FileIndex</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 468   <span class="k">my</span><span class="s">(</span><span class="i">$CmpdNum</span><span class="cm">,</span> <span class="i">$CmpdCount</span><span class="cm">,</span> <span class="i">@CmpdLines</span><span class="s">)</span><span class="sc">;</span>
 469 
 470   <span class="i">@</span>{<span class="i">$SDFilesInfo</span>{<span class="w">DataLabels</span>}} = <span class="i">@</span>{<span class="i">$SDFilesInfo</span>{<span class="w">AllDataFieldLabels</span>}[<span class="i">$FileIndex</span>]}<span class="sc">;</span>
 471   <span class="i">WriteTextFileColLabels</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 472 
 473   <span class="i">$CmpdNum</span> = <span class="n">0</span><span class="sc">;</span>
 474   <span class="i">$CmpdCount</span> = <span class="n">0</span><span class="sc">;</span>
 475 
 476   <span class="j">CMPDSTRING:</span> <span class="k">while</span> <span class="s">(</span><span class="i">$SDFilesInfo</span>{<span class="w">CmpdString</span>} = <span class="i">ReadCmpdString</span><span class="s">(</span><span class="i">$SDFilesInfo</span>{<span class="w">InputSDFileRef</span>}<span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 477     <span class="i">$CmpdNum</span>++<span class="sc">;</span>
 478 
 479     <span class="k">if</span> <span class="s">(</span><span class="k">exists</span> <span class="i">$OptionsInfo</span>{<span class="w">RecordNums</span>}{<span class="i">$CmpdNum</span>}<span class="s">)</span> <span class="s">{</span>
 480       <span class="i">$CmpdCount</span>++<span class="sc">;</span>
 481       <span class="i">@CmpdLines</span> = <span class="k">split</span> <span class="q">&quot;\n&quot;</span><span class="cm">,</span> <span class="i">$SDFilesInfo</span>{<span class="w">CmpdString</span>}<span class="sc">;</span>
 482 
 483       <span class="i">WriteSDFileCmpdString</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 484 
 485       <span class="k">if</span> <span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">OutputTextFile</span>}<span class="s">)</span> <span class="s">{</span>
 486         <span class="i">%</span>{<span class="i">$SDFilesInfo</span>{<span class="w">DataFieldValues</span>}} = <span class="i">GetCmpdDataHeaderLabelsAndValues</span><span class="s">(</span>\<span class="i">@CmpdLines</span><span class="s">)</span><span class="sc">;</span>
 487         <span class="i">SetupDataValues</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 488         <span class="i">WriteTextFileCmpdData</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 489       <span class="s">}</span>
 490     <span class="s">}</span>
 491     <span class="k">elsif</span> <span class="s">(</span><span class="i">$CmpdNum</span> &gt; <span class="i">$OptionsInfo</span>{<span class="w">RecordNumsMax</span>} || <span class="i">$CmpdCount</span> &gt;= <span class="i">$OptionsInfo</span>{<span class="w">RecordNumsCount</span>}<span class="s">)</span> <span class="s">{</span>
 492       <span class="k">last</span> <span class="j">CMPDSTRING</span><span class="sc">;</span>
 493     <span class="s">}</span>
 494   <span class="s">}</span>
 495 <span class="s">}</span>
 496 
 497 
 498 <span class="c"># Extract compounds in a specific record range...</span>
<a name="ExtractRecordRange-"></a> 499 <span class="k">sub </span><span class="m">ExtractRecordRange</span> <span class="s">{</span>
 500   <span class="k">my</span><span class="s">(</span><span class="i">$FileIndex</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 501   <span class="k">my</span><span class="s">(</span><span class="i">$CmpdNum</span><span class="cm">,</span> <span class="i">@CmpdLines</span><span class="s">)</span><span class="sc">;</span>
 502 
 503   <span class="i">@</span>{<span class="i">$SDFilesInfo</span>{<span class="w">DataLabels</span>}} = <span class="i">@</span>{<span class="i">$SDFilesInfo</span>{<span class="w">AllDataFieldLabels</span>}[<span class="i">$FileIndex</span>]}<span class="sc">;</span>
 504   <span class="i">WriteTextFileColLabels</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 505 
 506   <span class="i">$CmpdNum</span> = <span class="n">0</span><span class="sc">;</span>
 507   <span class="j">CMPDSTRING:</span> <span class="k">while</span> <span class="s">(</span><span class="i">$SDFilesInfo</span>{<span class="w">CmpdString</span>} = <span class="i">ReadCmpdString</span><span class="s">(</span><span class="i">$SDFilesInfo</span>{<span class="w">InputSDFileRef</span>}<span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 508     <span class="i">$CmpdNum</span>++<span class="sc">;</span>
 509 
 510     <span class="k">if</span> <span class="s">(</span><span class="i">$CmpdNum</span> &gt;= <span class="i">$OptionsInfo</span>{<span class="w">StartRecordNum</span>} &amp;&amp; <span class="i">$CmpdNum</span> &lt;= <span class="i">$OptionsInfo</span>{<span class="w">EndRecordNum</span>}<span class="s">)</span> <span class="s">{</span>
 511       <span class="i">@CmpdLines</span> = <span class="k">split</span> <span class="q">&quot;\n&quot;</span><span class="cm">,</span> <span class="i">$SDFilesInfo</span>{<span class="w">CmpdString</span>}<span class="sc">;</span>
 512 
 513       <span class="i">WriteSDFileCmpdString</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 514 
 515       <span class="k">if</span> <span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">OutputTextFile</span>}<span class="s">)</span> <span class="s">{</span>
 516         <span class="i">%</span>{<span class="i">$SDFilesInfo</span>{<span class="w">DataFieldValues</span>}} = <span class="i">GetCmpdDataHeaderLabelsAndValues</span><span class="s">(</span>\<span class="i">@CmpdLines</span><span class="s">)</span><span class="sc">;</span>
 517         <span class="i">SetupDataValues</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 518         <span class="i">WriteTextFileCmpdData</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 519       <span class="s">}</span>
 520     <span class="s">}</span>
 521     <span class="k">elsif</span> <span class="s">(</span><span class="i">$CmpdNum</span> &gt; <span class="i">$OptionsInfo</span>{<span class="w">EndRecordNum</span>}<span class="s">)</span> <span class="s">{</span>
 522       <span class="k">last</span> <span class="j">CMPDSTRING</span><span class="sc">;</span>
 523     <span class="s">}</span>
 524   <span class="s">}</span>
 525 <span class="s">}</span>
 526 
 527 <span class="c"># Extract 2D compound records...</span>
<a name="Extract2DCmpdRecords-"></a> 528 <span class="k">sub </span><span class="m">Extract2DCmpdRecords</span> <span class="s">{</span>
 529   <span class="k">my</span><span class="s">(</span><span class="i">$FileIndex</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 530   <span class="k">my</span><span class="s">(</span><span class="i">@CmpdLines</span><span class="s">)</span><span class="sc">;</span>
 531 
 532   <span class="i">@</span>{<span class="i">$SDFilesInfo</span>{<span class="w">DataLabels</span>}} = <span class="i">@</span>{<span class="i">$SDFilesInfo</span>{<span class="w">AllDataFieldLabels</span>}[<span class="i">$FileIndex</span>]}<span class="sc">;</span>
 533   <span class="i">WriteTextFileColLabels</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 534 
 535 
 536   <span class="j">CMPDSTRING:</span> <span class="k">while</span> <span class="s">(</span><span class="i">$SDFilesInfo</span>{<span class="w">CmpdString</span>} = <span class="i">ReadCmpdString</span><span class="s">(</span><span class="i">$SDFilesInfo</span>{<span class="w">InputSDFileRef</span>}<span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 537     <span class="i">@CmpdLines</span> = <span class="k">split</span> <span class="q">&quot;\n&quot;</span><span class="cm">,</span> <span class="i">$SDFilesInfo</span>{<span class="w">CmpdString</span>}<span class="sc">;</span>
 538     <span class="k">if</span> <span class="s">(</span>!<span class="i">IsCmpd2D</span><span class="s">(</span>\<span class="i">@CmpdLines</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 539       <span class="k">next</span> <span class="j">CMPDSTRING</span><span class="sc">;</span>
 540     <span class="s">}</span>
 541 
 542     <span class="i">WriteSDFileCmpdString</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 543 
 544     <span class="k">if</span> <span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">OutputTextFile</span>}<span class="s">)</span> <span class="s">{</span>
 545       <span class="i">%</span>{<span class="i">$SDFilesInfo</span>{<span class="w">DataFieldValues</span>}} = <span class="i">GetCmpdDataHeaderLabelsAndValues</span><span class="s">(</span>\<span class="i">@CmpdLines</span><span class="s">)</span><span class="sc">;</span>
 546       <span class="i">SetupDataValues</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 547       <span class="i">WriteTextFileCmpdData</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 548     <span class="s">}</span>
 549   <span class="s">}</span>
 550 <span class="s">}</span>
 551 
 552 <span class="c"># Extract 3D compound records...</span>
<a name="Extract3DCmpdRecords-"></a> 553 <span class="k">sub </span><span class="m">Extract3DCmpdRecords</span> <span class="s">{</span>
 554   <span class="k">my</span><span class="s">(</span><span class="i">$FileIndex</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 555   <span class="k">my</span><span class="s">(</span><span class="i">@CmpdLines</span><span class="s">)</span><span class="sc">;</span>
 556 
 557   <span class="i">@</span>{<span class="i">$SDFilesInfo</span>{<span class="w">DataLabels</span>}} = <span class="i">@</span>{<span class="i">$SDFilesInfo</span>{<span class="w">AllDataFieldLabels</span>}[<span class="i">$FileIndex</span>]}<span class="sc">;</span>
 558   <span class="i">WriteTextFileColLabels</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 559 
 560 
 561   <span class="j">CMPDSTRING:</span> <span class="k">while</span> <span class="s">(</span><span class="i">$SDFilesInfo</span>{<span class="w">CmpdString</span>} = <span class="i">ReadCmpdString</span><span class="s">(</span><span class="i">$SDFilesInfo</span>{<span class="w">InputSDFileRef</span>}<span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 562     <span class="i">@CmpdLines</span> = <span class="k">split</span> <span class="q">&quot;\n&quot;</span><span class="cm">,</span> <span class="i">$SDFilesInfo</span>{<span class="w">CmpdString</span>}<span class="sc">;</span>
 563     <span class="k">if</span> <span class="s">(</span>!<span class="i">IsCmpd3D</span><span class="s">(</span>\<span class="i">@CmpdLines</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 564       <span class="k">next</span> <span class="j">CMPDSTRING</span><span class="sc">;</span>
 565     <span class="s">}</span>
 566 
 567     <span class="i">WriteSDFileCmpdString</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 568 
 569     <span class="k">if</span> <span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">OutputTextFile</span>}<span class="s">)</span> <span class="s">{</span>
 570       <span class="i">%</span>{<span class="i">$SDFilesInfo</span>{<span class="w">DataFieldValues</span>}} = <span class="i">GetCmpdDataHeaderLabelsAndValues</span><span class="s">(</span>\<span class="i">@CmpdLines</span><span class="s">)</span><span class="sc">;</span>
 571       <span class="i">SetupDataValues</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 572       <span class="i">WriteTextFileCmpdData</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 573     <span class="s">}</span>
 574   <span class="s">}</span>
 575 <span class="s">}</span>
 576 
 577 
 578 <span class="c"># Open input and output files...</span>
<a name="OpenInputAndOutputFiles-"></a> 579 <span class="k">sub </span><span class="m">OpenInputAndOutputFiles</span> <span class="s">{</span>
 580   <span class="k">my</span><span class="s">(</span><span class="i">$FileIndex</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 581 
 582   <span class="i">$SDFilesInfo</span>{<span class="w">NewTextFileRef</span>} = <span class="k">undef</span><span class="sc">;</span>
 583   <span class="i">$SDFilesInfo</span>{<span class="w">NewSDFileRef</span>} = <span class="k">undef</span><span class="sc">;</span>
 584 
 585   <span class="k">if</span> <span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">OutputTextFile</span>} &amp;&amp; <span class="i">$OptionsInfo</span>{<span class="w">OutputSDFile</span>}<span class="s">)</span> <span class="s">{</span>
 586     <span class="k">print</span> <span class="q">&quot;Generating files $SDFilesInfo{NewSDFileName}[$FileIndex] and $SDFilesInfo{NewTextFileName}[$FileIndex]...\n&quot;</span><span class="sc">;</span>
 587   <span class="s">}</span>
 588   <span class="k">elsif</span> <span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">OutputSDFile</span>}<span class="s">)</span> <span class="s">{</span>
 589     <span class="k">print</span> <span class="q">&quot;Generating file $SDFilesInfo{NewSDFileName}[$FileIndex]...\n&quot;</span><span class="sc">;</span>
 590   <span class="s">}</span>
 591   <span class="k">else</span> <span class="s">{</span>
 592     <span class="k">print</span> <span class="q">&quot;Generating file $SDFilesInfo{NewTextFileName}[$FileIndex]...\n&quot;</span><span class="sc">;</span>
 593   <span class="s">}</span>
 594 
 595   <span class="k">if</span> <span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">OutputSDFile</span>}<span class="s">)</span> <span class="s">{</span>
 596     <span class="k">open</span> <span class="w">NEWSDFILE</span><span class="cm">,</span> <span class="q">&quot;&gt;$SDFilesInfo{NewSDFileName}[$FileIndex]&quot;</span> <span class="k">or</span> <span class="k">die</span> <span class="q">&quot;Error: Couldn&#39;t open $SDFilesInfo{NewSDFileName}[$FileIndex]: $! \n&quot;</span><span class="sc">;</span>
 597     <span class="i">$SDFilesInfo</span>{<span class="w">NewSDFileRef</span>} = \<span class="i">*NEWSDFILE</span><span class="sc">;</span>
 598   <span class="s">}</span>
 599   <span class="k">if</span> <span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">OutputTextFile</span>}<span class="s">)</span> <span class="s">{</span>
 600     <span class="k">open</span> <span class="w">NEWTEXTFILE</span><span class="cm">,</span> <span class="q">&quot;&gt;$SDFilesInfo{NewTextFileName}[$FileIndex]&quot;</span> <span class="k">or</span> <span class="k">die</span> <span class="q">&quot;Error: Couldn&#39;t open $SDFilesInfo{NewTextFileName}[$FileIndex]: $! \n&quot;</span><span class="sc">;</span>
 601     <span class="i">$SDFilesInfo</span>{<span class="w">NewTextFileRef</span>} = \<span class="i">*NEWTEXTFILE</span><span class="sc">;</span>
 602   <span class="s">}</span>
 603 
 604   <span class="k">open</span> <span class="w">SDFILE</span><span class="cm">,</span> <span class="q">&quot;$SDFilesList[$FileIndex]&quot;</span> <span class="k">or</span> <span class="k">die</span> <span class="q">&quot;Error: Couldn&#39;t open $SDFilesList[$FileIndex]: $! \n&quot;</span><span class="sc">;</span>
 605   <span class="i">$SDFilesInfo</span>{<span class="w">InputSDFileRef</span>} = \<span class="i">*SDFILE</span><span class="sc">;</span>
 606 
 607 <span class="s">}</span>
 608 
 609 <span class="c"># Close open input and output files...</span>
<a name="CloseInputAndOutputFiles-"></a> 610 <span class="k">sub </span><span class="m">CloseInputAndOutputFiles</span> <span class="s">{</span>
 611   <span class="k">if</span> <span class="s">(</span><span class="i">$SDFilesInfo</span>{<span class="w">NewSDFileRef</span>}<span class="s">)</span> <span class="s">{</span>
 612     <span class="k">close</span> <span class="i">$SDFilesInfo</span>{<span class="w">NewSDFileRef</span>}<span class="sc">;</span>
 613   <span class="s">}</span>
 614   <span class="k">if</span> <span class="s">(</span><span class="i">$SDFilesInfo</span>{<span class="w">NewTextFileRef</span>}<span class="s">)</span> <span class="s">{</span>
 615     <span class="k">close</span> <span class="i">$SDFilesInfo</span>{<span class="w">NewTextFileRef</span>}<span class="sc">;</span>
 616   <span class="s">}</span>
 617 
 618   <span class="k">if</span> <span class="s">(</span><span class="i">$SDFilesInfo</span>{<span class="w">InputSDFileRef</span>}<span class="s">)</span> <span class="s">{</span>
 619     <span class="k">close</span> <span class="i">$SDFilesInfo</span>{<span class="w">InputSDFileRef</span>}<span class="sc">;</span>
 620   <span class="s">}</span>
 621 
 622   <span class="i">$SDFilesInfo</span>{<span class="w">NewTextFileRef</span>} = <span class="k">undef</span><span class="sc">;</span>
 623   <span class="i">$SDFilesInfo</span>{<span class="w">NewSDFileRef</span>} = <span class="k">undef</span><span class="sc">;</span>
 624   <span class="i">$SDFilesInfo</span>{<span class="w">InputSDFileRef</span>} = <span class="k">undef</span><span class="sc">;</span>
 625 <span class="s">}</span>
 626 
 627 <span class="c"># Write out column labels for text file...</span>
<a name="WriteTextFileColLabels-"></a> 628 <span class="k">sub </span><span class="m">WriteTextFileColLabels</span> <span class="s">{</span>
 629   <span class="k">my</span><span class="s">(</span><span class="i">$ColLabelsLine</span><span class="cm">,</span> <span class="i">$NewTextFileRef</span><span class="s">)</span><span class="sc">;</span>
 630 
 631   <span class="k">if</span> <span class="s">(</span>!<span class="i">$OptionsInfo</span>{<span class="w">OutputTextFile</span>}<span class="s">)</span> <span class="s">{</span>
 632     <span class="k">return</span><span class="sc">;</span>
 633   <span class="s">}</span>
 634   <span class="i">$NewTextFileRef</span> = <span class="i">$SDFilesInfo</span>{<span class="w">NewTextFileRef</span>}<span class="sc">;</span>
 635 
 636   <span class="k">if</span> <span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">OutputStrDataString</span>}<span class="s">)</span> <span class="s">{</span>
 637     <span class="c"># Append structure data string label...</span>
 638     <span class="k">my</span><span class="s">(</span><span class="i">@DataLabels</span><span class="s">)</span><span class="sc">;</span>
 639 
 640     <span class="i">@DataLabels</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 641     <span class="k">push</span> <span class="i">@DataLabels</span><span class="cm">,</span> <span class="i">@</span>{<span class="i">$SDFilesInfo</span>{<span class="w">DataLabels</span>}}<span class="sc">;</span>
 642     <span class="k">push</span> <span class="i">@DataLabels</span><span class="cm">,</span> <span class="q">&quot;StructureDataString&quot;</span><span class="sc">;</span>
 643 
 644     <span class="i">$ColLabelsLine</span> = <span class="i">JoinWords</span><span class="s">(</span>\<span class="i">@DataLabels</span><span class="cm">,</span> <span class="i">$OptionsInfo</span>{<span class="w">OutDelim</span>}<span class="cm">,</span> <span class="i">$OptionsInfo</span>{<span class="w">OutQuote</span>}<span class="s">)</span><span class="sc">;</span>
 645   <span class="s">}</span>
 646   <span class="k">else</span> <span class="s">{</span>
 647     <span class="i">$ColLabelsLine</span> = <span class="i">JoinWords</span><span class="s">(</span>\<span class="i">@</span>{<span class="i">$SDFilesInfo</span>{<span class="w">DataLabels</span>}}<span class="cm">,</span> <span class="i">$OptionsInfo</span>{<span class="w">OutDelim</span>}<span class="cm">,</span> <span class="i">$OptionsInfo</span>{<span class="w">OutQuote</span>}<span class="s">)</span><span class="sc">;</span>
 648   <span class="s">}</span>
 649   <span class="k">print</span> <span class="i">$NewTextFileRef</span> <span class="q">&quot;$ColLabelsLine\n&quot;</span><span class="sc">;</span>
 650 <span class="s">}</span>
 651 
 652 <span class="c"># Setup values for data fields...</span>
<a name="SetupDataValues-"></a> 653 <span class="k">sub </span><span class="m">SetupDataValues</span> <span class="s">{</span>
 654   <span class="i">@</span>{<span class="i">$SDFilesInfo</span>{<span class="w">DataValues</span>}} = <span class="k">map</span> <span class="s">{</span> <span class="k">exists</span> <span class="i">$SDFilesInfo</span>{<span class="w">DataFieldValues</span>}{<span class="i">$_</span>} ? <span class="i">$SDFilesInfo</span>{<span class="w">DataFieldValues</span>}{<span class="i">$_</span>} <span class="co">:</span> <span class="q">&quot;&quot;</span> <span class="s">}</span> <span class="i">@</span>{<span class="i">$SDFilesInfo</span>{<span class="w">DataLabels</span>}}<span class="sc">;</span>
 655 <span class="s">}</span>
 656 
 657 <span class="c"># Write out structure data and specific data fields to SD file...</span>
<a name="WriteSDFileCmpdData-"></a> 658 <span class="k">sub </span><span class="m">WriteSDFileCmpdData</span> <span class="s">{</span>
 659   <span class="k">my</span><span class="s">(</span><span class="i">$MolString</span><span class="cm">,</span> <span class="i">$Count</span><span class="cm">,</span> <span class="i">$NewSDFileRef</span><span class="s">)</span><span class="sc">;</span>
 660 
 661   <span class="k">if</span> <span class="s">(</span>!<span class="i">$OptionsInfo</span>{<span class="w">OutputSDFile</span>}<span class="s">)</span> <span class="s">{</span>
 662     <span class="k">return</span><span class="sc">;</span>
 663   <span class="s">}</span>
 664 
 665   <span class="i">$NewSDFileRef</span> = <span class="i">$SDFilesInfo</span>{<span class="w">NewSDFileRef</span>}<span class="sc">;</span>
 666 
 667   <span class="s">(</span><span class="i">$MolString</span><span class="s">)</span> = <span class="k">split</span> <span class="q">&quot;M  END&quot;</span><span class="cm">,</span> <span class="i">$SDFilesInfo</span>{<span class="w">CmpdString</span>}<span class="sc">;</span>
 668   <span class="i">$MolString</span> .= <span class="q">&quot;M  END&quot;</span><span class="sc">;</span>
 669   <span class="k">print</span> <span class="i">$NewSDFileRef</span> <span class="q">&quot;$MolString\n&quot;</span><span class="sc">;</span>
 670 
 671   <span class="k">for</span> <span class="i">$Count</span> <span class="s">(</span><span class="n">0</span> .. <span class="i">$#</span>{<span class="i">$SDFilesInfo</span>{<span class="w">DataLabels</span>}}<span class="s">)</span> <span class="s">{</span>
 672     <span class="k">print</span> <span class="i">$NewSDFileRef</span> <span class="q">&quot;&gt;  &lt;$SDFilesInfo{DataLabels}[$Count]&gt;\n$SDFilesInfo{DataValues}[$Count]\n\n&quot;</span><span class="sc">;</span>
 673   <span class="s">}</span>
 674   <span class="k">print</span> <span class="i">$NewSDFileRef</span> <span class="q">&quot;\$\$\$\$\n&quot;</span><span class="sc">;</span>
 675 <span class="s">}</span>
 676 
 677 <span class="c"># Write out compound string...</span>
<a name="WriteSDFileCmpdString-"></a> 678 <span class="k">sub </span><span class="m">WriteSDFileCmpdString</span> <span class="s">{</span>
 679   <span class="k">my</span><span class="s">(</span><span class="i">$NewSDFileRef</span><span class="s">)</span><span class="sc">;</span>
 680 
 681   <span class="k">if</span> <span class="s">(</span>!<span class="i">$OptionsInfo</span>{<span class="w">OutputSDFile</span>}<span class="s">)</span> <span class="s">{</span>
 682     <span class="k">return</span><span class="sc">;</span>
 683   <span class="s">}</span>
 684 
 685   <span class="i">$NewSDFileRef</span> = <span class="i">$SDFilesInfo</span>{<span class="w">NewSDFileRef</span>}<span class="sc">;</span>
 686   <span class="k">print</span> <span class="i">$NewSDFileRef</span> <span class="q">&quot;$SDFilesInfo{CmpdString}\n&quot;</span><span class="sc">;</span>
 687 <span class="s">}</span>
 688 
 689 <span class="c"># Write out data for text file...</span>
<a name="WriteTextFileCmpdData-"></a> 690 <span class="k">sub </span><span class="m">WriteTextFileCmpdData</span> <span class="s">{</span>
 691   <span class="k">my</span><span class="s">(</span><span class="i">$DataValuesLine</span><span class="cm">,</span> <span class="i">$NewTextFileRef</span><span class="s">)</span><span class="sc">;</span>
 692 
 693   <span class="k">if</span> <span class="s">(</span>!<span class="i">$OptionsInfo</span>{<span class="w">OutputTextFile</span>}<span class="s">)</span> <span class="s">{</span>
 694     <span class="k">return</span><span class="sc">;</span>
 695   <span class="s">}</span>
 696 
 697   <span class="i">$NewTextFileRef</span> = <span class="i">$SDFilesInfo</span>{<span class="w">NewTextFileRef</span>}<span class="sc">;</span>
 698   <span class="i">$DataValuesLine</span> = <span class="i">JoinWords</span><span class="s">(</span>\<span class="i">@</span>{<span class="i">$SDFilesInfo</span>{<span class="w">DataValues</span>}}<span class="cm">,</span> <span class="i">$OptionsInfo</span>{<span class="w">OutDelim</span>}<span class="cm">,</span> <span class="i">$OptionsInfo</span>{<span class="w">OutQuote</span>}<span class="s">)</span><span class="sc">;</span>
 699 
 700   <span class="c"># Handle multiple lines data values for data fields by joining &#39;em using semicolons...</span>
 701   <span class="k">if</span> <span class="s">(</span><span class="i">$DataValuesLine</span> =~ <span class="q">/\n/</span><span class="s">)</span> <span class="s">{</span>
 702     <span class="i">$DataValuesLine</span> =~ <span class="q">s/\n/;/g</span><span class="sc">;</span>
 703   <span class="s">}</span>
 704 
 705   <span class="k">if</span> <span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">OutputStrDataString</span>}<span class="s">)</span> <span class="s">{</span>
 706     <span class="c"># Append structure data string...</span>
 707     <span class="k">my</span><span class="s">(</span><span class="i">$StrDataString</span><span class="cm">,</span> <span class="i">$OutQuoteValue</span><span class="cm">,</span> <span class="i">$OutDelim</span><span class="cm">,</span> <span class="i">$StrDataStringDelimiter</span><span class="s">)</span><span class="sc">;</span>
 708 
 709     <span class="k">if</span> <span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">StrDataStringWithFields</span>}<span class="s">)</span> <span class="s">{</span>
 710       <span class="i">$StrDataString</span> = <span class="i">$SDFilesInfo</span>{<span class="w">CmpdString</span>}<span class="sc">;</span>
 711     <span class="s">}</span>
 712     <span class="k">else</span> <span class="s">{</span>
 713       <span class="s">(</span><span class="i">$StrDataString</span><span class="s">)</span> = <span class="k">split</span> <span class="q">&quot;M  END&quot;</span><span class="cm">,</span> <span class="i">$SDFilesInfo</span>{<span class="w">CmpdString</span>}<span class="sc">;</span>
 714       <span class="i">$StrDataString</span> .= <span class="q">&quot;M  END&quot;</span><span class="sc">;</span>
 715     <span class="s">}</span>
 716     <span class="i">$StrDataStringDelimiter</span> = <span class="i">$OptionsInfo</span>{<span class="w">StrDataStringDelimiter</span>}<span class="sc">;</span>
 717     <span class="i">$StrDataString</span> =~ <span class="q">s/\n/$StrDataStringDelimiter/g</span><span class="sc">;</span>
 718 
 719     <span class="i">$OutDelim</span> = <span class="i">$OptionsInfo</span>{<span class="w">OutDelim</span>}<span class="sc">;</span>
 720     <span class="i">$OutQuoteValue</span> = <span class="i">$OptionsInfo</span>{<span class="w">OutQuote</span>} ? <span class="q">&quot;\&quot;&quot;</span> <span class="co">:</span> <span class="q">&quot;&quot;</span><span class="sc">;</span>
 721 
 722     <span class="k">print</span> <span class="i">$NewTextFileRef</span> <span class="q">&quot;$DataValuesLine${OutDelim}${OutQuoteValue}${StrDataString}${OutQuoteValue}\n&quot;</span><span class="sc">;</span>
 723   <span class="s">}</span>
 724   <span class="k">else</span> <span class="s">{</span>
 725     <span class="k">print</span> <span class="i">$NewTextFileRef</span> <span class="q">&quot;$DataValuesLine\n&quot;</span><span class="sc">;</span>
 726   <span class="s">}</span>
 727 <span class="s">}</span>
 728 
 729 <span class="c"># Retrieve information about input SD files...</span>
<a name="RetrieveSDFilesInfo-"></a> 730 <span class="k">sub </span><span class="m">RetrieveSDFilesInfo</span> <span class="s">{</span>
 731   <span class="k">my</span><span class="s">(</span><span class="i">$SDFile</span><span class="cm">,</span> <span class="i">$Index</span><span class="cm">,</span> <span class="i">$FileDir</span><span class="cm">,</span> <span class="i">$FileExt</span><span class="cm">,</span> <span class="i">$FileName</span><span class="cm">,</span> <span class="i">$NewFileName</span><span class="cm">,</span> <span class="i">$NewSDFileName</span><span class="cm">,</span> <span class="i">$NewTextFileName</span><span class="cm">,</span> <span class="i">$CmpdCount</span><span class="s">)</span><span class="sc">;</span>
 732 
 733   <span class="i">%SDFilesInfo</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 734 
 735   <span class="i">@</span>{<span class="i">$SDFilesInfo</span>{<span class="w">FileOkay</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 736   <span class="i">@</span>{<span class="i">$SDFilesInfo</span>{<span class="w">CmpdCount</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 737   <span class="i">@</span>{<span class="i">$SDFilesInfo</span>{<span class="w">NewTextFileName</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 738   <span class="i">@</span>{<span class="i">$SDFilesInfo</span>{<span class="w">NewSDFileName</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 739 
 740   <span class="i">@</span>{<span class="i">$SDFilesInfo</span>{<span class="w">AllDataFieldLabels</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 741   <span class="i">@</span>{<span class="i">$SDFilesInfo</span>{<span class="w">CommonDataFieldLabels</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 742 
 743   <span class="j">FILELIST:</span> <span class="k">for</span> <span class="i">$Index</span> <span class="s">(</span><span class="n">0</span> .. <span class="i">$#SDFilesList</span><span class="s">)</span> <span class="s">{</span>
 744     <span class="i">$SDFile</span> = <span class="i">$SDFilesList</span>[<span class="i">$Index</span>]<span class="sc">;</span>
 745 
 746     <span class="i">$SDFilesInfo</span>{<span class="w">FileOkay</span>}[<span class="i">$Index</span>] = <span class="n">0</span><span class="sc">;</span>
 747 
 748     <span class="i">$SDFilesInfo</span>{<span class="w">CmpdCount</span>}[<span class="i">$Index</span>] = <span class="n">0</span><span class="sc">;</span>
 749     <span class="i">$SDFilesInfo</span>{<span class="w">NewTextFileName</span>}[<span class="i">$Index</span>] = <span class="q">&quot;&quot;</span><span class="sc">;</span>
 750     <span class="i">$SDFilesInfo</span>{<span class="w">NewSDFileName</span>}[<span class="i">$Index</span>] = <span class="q">&quot;&quot;</span><span class="sc">;</span>
 751 
 752     <span class="i">@</span>{<span class="i">$SDFilesInfo</span>{<span class="w">AllDataFieldLabels</span>}[<span class="i">$Index</span>]} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 753     <span class="i">@</span>{<span class="i">$SDFilesInfo</span>{<span class="w">CommonDataFieldLabels</span>}[<span class="i">$Index</span>]} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 754 
 755     <span class="k">if</span> <span class="s">(</span>!<span class="s">(</span><span class="k">-e</span> <span class="i">$SDFile</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 756       <span class="k">warn</span> <span class="q">&quot;Warning: Ignoring file $SDFile: It doesn&#39;t exist\n&quot;</span><span class="sc">;</span>
 757       <span class="k">next</span> <span class="j">FILELIST</span><span class="sc">;</span>
 758     <span class="s">}</span>
 759 
 760     <span class="k">if</span> <span class="s">(</span>!<span class="i">CheckFileType</span><span class="s">(</span><span class="i">$SDFile</span><span class="cm">,</span> <span class="q">&quot;sd sdf&quot;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 761       <span class="k">warn</span> <span class="q">&quot;Warning: Ignoring file $SDFile: It&#39;s not a SD file\n&quot;</span><span class="sc">;</span>
 762       <span class="k">next</span> <span class="j">FILELIST</span><span class="sc">;</span>
 763     <span class="s">}</span>
 764 
 765     <span class="c"># Generate appropriate name for the new output file.</span>
 766     <span class="i">$FileDir</span> = <span class="q">&quot;&quot;</span><span class="sc">;</span> <span class="i">$FileName</span> = <span class="q">&quot;&quot;</span><span class="sc">;</span> <span class="i">$FileExt</span> = <span class="q">&quot;&quot;</span><span class="sc">;</span>
 767     <span class="s">(</span><span class="i">$FileDir</span><span class="cm">,</span> <span class="i">$FileName</span><span class="cm">,</span> <span class="i">$FileExt</span><span class="s">)</span> = <span class="i">ParseFileName</span><span class="s">(</span><span class="i">$SDFile</span><span class="s">)</span><span class="sc">;</span>
 768     <span class="i">$NewFileName</span> = <span class="i">$FileName</span><span class="sc">;</span>
 769     <span class="i">$NewFileName</span> = <span class="i">$FileName</span>  . <span class="i">$OptionsInfo</span>{<span class="w">FileNameMode</span>}<span class="sc">;</span>
 770     <span class="k">if</span> <span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">OutFileRoot</span>} &amp;&amp; <span class="s">(</span><span class="i">@SDFilesList</span> == <span class="n">1</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 771       <span class="k">my</span> <span class="s">(</span><span class="i">$RootFileDir</span><span class="cm">,</span> <span class="i">$RootFileName</span><span class="cm">,</span> <span class="i">$RootFileExt</span><span class="s">)</span> = <span class="i">ParseFileName</span><span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">OutFileRoot</span>}<span class="s">)</span><span class="sc">;</span>
 772       <span class="k">if</span> <span class="s">(</span><span class="i">$RootFileName</span> &amp;&amp; <span class="i">$RootFileExt</span><span class="s">)</span> <span class="s">{</span>
 773         <span class="i">$NewFileName</span> = <span class="i">$RootFileName</span><span class="sc">;</span>
 774       <span class="s">}</span>
 775       <span class="k">else</span> <span class="s">{</span>
 776         <span class="i">$NewFileName</span> = <span class="i">$OptionsInfo</span>{<span class="w">OutFileRoot</span>}<span class="sc">;</span>
 777       <span class="s">}</span>
 778     <span class="s">}</span>
 779     <span class="i">$NewSDFileName</span> = <span class="i">$NewFileName</span> . <span class="q">&quot;.$OptionsInfo{SDFileExt}&quot;</span><span class="sc">;</span>
 780     <span class="i">$NewTextFileName</span> = <span class="i">$NewFileName</span> . <span class="q">&quot;.$OptionsInfo{TextFileExt}&quot;</span><span class="sc">;</span>
 781 
 782     <span class="k">if</span> <span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">OutputSDFile</span>}<span class="s">)</span> <span class="s">{</span>
 783       <span class="k">if</span> <span class="s">(</span><span class="k">lc</span><span class="s">(</span><span class="i">$NewSDFileName</span><span class="s">)</span> <span class="k">eq</span> <span class="k">lc</span><span class="s">(</span><span class="i">$SDFile</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 784         <span class="k">warn</span> <span class="q">&quot;Warning: Ignoring input file $SDFile: Same output, $NewSDFileName, and input file names.\n&quot;</span><span class="sc">;</span>
 785         <span class="k">print</span> <span class="q">&quot;Specify a different name using \&quot;-r --root\&quot; option or use default name.\n&quot;</span><span class="sc">;</span>
 786         <span class="k">next</span> <span class="j">FILELIST</span><span class="sc">;</span>
 787       <span class="s">}</span>
 788     <span class="s">}</span>
 789 
 790     <span class="k">if</span> <span class="s">(</span>!<span class="i">$OptionsInfo</span>{<span class="w">Overwrite</span>}<span class="s">)</span> <span class="s">{</span>
 791       <span class="k">if</span> <span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">OutputSDFile</span>}<span class="s">)</span> <span class="s">{</span>
 792         <span class="k">if</span> <span class="s">(</span><span class="k">-e</span> <span class="i">$NewSDFileName</span><span class="s">)</span> <span class="s">{</span>
 793           <span class="k">warn</span> <span class="q">&quot;Warning: Ignoring file $SDFile: New file, $NewSDFileName, already exists\n&quot;</span><span class="sc">;</span>
 794           <span class="k">next</span> <span class="j">FILELIST</span><span class="sc">;</span>
 795         <span class="s">}</span>
 796       <span class="s">}</span>
 797       <span class="k">if</span> <span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">OutputTextFile</span>}<span class="s">)</span> <span class="s">{</span>
 798         <span class="k">if</span> <span class="s">(</span><span class="k">-e</span> <span class="i">$NewTextFileName</span><span class="s">)</span> <span class="s">{</span>
 799           <span class="k">warn</span> <span class="q">&quot;Warning: Ignoring file $SDFile: New file, $NewTextFileName, already exists\n&quot;</span><span class="sc">;</span>
 800           <span class="k">next</span> <span class="j">FILELIST</span><span class="sc">;</span>
 801         <span class="s">}</span>
 802       <span class="s">}</span>
 803     <span class="s">}</span>
 804 
 805     <span class="k">if</span> <span class="s">(</span>!<span class="k">open</span> <span class="w">SDFILE</span><span class="cm">,</span> <span class="q">&quot;$SDFile&quot;</span><span class="s">)</span> <span class="s">{</span>
 806       <span class="k">warn</span> <span class="q">&quot;Warning: Ignoring file $SDFile: Couldn&#39;t open it: $! \n&quot;</span><span class="sc">;</span>
 807       <span class="k">next</span> <span class="j">FILELIST</span><span class="sc">;</span>
 808     <span class="s">}</span>
 809 
 810     <span class="k">my</span><span class="s">(</span><span class="i">$CountCmpds</span><span class="cm">,</span> <span class="i">$CollectDataFields</span><span class="s">)</span><span class="sc">;</span>
 811     <span class="k">my</span><span class="s">(</span><span class="i">$CmpdString</span><span class="cm">,</span> <span class="i">@CmpdLines</span><span class="cm">,</span> <span class="i">@DataFieldLabels</span><span class="cm">,</span> <span class="i">%DataFieldLabelsMap</span><span class="cm">,</span><span class="i">@CommonDataFieldLabels</span><span class="s">)</span><span class="sc">;</span>
 812 
 813     <span class="i">$CountCmpds</span> = <span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">Mode</span>} =~ <span class="q">/^randomcmpds$/i</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 814 
 815     <span class="i">$CollectDataFields</span> = <span class="s">(</span><span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">Mode</span>} =~ <span class="q">/^(alldatafields|commondatafields|randomcmpds)$/i</span> &amp;&amp; <span class="i">$OptionsInfo</span>{<span class="w">OutputTextFile</span>}<span class="s">)</span> || <span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">Mode</span>} =~ <span class="q">/^(datafieldsbyvalue|datafieldsbyregex)$/i</span>  &amp;&amp; <span class="i">$OptionsInfo</span>{<span class="w">OutputTextFile</span>}<span class="s">)</span> || <span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">Mode</span>} =~ <span class="q">/^datafieldbylist$/i</span>  &amp;&amp; <span class="i">$OptionsInfo</span>{<span class="w">OutputTextFile</span>}<span class="s">)</span> || <span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">Mode</span>} =~ <span class="q">/^datafielduniquebylist$/i</span>  &amp;&amp; <span class="i">$OptionsInfo</span>{<span class="w">OutputTextFile</span>}<span class="s">)</span> || <span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">Mode</span>} =~ <span class="q">/^datafieldnotbylist$/i</span>  &amp;&amp; <span class="i">$OptionsInfo</span>{<span class="w">OutputTextFile</span>}<span class="s">)</span> || <span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">Mode</span>} =~ <span class="q">/^recordnum$/i</span> &amp;&amp; <span class="i">$OptionsInfo</span>{<span class="w">OutputTextFile</span>}<span class="s">)</span> || <span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">Mode</span>} =~ <span class="q">/^recordnums$/i</span> &amp;&amp; <span class="i">$OptionsInfo</span>{<span class="w">OutputTextFile</span>}<span class="s">)</span> || <span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">Mode</span>} =~ <span class="q">/^recordrange$/i</span> &amp;&amp; <span class="i">$OptionsInfo</span>{<span class="w">OutputTextFile</span>}<span class="s">)</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 816 
 817     <span class="i">$CmpdCount</span> = <span class="n">0</span><span class="sc">;</span>
 818     <span class="k">if</span> <span class="s">(</span><span class="i">$CountCmpds</span> || <span class="i">$CollectDataFields</span><span class="s">)</span> <span class="s">{</span>
 819       <span class="i">@DataFieldLabels</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 820       <span class="i">@CommonDataFieldLabels</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 821       <span class="i">%DataFieldLabelsMap</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 822       <span class="j">CMPDSTRING:</span> <span class="k">while</span> <span class="s">(</span><span class="i">$CmpdString</span> = <span class="i">ReadCmpdString</span><span class="s">(</span>\<span class="i">*SDFILE</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 823         <span class="i">$CmpdCount</span>++<span class="sc">;</span>
 824         <span class="k">if</span> <span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">Mode</span>} =~ <span class="q">/^recordnum$/i</span><span class="s">)</span> <span class="s">{</span>
 825           <span class="k">if</span> <span class="s">(</span><span class="i">$CmpdCount</span> == <span class="i">$OptionsInfo</span>{<span class="w">RecordNum</span>}<span class="s">)</span> <span class="s">{</span>
 826             <span class="i">@CmpdLines</span> = <span class="k">split</span> <span class="q">&quot;\n&quot;</span><span class="cm">,</span> <span class="i">$CmpdString</span><span class="sc">;</span>
 827             <span class="i">@DataFieldLabels</span> = <span class="i">GetCmpdDataHeaderLabels</span><span class="s">(</span>\<span class="i">@CmpdLines</span><span class="s">)</span><span class="sc">;</span>
 828             <span class="k">last</span> <span class="j">CMPDSTRING</span><span class="sc">;</span>
 829           <span class="s">}</span>
 830         <span class="s">}</span>
 831         <span class="k">if</span> <span class="s">(</span><span class="i">$CollectDataFields</span><span class="s">)</span> <span class="s">{</span>
 832           <span class="k">my</span><span class="s">(</span><span class="i">$Label</span><span class="s">)</span><span class="sc">;</span>
 833           <span class="i">@CmpdLines</span> = <span class="k">split</span> <span class="q">&quot;\n&quot;</span><span class="cm">,</span> <span class="i">$CmpdString</span><span class="sc">;</span>
 834           <span class="c"># Process compound data header labels and figure out which ones are present for</span>
 835           <span class="c"># all the compounds...</span>
 836           <span class="k">if</span> <span class="s">(</span><span class="i">@DataFieldLabels</span><span class="s">)</span> <span class="s">{</span>
 837             <span class="k">my</span> <span class="s">(</span><span class="i">@CmpdDataFieldLabels</span><span class="s">)</span> = <span class="i">GetCmpdDataHeaderLabels</span><span class="s">(</span>\<span class="i">@CmpdLines</span><span class="s">)</span><span class="sc">;</span>
 838             <span class="k">my</span><span class="s">(</span><span class="i">%CmpdDataFieldLabelsMap</span><span class="s">)</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 839             <span class="c"># Setup a map for the current labels...</span>
 840             <span class="k">for</span> <span class="i">$Label</span> <span class="s">(</span><span class="i">@CmpdDataFieldLabels</span><span class="s">)</span> <span class="s">{</span>
 841               <span class="i">$CmpdDataFieldLabelsMap</span>{<span class="i">$Label</span>} = <span class="q">&quot;PresentInSome&quot;</span><span class="sc">;</span>
 842             <span class="s">}</span>
 843             <span class="c"># Check the presence old labels for this compound; otherwise, mark &#39;em new...</span>
 844             <span class="k">for</span> <span class="i">$Label</span> <span class="s">(</span><span class="i">@DataFieldLabels</span><span class="s">)</span> <span class="s">{</span>
 845               <span class="k">if</span> <span class="s">(</span>!<span class="i">$CmpdDataFieldLabelsMap</span>{<span class="i">$Label</span>}<span class="s">)</span> <span class="s">{</span>
 846                 <span class="i">$DataFieldLabelsMap</span>{<span class="i">$Label</span>} = <span class="q">&quot;PresentInSome&quot;</span><span class="sc">;</span>
 847               <span class="s">}</span>
 848             <span class="s">}</span>
 849             <span class="c"># Check the presence this compound in the old labels; otherwise, add &#39;em...</span>
 850             <span class="k">for</span> <span class="i">$Label</span> <span class="s">(</span><span class="i">@CmpdDataFieldLabels</span> <span class="s">)</span> <span class="s">{</span>
 851               <span class="k">if</span> <span class="s">(</span>!<span class="i">$DataFieldLabelsMap</span>{<span class="i">$Label</span>}<span class="s">)</span> <span class="s">{</span>
 852                 <span class="c"># It&#39;s a new label...</span>
 853                 <span class="k">push</span> <span class="i">@DataFieldLabels</span><span class="cm">,</span> <span class="i">$Label</span><span class="sc">;</span>
 854                 <span class="i">$DataFieldLabelsMap</span>{<span class="i">$Label</span>} = <span class="q">&quot;PresentInSome&quot;</span><span class="sc">;</span>
 855               <span class="s">}</span>
 856             <span class="s">}</span>
 857           <span class="s">}</span>
 858           <span class="k">else</span> <span class="s">{</span>
 859             <span class="c"># Get the initial label set and set up a map...</span>
 860             <span class="i">@DataFieldLabels</span> = <span class="i">GetCmpdDataHeaderLabels</span><span class="s">(</span>\<span class="i">@CmpdLines</span><span class="s">)</span><span class="sc">;</span>
 861             <span class="k">for</span> <span class="i">$Label</span> <span class="s">(</span><span class="i">@DataFieldLabels</span><span class="s">)</span> <span class="s">{</span>
 862               <span class="i">$DataFieldLabelsMap</span>{<span class="i">$Label</span>} = <span class="q">&quot;PresentInAll&quot;</span><span class="sc">;</span>
 863             <span class="s">}</span>
 864           <span class="s">}</span>
 865           <span class="c"># Identify the common data field labels...</span>
 866           <span class="k">if</span> <span class="s">(</span><span class="i">$Options</span>{<span class="w">mode</span>} =~ <span class="q">/^commondatafields$/i</span><span class="s">)</span> <span class="s">{</span>
 867             <span class="i">@CommonDataFieldLabels</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 868             <span class="k">for</span> <span class="i">$Label</span> <span class="s">(</span><span class="i">@DataFieldLabels</span><span class="s">)</span> <span class="s">{</span>
 869               <span class="k">if</span> <span class="s">(</span><span class="i">$DataFieldLabelsMap</span>{<span class="i">$Label</span>} <span class="k">eq</span> <span class="q">&quot;PresentInAll&quot;</span><span class="s">)</span> <span class="s">{</span>
 870                 <span class="k">push</span> <span class="i">@CommonDataFieldLabels</span><span class="cm">,</span> <span class="i">$Label</span><span class="sc">;</span>
 871               <span class="s">}</span>
 872             <span class="s">}</span>
 873           <span class="s">}</span>
 874         <span class="s">}</span>
 875       <span class="s">}</span>
 876     <span class="s">}</span>
 877 
 878     <span class="i">$SDFilesInfo</span>{<span class="w">FileOkay</span>}[<span class="i">$Index</span>] = <span class="n">1</span><span class="sc">;</span>
 879 
 880     <span class="i">$SDFilesInfo</span>{<span class="w">NewTextFileName</span>}[<span class="i">$Index</span>] = <span class="i">$NewTextFileName</span><span class="sc">;</span>
 881     <span class="i">$SDFilesInfo</span>{<span class="w">NewSDFileName</span>}[<span class="i">$Index</span>] = <span class="i">$NewSDFileName</span><span class="sc">;</span>
 882 
 883     <span class="i">$SDFilesInfo</span>{<span class="w">CmpdCount</span>}[<span class="i">$Index</span>] = <span class="i">$CmpdCount</span><span class="sc">;</span>
 884 
 885     <span class="k">push</span> <span class="i">@</span>{<span class="i">$SDFilesInfo</span>{<span class="w">AllDataFieldLabels</span>}[<span class="i">$Index</span>]}<span class="cm">,</span> <span class="i">@DataFieldLabels</span><span class="sc">;</span>
 886     <span class="k">push</span> <span class="i">@</span>{<span class="i">$SDFilesInfo</span>{<span class="w">CommonDataFieldLabels</span>}[<span class="i">$Index</span>]}<span class="cm">,</span> <span class="i">@CommonDataFieldLabels</span><span class="sc">;</span>
 887 
 888     <span class="k">close</span> <span class="w">SDFILE</span><span class="sc">;</span>
 889   <span class="s">}</span>
 890 <span class="s">}</span>
 891 
 892 <span class="c"># Process options...</span>
<a name="ProcessOptions-"></a> 893 <span class="k">sub </span><span class="m">ProcessOptions</span> <span class="s">{</span>
 894   <span class="i">%OptionsInfo</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 895 
 896   <span class="i">$OptionsInfo</span>{<span class="w">Mode</span>} = <span class="i">$Options</span>{<span class="w">mode</span>}<span class="sc">;</span>
 897 
 898   <span class="i">$OptionsInfo</span>{<span class="w">InDelim</span>} = <span class="q">&quot;\,&quot;</span><span class="sc">;</span>
 899   <span class="k">if</span> <span class="s">(</span><span class="i">$Options</span>{<span class="w">indelim</span>} =~ <span class="q">/^semicolon$/i</span><span class="s">)</span> <span class="s">{</span>
 900     <span class="i">$OptionsInfo</span>{<span class="w">InDelim</span>} = <span class="q">&quot;\;&quot;</span><span class="sc">;</span>
 901   <span class="s">}</span>
 902   <span class="k">elsif</span> <span class="s">(</span><span class="i">$Options</span>{<span class="w">indelim</span>} =~ <span class="q">/^tab$/i</span><span class="s">)</span> <span class="s">{</span>
 903     <span class="i">$OptionsInfo</span>{<span class="w">InDelim</span>} = <span class="q">&quot;\t&quot;</span><span class="sc">;</span>
 904   <span class="s">}</span>
 905 
 906   <span class="i">$OptionsInfo</span>{<span class="w">OutDelim</span>} = <span class="q">&quot;\,&quot;</span><span class="sc">;</span>
 907   <span class="k">if</span> <span class="s">(</span><span class="i">$Options</span>{<span class="w">outdelim</span>} =~ <span class="q">/^semicolon$/i</span><span class="s">)</span> <span class="s">{</span>
 908     <span class="i">$OptionsInfo</span>{<span class="w">OutDelim</span>} = <span class="q">&quot;\;&quot;</span><span class="sc">;</span>
 909   <span class="s">}</span>
 910   <span class="k">elsif</span> <span class="s">(</span><span class="i">$Options</span>{<span class="w">outdelim</span>} =~ <span class="q">/^tab$/i</span><span class="s">)</span> <span class="s">{</span>
 911     <span class="i">$OptionsInfo</span>{<span class="w">OutDelim</span>} = <span class="q">&quot;\t&quot;</span><span class="sc">;</span>
 912   <span class="s">}</span>
 913 
 914   <span class="i">$OptionsInfo</span>{<span class="w">OutQuote</span>} = <span class="s">(</span><span class="i">$Options</span>{<span class="w">quote</span>} =~ <span class="q">/^yes$/i</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 915 
 916   <span class="i">$OptionsInfo</span>{<span class="w">RegexIgnoreCase</span>} = <span class="s">(</span><span class="i">$Options</span>{<span class="w">regexignorecase</span>} =~ <span class="q">/^yes$/i</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 917 
 918   <span class="i">$OptionsInfo</span>{<span class="w">OutFileRoot</span>} = <span class="i">$Options</span>{<span class="w">root</span>} ? <span class="i">$Options</span>{<span class="w">root</span>} <span class="co">:</span> <span class="k">undef</span><span class="sc">;</span>
 919   <span class="i">$OptionsInfo</span>{<span class="w">Overwrite</span>} = <span class="i">$Options</span>{<span class="w">overwrite</span>} ? <span class="i">$Options</span>{<span class="w">overwrite</span>} <span class="co">:</span> <span class="k">undef</span><span class="sc">;</span>
 920 
 921   <span class="i">$OptionsInfo</span>{<span class="w">NumOfCmpds</span>} = <span class="i">$Options</span>{<span class="w">numofcmpds</span>}<span class="sc">;</span>
 922 
 923   <span class="i">$OptionsInfo</span>{<span class="w">ValueComparisonMode</span>} = <span class="i">$Options</span>{<span class="w">valuecomparisonmode</span>}<span class="sc">;</span>
 924   <span class="i">$OptionsInfo</span>{<span class="w">NumericalComparison</span>} = <span class="s">(</span><span class="i">$Options</span>{<span class="w">valuecomparisonmode</span>} =~ <span class="q">/^Numeric$/i</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 925 
 926   <span class="i">$OptionsInfo</span>{<span class="w">Violations</span>} = <span class="i">$Options</span>{<span class="w">violations</span>}<span class="sc">;</span>
 927   <span class="i">$OptionsInfo</span>{<span class="w">Seed</span>} = <span class="i">$Options</span>{<span class="w">seed</span>}<span class="sc">;</span>
 928 
 929 
 930   <span class="k">if</span> <span class="s">(</span><span class="i">$Options</span>{<span class="w">mode</span>} =~ <span class="q">/^(datafields|datafieldsbyregex|datafieldsbyvalue|datafieldbylist|datafielduniquebylist|datafieldnotbylist)$/i</span><span class="s">)</span> <span class="s">{</span>
 931     <span class="k">if</span> <span class="s">(</span><span class="i">$Options</span>{<span class="w">datafields</span>} || <span class="i">$Options</span>{<span class="w">datafieldsfile</span>}<span class="s">)</span> <span class="s">{</span>
 932       <span class="k">if</span> <span class="s">(</span><span class="i">$Options</span>{<span class="w">datafields</span>} &amp;&amp; <span class="i">$Options</span>{<span class="w">datafieldsfile</span>}<span class="s">)</span> <span class="s">{</span>
 933         <span class="k">die</span> <span class="q">&quot;Error: For \&quot;-m --mode\&quot; option values of datafields, datafieldsbyvalue, datafieldsbyregex, datafieldbylist, datafielduniquebylist, or datafieldnotbylist specify only one of the \&quot;-d --datafields\&quot; or \&quot;--datafieldsfile\&quot; option.\n&quot;</span><span class="sc">;</span>
 934       <span class="s">}</span>
 935     <span class="s">}</span>
 936     <span class="k">else</span> <span class="s">{</span>
 937       <span class="k">die</span> <span class="q">&quot;Error: For \&quot;-m --mode\&quot; option values of datafields, datafieldsbyvalue, datafieldsbyregex, datafieldbylist, datafielduniquebylist, or datafieldnotbylist specify one of the \&quot;-d --datafields\&quot; or \&quot;--datafieldsfile\&quot; option.\n&quot;</span><span class="sc">;</span>
 938     <span class="s">}</span>
 939   <span class="s">}</span>
 940   <span class="i">$OptionsInfo</span>{<span class="w">DataFields</span>} = <span class="i">$Options</span>{<span class="w">datafields</span>} ? <span class="i">$Options</span>{<span class="w">datafields</span>} <span class="co">:</span> <span class="k">undef</span><span class="sc">;</span>
 941   <span class="i">$OptionsInfo</span>{<span class="w">DataFieldsFile</span>} = <span class="i">$Options</span>{<span class="w">datafieldsfile</span>} ? <span class="i">$Options</span>{<span class="w">datafieldsfile</span>} <span class="co">:</span> <span class="k">undef</span><span class="sc">;</span>
 942 
 943   <span class="i">$OptionsInfo</span>{<span class="w">RecordNum</span>} = <span class="n">0</span><span class="sc">;</span> <span class="i">$OptionsInfo</span>{<span class="w">StartRecordNum</span>} = <span class="n">0</span><span class="sc">;</span> <span class="i">$OptionsInfo</span>{<span class="w">EndRecordNum</span>} = <span class="n">0</span><span class="sc">;</span>
 944 
 945   <span class="i">%</span>{<span class="i">$OptionsInfo</span>{<span class="w">RecordNums</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 946   <span class="i">$OptionsInfo</span>{<span class="w">RecordNumsMin</span>} = <span class="n">0</span><span class="sc">;</span> <span class="i">$OptionsInfo</span>{<span class="w">RecordNumsMax</span>} = <span class="n">0</span><span class="sc">;</span> <span class="i">$OptionsInfo</span>{<span class="w">RecordNumsCount</span>} = <span class="n">0</span><span class="sc">;</span>
 947 
 948   <span class="i">$OptionsInfo</span>{<span class="w">Record</span>} = <span class="i">$Options</span>{<span class="w">record</span>} ? <span class="i">$Options</span>{<span class="w">record</span>} <span class="co">:</span> <span class="k">undef</span><span class="sc">;</span>
 949 
 950   <span class="k">if</span> <span class="s">(</span><span class="i">$Options</span>{<span class="w">mode</span>} =~ <span class="q">/^(recordnum|recordnums|recordrange)$/i</span><span class="s">)</span> <span class="s">{</span>
 951     <span class="k">if</span> <span class="s">(</span><span class="i">$Options</span>{<span class="w">record</span>}<span class="s">)</span> <span class="s">{</span>
 952       <span class="k">my</span><span class="s">(</span><span class="i">$Record</span><span class="cm">,</span> <span class="i">@RecordSplit</span><span class="s">)</span><span class="sc">;</span>
 953 
 954       <span class="i">$Record</span> = <span class="i">$Options</span>{<span class="w">record</span>}<span class="sc">;</span>
 955       <span class="i">$Record</span> =~ <span class="q">s/ //g</span><span class="sc">;</span>
 956 
 957       <span class="i">@RecordSplit</span> = <span class="k">split</span> <span class="q">&quot;,&quot;</span><span class="cm">,</span> <span class="i">$Record</span><span class="sc">;</span>
 958 
 959       <span class="k">if</span> <span class="s">(</span><span class="i">$Options</span>{<span class="w">mode</span>} =~ <span class="q">/^recordnum$/i</span> <span class="s">)</span> <span class="s">{</span>
 960         <span class="k">if</span> <span class="s">(</span><span class="i">@RecordSplit</span> == <span class="n">1</span><span class="s">)</span> <span class="s">{</span>
 961           <span class="i">$OptionsInfo</span>{<span class="w">RecordNum</span>} = <span class="i">$RecordSplit</span>[<span class="n">0</span>]<span class="sc">;</span>
 962           <span class="k">if</span> <span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">RecordNum</span>} &lt;= <span class="n">0</span><span class="s">)</span> <span class="s">{</span>
 963             <span class="k">die</span> <span class="q">&quot;Error: The value specified, $OptionsInfo{RecordNum},  for option \&quot;--records\&quot; is not valid. Allowed values: &gt; 0 \n&quot;</span><span class="sc">;</span>
 964           <span class="s">}</span>
 965         <span class="s">}</span>
 966         <span class="k">else</span> <span class="s">{</span>
 967           <span class="k">die</span> <span class="q">&quot;Error: Invalid number of values, &quot;</span><span class="cm">,</span> <span class="k">scalar</span><span class="s">(</span><span class="i">@RecordSplit</span><span class="s">)</span><span class="cm">,</span> <span class="q">&quot;, specified using \&quot;--record\&quot; option: only 1 value is allowed.\n&quot;</span><span class="sc">;</span>
 968         <span class="s">}</span>
 969       <span class="s">}</span>
 970       <span class="k">elsif</span> <span class="s">(</span><span class="i">$Options</span>{<span class="w">mode</span>} =~ <span class="q">/^recordnums$/i</span> <span class="s">)</span> <span class="s">{</span>
 971         <span class="k">my</span><span class="s">(</span><span class="i">$RecordNum</span><span class="cm">,</span> <span class="i">$RecordCount</span><span class="cm">,</span> <span class="i">@SortedRecordSplit</span><span class="s">)</span><span class="sc">;</span>
 972 
 973         <span class="i">@SortedRecordSplit</span> = <span class="k">sort</span> <span class="s">{</span> <span class="i">$a</span> &lt;=&gt; <span class="i">$b</span> <span class="s">}</span> <span class="i">@RecordSplit</span><span class="sc">;</span>
 974 
 975         <span class="i">$RecordCount</span> = <span class="n">0</span><span class="sc">;</span>
 976         <span class="j">RECORDNUM:</span> <span class="k">for</span> <span class="i">$RecordNum</span> <span class="s">(</span><span class="i">@SortedRecordSplit</span><span class="s">)</span> <span class="s">{</span>
 977           <span class="k">if</span> <span class="s">(</span><span class="k">exists</span> <span class="i">$OptionsInfo</span>{<span class="w">RecordNums</span>}{<span class="i">$RecordNum</span>}<span class="s">)</span> <span class="s">{</span>
 978             <span class="k">next</span> <span class="j">RECORDNUM</span><span class="sc">;</span>
 979           <span class="s">}</span>
 980           <span class="i">$RecordCount</span>++<span class="sc">;</span>
 981           <span class="i">$OptionsInfo</span>{<span class="w">RecordNums</span>}{<span class="i">$RecordNum</span>} = <span class="i">$RecordNum</span><span class="sc">;</span>
 982         <span class="s">}</span>
 983         <span class="i">$OptionsInfo</span>{<span class="w">RecordNumsCount</span>} = <span class="i">$RecordCount</span><span class="sc">;</span>
 984         <span class="i">$OptionsInfo</span>{<span class="w">RecordNumsMin</span>} = <span class="i">$SortedRecordSplit</span>[<span class="n">0</span>]<span class="sc">;</span>
 985         <span class="i">$OptionsInfo</span>{<span class="w">RecordNumsMax</span>} = <span class="i">$SortedRecordSplit</span>[<span class="i">$#SortedRecordSplit</span>]<span class="sc">;</span>
 986       <span class="s">}</span>
 987       <span class="k">else</span> <span class="s">{</span>
 988         <span class="k">if</span> <span class="s">(</span><span class="i">@RecordSplit</span> == <span class="n">2</span><span class="s">)</span> <span class="s">{</span>
 989           <span class="i">$OptionsInfo</span>{<span class="w">StartRecordNum</span>} = <span class="i">$RecordSplit</span>[<span class="n">0</span>]<span class="sc">;</span>
 990           <span class="i">$OptionsInfo</span>{<span class="w">EndRecordNum</span>} = <span class="i">$RecordSplit</span>[<span class="n">1</span>]<span class="sc">;</span>
 991           <span class="k">if</span> <span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">StartRecordNum</span>} &lt;= <span class="n">0</span> || <span class="i">$OptionsInfo</span>{<span class="w">EndRecordNum</span>} &lt;= <span class="n">0</span><span class="s">)</span> <span class="s">{</span>
 992             <span class="k">die</span> <span class="q">&quot;Error: The value pair specified, $Options{record},  for option \&quot;--records\&quot; is not valid. Allowed values: &gt; 0 \n&quot;</span><span class="sc">;</span>
 993           <span class="s">}</span>
 994         <span class="s">}</span>
 995         <span class="k">else</span> <span class="s">{</span>
 996           <span class="k">die</span> <span class="q">&quot;Error: Invalid number of values, &quot;</span><span class="cm">,</span> <span class="k">scalar</span><span class="s">(</span><span class="i">@RecordSplit</span><span class="s">)</span><span class="cm">,</span> <span class="q">&quot;, specified using \&quot;--record\&quot; option: only 2 values is allowed.\n&quot;</span><span class="sc">;</span>
 997         <span class="s">}</span>
 998         <span class="k">if</span> <span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">StartRecordNum</span>} &gt; <span class="i">$OptionsInfo</span>{<span class="w">EndRecordNum</span>}<span class="s">)</span> <span class="s">{</span>
 999           <span class="k">die</span> <span class="q">&quot;Error: Start record number, $OptionsInfo{StartRecordNum}, must be smaller than end record number, $OptionsInfo{EndRecordNum}.\nSpecify different values using \&quot;--record\&quot; option.\n&quot;</span><span class="sc">;</span>
1000         <span class="s">}</span>
1001       <span class="s">}</span>
1002     <span class="s">}</span>
1003     <span class="k">else</span> <span class="s">{</span>
1004       <span class="k">die</span> <span class="q">&quot;Error: For \&quot;-m --mode\&quot; option values recordnum, recordnums or recordrange, specify \&quot;--record\&quot; option value.\n&quot;</span><span class="sc">;</span>
1005     <span class="s">}</span>
1006   <span class="s">}</span>
1007 
1008   <span class="i">@</span>{<span class="i">$OptionsInfo</span>{<span class="w">SpecifiedDataFieldLabels</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1009 
1010   <span class="k">my</span><span class="s">(</span><span class="i">@Words</span><span class="cm">,</span> <span class="i">$Line</span><span class="cm">,</span> <span class="i">$Value</span><span class="s">)</span><span class="sc">;</span>
1011   <span class="k">if</span> <span class="s">(</span><span class="i">$Options</span>{<span class="w">mode</span>} =~ <span class="q">/^datafields$/i</span><span class="s">)</span> <span class="s">{</span>
1012     <span class="i">@</span>{<span class="i">$OptionsInfo</span>{<span class="w">SpecifiedDataFieldLabels</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1013     <span class="k">if</span> <span class="s">(</span><span class="i">$Options</span>{<span class="w">datafields</span>}<span class="s">)</span> <span class="s">{</span>
1014       <span class="i">@</span>{<span class="i">$OptionsInfo</span>{<span class="w">SpecifiedDataFieldLabels</span>}} = <span class="k">split</span> <span class="i">$OptionsInfo</span>{<span class="w">InDelim</span>}<span class="cm">,</span> <span class="i">$Options</span>{<span class="w">datafields</span>}<span class="sc">;</span>
1015     <span class="s">}</span>
1016     <span class="k">elsif</span> <span class="s">(</span><span class="i">$Options</span>{<span class="w">datafieldsfile</span>}<span class="s">)</span> <span class="s">{</span>
1017       <span class="k">open</span> <span class="w">DATAFIELDSFILE</span><span class="cm">,</span> <span class="q">&quot;$Options{datafieldsfile}&quot;</span> <span class="k">or</span> <span class="k">die</span> <span class="q">&quot;Error: Couldn&#39;t open $Options{datafieldsfile}: $! \n&quot;</span><span class="sc">;</span>
1018       <span class="k">while</span> <span class="s">(</span><span class="i">$Line</span> = <span class="i">GetTextLine</span><span class="s">(</span>\<span class="i">*DATAFIELDSFILE</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1019         <span class="i">@Words</span> = <span class="i">quotewords</span><span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">InDelim</span>}<span class="cm">,</span> <span class="n">0</span><span class="cm">,</span> <span class="i">$Line</span><span class="s">)</span><span class="sc">;</span>
1020         <span class="k">if</span> <span class="s">(</span><span class="i">@Words</span><span class="s">)</span> <span class="s">{</span>
1021           <span class="k">push</span> <span class="i">@</span>{<span class="i">$OptionsInfo</span>{<span class="w">SpecifiedDataFieldLabels</span>}}<span class="cm">,</span> <span class="i">@Words</span><span class="sc">;</span>
1022         <span class="s">}</span>
1023       <span class="s">}</span>
1024       <span class="k">close</span> <span class="w">DATAFIELDSFILE</span><span class="sc">;</span>
1025     <span class="s">}</span>
1026   <span class="s">}</span>
1027   <span class="k">elsif</span> <span class="s">(</span><span class="i">$Options</span>{<span class="w">mode</span>} =~ <span class="q">/^datafieldsbyvalue$/i</span><span class="s">)</span> <span class="s">{</span>
1028     <span class="k">my</span><span class="s">(</span><span class="i">@DataFieldsByValueTriplets</span><span class="s">)</span><span class="sc">;</span>
1029     <span class="i">@DataFieldsByValueTriplets</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1030     <span class="k">if</span> <span class="s">(</span><span class="i">$Options</span>{<span class="w">datafields</span>}<span class="s">)</span> <span class="s">{</span>
1031       <span class="i">@DataFieldsByValueTriplets</span> = <span class="k">split</span> <span class="i">$OptionsInfo</span>{<span class="w">InDelim</span>}<span class="cm">,</span> <span class="i">$Options</span>{<span class="w">datafields</span>}<span class="sc">;</span>
1032     <span class="s">}</span>
1033     <span class="k">elsif</span> <span class="s">(</span><span class="i">$Options</span>{<span class="w">datafieldsfile</span>}<span class="s">)</span> <span class="s">{</span>
1034       <span class="k">open</span> <span class="w">DATAFIELDSFILE</span><span class="cm">,</span> <span class="q">&quot;$Options{datafieldsfile}&quot;</span> <span class="k">or</span> <span class="k">die</span> <span class="q">&quot;Error: Couldn&#39;t open $Options{datafieldsfile}: $! \n&quot;</span><span class="sc">;</span>
1035       <span class="k">while</span> <span class="s">(</span><span class="i">$Line</span> = <span class="i">GetTextLine</span><span class="s">(</span>\<span class="i">*DATAFIELDSFILE</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1036         <span class="i">@Words</span> = <span class="i">quotewords</span><span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">InDelim</span>}<span class="cm">,</span> <span class="n">0</span><span class="cm">,</span> <span class="i">$Line</span><span class="s">)</span><span class="sc">;</span>
1037         <span class="k">if</span> <span class="s">(</span><span class="i">@Words</span><span class="s">)</span> <span class="s">{</span>
1038           <span class="k">push</span> <span class="i">@DataFieldsByValueTriplets</span><span class="cm">,</span> <span class="i">@Words</span><span class="sc">;</span>
1039         <span class="s">}</span>
1040       <span class="s">}</span>
1041       <span class="k">close</span> <span class="w">DATAFIELDSFILE</span><span class="sc">;</span>
1042     <span class="s">}</span>
1043     <span class="k">if</span> <span class="s">(</span><span class="s">(</span><span class="i">@DataFieldsByValueTriplets</span> % <span class="n">3</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1044       <span class="k">if</span> <span class="s">(</span><span class="i">$Options</span>{<span class="w">datafields</span>}<span class="s">)</span> <span class="s">{</span>
1045         <span class="k">die</span> <span class="q">&quot;Error: Triplets not found in values specified by \&quot;-d --datafields\&quot; option\n&quot;</span><span class="sc">;</span>
1046       <span class="s">}</span>
1047       <span class="k">elsif</span> <span class="s">(</span><span class="i">$Options</span>{<span class="w">datafieldsfile</span>}<span class="s">)</span> <span class="s">{</span>
1048         <span class="k">die</span> <span class="q">&quot;Error: Triplets not found in values specified by \&quot;--datafieldsfile\&quot; option\n&quot;</span><span class="sc">;</span>
1049       <span class="s">}</span>
1050     <span class="s">}</span>
1051     <span class="k">my</span><span class="s">(</span><span class="i">$Index</span><span class="cm">,</span> <span class="i">$Label</span><span class="cm">,</span> <span class="i">$Value</span><span class="cm">,</span> <span class="i">$Criterion</span><span class="s">)</span><span class="sc">;</span>
1052 
1053     <span class="i">@</span>{<span class="i">$OptionsInfo</span>{<span class="w">SpecifiedDataFieldLabels</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1054     <span class="i">%</span>{<span class="i">$OptionsInfo</span>{<span class="w">SpecifiedDataFieldValuesMap</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1055     <span class="i">%</span>{<span class="i">$OptionsInfo</span>{<span class="w">SpecifiedDataFieldCriteriaMap</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1056 
1057     <span class="k">for</span> <span class="s">(</span><span class="i">$Index</span> = <span class="n">0</span><span class="sc">;</span> <span class="i">$Index</span> &lt; <span class="i">@DataFieldsByValueTriplets</span><span class="sc">;</span> <span class="i">$Index</span> = <span class="i">$Index</span> + <span class="n">3</span><span class="s">)</span> <span class="s">{</span>
1058       <span class="i">$Label</span> = <span class="i">$DataFieldsByValueTriplets</span>[<span class="i">$Index</span>]<span class="sc">;</span>
1059       <span class="i">$Value</span> = <span class="i">$DataFieldsByValueTriplets</span>[<span class="i">$Index</span> + <span class="n">1</span>]<span class="sc">;</span>
1060       <span class="i">$Criterion</span> = <span class="i">$DataFieldsByValueTriplets</span>[<span class="i">$Index</span> + <span class="n">2</span>]<span class="sc">;</span>
1061 
1062       <span class="k">if</span> <span class="s">(</span><span class="i">$Criterion</span> =~ <span class="q">/^(eq|le|ge)$/i</span><span class="s">)</span> <span class="s">{</span>
1063         <span class="k">push</span> <span class="i">@</span>{<span class="i">$OptionsInfo</span>{<span class="w">SpecifiedDataFieldLabels</span>}}<span class="cm">,</span> <span class="i">$Label</span><span class="sc">;</span>
1064         <span class="i">$OptionsInfo</span>{<span class="w">SpecifiedDataFieldValuesMap</span>}{<span class="i">$Label</span>} = <span class="i">$Value</span><span class="sc">;</span>
1065         <span class="i">$OptionsInfo</span>{<span class="w">SpecifiedDataFieldCriteriaMap</span>}{<span class="i">$Label</span>} = <span class="i">$Criterion</span><span class="sc">;</span>
1066       <span class="s">}</span>
1067       <span class="k">else</span> <span class="s">{</span>
1068         <span class="k">warn</span> <span class="q">&quot;Warning: Ignoring triplet value, $Label $Value $Criterion , specified using \&quot;-d --datafields\&quot; or \&quot;--datafieldsfile\&quot; option: Invalid criterion value: $Criterion\n&quot;</span><span class="sc">;</span>
1069       <span class="s">}</span>
1070     <span class="s">}</span>
1071   <span class="s">}</span>
1072   <span class="k">elsif</span> <span class="s">(</span><span class="i">$Options</span>{<span class="w">mode</span>} =~ <span class="q">/^datafieldsbyregex$/i</span><span class="s">)</span> <span class="s">{</span>
1073     <span class="k">my</span><span class="s">(</span><span class="i">@DataFieldsByRegexTriplets</span><span class="s">)</span><span class="sc">;</span>
1074 
1075     <span class="i">@DataFieldsByRegexTriplets</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1076     <span class="k">if</span> <span class="s">(</span><span class="i">$Options</span>{<span class="w">datafields</span>}<span class="s">)</span> <span class="s">{</span>
1077       <span class="i">@DataFieldsByRegexTriplets</span> = <span class="i">quotewords</span><span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">InDelim</span>}<span class="cm">,</span> <span class="n">0</span><span class="cm">,</span> <span class="i">$Options</span>{<span class="w">datafields</span>}<span class="s">)</span><span class="sc">;</span>
1078     <span class="s">}</span>
1079     <span class="k">elsif</span> <span class="s">(</span><span class="i">$Options</span>{<span class="w">datafieldsfile</span>}<span class="s">)</span> <span class="s">{</span>
1080       <span class="k">open</span> <span class="w">DATAFIELDSFILE</span><span class="cm">,</span> <span class="q">&quot;$Options{datafieldsfile}&quot;</span> <span class="k">or</span> <span class="k">die</span> <span class="q">&quot;Error: Couldn&#39;t open $Options{datafieldsfile}: $! \n&quot;</span><span class="sc">;</span>
1081       <span class="k">while</span> <span class="s">(</span><span class="i">$Line</span> = <span class="i">GetTextLine</span><span class="s">(</span>\<span class="i">*DATAFIELDSFILE</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1082           <span class="i">@Words</span> = <span class="i">quotewords</span><span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">InDelim</span>}<span class="cm">,</span> <span class="n">0</span><span class="cm">,</span> <span class="i">$Line</span><span class="s">)</span><span class="sc">;</span>
1083           <span class="k">if</span> <span class="s">(</span><span class="i">@Words</span><span class="s">)</span> <span class="s">{</span>
1084             <span class="k">push</span> <span class="i">@DataFieldsByRegexTriplets</span><span class="cm">,</span> <span class="i">@Words</span><span class="sc">;</span>
1085           <span class="s">}</span>
1086       <span class="s">}</span>
1087       <span class="k">close</span> <span class="w">DATAFIELDSFILE</span><span class="sc">;</span>
1088     <span class="s">}</span>
1089     <span class="k">if</span> <span class="s">(</span><span class="s">(</span><span class="i">@DataFieldsByRegexTriplets</span> % <span class="n">3</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1090       <span class="k">if</span> <span class="s">(</span><span class="i">$Options</span>{<span class="w">datafields</span>}<span class="s">)</span> <span class="s">{</span>
1091           <span class="k">die</span> <span class="q">&quot;Error: Triplet not found in values specified by \&quot;-d --datafields\&quot; option\n&quot;</span><span class="sc">;</span>
1092       <span class="s">}</span>
1093       <span class="k">elsif</span> <span class="s">(</span><span class="i">$Options</span>{<span class="w">datafieldsfile</span>}<span class="s">)</span> <span class="s">{</span>
1094           <span class="k">die</span> <span class="q">&quot;Error: Triplet not found in values specified by \&quot;--datafieldsfile\&quot; option\n&quot;</span><span class="sc">;</span>
1095       <span class="s">}</span>
1096     <span class="s">}</span>
1097 
1098     <span class="k">my</span><span class="s">(</span><span class="i">$Index</span><span class="cm">,</span> <span class="i">$Label</span><span class="cm">,</span> <span class="i">$Value</span><span class="cm">,</span> <span class="i">$Criterion</span><span class="s">)</span><span class="sc">;</span>
1099 
1100     <span class="i">@</span>{<span class="i">$OptionsInfo</span>{<span class="w">SpecifiedDataFieldLabels</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1101     <span class="i">%</span>{<span class="i">$OptionsInfo</span>{<span class="w">SpecifiedDataFieldRegexMap</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1102     <span class="i">%</span>{<span class="i">$OptionsInfo</span>{<span class="w">SpecifiedDataFieldRegexCriteriaMap</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1103 
1104     <span class="k">for</span> <span class="s">(</span><span class="i">$Index</span> = <span class="n">0</span><span class="sc">;</span> <span class="i">$Index</span> &lt; <span class="i">@DataFieldsByRegexTriplets</span><span class="sc">;</span> <span class="i">$Index</span> = <span class="i">$Index</span> + <span class="n">3</span><span class="s">)</span> <span class="s">{</span>
1105       <span class="i">$Label</span> = <span class="i">$DataFieldsByRegexTriplets</span>[<span class="i">$Index</span>]<span class="sc">;</span>
1106       <span class="i">$Value</span> = <span class="i">$DataFieldsByRegexTriplets</span>[<span class="i">$Index</span> + <span class="n">1</span>]<span class="sc">;</span>
1107       <span class="i">$Criterion</span> = <span class="i">$DataFieldsByRegexTriplets</span>[<span class="i">$Index</span> + <span class="n">2</span>]<span class="sc">;</span>
1108 
1109       <span class="k">if</span> <span class="s">(</span><span class="i">$Criterion</span> =~ <span class="q">/^(eq|ne)$/i</span><span class="s">)</span> <span class="s">{</span>
1110           <span class="k">push</span> <span class="i">@</span>{<span class="i">$OptionsInfo</span>{<span class="w">SpecifiedDataFieldLabels</span>}}<span class="cm">,</span> <span class="i">$Label</span><span class="sc">;</span>
1111           <span class="i">$OptionsInfo</span>{<span class="w">SpecifiedDataFieldRegexMap</span>}{<span class="i">$Label</span>} = <span class="i">$Value</span><span class="sc">;</span>
1112           <span class="i">$OptionsInfo</span>{<span class="w">SpecifiedDataFieldRegexCriteriaMap</span>}{<span class="i">$Label</span>} = <span class="i">$Criterion</span><span class="sc">;</span>
1113       <span class="s">}</span>
1114       <span class="k">else</span> <span class="s">{</span>
1115           <span class="k">warn</span> <span class="q">&quot;Warning: Ignoring triplet value, $Label $Value $Criterion , specified using \&quot;-d --datafields\&quot; or \&quot;--datafieldsfile\&quot; option: Invalid criterion value: $Criterion; Supported values: eq or ne\n&quot;</span><span class="sc">;</span>
1116       <span class="s">}</span>
1117     <span class="s">}</span>
1118   <span class="s">}</span>
1119   <span class="k">elsif</span> <span class="s">(</span><span class="i">$Options</span>{<span class="w">mode</span>} =~ <span class="q">/^(datafieldbylist|datafielduniquebylist|datafieldnotbylist)$/i</span><span class="s">)</span> <span class="s">{</span>
1120     <span class="k">my</span><span class="s">(</span><span class="i">$Index</span><span class="cm">,</span> <span class="i">@DataFieldAndValuesList</span><span class="s">)</span><span class="sc">;</span>
1121     <span class="k">if</span> <span class="s">(</span><span class="i">$Options</span>{<span class="w">datafields</span>}<span class="s">)</span> <span class="s">{</span>
1122       <span class="i">@DataFieldAndValuesList</span> = <span class="k">split</span> <span class="i">$OptionsInfo</span>{<span class="w">InDelim</span>}<span class="cm">,</span> <span class="i">$Options</span>{<span class="w">datafields</span>}<span class="sc">;</span>
1123     <span class="s">}</span>
1124     <span class="k">elsif</span> <span class="s">(</span><span class="i">$Options</span>{<span class="w">datafieldsfile</span>}<span class="s">)</span> <span class="s">{</span>
1125       <span class="k">open</span> <span class="w">DATAFIELDSFILE</span><span class="cm">,</span> <span class="q">&quot;$Options{datafieldsfile}&quot;</span> <span class="k">or</span> <span class="k">die</span> <span class="q">&quot;Error: Couldn&#39;t open $Options{datafieldsfile}: $! \n&quot;</span><span class="sc">;</span>
1126       <span class="k">while</span> <span class="s">(</span><span class="i">$Line</span> = <span class="i">GetTextLine</span><span class="s">(</span>\<span class="i">*DATAFIELDSFILE</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1127         <span class="i">@Words</span> = <span class="i">quotewords</span><span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">InDelim</span>}<span class="cm">,</span> <span class="n">0</span><span class="cm">,</span> <span class="i">$Line</span><span class="s">)</span><span class="sc">;</span>
1128         <span class="k">if</span> <span class="s">(</span><span class="i">@Words</span><span class="s">)</span> <span class="s">{</span>
1129           <span class="k">push</span> <span class="i">@DataFieldAndValuesList</span><span class="cm">,</span> <span class="i">@Words</span><span class="sc">;</span>
1130         <span class="s">}</span>
1131       <span class="s">}</span>
1132       <span class="k">close</span> <span class="w">DATAFIELDSFILE</span><span class="sc">;</span>
1133     <span class="s">}</span>
1134     <span class="k">if</span> <span class="s">(</span><span class="i">@DataFieldAndValuesList</span> &lt; <span class="n">2</span><span class="s">)</span> <span class="s">{</span>
1135       <span class="k">if</span> <span class="s">(</span><span class="i">$Options</span>{<span class="w">datafields</span>}<span class="s">)</span> <span class="s">{</span>
1136         <span class="k">die</span> <span class="q">&quot;Error: Invalid number of values specified by \&quot;-d --datafields\&quot; option\n&quot;</span><span class="sc">;</span>
1137       <span class="s">}</span>
1138       <span class="k">elsif</span> <span class="s">(</span><span class="i">$Options</span>{<span class="w">datafieldsfile</span>}<span class="s">)</span> <span class="s">{</span>
1139         <span class="k">die</span> <span class="q">&quot;Error: Invalid number values specified by \&quot;--datafieldsfile\&quot; option\n&quot;</span><span class="sc">;</span>
1140       <span class="s">}</span>
1141     <span class="s">}</span>
1142 
1143     <span class="i">$OptionsInfo</span>{<span class="w">SpecifiedDataFieldLabel</span>} = <span class="i">$DataFieldAndValuesList</span>[<span class="n">0</span>]<span class="sc">;</span>
1144     <span class="i">$OptionsInfo</span>{<span class="w">SpecifiedDataFieldValuesCount</span>} = <span class="i">@DataFieldAndValuesList</span> - <span class="n">1</span><span class="sc">;</span>
1145     <span class="i">%</span>{<span class="i">$OptionsInfo</span>{<span class="w">SpecifiedDataFieldValues</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1146 
1147     <span class="k">for</span> <span class="s">(</span><span class="i">$Index</span> = <span class="n">1</span><span class="sc">;</span> <span class="i">$Index</span> &lt; <span class="i">@DataFieldAndValuesList</span><span class="sc">;</span> <span class="i">$Index</span>++<span class="s">)</span> <span class="s">{</span>
1148       <span class="i">$Value</span> = <span class="i">$DataFieldAndValuesList</span>[<span class="i">$Index</span>]<span class="sc">;</span>
1149       <span class="i">$OptionsInfo</span>{<span class="w">SpecifiedDataFieldValues</span>}{<span class="i">$Value</span>} = <span class="q">&quot;NotFound&quot;</span><span class="sc">;</span>
1150     <span class="s">}</span>
1151   <span class="s">}</span>
1152 
1153   <span class="i">$OptionsInfo</span>{<span class="w">SDFileExt</span>} = <span class="q">&quot;sdf&quot;</span><span class="sc">;</span>
1154   <span class="i">$OptionsInfo</span>{<span class="w">TextFileExt</span>} = <span class="q">&quot;csv&quot;</span><span class="sc">;</span>
1155 
1156   <span class="k">if</span> <span class="s">(</span><span class="i">$Options</span>{<span class="w">outdelim</span>} =~ <span class="q">/^tab$/i</span><span class="s">)</span> <span class="s">{</span>
1157     <span class="i">$OptionsInfo</span>{<span class="w">TextFileExt</span>} = <span class="q">&quot;tsv&quot;</span><span class="sc">;</span>
1158   <span class="s">}</span>
1159 
1160   <span class="k">if</span> <span class="s">(</span><span class="i">$Options</span>{<span class="w">mode</span>} =~ <span class="q">/^(alldatafields|molnames)$/i</span><span class="s">)</span> <span class="s">{</span>
1161     <span class="i">$OptionsInfo</span>{<span class="w">OutputSDFile</span>} = <span class="n">0</span><span class="sc">;</span>
1162     <span class="i">$OptionsInfo</span>{<span class="w">OutputTextFile</span>} = <span class="n">1</span><span class="sc">;</span>
1163   <span class="s">}</span>
1164   <span class="k">else</span> <span class="s">{</span>
1165     <span class="i">$OptionsInfo</span>{<span class="w">OutputSDFile</span>} = <span class="s">(</span><span class="i">$Options</span>{<span class="w">output</span>} =~ <span class="q">/^(SD|both)$/i</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1166     <span class="i">$OptionsInfo</span>{<span class="w">OutputTextFile</span>} = <span class="s">(</span><span class="i">$Options</span>{<span class="w">output</span>} =~ <span class="q">/^(text|both)$/i</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1167   <span class="s">}</span>
1168 
1169   <span class="i">$OptionsInfo</span>{<span class="w">StrDataString</span>} = <span class="i">$Options</span>{<span class="w">strdatastring</span>}<span class="sc">;</span>
1170   <span class="i">$OptionsInfo</span>{<span class="w">OutputStrDataString</span>} = <span class="s">(</span><span class="i">$Options</span>{<span class="w">strdatastring</span>} =~ <span class="q">/^Yes$/i</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1171 
1172   <span class="i">$OptionsInfo</span>{<span class="w">StrDataStringDelimiter</span>} = <span class="i">$Options</span>{<span class="w">strdatastringdelimiter</span>}<span class="sc">;</span>
1173 
1174   <span class="k">if</span> <span class="s">(</span><span class="i">IsEmpty</span><span class="s">(</span><span class="i">$Options</span>{<span class="w">strdatastringdelimiter</span>}<span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1175     <span class="k">die</span> <span class="q">&quot;Error: No value specified for \&quot;--StrDataStringDelimiter\&quot; option.\n&quot;</span><span class="sc">;</span>
1176   <span class="s">}</span>
1177   <span class="i">$OptionsInfo</span>{<span class="w">StrDataStringMode</span>} = <span class="i">$Options</span>{<span class="w">strdatastringmode</span>}<span class="sc">;</span>
1178   <span class="i">$OptionsInfo</span>{<span class="w">StrDataStringWithFields</span>} = <span class="i">$Options</span>{<span class="w">strdatastringmode</span>} =~ <span class="q">/^StrAndDataFields$/i</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1179 
1180   <span class="j">MODE:</span> <span class="s">{</span>
1181     <span class="k">if</span> <span class="s">(</span><span class="i">$Options</span>{<span class="w">mode</span>} =~ <span class="q">/^alldatafields$/i</span><span class="s">)</span> <span class="s">{</span> <span class="i">$OptionsInfo</span>{<span class="w">FileNameMode</span>} = <span class="q">&quot;AllDataDields&quot;</span><span class="sc">;</span> <span class="k">last</span> <span class="j">MODE</span><span class="sc">;</span> <span class="s">}</span>
1182     <span class="k">if</span> <span class="s">(</span><span class="i">$Options</span>{<span class="w">mode</span>} =~ <span class="q">/^commondatafields$/i</span><span class="s">)</span> <span class="s">{</span> <span class="i">$OptionsInfo</span>{<span class="w">FileNameMode</span>} = <span class="q">&quot;CommonDataDields&quot;</span><span class="sc">;</span> <span class="k">last</span> <span class="j">MODE</span><span class="sc">;</span> <span class="s">}</span>
1183     <span class="k">if</span> <span class="s">(</span><span class="i">$Options</span>{<span class="w">mode</span>} =~ <span class="q">/^datafields$/i</span><span class="s">)</span> <span class="s">{</span> <span class="i">$OptionsInfo</span>{<span class="w">FileNameMode</span>} = <span class="q">&quot;SpecifiedDataFields&quot;</span><span class="sc">;</span> <span class="k">last</span> <span class="j">MODE</span><span class="sc">;</span> <span class="s">}</span>
1184     <span class="k">if</span> <span class="s">(</span><span class="i">$Options</span>{<span class="w">mode</span>} =~ <span class="q">/^datafieldsbyvalue$/i</span><span class="s">)</span> <span class="s">{</span> <span class="i">$OptionsInfo</span>{<span class="w">FileNameMode</span>} = <span class="q">&quot;SpecifiedDataFieldsByValue&quot;</span><span class="sc">;</span> <span class="k">last</span> <span class="j">MODE</span><span class="sc">;</span> <span class="s">}</span>
1185     <span class="k">if</span> <span class="s">(</span><span class="i">$Options</span>{<span class="w">mode</span>} =~ <span class="q">/^datafieldsbyregex$/i</span><span class="s">)</span> <span class="s">{</span> <span class="i">$OptionsInfo</span>{<span class="w">FileNameMode</span>} = <span class="q">&quot;SpecifiedDataFieldsByRegex&quot;</span><span class="sc">;</span> <span class="k">last</span> <span class="j">MODE</span><span class="sc">;</span> <span class="s">}</span>
1186     <span class="k">if</span> <span class="s">(</span><span class="i">$Options</span>{<span class="w">mode</span>} =~ <span class="q">/^datafieldbylist$/i</span><span class="s">)</span> <span class="s">{</span> <span class="i">$OptionsInfo</span>{<span class="w">FileNameMode</span>} = <span class="q">&quot;SpecifiedDataField&quot;</span><span class="sc">;</span> <span class="k">last</span> <span class="j">MODE</span><span class="sc">;</span> <span class="s">}</span>
1187     <span class="k">if</span> <span class="s">(</span><span class="i">$Options</span>{<span class="w">mode</span>} =~ <span class="q">/^datafielduniquebylist$/i</span><span class="s">)</span> <span class="s">{</span> <span class="i">$OptionsInfo</span>{<span class="w">FileNameMode</span>} = <span class="q">&quot;SpecifiedUniqueDataField&quot;</span><span class="sc">;</span> <span class="k">last</span> <span class="j">MODE</span><span class="sc">;</span> <span class="s">}</span>
1188     <span class="k">if</span> <span class="s">(</span><span class="i">$Options</span>{<span class="w">mode</span>} =~ <span class="q">/^datafieldnotbylist$/i</span><span class="s">)</span> <span class="s">{</span> <span class="i">$OptionsInfo</span>{<span class="w">FileNameMode</span>} = <span class="q">&quot;SpecifiedDataFieldNotByList&quot;</span><span class="sc">;</span> <span class="k">last</span> <span class="j">MODE</span><span class="sc">;</span> <span class="s">}</span>
1189     <span class="k">if</span> <span class="s">(</span><span class="i">$Options</span>{<span class="w">mode</span>} =~ <span class="q">/^molnames$/i</span><span class="s">)</span> <span class="s">{</span> <span class="i">$OptionsInfo</span>{<span class="w">FileNameMode</span>} = <span class="q">&quot;MolName&quot;</span><span class="sc">;</span> <span class="k">last</span> <span class="j">MODE</span><span class="sc">;</span> <span class="s">}</span>
1190     <span class="k">if</span> <span class="s">(</span><span class="i">$Options</span>{<span class="w">mode</span>} =~ <span class="q">/^randomcmpds$/i</span><span class="s">)</span> <span class="s">{</span> <span class="i">$OptionsInfo</span>{<span class="w">FileNameMode</span>} = <span class="q">&quot;RandomCmpds&quot;</span><span class="sc">;</span> <span class="k">last</span> <span class="j">MODE</span><span class="sc">;</span> <span class="s">}</span>
1191     <span class="k">if</span> <span class="s">(</span><span class="i">$Options</span>{<span class="w">mode</span>} =~ <span class="q">/^recordnum$/i</span><span class="s">)</span> <span class="s">{</span> <span class="i">$OptionsInfo</span>{<span class="w">FileNameMode</span>} = <span class="q">&quot;RecordNum$OptionsInfo{RecordNum}&quot;</span><span class="sc">;</span> <span class="k">last</span> <span class="j">MODE</span><span class="sc">;</span> <span class="s">}</span>
1192     <span class="k">if</span> <span class="s">(</span><span class="i">$Options</span>{<span class="w">mode</span>} =~ <span class="q">/^recordnums$/i</span><span class="s">)</span> <span class="s">{</span> <span class="i">$OptionsInfo</span>{<span class="w">FileNameMode</span>} = <span class="q">&quot;RecordNums&quot;</span><span class="sc">;</span> <span class="k">last</span> <span class="j">MODE</span><span class="sc">;</span> <span class="s">}</span>
1193     <span class="k">if</span> <span class="s">(</span><span class="i">$Options</span>{<span class="w">mode</span>} =~ <span class="q">/^recordrange$/i</span><span class="s">)</span> <span class="s">{</span> <span class="i">$OptionsInfo</span>{<span class="w">FileNameMode</span>} = <span class="q">&quot;RecordNum$OptionsInfo{StartRecordNum}&quot;</span> . <span class="q">&quot;To&quot;</span> . <span class="q">&quot;$OptionsInfo{EndRecordNum}&quot;</span><span class="sc">;</span> <span class="k">last</span> <span class="j">MODE</span><span class="sc">;</span> <span class="s">}</span>
1194     <span class="k">if</span> <span class="s">(</span><span class="i">$Options</span>{<span class="w">mode</span>} =~ <span class="q">/^2dcmpdrecords$/i</span><span class="s">)</span> <span class="s">{</span> <span class="i">$OptionsInfo</span>{<span class="w">FileNameMode</span>} = <span class="q">&quot;2DCmpdRecords&quot;</span><span class="sc">;</span> <span class="k">last</span> <span class="j">MODE</span><span class="sc">;</span> <span class="s">}</span>
1195     <span class="k">if</span> <span class="s">(</span><span class="i">$Options</span>{<span class="w">mode</span>} =~ <span class="q">/^3dcmpdrecords$/i</span><span class="s">)</span> <span class="s">{</span> <span class="i">$OptionsInfo</span>{<span class="w">FileNameMode</span>} = <span class="q">&quot;3DCmpdRecords&quot;</span><span class="sc">;</span> <span class="k">last</span> <span class="j">MODE</span><span class="sc">;</span> <span class="s">}</span>
1196     <span class="k">die</span> <span class="q">&quot;Error: The value specified, $Options{mode}, for option \&quot;-m --mode\&quot; is not valid. Allowed values: alldatafields, commondatafields, datafields, datafieldsbyvalue, datafieldbylist, datafielduniquebylist, , datafieldnotbylist, molnames, randomcmpds, recordnum, recordnums, recordrange, 2dcmpdrecords, 3dcmpdrecords\n&quot;</span><span class="sc">;</span>
1197   <span class="s">}</span>
1198 
1199 <span class="s">}</span>
1200 
1201 <span class="c"># Setup script usage  and retrieve command line arguments specified using various options...</span>
<a name="SetupScriptUsage-"></a>1202 <span class="k">sub </span><span class="m">SetupScriptUsage</span> <span class="s">{</span>
1203 
1204   <span class="c"># Retrieve all the options...</span>
1205   <span class="i">%Options</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1206   <span class="i">$Options</span>{<span class="w">numofcmpds</span>} = <span class="n">1</span><span class="sc">;</span>
1207   <span class="i">$Options</span>{<span class="w">mode</span>} = <span class="q">&quot;alldatafields&quot;</span><span class="sc">;</span>
1208   <span class="i">$Options</span>{<span class="w">indelim</span>} = <span class="q">&quot;comma&quot;</span><span class="sc">;</span>
1209   <span class="i">$Options</span>{<span class="w">outdelim</span>} = <span class="q">&quot;comma&quot;</span><span class="sc">;</span>
1210   <span class="i">$Options</span>{<span class="w">output</span>} = <span class="q">&quot;SD&quot;</span><span class="sc">;</span>
1211   <span class="i">$Options</span>{<span class="w">quote</span>} = <span class="q">&quot;yes&quot;</span><span class="sc">;</span>
1212   <span class="i">$Options</span>{<span class="w">regexignorecase</span>} = <span class="q">&quot;yes&quot;</span><span class="sc">;</span>
1213   <span class="i">$Options</span>{<span class="w">valuecomparisonmode</span>} = <span class="q">&quot;numeric&quot;</span><span class="sc">;</span>
1214   <span class="i">$Options</span>{<span class="w">violations</span>} = <span class="n">0</span><span class="sc">;</span>
1215   <span class="i">$Options</span>{<span class="w">seed</span>} = <span class="n">123456789</span><span class="sc">;</span>
1216 
1217   <span class="i">$Options</span>{<span class="w">strdatastring</span>} = <span class="q">&quot;no&quot;</span><span class="sc">;</span>
1218   <span class="i">$Options</span>{<span class="w">strdatastringdelimiter</span>} = <span class="q">&quot;|&quot;</span><span class="sc">;</span>
1219   <span class="i">$Options</span>{<span class="w">strdatastringmode</span>} = <span class="q">&quot;StrOnly&quot;</span><span class="sc">;</span>
1220 
1221   <span class="k">if</span> <span class="s">(</span>!<span class="i">GetOptions</span><span class="s">(</span>\<span class="i">%Options</span><span class="cm">,</span> <span class="q">&quot;help|h&quot;</span><span class="cm">,</span> <span class="q">&quot;datafields|d=s&quot;</span><span class="cm">,</span> <span class="q">&quot;datafieldsfile=s&quot;</span><span class="cm">,</span> <span class="q">&quot;indelim=s&quot;</span><span class="cm">,</span> <span class="q">&quot;mode|m=s&quot;</span><span class="cm">,</span> <span class="q">&quot;numofcmpds|n=i&quot;</span><span class="cm">,</span> <span class="q">&quot;outdelim=s&quot;</span><span class="cm">,</span> <span class="q">&quot;output=s&quot;</span><span class="cm">,</span> <span class="q">&quot;overwrite|o&quot;</span><span class="cm">,</span> <span class="q">&quot;quote|q=s&quot;</span><span class="cm">,</span> <span class="q">&quot;regexignorecase=s&quot;</span><span class="cm">,</span> <span class="q">&quot;record=s&quot;</span><span class="cm">,</span> <span class="q">&quot;root|r=s&quot;</span><span class="cm">,</span> <span class="q">&quot;seed|s=i&quot;</span><span class="cm">,</span> <span class="q">&quot;strdatastring=s&quot;</span><span class="cm">,</span> <span class="q">&quot;strdatastringdelimiter=s&quot;</span><span class="cm">,</span> <span class="q">&quot;strdatastringmode=s&quot;</span><span class="cm">,</span> <span class="q">&quot;valuecomparisonmode=s&quot;</span><span class="cm">,</span> <span class="q">&quot;violations|v=i&quot;</span><span class="cm">,</span> <span class="q">&quot;workingdir|w=s&quot;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1222     <span class="k">die</span> <span class="q">&quot;\nTo get a list of valid options and their values, use \&quot;$ScriptName -h\&quot; or\n\&quot;perl -S $ScriptName -h\&quot; command and try again...\n&quot;</span><span class="sc">;</span>
1223   <span class="s">}</span>
1224   <span class="k">if</span> <span class="s">(</span><span class="i">$Options</span>{<span class="w">workingdir</span>}<span class="s">)</span> <span class="s">{</span>
1225     <span class="k">if</span> <span class="s">(</span>! <span class="k">-d</span> <span class="i">$Options</span>{<span class="w">workingdir</span>}<span class="s">)</span> <span class="s">{</span>
1226       <span class="k">die</span> <span class="q">&quot;Error: The value specified, $Options{workingdir}, for option \&quot;-w --workingdir\&quot; is not a directory name.\n&quot;</span><span class="sc">;</span>
1227     <span class="s">}</span>
1228     <span class="k">chdir</span> <span class="i">$Options</span>{<span class="w">workingdir</span>} <span class="k">or</span> <span class="k">die</span> <span class="q">&quot;Error: Couldn&#39;t chdir $Options{workingdir}: $! \n&quot;</span><span class="sc">;</span>
1229   <span class="s">}</span>
1230   <span class="k">if</span> <span class="s">(</span><span class="i">$Options</span>{<span class="w">numofcmpds</span>} &lt; <span class="n">1</span><span class="s">)</span> <span class="s">{</span>
1231     <span class="k">die</span> <span class="q">&quot;Error: The value specified, $Options{numofcmpds},  for option \&quot;-n --numofcmpds\&quot; is not valid. Allowed values: &gt;= 1 \n&quot;</span><span class="sc">;</span>
1232   <span class="s">}</span>
1233   <span class="k">if</span> <span class="s">(</span><span class="i">$Options</span>{<span class="w">valuecomparisonmode</span>} !~ <span class="q">/^(Numeric|Alphanumeric)$/i</span><span class="s">)</span> <span class="s">{</span>
1234     <span class="k">die</span> <span class="q">&quot;Error: The value specified, $Options{valuecomparisonmode}, for option \&quot;--ValueComparisonMode\&quot; is not valid. Allowed values: Numeric or Alphanumeric\n&quot;</span><span class="sc">;</span>
1235   <span class="s">}</span>
1236   <span class="k">if</span> <span class="s">(</span><span class="i">$Options</span>{<span class="w">violations</span>} &lt; <span class="n">0</span><span class="s">)</span> <span class="s">{</span>
1237     <span class="k">die</span> <span class="q">&quot;Error: The value specified, $Options{violations},  for option \&quot;-v --violations\&quot; is not valid. Allowed values: &gt;= 0 \n&quot;</span><span class="sc">;</span>
1238   <span class="s">}</span>
1239   <span class="k">if</span> <span class="s">(</span><span class="i">$Options</span>{<span class="w">mode</span>} !~ <span class="q">/^(alldatafields|commondatafields|datafields|datafieldsbyvalue|datafieldsbyregex|datafieldbylist|datafielduniquebylist|datafieldnotbylist|molnames|randomcmpds|recordnum|recordnums|recordrange|2dcmpdrecords|3dcmpdrecords)$/i</span><span class="s">)</span> <span class="s">{</span>
1240     <span class="k">die</span> <span class="q">&quot;Error: The value specified, $Options{mode}, for option \&quot;-m --mode\&quot; is not valid. Allowed values: alldatafields, commondatafields, datafields, datafieldsbyvalue, datafieldbylist, datafielduniquebylist, datafieldnotbylist, molnames, randomcmpds, recordnum, recordnums, recordrange, 2dcmpdrecords, 3dcmpdrecords\n&quot;</span><span class="sc">;</span>
1241   <span class="s">}</span>
1242   <span class="k">if</span> <span class="s">(</span><span class="i">$Options</span>{<span class="w">output</span>} !~ <span class="q">/^(SD|text|both)$/i</span><span class="s">)</span> <span class="s">{</span>
1243     <span class="k">die</span> <span class="q">&quot;Error: The value specified, $Options{output}, for option \&quot;--output\&quot; is not valid. Allowed values: SD, text, or both\n&quot;</span><span class="sc">;</span>
1244   <span class="s">}</span>
1245   <span class="k">if</span> <span class="s">(</span><span class="i">$Options</span>{<span class="w">indelim</span>} !~ <span class="q">/^(comma|semicolon|tab)$/i</span><span class="s">)</span> <span class="s">{</span>
1246     <span class="k">die</span> <span class="q">&quot;Error: The value specified, $Options{indelim}, for option \&quot;--indelim\&quot; is not valid. Allowed values: comma, tab, or semicolon\n&quot;</span><span class="sc">;</span>
1247   <span class="s">}</span>
1248   <span class="k">if</span> <span class="s">(</span><span class="i">$Options</span>{<span class="w">outdelim</span>} !~ <span class="q">/^(comma|semicolon|tab)$/i</span><span class="s">)</span> <span class="s">{</span>
1249     <span class="k">die</span> <span class="q">&quot;Error: The value specified, $Options{outdelim}, for option \&quot;--outdelim\&quot; is not valid. Allowed values: comma, tab, or semicolon\n&quot;</span><span class="sc">;</span>
1250   <span class="s">}</span>
1251   <span class="k">if</span> <span class="s">(</span><span class="i">$Options</span>{<span class="w">quote</span>} !~ <span class="q">/^(yes|no)$/i</span><span class="s">)</span> <span class="s">{</span>
1252     <span class="k">die</span> <span class="q">&quot;Error: The value specified, $Options{quote}, for option \&quot;-q --quote\&quot; is not valid. Allowed values: yes or no\n&quot;</span><span class="sc">;</span>
1253   <span class="s">}</span>
1254   <span class="k">if</span> <span class="s">(</span><span class="i">$Options</span>{<span class="w">regexignorecase</span>} !~ <span class="q">/^(yes|no)$/i</span><span class="s">)</span> <span class="s">{</span>
1255     <span class="k">die</span> <span class="q">&quot;Error: The value specified, $Options{regexignorecase}, for option \&quot;--regexignorecase\&quot; is not valid. Allowed values: yes or no\n&quot;</span><span class="sc">;</span>
1256   <span class="s">}</span>
1257   <span class="k">if</span> <span class="s">(</span><span class="i">$Options</span>{<span class="w">strdatastring</span>} !~ <span class="q">/^(yes|no)$/i</span><span class="s">)</span> <span class="s">{</span>
1258     <span class="k">die</span> <span class="q">&quot;Error: The value specified, $Options{strdatastring}, for option \&quot;--StrDataString\&quot; is not valid. Allowed values: yes or no\n&quot;</span><span class="sc">;</span>
1259   <span class="s">}</span>
1260   <span class="k">if</span> <span class="s">(</span><span class="i">$Options</span>{<span class="w">strdatastringmode</span>} !~ <span class="q">/^(StrOnly|StrAndDataFields)$/i</span><span class="s">)</span> <span class="s">{</span>
1261     <span class="k">die</span> <span class="q">&quot;Error: The value specified, $Options{strdatastringmode}, for option \&quot;--StrDataStringMode\&quot; is not valid. Allowed values: StrOnly or StrAndDataFields\n&quot;</span><span class="sc">;</span>
1262   <span class="s">}</span>
1263 <span class="s">}</span>
1264 
<a name="EOF-"></a></pre>
<p>&nbsp;</p>
<br />
<center>
<img src="../../../images/h2o2.png">
</center>
</body>
</html>
